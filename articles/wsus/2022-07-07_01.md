---
title: WSUS の仕組み レポート編
date: 2022-07-07
tags:
  - WSUS
---

# WSUS の仕組み レポート編
みなさま、こんにちは。WSUS サポート チームです。

今回は、WSUSのレポートの仕組みについて、ご紹介していきたいと思います。  
WSUS ではクライアントから状態レポートが報告され、それをもとにクライアントの更新プログラムの適用状況などを把握することができますが、  
その仕組みの理解やレポートが報告されていないときなどのトラブルシューティングの際に、お役立ていただける情報となっていますので是非ご一読ください！  

# WSUS の仕組み   

WSUS にクライアントからレポートが送られるときの流れは以下の通りです。    
1. クライアントが次の処理を実施（更新プログラムの検出、ダウンロード、インストール）  
2. その結果をもとに状態レポートが WSUS へ送信される  
3. WSUSが状態レポートを受け取る  

解説  
1. クライアントが次の処理を実施（更新プログラムの検出、ダウンロード、インストール）  
各処理の流れは以下の通りです。

ⅰ. 更新プログラムの検出処理開始  
ⅱ. 更新プログラムの検出処理完了 ＞ 2 を実施  
ⅲ．ダウンロード処理開始  
ⅳ．ダウンロード処理完了 ＞ 2 を実施  
ⅴ．インストール処理開始  
ⅵ．インストール処理完了 ＞ 2 を実施  

2. 1.の結果をもとに状態レポートがクライアントからWSUSへ送信  
以下のフォルダにイベントを含むファイルが生成されます。  
作成されたファイルは、IISの ReportingWebService を介してWSUSデータベースへ送信されます。  
```
%windir%\SoftwareDistribution\EventCache.v2
```

3. WSUS が状態レポートを受け取る  
送信されたイベントファイルが WSUS データベースへ格納され、状態レポートとして WSUS で表示されます。  

状態レポートの見方については以下の記事をご参照ください。    
[WSUS のレポートに表示される「状態」の項目の説明](https://jpmem.github.io/blog/wsus/2017-09-04_02/)

# トラブルシュート方法  
状態レポートが WSUS にあがらないときに、まずご実施いただきたいトラブルシュート方法についてご紹介します。  
以下の手順に沿って、検出処理実行からイベントファイル作成及び送信の動作をご確認ください。

1-1.[設定]>[WindowsUpdate]>[更新プログラムのチェック]を実行し検出を完了させます。  
1-2.下記フォルダにイベントファイルが作成されたことを確認します。  
```
%windir%\SoftwareDistribution\EventCache.v2
```
1-3.以下のコマンドを実行します。  
```
wuauclt /reportnow
```
1-4. 1-2 で作成されたファイルがフォルダから消えていることを確認します。  

### 1-1 から 1-4 まで全てが確認できた場合    
ここまでの処理が実行されているにもかかわらず、WSUS 側で状態レポートが更新されないなどの事象が発生している場合には、
WSUS データベースへの書き込み処理の失敗なども疑われます為 の WSUS 及びクライアントのファイル送信時のログなども併せて確認する必要があります。  

### 1-4 にてイベントファイルが送信されず滞留してしまう場合  
Windows Update のクライアント情報のキャッシュをクリアすることで解消されることがありますので、以下の記事に記載の手順をご実施ください。   
[Windows Update クライアントの情報をクリアにする手順](https://jpwinsup.github.io/blog/2022/02/28/Setup/WU/WindowsUpdateAgent/WUClientInfo/)  

### 補足：状態レポート報告完了の確認方法
WSUS コンソールより対象端末の最後の状態レポートの日時列の情報を参照してください。  
WSUS コンソールを開き、 [コンピュータ] > 確認対象のコンピュータを選択
![](2022-07-07_01/2022-07-07_01_1.png)
