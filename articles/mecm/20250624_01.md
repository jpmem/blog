---
title: ConfigMgr の バックアップ と リカバリ
date: 2025-06-24
tags:
  - MECM
---

# ConfigMgr の バックアップ と リカバリ

こんにちは。Configuration Manager サポート チーム です。
本記事では、Configuration Manager (ConfigMgr) の バックアップ と リカバリ について出来るだけ分かりやすく解説します。お客様にてバックアップ設計を実施される際の参考になればと存じます。

詳細は下記 URL の公開 ドキュメント にもございますので、ご確認ください。

- Configuration Manager サイトをバックアップする  
  https://learn.microsoft.com/ja-jp/intune/configmgr/core/servers/manage/backup-and-recovery

- Configuration Manager サイトを回復する  
  https://learn.microsoft.com/ja-jp/intune/configmgr/core/servers/manage/recover-sites


# 用語の定義

本記事では、各用語を以下のように定義しますので、予めご確認くださいますようお願いいたします。

- バックアップの種類
  - システム バックアップ:
     あるシステムが持つ全てのデータを含むバックアップのこと。
  - 仮想マシン バックアップ: システムが仮想マシン上で稼働していた場合、その仮想マシンが動作するための設定ファイル、および所有する仮想ディスクの全てが含まれるバックアップのこと。
  - OS バックアップ: あるサーバーのデータのうち、OS データを含むドライブのバックアップのこと。便宜上、 WMI レポジトリや レジストリのバックアップはここに含まれる。
  - DB バックアップ: あるシステムが利用するデータベースのバックアップのこと。データ、および redo ログを含む。
  - アプリケーション バックアップ: あるシステムが提供するアプリケーションの実行バイナリやアプリケーションの動作に必要な設定ファイルのバックアップのこと。
  - ファイル バックアップ: あるサーバーのデータのうち、OS や DB、アプリケーション 以外のデータファイルバックアップのこと。
  - サイト バックアップ: ConfigMgr が独自に用意している、ConfigMgr のサイト回復に必要なファイル群をバックアップしたもの。
- 仮想マシン スナップショット: サーバーが仮想マシン上で稼働していた場合に、その仮想マシンのある時点での動作状態を復元可能なように一時保存したもの。 バックアップとは異なる。

# ConfigMgr が取り扱うデータ

ConfigMgr はご利用の階層設計により、取り扱っているデータの配置場所が異なります。
代表的なサイト ロールで取り扱っているデータは以下の通りです。

##  サイト サーバー
- Site Server Apps:  
  ConfigMgr サイト サーバー のアプリケーション 本体です。クライアント プログラムや各種ツール群も含まれます。また、各サイト システムのアプリケーション バイナリや、セットアップ プログラム、リストア プログラムなども含まれています。
- Inbox files  
  クライアントから収集したデータや、各サイト システムからのジョブ ファイルが一時的に格納されています。サイト データベースに反映され次第、各ジョブ ファイルは削除されます。
- Log files  
  サイト サーバーのログです。
- ContentLib  
  ConfigMgrで配布しているパッケージやアプリケーション、更新プログラムの展開パッケージなどが保持されているコンテンツ ライブラリ です。

## サイト データベース
- SQL Server:   
  データベース管理ソフトウェアです。
- CMDB:  
  ConfigMgr のデータベースです。クライアント情報、パッケージやアプリケーション、更新プログラムの構成情報、展開ポリシー情報など多くのデータが管理されています。データおよび変更履歴である redo ログの形式でデータが保持されています。
- SQL Srv Log file:  
  SQL Server のログファイルです。

## 管理ポイント
- MP App:  
  管理ポイントのアプリケーション コンポーネントです。CCM フレームワーク、クライアント通知サービス、IIS Webアプリケーション等を含みます。
- Outbox files:  
  管理ポイントがクライアントから収集したデータを一時保管しているフォルダです。サイト データベースへ反映されるか、サイト データベースの Inbox files に転送され次第、各ファイルは削除されます。
- Log files:  
  管理ポイントのアプリケーション ログ ファイルです。
- IIS Log Files (MP):  
  IIS Web アプリケーションとして提供される、IIS 上のエンドポイントとしてのログファイルです。アクセス ログ、エラー ログが含まれます。

## 配布ポイント
以下では、配布ポイント機能のみを持っている場合のデータを示しています。Pull 配布ポイントや、PXE サポート、Microsoft Connected Cache for ConfigMgr を有効にした場合は、データが追加されます。
- DP App:  
  配布ポイントのアプリケーション コンポーネントです。IIS Webアプリケーションが主体となります。
- Log files:  
  配布ポイントのアプリケーション ログ ファイルです。
- ContentLib:  
  ConfigMgrで配布しているパッケージやアプリケーション、更新プログラムの展開パッケージなどが保持されているコンテンツ ライブラリ です。サイト サーバーから配布されたものが含まれます。

## レポート サービス ポイント
- SRP App:  
  レポート サービス ポイントのアプリケーション コンポーネントです。便宜上、ConfigMgr の標準レポート ファイルはこちらに含まれます。
- Log files:  
  レポート サービス ポイントのアプリケーション ログ ファイルです。
- Custom Reports:  
  標準で用意されている, ConfigMgr のレポートの他にお客様が別途作成されたレポート ファイル群です。

## ソフトウェア更新ポイント
- SUP App:  
  ソフトウェア更新ポイントのアプリケーション コンポーネントです。WSUS との連携に使われるモジュールなどが含まれます。
- Log files:  
  ソフトウェア更新ポイントのアプリケーション ログ ファイルです。

## クラウド管理ゲートウェイ接続ポイント
- CMG-CP App:  
  クラウド管理ゲートウェイ接続ポイントのアプリケーション コンポーネントです。
- Log files:  
  クラウド管理ゲートウェイ接続ポイントのログ ファイルです。

## その他

サイト サーバーやサイト システムの役割とは別に生成される/必要とされるデータ群を以下に示します。

### レポート サービス ポイントに必要なコンポーネントとデータ

レポート サービス ポイントに必要なコンポーネントとデータを以下に示します。

- SQL Server Reporting Services:  
レポート サービス ポイントの前提サービスです。略称 SSRS.
- SSRS Log files:  
SQL Server Reporting Servicesのログ ファイルです。
- Report DB:
SQL Server Reporting Servicesのデータベースです。SQL Server 上に生成します。

### ソフトウェア更新ポイントに必要なコンポーネントとデータ

ソフトウェア更新ポイントの動作に必要なコンポーネントとデータを以下に示します。

- Windows Server Update Services (WSUS):  
  Windows Server Update Services です。イントラ ネット上の端末の更新プログラムの管理に使われます。ソフトウェア更新ポイントの前提コンポーネントです。
- SUSDB: 
  WSUSのデータベースです。
- WID or MSSQL:  
  SUSDBのデータベース管理ソフトウェアとして、Windows Internal Database (WID) もしくは SQL Server Database のアプリケーション コンポーネントが必要となります。

### その他

- Content Files:  
  アプリケーションやパッケージ、展開パッケージなど、コンテンツ ライブラリに取り込む前のファイル群です。サイト サーバーのローカルフォルダや、別サーバーの共有フォルダに置かれます。
- Internet Information Service (IIS):  
  Web サーバーです。管理ポイント、配布ポイントはクライアントとの通信に使うエンドポイントを IIS アプリケーションとして提供しています。ソフトウェア更新ポイントの前提となる WSUS も同様に IIS でエンドポイントを提供しています。
- IIS Log files:  
  IIS ログ ファイルです。クライアントから管理ポイント、配布ポイント、ソフトウェア更新ポイントへのアクセス ログや、エラー ログが含まれます。
- OS:
  ConfigMgr サイト サーバーやサイト システムが動作するためのWindows Server OSです。

# 構成別のデータ格納場所

下記では、よくある以下の二例の構成について、データの場所を図に示します。

## 例1: スタンドアロン サイト サーバー構成

開発 / ラボ 環境など、非常に少ない端末台数を管理されている際の構成です。

- プライマリ サイト サーバー 1台
  - 以下 サイト ロールが同居
    - サイト データベース 
    - 管理ポイント (MP)
    - 配布ポイント (DP)
    - ソフトウェア更新ポイント (SUP)
    - レポート サービス ポイント (SRP)
    - クラウド管理ゲートウェイ接続 ポイント (CMG-CP)

### データの格納場所

例1の場合のデータの格納場所は以下の図の通りです。

####  サイト サーバー
- Site Server Apps:  
  ```
  [ConfigMgr サイト サーバー インストール フォルダ]
  ※デフォルト: C:\Program Files\Microsoft Configuration Manager\
  ```

- Inbox files  
  ```
  [ConfigMgr サイト サーバー インストール フォルダ]\inboxes\
  ※デフォルト: C:\Program Files\Microsoft Configuration Manager\inboxes\
  ```

- Log files  
  ```
  [ConfigMgr サイト サーバー インストール フォルダ]\Logs\
  ※デフォルト: C:\Program Files\Microsoft Configuration Manager\Logs\
  ```

- ContentLib  
  ```
  \SCCMContentLib\
  ```
  ドライブは、ルート ドライブに ```NO_SMS_ON_DRIVE.SMS```の空ファイルが置かれていない場所が候補となります。

## サイト データベース
- SQL Server:   
  ```
  [SQL Server インストール フォルダ]
  ※デフォルト: C:\Program Files\Microsoft SQL Server\
  ```

- CMDB:  
  ```
  以下で確認可能: 
  ```

- SQL Srv Log file:  
  ```
  [SQL Server インストール フォルダ]\Log\
  ※デフォルト: C:\Program Files\Microsoft SQL Server\MSSQLXX.MSSQLSERVER\MSSQL\Log
  ```

## 管理ポイント
- MP App:  
  管理ポイントのアプリケーション コンポーネントです。CCM フレームワーク、クライアント通知サービス、IIS Webアプリケーション等を含みます。
- Outbox files:  
  管理ポイントがクライアントから収集したデータを一時保管しているフォルダです。サイト データベースへ反映されるか、サイト データベースの Inbox files に転送され次第、各ファイルは削除されます。
- Log files:  
  管理ポイントのアプリケーション ログ ファイルです。
- IIS Log Files (MP):  
  IIS Web アプリケーションとして提供される、IIS 上のエンドポイントとしてのログファイルです。アクセス ログ、エラー ログが含まれます。

## 配布ポイント
以下では、配布ポイント機能のみを持っている場合のデータを示しています。Pull 配布ポイントや、PXE サポート、Microsoft Connected Cache for ConfigMgr を有効にした場合は、データが追加されます。
- DP App:  
  配布ポイントのアプリケーション コンポーネントです。IIS Webアプリケーションが主体となります。
- Log files:  
  配布ポイントのアプリケーション ログ ファイルです。
- ContentLib:  
  ConfigMgrで配布しているパッケージやアプリケーション、更新プログラムの展開パッケージなどが保持されているコンテンツ ライブラリ です。サイト サーバーから配布されたものが含まれます。

## レポート サービス ポイント
- SRP App:  
  レポート サービス ポイントのアプリケーション コンポーネントです。便宜上、ConfigMgr の標準レポート ファイルはこちらに含まれます。
- Log files:  
  レポート サービス ポイントのアプリケーション ログ ファイルです。
- Custom Reports:  
  標準で用意されている, ConfigMgr のレポートの他にお客様が別途作成されたレポート ファイル群です。

## ソフトウェア更新ポイント
- SUP App:  
  ソフトウェア更新ポイントのアプリケーション コンポーネントです。WSUS との連携に使われるモジュールなどが含まれます。
- Log files:  
  ソフトウェア更新ポイントのアプリケーション ログ ファイルです。

## クラウド管理ゲートウェイ接続ポイント
- CMG-CP App:  
  クラウド管理ゲートウェイ接続ポイントのアプリケーション コンポーネントです。
- Log files:  
  クラウド管理ゲートウェイ接続ポイントのログ ファイルです。

## その他

サイト サーバーやサイト システムの役割とは別に生成される/必要とされるデータ群を以下に示します。

### レポート サービス ポイントに必要なコンポーネントとデータ

レポート サービス ポイントに必要なコンポーネントとデータを以下に示します。

- SQL Server Reporting Services:  
レポート サービス ポイントの前提サービスです。略称 SSRS.
- SSRS Log files:  
SQL Server Reporting Servicesのログ ファイルです。
- Report DB:
SQL Server Reporting Servicesのデータベースです。SQL Server 上に生成します。

### ソフトウェア更新ポイントに必要なコンポーネントとデータ

ソフトウェア更新ポイントの動作に必要なコンポーネントとデータを以下に示します。

- Windows Server Update Services (WSUS):  
  Windows Server Update Services です。イントラ ネット上の端末の更新プログラムの管理に使われます。ソフトウェア更新ポイントの前提コンポーネントです。
- SUSDB: 
  WSUSのデータベースです。
- WID or MSSQL:  
  SUSDBのデータベース管理ソフトウェアとして、Windows Internal Database (WID) もしくは SQL Server Database のアプリケーション コンポーネントが必要となります。

### その他

- Content Files:  
  アプリケーションやパッケージ、展開パッケージなど、コンテンツ ライブラリに取り込む前のファイル群です。サイト サーバーのローカルフォルダや、別サーバーの共有フォルダに置かれます。
- Internet Information Service (IIS):  
  Web サーバーです。管理ポイント、配布ポイントはクライアントとの通信に使うエンドポイントを IIS アプリケーションとして提供しています。ソフトウェア更新ポイントの前提となる WSUS も同様に IIS でエンドポイントを提供しています。
- IIS Log files:  
  IIS ログ ファイルです。クライアントから管理ポイント、配布ポイント、ソフトウェア更新ポイントへのアクセス ログや、エラー ログが含まれます。
- OS:
  ConfigMgr サイト サーバーやサイト システムが動作するためのWindows Server OSです。


## 例2: MP / DP / CMG-CP 分離構成

本番環境にて一定の端末台数を管理されている際の構成です。

- プライマリ サイト サーバー 1台
  - 以下サイト ロールが同居
    - サイト データベース     
    - ソフトウェア更新ポイント (SUP)
    - レポート サービス ポイント (SRP)
- リモート管理ポイント 1台
- リモート配布ポイント 1台
- リモート クラウド管理ゲートウェイ接続ポイント 1台    



# ConfigMgr が用意している サイト バックアップについて

# その他のバックアップ形態について

# サイト バックアップからの回復について

# ConfigMgr 中央管理サイト構成で利用できる 他サイトからのデータベース復帰について
