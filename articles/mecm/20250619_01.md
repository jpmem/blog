---
title: クライアントがコンテンツのダウンロードを行う際の帯域の制限
date: 2025-06-19
tags:
  - MECM
---
# クライアントがコンテンツのダウンロードを行う際の帯域の制限
みなさま、こんにちは。Configuration Manager サポート チームです。

今回は、Configuration Manager クライアントがコンテンツのダウンロードを行う際に使用するネットワーク帯域の制限にまつわる話をご紹介します。基本的に Configuration Manager クライアントがコンテンツのダウンロードを行う際は BITS を使用しますが、BITS が使用するネットワーク帯域はクライアント設定で制限することが可能です。そのため、使用可能な帯域が限られている環境では BITS の帯域を制限されているお客様が多いと思いますが、予期せぬ結果にならないように幾つか抑えておくべきポイントがあります。


## フォアグラウンドのダウンロードは帯域を制限できません
Configuration Manager クライアントが生成する BITS ジョブは、フォアグラウンドとバックグラウンドの 2 種類が存在します。そして、制限できるのはバックグラウンドのみです。具体的には、以下の表 1 において、バックグラウンドと記載されているシナリオが該当します。

<table>
  <caption>表 1: BITS の転送モード</caption>
  <thead>
    <tr>
      <th>コンテンツの種類</th>
      <th>ソフトウェア センターからインストールする場合</th>
      <th>自動でインストールする場合(必須の展開)
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>アプリケーション</td>
      <td>フォアグラウンド</td>
      <td>バックグラウンド</td>
    </tr>
    <tr>
      <td>パッケージ</td>
      <td>バックグラウンド</td>
      <td>バックグラウンド</td>
    </tr>
    <tr>
      <td>ソフトウェア更新プログラム</td>
      <td>フォアグラウンド</td>
      <td>バックグラウンド</td>
  </tbody>
</table>

ソフトウェア更新プログラムやアプリケーションに関しては、ソフトウェア センターを使用し [インストール] をクリックした場合はバックグラウンドではなくフォアグラウンドでダウンロードを行うため、帯域制限の設定は無視されます。パッケージは常にバックグラウンド モードでダウンロードが行われます。

つまり、コンテンツの種類を問わずダウンロードで使用される帯域を制限したい場合は、ソフトウェア センターを使用しない想定とし、[利用可能] ではなく [必須] で展開する必要があります。ただし、必須で展開を行っても、何らかの理由で展開の「インストールの期限」に到達した時点でダウンロードやインストールが完了していない場合は、ソフトウェア センターで [インストール] を行うことが可能になります。その状態で [インストール] を行うと、まだコンテンツのダウンロードが完了していない場合はフォアグラウンドでダウンロードを行うことになります。


## コンテンツのダウンロード時は BITS を使用します
上記の動作は理解されていても、「帯域が制限される場合は BITS を使用し、帯域が制限されない場合は BITS を使用していない」と解釈されている場面にしばしば遭遇しますが、それは誤りです。上記の通り、いずれも BITS は使用するがフォアグラウンドかバックグラウンドかの違い、ということになります。

なお、当記事では詳細は割愛しますが、UUP 形式の更新プログラムのダウンロードを行う際は、OS の配信の最適化(DO)エージェントがダウンロード処理に関与します。しかし、その場合は BITS の代わりに DO を使用するのではなく、Configuration Manager クライアントが listen する localhost:8005 に対して DO エージェントが  HTTP でコンテンツを要求し、そのリクエストに基づき Configuration Manager クライアントが外部から BITS でコンテンツのダウンロードを行うことになります。DO の構成によっては localhost:8005 に対するコンテンツの要求の前に DO の仕組みでダウンロードが完了するシナリオも存在するため厳密には全てが BITS ではありませんが、Configuration Manager クライアント自身がダウンロードを行う際は BITS を使用する、ということになります。


## 時間帯以外の条件に応じて帯域を制限することは不可です
BITS は Configuration Manager ではなく OS の機能であり、各アプリケーションが共有する仕組みです。そのため、帯域の制限を行う場合は、その OS 上で動作する全ての BITS ジョブが影響を受けます。クライアント設定で帯域を制限する場合は、実際には [BITS バックグラウンド転送の最大ネットワーク帯域幅を制限する] がローカル グループ ポリシーとして設定されます。いずれも特定の時間帯とそれ以外の時間帯の最大転送速度を設定可能ですが、例えばアプリケーション毎に動作を変えたり、インターネットに接続時とそれ以外で動作を変える等の条件は設定できません。

ご参考: https://learn.microsoft.com/ja-jp/intune/configmgr/core/clients/deploy/about-client-settings#limit-the-maximum-network-bandwidth-for-bits-background-transfers

なお、クライアント設定ではなく Active Directory からグループ ポリシーとして [BITS バックグラウンド転送の最大ネットワーク帯域幅を制限する] を設定すると、クライアント設定と競合することになります。そのため、Configuration Manager クライアントが動作する環境では、クライアント設定のみで制御ください。

