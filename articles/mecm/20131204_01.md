---
title: Configuration Manager におけるワークグループ環境でのクライアントご利用手順について
date: 2013-12-04
tags:
  - MECM
---

こんにちは。Configuration Manager Support Team です。

今回は、Configuration Manager (以下、ConfigMgr) クライアントをワークグループ環境にてご利用いただく場合に、ご注意いただきたいポイントについてご案内します。

ConfigMgr では、ワークグループ環境の ConfigMgr クライアントを管理することをサポートしています。  
しかしながら、ワークグループ環境は、 ConfigMgr サイト サーバーと同じドメインに参加している環境とは異なり、Active Directory の情報が参照できない、またドメイン環境にあるリソースへアクセスすることができないといった制限があります。  
ここでは、ワークグループ環境にて ConfigMgr クライアントをご利用いただく際に必要となる以下の代表的な注意事項をご案内します。  

**A. ConfigMgr クライアントのインストール**  
**B. ConfigMgr クライアントの手動承認**  
**C. ネットワーク アクセス アカウントの構成**  

詳細な内容は以下の通りです。  

## A. ConfigMgr クライアントのインストール
ワークグループ 環境にある端末へ、ConfigMgr クライアントをインストールいただく際に、クライアントが最初に通信する管理ポイントを指定していただく必要があります。
そのため、ConfigMgr クライアント エージェントをインストールする際には、以下の SMSMP オプションを用いて管理ポイントを指定してください。

クライアントに ccmsetup.exe のみを予め配布しておいて、インストール ソース ファイルを配布ポイントから取得する場合は、以下のコマンドを実行します。

例 : 接続先管理ポイントを mp01.contoso.com, サイトコードを P01 とする場合、コマンド プロンプトを管理者権限で起動し、以下のコマンドを実行します。
```txt
CCMSetup.exe /mp:mp01.contoso.com SMSMP=mp01.contoso.com SMSSITECODE=P01
```

参考情報  
Title: Configuration Managerのクライアント インストール パラメーターとプロパティについて  
URL: https://learn.microsoft.com/ja-jp/mem/configmgr/core/clients/deploy/about-client-installation-properties  

**補足情報**  
ccmsetup.exe を実行する際に、 `\\SERVER\SMS_PRI\Client\ccmsetup.exe` のように、共有フォルダーに配置してある ccmsetup.exe を実行する場合は、`/noservice` オプションを付与する必要があります。  
既定では、`/service` で実行されるため、ccmsetup.exe はローカル システム アカウント (SYSTEM) で実行されます。  
しかしながら、ワークグループ コンピューターにおいて、ccmsetup.exe が SYSTEM で実行されると、共有フォルダーからインストール モジュールをダウンロードする際に、認証が通らず失敗します。  
`/noservice` で実行することで、ユーザー アカウントで実行されますので、共有フォルダーにアクセスできるアカウントであれば、共有フォルダーからのインストール モジュールのダウンロードが成功し、インストールが進みます。
なお、プライマリ サイトから Client フォルダーの内容をすべてワークグループ コンピューターにコピーして、コピーした Client フォルダー配下の ccmsetup.exe を実行する場合は、ローカルのファイルを使用するため、`/noservice` を付与しなくても問題ありません。

## B. ConfigMgr クライアントの手動承認
ConfigMgr クライアントが、ConfigMgr サイト サーバーのリソース（配布ポイント、ソフトウェア更新ポイントなど）にアクセスする場合、TCP/IP レベルでの認証処理が行われます。

ドメイン環境のクライアントについては、既定では自動的に承認されますが、ワークグループ環境のクライアントについては、手動で承認する必要があります。  
※ 既定では、[信頼されたドメインのコンピュータを自動的に承認する] が有効になっています。この設定は、[管理] - [概要] - [サイトの構成] - [サイト] を右クリックし、[階層設定] をクリックすることでご確認いただけます。

手動承認手順は以下の通りです。

### 手順
1. Configuration Manager コンソールを起動し、[資産とコンプライアンス] - [デバイス] を開きます。
2. 右ペインに表示された対象のワークグループ コンピューターを右クリックして、[承認] を実施してください。

参考情報  
Title: 承認する  
URL: https://learn.microsoft.com/ja-jp/mem/configmgr/core/clients/manage/manage-clients#approve  

## C. ネットワーク アクセス アカウントの構成
ご利用のプライマリ サイトが拡張 HTTP または HTTPS 構成の場合、ネットワーク アクセス アカウントの構成は不要です。

拡張 HTTP または HTTPS 構成でない場合には、ネットワーク アクセス アカウントを構成する必要があります。
ワークグループ 環境にあるクライアントは、ネットワーク アクセス アカウントを使用して、ドメイン環境にある配布ポイント上のリソースにアクセスします。
そのため、ネットワーク アクセス アカウントが構成されていない場合、クライアントは配布ポイント上のコンテンツにアクセスすることができず、認証エラーが発生します。

構成手順は以下の通りです。

### 手順
1. Configuration Manager コンソールを起動し、[管理] - [サイトの構成] - [サイト] を開きます。
2. [サイト コンポーネントの構成] -[ソフトウェアの配布] を選択します。
3. [ネットワーク アクセス アカウント]タブを開き、[ネットワークの場所にアクセスするアカウントを指定する] にて任意のドメイン アカウントを指定します。

参考情報  
Title: ネットワーク アクセス アカウントの構成  
URL: https://learn.microsoft.com/ja-jp/mem/configmgr/core/plan-design/hierarchy/accounts#network-access-account  

コミュニティにおけるマイクロソフト社員による発言やコメントは、マイクロソフトの正式な見解またはコメントではありません。
