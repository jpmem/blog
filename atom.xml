<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Japan Microsoft Configuration Manager Support Team Blog</title>
  
  <subtitle>日本マイクロソフト Microsoft Configuration Manager / Windows 365 / WSUS サポート チームのブログです。</subtitle>
  <link href="https://jpmem.github.io/blog/atom.xml" rel="self"/>
  
  <link href="https://jpmem.github.io/blog/"/>
  <updated>2023-11-07T08:27:44.800Z</updated>
  <id>https://jpmem.github.io/blog/</id>
  
  <author>
    <name>Japan Microsoft Configuration Manager Support Team</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Windows 11 以降のデバイスにおいて、Windows Defender の定義ファイルや OS の更新プログラムが配布されない事象について</title>
    <link href="https://jpmem.github.io/blog/mecm/20231102_02/"/>
    <id>https://jpmem.github.io/blog/mecm/20231102_02/</id>
    <published>2023-11-01T15:00:00.000Z</published>
    <updated>2023-11-07T08:27:44.800Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。Configuration Manager サポート チームです。</p><p>特定の条件下にある Windows 11 以降のデバイスにおいて、Windows Defender の定義ファイルや OS の更新プログラムが配布されない事象についてご案内いたします。</p><h1 id="事象について"><a href="#事象について" class="headerlink" title="事象について"></a>事象について</h1><p>Windows 11 以降のデバイスにおいて、Windows Defender の定義ファイルや OS の更新プログラムが配布されないことがございます。<br>また、本事象については <a href="https://learn.microsoft.com/ja-jp/mem/configmgr/hotfix/2303/25073607">Microsoft Configuration Manager バージョン 2303 のクライアント更新プログラム</a> の公開情報でもご案内しております。</p><h1 id="発生条件について"><a href="#発生条件について" class="headerlink" title="発生条件について"></a>発生条件について</h1><ol><li><p>Windows 11 以降のデバイスである。  </p></li><li><p>2023 年の 7 月以降の累積更新プログラムが適用されている。    </p></li><li><p>以下の何れかの Windows Update に関するグループポリシー (ローカルグループポリシー) が設定されている。    </p><p>  ・[コンピューターの構成] -&gt; [管理用テンプレート] -&gt; [Windows コンポーネント] -&gt; [Windows Update] -&gt; [Windows Update から提供される更新プログラムの管理] -&gt; [品質更新プログラムをいつ受信するかを選択してください]<br>  ※構成されるレジストリは HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate : DeferQualityUpdatesPeriodInDays となります。</p><p> ・[コンピューターの構成] -&gt; [管理用テンプレート] -&gt; [Windows コンポーネント] -&gt; [Windows Update] -&gt; [Windows Update から提供される更新プログラムの管理] -&gt; [プレビュービルドや機能更新プログラムをいつ受信するかを選択してください]<br>  ※構成されるレジストリは HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate : DeferFeatureUpdatesPeriodInDays となります。</p></li></ol><h1 id="原因について"><a href="#原因について" class="headerlink" title="原因について"></a>原因について</h1><p>発生条件に当てはまるデバイスについては、Configuration Manager を利用して Windows 更新プログラムを取得するのではなく、Windows Update 経由で Windows 更新プログラムを取得する動作に変更されます。<br>これはデュアルスキャンと呼称され、Configuration Manager から Windows Defender の定義ファイルや OS の更新プログラムが配布されなくなります。<br>Configuration Manager クライアントは、既定でこのデュアル スキャンを抑止するレジストリをセットしますが、Windows 11 においては、抑止するための以下のレジストリが正しくセットされていないために、意図せずデュアルスキャンが発生します。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate\AU</span><br><span class="line">UseUpdateClassPolicySource</span><br></pre></td></tr></table></figure><h1 id="対処について"><a href="#対処について" class="headerlink" title="対処について"></a>対処について</h1><p>以下の 1 ～ 3 のいずれかの対処を行うことで、本事象は解消します。</p><h2 id="1．Configuration-Manager-Version-2303-に-“Configuration-Manager-2303-修正プログラム-KB25506239-”-の修正プログラムをインストールする、または-2309-にアップグレードする。"><a href="#1．Configuration-Manager-Version-2303-に-“Configuration-Manager-2303-修正プログラム-KB25506239-”-の修正プログラムをインストールする、または-2309-にアップグレードする。" class="headerlink" title="1．Configuration Manager Version 2303 に “Configuration Manager 2303 修正プログラム (KB25506239)” の修正プログラムをインストールする、または 2309 にアップグレードする。"></a>1．Configuration Manager Version 2303 に “Configuration Manager 2303 修正プログラム (KB25506239)” の修正プログラムをインストールする、または 2309 にアップグレードする。</h2><p>Configuration Manager 2303 修正プログラム (KB25506239) および、Configuration Manager 2309 にはデュアルスキャンの動作を抑制するためのレジストリである UseUpdateClassPolicySource を自動で構成するための修正がされております。<br>そのため、サーバーを本バージョンにアップグレードした後、問題のクライアント端末にインストールされている Configuration Manager クライアントをアップグレードしてください。</p><p>修正プログラムのインポート方法については<a href="https://learn.microsoft.com/ja-jp/mem/configmgr/hotfix/2303/25073607#update-information-for-microsoft--configuration-manager">こちら</a>をご確認ください。</p><h2 id="2．1-の対処ができず、以下のグループポリシー-ローカルグループポリシー-が必要ない場合には未構成とし構成されないようにする。"><a href="#2．1-の対処ができず、以下のグループポリシー-ローカルグループポリシー-が必要ない場合には未構成とし構成されないようにする。" class="headerlink" title="2．1 の対処ができず、以下のグループポリシー (ローカルグループポリシー) が必要ない場合には未構成とし構成されないようにする。"></a>2．1 の対処ができず、以下のグループポリシー (ローカルグループポリシー) が必要ない場合には未構成とし構成されないようにする。</h2><p>. [コンピューターの構成] -&gt; [管理用テンプレート] -&gt; [Windows コンポーネント] -&gt; [Windows Update] -&gt; [Windows Update から提供される更新プログラムの管理] -&gt; [品質更新プログラムをいつ受信するかを選択してください]   </p><p>直接レジストリに設定をしている場合には以下を削除ください。<br>HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate : DeferQualityUpdatesPeriodInDays</p><p>・[コンピューターの構成] -&gt; [管理用テンプレート] -&gt; [Windows コンポーネント] -&gt; [Windows Update] -&gt; [Windows Update から提供される更新プログラムの管理] -&gt; [プレビュービルドや機能更新プログラムをいつ受信するかを選択してください]  </p><p>直接レジストリに設定をしている場合には以下を削除ください。<br>HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate : DeferFeatureUpdatesPeriodInDays</p><h2 id="3．1-および-2-の対処ができない場合にはデュアルスキャンを回避するためのレジストリを追加する。"><a href="#3．1-および-2-の対処ができない場合にはデュアルスキャンを回避するためのレジストリを追加する。" class="headerlink" title="3．1 および 2 の対処ができない場合にはデュアルスキャンを回避するためのレジストリを追加する。"></a>3．1 および 2 の対処ができない場合にはデュアルスキャンを回避するためのレジストリを追加する。</h2><p>UseUpdateClassPolicySource を構成することにより、デュアルスキャンの動作を抑制することが可能です。本レジストリを構成した時の影響は特にございません。   </p><p>HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate\AU<br>値の名前：UseUpdateClassPolicySource<br>値のデータ：1<br>値の種類：REG_DWORD  </p><p>Configuration Manager を利用してレジストリを構成する手順については、<a href="https://jpmem.github.io/blog/mecm/20230307_01/">コンプライアンス機能で特定レジストリ値をセットする方法</a>を参照ください。<br>なお、Configuration Manager 2303 修正プログラムの適用、または Configuration Manager 2309 にアップグレードして本事象を解消した後は、本構成基準の展開は無効または削除ください。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。Configuration Manager サポート チームです。&lt;/p&gt;
&lt;p&gt;特定の条件下にある Windows 11 以降のデバイスにおいて、Windows Defender の定義ファイルや OS の更新プログラムが配布されない事象についてご案</summary>
      
    
    
    
    
    <category term="MECM" scheme="https://jpmem.github.io/blog/tags/MECM/"/>
    
  </entry>
  
  <entry>
    <title>Microsoft Configuration Manager 自習書シリーズ 2 Microsoft Configuration Manager FAQ よりライセンスについての解説</title>
    <link href="https://jpmem.github.io/blog/mecm/20230928_01/"/>
    <id>https://jpmem.github.io/blog/mecm/20230928_01/</id>
    <published>2023-09-27T15:00:00.000Z</published>
    <updated>2023-11-07T08:27:44.800Z</updated>
    
    <content type="html"><![CDATA[<p>皆様、Microsoft Configuration Manager サポート チームの箱木です。</p><p>今回は <a href="https://learn.microsoft.com/ja-jp/mem/configmgr/core/understand/configuration-manager-faq">Microsoft Configuration Manager FAQ</a> についてライセンス部分の詳細をご案内します。</p><p>なお技術サポートではお客様の契約内容を確認することができませんので、ライセンスについての消費概念や購入方法などの詳細なご質問については弊社担当営業もしくは契約担当者へお問い合わせいただくようお願いいたします。</p><p>ライセンス観点で特にお問合せをいただく内容についてご説明いたします。</p><h1 id="管理するためのサーバー（管理ポイントやソフトウェア更新ポイントなど）側にライセンスは必要ですか？"><a href="#管理するためのサーバー（管理ポイントやソフトウェア更新ポイントなど）側にライセンスは必要ですか？" class="headerlink" title="管理するためのサーバー（管理ポイントやソフトウェア更新ポイントなど）側にライセンスは必要ですか？"></a>管理するためのサーバー（管理ポイントやソフトウェア更新ポイントなど）側にライセンスは必要ですか？</h1><p>不要です。ConfigMgr は管理対象のクライアントもしくはユーザー数、OSE 数でライセンスを購入いただく必要がありますが、管理インフラストラクチャ側にはライセンスは不要です。<br>サイト データベースを構成するための SQL Server ライセンスについてもクライアント管理ライセンスに含まれます。<br>ただしこの SQL Server のライセンスは、ConfigMgr のサイト データベースとしてのみ利用いただけますため、外部連携用のアプリケーションとして SQL Server を使う場合にはその SQL インスタンスごとに別途ライセンスが必要となります。</p><h1 id="プライマリ-サイトや中央管理サイトのインストール時に求められるライセンス-キーはどこから入手できますか？"><a href="#プライマリ-サイトや中央管理サイトのインストール時に求められるライセンス-キーはどこから入手できますか？" class="headerlink" title="プライマリ サイトや中央管理サイトのインストール時に求められるライセンス キーはどこから入手できますか？"></a>プライマリ サイトや中央管理サイトのインストール時に求められるライセンス キーはどこから入手できますか？</h1><p>従来のボリューム ライセンスで契約されている場合は ConfgMgr および SQL Server ライセンスを VLSC <a href="https://www.microsoft.com/licensing/servicecenter/default.aspx">ボリューム ライセンス サービス センター</a> より入手いただけます。<br>しかしながら、最近は Intune との共同管理目的で導入されるため EMS や M365 ライセンスを保持されている状態からの ConfigMgr のインストールを始められる方が多い傾向です。</p><p>この場合、ライセンス キーは VLSC ではなくライセンスを購入されたクラウド ソリューション プロバイダー (CSP) パートナーから入手いただく必要があります。</p><p>またクラウド ソリューション プロバイダー (CSP)自身がお客様に提供するためのライセンス キーを入手する場合は技術サポートではなく、<a href="https://partner.microsoft.com/ja-JP/support/?stage=1">Microsoft パートナー センター</a> にて ID 4033838 のライセンス発行を依頼してください。</p><p>詳細については <a href="https://learn.microsoft.com/ja-jp/mem/configmgr/core/understand/product-and-licensing-faq">Configuration Manager ブランチとライセンスについてよく寄せられる質問</a> もご参照ください。</p><p>上記リンクのポイントについて抜粋します。</p><h1 id="Microsoft-Intune-製品ファミリの共同管理のライセンスに関する変更点"><a href="#Microsoft-Intune-製品ファミリの共同管理のライセンスに関する変更点" class="headerlink" title="Microsoft Intune 製品ファミリの共同管理のライセンスに関する変更点"></a>Microsoft Intune 製品ファミリの共同管理のライセンスに関する変更点</h1><blockquote><p>以前に System Center Configuration Manager に対して持っていたライセンスは、引き続き Microsoft Configuration Managerに適用されます。 新しいサイトをインストールする場合は、既存のプロダクト キーを使用してください。</p></blockquote><p>上記の通りすでに保有しているクライアント管理用のライセンスは新規環境でも再利用することができます。<br>サイト自体を新規インストールする場合には VLSC などから旧環境構築時に利用したプロダクト キーを入手いただいて利用ください。</p><p>次回は Configuration Manager のシステム設計についてご紹介する予定です。</p><h1 id="免責事項"><a href="#免責事項" class="headerlink" title="免責事項"></a>免責事項</h1><p>下記内容は 2023/9/1 時点での内容についての記載となっております。<br>今後内容が更新されることもございますので、最新情報は以下の公開情報をご確認ください。<br><a href="https://learn.microsoft.com/ja-jp/mem/configmgr/core/understand/product-and-licensing-faq">Configuration Manager ブランチとライセンスについてよく寄せられる質問</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;皆様、Microsoft Configuration Manager サポート チームの箱木です。&lt;/p&gt;
&lt;p&gt;今回は &lt;a href=&quot;https://learn.microsoft.com/ja-jp/mem/configmgr/core/understand/con</summary>
      
    
    
    
    
    <category term="MECM" scheme="https://jpmem.github.io/blog/tags/MECM/"/>
    
    <category term="自習書シリーズ" scheme="https://jpmem.github.io/blog/tags/%E8%87%AA%E7%BF%92%E6%9B%B8%E3%82%B7%E3%83%AA%E3%83%BC%E3%82%BA/"/>
    
  </entry>
  
  <entry>
    <title>suffix が cloudapp.net な CMG の仮想マシンスケールセットへの移行について</title>
    <link href="https://jpmem.github.io/blog/mecm/20230816_01/"/>
    <id>https://jpmem.github.io/blog/mecm/20230816_01/</id>
    <published>2023-08-15T15:00:00.000Z</published>
    <updated>2023-11-07T08:27:44.800Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。Configuration Manager サポート チームです。本日は、 Microsoft Configuration Manager (ConfigMgr) において、suffix が cloudapp.net である、クラウド サービス(クラシック) ベースのクラウド管理ゲートウェイ (CMG) を仮想マシンスケールセット （VMSS) の CMG に移行する方法についてご案内させて頂きます。</p><p>以前も下記記事でご案内させて頂いている通り、クライアントからアクセスする際に使われる URL (サービス名) が 展開名と同じ、 [ホスト名].cloudapp.net の CMG については VMSS の CMG への変換が利用できません。それは、VMSS への変換に伴い、展開名の URL の形式が [ホスト名].[リージョン名].cloudapp.azure.com に変わりますが、その変更をクライアント側に伝える手段が無いためです。DNS サーバーに CNAME レコードにより、お客様独自の サービス名を、[ホスト名].cloudapp.net の エイリアスとして登録されていたお客様であれば、CNAME レコードのエイリアスを変更するだけで対処が出来るのですが、それが使えないため、 VMSS 版 CMG への変換をご提供していません。</p><p>仮想マシン スケールセットのクラウド管理ゲートウェイについて<br><a href="https://jpmem.github.io/blog/mecm/20211212_01/">https://jpmem.github.io/blog/mecm/20211212_01/</a>  </p><p>そのため、サービス名を [ホスト名].cloudapp.net として設定した CMG をお使いのお客様は、VMSS 版 CMG への移行に当たって、変換ではなく、CMG の再構築を実施頂く必要がございます。</p><p>なお、上記記事でもご案内の通り、 MECM CB 2203 以降、クラウドサービス (クラシック) 版の CMG のデプロイは利用できなくなっております。 MECM CB 2203 へアップグレードする際の前提条件チェックでも警告されますが、アップグレード後も構築済みのクラウドサービス (クラシック)のご利用は可能なものの、一度でも削除すると、再デプロイできなくなるため、出来る限り早く VMSS 版の CMG への移行を推奨しております。</p><h2 id="VMSS-版-CMG-への移行にあたっての課題"><a href="#VMSS-版-CMG-への移行にあたっての課題" class="headerlink" title="VMSS 版 CMG への移行にあたっての課題"></a>VMSS 版 CMG への移行にあたっての課題</h2><p>上記でも触れたとおり、VMSS 版 CMG の利用により クライアントが CMG に繋がる際に利用する FQDN が変わるため、その変更をクライアントに伝える手段が必要となります。インターネットとイントラネット ( VPN 接続を含む)を行き来するようなご利用をされている端末であれば、イントラネットに接続した際に 新しい URL をクライアントに伝えることが出来ますが、インターネット経由でしか繋げないクライアントの場合、新しい URL が分からないため、二度と ConfgMgr へ接続出来なくなるといった課題が生じます。</p><p>また、新規構築した VMSS 版の CMG では、もちろん、移行前の CMG で配布していたコンテンツが引き継がれていないため、移行前の CMG で配布していた コンテンツ を アップロード する必要が出てきます。ConfigMgr CB 2211 以降では、<a href="https://learn.microsoft.com/ja-jp/mem/configmgr/core/servers/deploy/configure/deploy-and-manage-content#start-cmdistributionpointmigration">Start-CMDistributionPointMigration コマンドレット</a> が利用可能になりました。本記事ではこちらの コマンドレット を利用しますが、ConfigMgr CB 2207 以前の環境では利用出来ないので、旧 CMG の プロパティ から配布コンテンツ の リスト をスクリーンショット等で採取しておき、 手動で1つ1つ プライマリ サイト サーバー から配布する必要がございます。</p><h2 id="上記課題に対する対策"><a href="#上記課題に対する対策" class="headerlink" title="上記課題に対する対策"></a>上記課題に対する対策</h2><p>上記、二つの課題に対応するため、以下の対策を実施します。</p><ol><li>クラウド サービス(クラシック)版と VMSS 版 CMG を、VMSS 版 CMG の URL がクライアントに伝わるまで、並行稼働する。クライアントに伝わったかどうかはスクリプト機能を使って収集する。電源断等でスクリプトが伝わったかどうか不明なクライアントに対しては手動で設定変更させる。</li><li>Start-CMDistributionMigration コマンドレットを使う。</li></ol><h3 id="必要なコスト"><a href="#必要なコスト" class="headerlink" title="必要なコスト"></a>必要なコスト</h3><p>上記対応策では、二つの CMG を並行稼働させるため、並行稼働期間中、クラウド管理ゲートウェイのコストが約 2 倍となります。また、それぞれの CMG からの通信を中継するため、クラウド管理ゲートウェイ接続ポイント (CMG-CP) が動作するサーバーを追加で用意する必要がございます。（2 個の CMG からの通信を 1 つの CMG-CP では中継できません。それぞれの CMG 用の CMG-CP を用意する必要がございます)</p><h3 id="実施手順"><a href="#実施手順" class="headerlink" title="実施手順"></a>実施手順</h3><ol><li><p>VMSS 版 CMG とその通信を中継する CMG-CP を作成します。以下でご案内している手順をご参考にしていただければと存じます。<br>クラウド管理ゲートウェイ (CMG) の構築手順例<br><a href="https://jpmem.github.io/blog/mecm/20220501_01/">https://jpmem.github.io/blog/mecm/20220501_01/</a>  </p></li><li><p>[ConfigMgrコンソール] - 画面左上の下▼ボタンをクリック - [Windows PowerShell で接続する]をクリックします。<br><img src="/blog/mecm/20230816_01/20230816_01_03.png"></p></li><li><p>Start-CMDistributionMigration コマンドレットで以下を実行します。</p></li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Start-CMDistributionPointMigration -SourceDistributionPointName [旧クラウド管理ゲートウェイのFQDN] -DestinationDistributionPointName [新クラウド管理ゲートウェイのFQDN]</span><br></pre></td></tr></table></figure><ol start="4"><li>実行後、以下を実行し複製状況を確認します。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Get-CMDistributionPointMigrationContentStatus -SourceDistributionPointName [旧クラウド管理ゲートウェイのFQDN] -DestinationDistributionPointName [新クラウド管理ゲートウェイのFQDN]</span><br></pre></td></tr></table></figure></li></ol><p>実行中は以下のように進行状態が表示されます。<br><img src="/blog/mecm/20230816_01/20230816_01_01.png"></p><p>実行が完了すると何も表示されなくなります。<br><img src="/blog/mecm/20230816_01/20230816_01_02.png"></p><ol start="5"><li>スクリプト機能を使って、以下のスクリプトにより新規に作成した VMSS 版 CMG の情報がクライアント側に伝わっているかを定期的に確認します。以下のスクリプトを実行すると、クライアントに伝わっている CMG の FQDN が ;(セミコロン) を区切り文字として取得可能です。</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$RegPath = &quot;HKLM:\SOFTWARE\Microsoft\CCM\&quot;</span><br><span class="line">$RegKey  = &quot;CMGFQDNs&quot;</span><br><span class="line"></span><br><span class="line">$cmgfqdns = Get-ItemPropertyValue $RegPath -Name $RegKey</span><br><span class="line"></span><br><span class="line">if($null -ne $cmgfqdns)&#123;</span><br><span class="line">    Write-Host $cmgfqdns</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    Write-Host &quot;No CMG&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>スクリプト機能のご紹介<br><a href="https://jpmem.github.io/blog/mecm/20211025_01/">https://jpmem.github.io/blog/mecm/20211025_01/</a>  </p><ol start="6"><li>クライアント側に十分に VMSS 版 CMG の情報が伝わったら、クラウド サービス(クラシック)側の CMG を削除します。</li><li>電源断等で FQDN 情報が伝わらなかったクライアントに対しては別途、イントラ内管理ポイントに接続させるか、ccmsetup による ConfigMgr クライアント再インストールで対応します。ccmsetup で VMSS 版 CMG の FQDN を設定するには、 CCMHOSTNAME オプションを使用します。以下、コマンドの例です。</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ccmsetup.exe /NoCRLCheck /mp:[CMGのFQDN ]SMSMP=[イントラの管理ポイント] CCMHOSTNAME=[CMGのFQDN] SMSSITECODE=[サイトコード]</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。Configuration Manager サポート チームです。本日は、 Microsoft Configuration Manager (ConfigMgr) において、suffix が cloudapp.net である、クラウド サービス(クラシ</summary>
      
    
    
    
    
    <category term="MECM" scheme="https://jpmem.github.io/blog/tags/MECM/"/>
    
    <category term="CMG" scheme="https://jpmem.github.io/blog/tags/CMG/"/>
    
  </entry>
  
  <entry>
    <title>リモート配布ポイントへ コンテンツ が配布出来ないときの トラブルシューティング</title>
    <link href="https://jpmem.github.io/blog/mecm/20230813_01/"/>
    <id>https://jpmem.github.io/blog/mecm/20230813_01/</id>
    <published>2023-08-12T15:00:00.000Z</published>
    <updated>2023-11-07T08:27:44.792Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。Configuration Manager サポート チームです。本日は、 Microsoft Configuration Manager (ConfigMgr) において、リモート配布ポイントへ コンテンツ を配布出来ないときの トラブルシューティング についてご案内致します。配布ポイントに対して コンテンツ が配布出来ないとき、以下の項目をまずご確認くださいますようお願い致します。</p><p>サイト サーバー から コンテンツ を配布する際に、リモート配布ポイントとの通信が必要ですが、その際に使われる プロトコル は RPC と SMB です。この二つが使われていることを意識していると トラブルシューティング がやりやすくなります。また、これらの プロトコル を扱う際の権限は、既定の設定だと サイトサーバー の コンピューター アカウント 権限が使われます。</p><ul><li>利用される プロトコル<ul><li>RPC</li><li>SMB</li></ul></li><li>プロトコル で使われる アカウント<ul><li>(既定の場合) サイト サーバー の コンピューター アカウント</li></ul></li></ul><h1 id="コンテンツ-転送の流れ"><a href="#コンテンツ-転送の流れ" class="headerlink" title="コンテンツ 転送の流れ"></a>コンテンツ 転送の流れ</h1><p>サイト サーバーから コンテンツ を リモート配布ポイント へ配布する際の コンテンツ の流れは以下の通りです。各 フォルダ に コンテンツ を格納するための十分な容量が必要です。</p><h2 id="アプリケーション、パッケージ、オペレーティングシステムイメージ、アップグレードイメージ、ブートイメージ"><a href="#アプリケーション、パッケージ、オペレーティングシステムイメージ、アップグレードイメージ、ブートイメージ" class="headerlink" title="アプリケーション、パッケージ、オペレーティングシステムイメージ、アップグレードイメージ、ブートイメージ"></a>アプリケーション、パッケージ、オペレーティングシステムイメージ、アップグレードイメージ、ブートイメージ</h2><p>ソース 共有 フォルダ -&gt; サイト サーバー の SCCMContentLib フォルダ -&gt; リモート 配布ポイントの SCCMContentLib フォルダ</p><p><img src="/blog/mecm/20230813_01/20230813_01_02.png"></p><h2 id="更新プログラム-（自動展開規則でのダウンロードも含む"><a href="#更新プログラム-（自動展開規則でのダウンロードも含む" class="headerlink" title="更新プログラム　（自動展開規則でのダウンロードも含む)"></a>更新プログラム　（自動展開規則でのダウンロードも含む)</h2><p>OS の TEMP フォルダ -&gt; ソース 共有 フォルダ -&gt; サイト サーバーの SCCMContentLib フォルダ -&gt;　リモート 配布ポイント の SCCMContentLib フォルダ</p><p><img src="/blog/mecm/20230813_01/20230813_01_03.png"></p><h1 id="エラーが出力されるログ"><a href="#エラーが出力されるログ" class="headerlink" title="エラーが出力されるログ"></a>エラーが出力されるログ</h1><p>コンテンツ 転送時に エラー が出力されるログは以下の通りです。プライマリサイトサーバーの [ConfigMgrのインストールフォルダ]\Logs\ フォルダを確認ください。</p><ul><li>distmgr.log</li><li>PkgXferMgr.log</li><li>PatchDownloader.log</li></ul><h1 id="チェック-リスト"><a href="#チェック-リスト" class="headerlink" title="チェック リスト"></a>チェック リスト</h1><p>上記を含め、確認すべき点は以下の通りです。</p><ul><li>時刻同期</li><li>プライマリサイトサーバー、リモート配布ポイントの更新プログラム適用状況</li><li>セキュリティ ソフトの設定</li><li>名前解決可否</li><li>通信 ポート の開放状況</li><li>格納 フォルダ の容量</li><li>SMB の利用可否</li><li>RPC の利用可否</li><li>アクセス権限</li><li>WMI の動作確認</li></ul><h2 id="時刻同期"><a href="#時刻同期" class="headerlink" title="時刻同期"></a>時刻同期</h2><p>プライマリサイトサーバー と リモート配布ポイント で時刻ズレがあると RPC 通信に失敗します。時刻ズレが発生していないか確認してください。また、両 サーバー にて NTP サービス が正しく動作していることを確認してください。</p><h2 id="プライマリサイトサーバー、リモート配布ポイントの更新プログラム適用状況"><a href="#プライマリサイトサーバー、リモート配布ポイントの更新プログラム適用状況" class="headerlink" title="プライマリサイトサーバー、リモート配布ポイントの更新プログラム適用状況"></a>プライマリサイトサーバー、リモート配布ポイントの更新プログラム適用状況</h2><p>DCOM 脆弱性 (CVE-2021-26414) に対応するため、DCOM　認証レベルが強化されるようになっています。</p><p>[IT管理者向け] DCOM の脆弱性 (CVE-2021-26414) に対応するためのガイダンス<br><a href="https://msrc.microsoft.com/blog/2021/06/20210609_dcomenrocement/">https://msrc.microsoft.com/blog/2021/06/20210609_dcomenrocement/</a></p><p>プライマリサイトサイトサーバー および リモート配布ポイント に 2023 年 3 月以降の OS 累積品質更新プログラムが適用されていることを確認してください。</p><h2 id="セキュリティ-ソフトの設定"><a href="#セキュリティ-ソフトの設定" class="headerlink" title="セキュリティ ソフトの設定"></a>セキュリティ ソフトの設定</h2><p>セキュリティ　ソフトをご利用の場合、以下をご確認頂き、サイト サーバー、リモート配布ポイントの各種フォルダの除外設定が正しく実施されているかご確認ください。</p><p>Configuration Manager サイト サーバー、サイト システム、クライアントに推奨されるウイルス対策の除外<br><a href="https://learn.microsoft.com/ja-jp/troubleshoot/mem/configmgr/endpoint-protection/recommended-antivirus-exclusions">https://learn.microsoft.com/ja-jp/troubleshoot/mem/configmgr/endpoint-protection/recommended-antivirus-exclusions</a></p><h2 id="名前解決可否"><a href="#名前解決可否" class="headerlink" title="名前解決可否"></a>名前解決可否</h2><p>サイト サーバーにて nslookup コマンド を使って リモート配布ポイント を名前解決できるか確認ください。</p><h2 id="通信-ポート-の開放状況"><a href="#通信-ポート-の開放状況" class="headerlink" title="通信 ポート の開放状況"></a>通信 ポート の開放状況</h2><p>サイトサーバー と リモート配布ポイント の通信ポート は以下の図の通りです。経路上正しく開放設定がなされているかご確認ください。確認には弊社 PortQry 等をご利用いただくのが良いかと存じます。</p><p><img src="/blog/mecm/20230813_01/20230813_01_01.png"></p><p>PortQryUI - User Interface for the PortQry Command Line Port Scanner<br><a href="https://www.microsoft.com/en-us/download/details.aspx?id=24009">https://www.microsoft.com/en-us/download/details.aspx?id=24009</a> </p><h2 id="格納-フォルダの容量"><a href="#格納-フォルダの容量" class="headerlink" title="格納 フォルダの容量"></a>格納 フォルダの容量</h2><p>格納 フォルダ が含まれる フォルダ 容量に十分な空き容量があるか確認ください。</p><p>確認すべき ドライブ は以下の通りです。</p><ul><li>OS ドライブ (更新 プログラム の場合)</li><li>ソース 共有 フォルダ のドライブ</li><li>サイト サーバー の SCCMContentLib フォルダ の ドライブ</li><li>リモート 配布ポイントの SCCMContentLib フォルダ の ドライブ</li></ul><h2 id="SMB-の利用可否"><a href="#SMB-の利用可否" class="headerlink" title="SMB の利用可否"></a>SMB の利用可否</h2><p>Powershell で　Get-SmbShare コマンドレットを使って サイト サーバー 及び リモート配布ポイントの 共有 フォルダ設定をご確認ください。</p><ul><li>サイト サーバー: ソース共有フォルダが共有できているか</li><li>リモート 配布ポイント 以下の共有フォルダが設定されているか<ul><li>ADMIN$</li><li>SCCMContentLib$</li><li>SMS_DP$</li><li>SMSPKG&lt;ドライブ名&gt;$</li><li>SMSSIG$</li></ul></li></ul><h2 id="RPC-の利用可否"><a href="#RPC-の利用可否" class="headerlink" title="RPC の利用可否"></a>RPC の利用可否</h2><p>RPC を利用出来る状況か確認ください。</p><h3 id="DCOM-の設定確認"><a href="#DCOM-の設定確認" class="headerlink" title="DCOM の設定確認"></a>DCOM の設定確認</h3><ol><li>[ファイル名を指定して実行] より [dcomcnfg] を開きます。</li><li>[コンソール ルート] - [コンポーネント サービス] - [コンピューター] - [マイ コンピューター] を右クリックして [プロパティ] を開きます。</li><li>[このコンピューター上で分散 COM を有効にする] にチェックが入っていることを確認します。<br><img src="/blog/mecm/20230813_01/20230813_01_04.png"></li></ol><h3 id="RPC-関連サービスの動作確認"><a href="#RPC-関連サービスの動作確認" class="headerlink" title="RPC 関連サービスの動作確認"></a>RPC 関連サービスの動作確認</h3><ol><li>[ファイル名を指定して実行] より [services.msc] を開きます。</li><li>以下の サービス の状態が [実行中] かつ スタートアップの種類が[自動]　であることを確認します。</li></ol><ul><li>DCOM Server Process Launcher</li><li>Remote Procedure Call (RPC)</li><li>RPC Endpoint Mapper</li></ul><h2 id="アクセス権限"><a href="#アクセス権限" class="headerlink" title="アクセス権限"></a>アクセス権限</h2><p>デフォルト　である　サイト サーバー　の コンピューターアカウント に 各種 アクセス 権限があることを確認します。</p><h3 id="サイト-システム-アクセス-に使われる-アカウント-の確認"><a href="#サイト-システム-アクセス-に使われる-アカウント-の確認" class="headerlink" title="サイト システム アクセス に使われる アカウント の確認"></a>サイト システム アクセス に使われる アカウント の確認</h3><ol><li>[ConfigMgr コンソール] - [監視] - [管理] - [概要] - [サイトの構成] - [サーバー と サイト システム の役割] を開きます。</li><li>リモート 配布ポイント の動作する サイト システム を選択します。</li><li>画面下部の [サイト システム] を選択し、[プロパティ] を開きます。</li><li>[全般] タブ にて、サイト システムのインストール アカウント に、[サイト サーバーのコンピューター アカウントを使用してこのサイト システムをインストールする] にチェックが入っていることを確認します。<br><img src="/blog/mecm/20230813_01/20230813_01_05.png"></li></ol><h3 id="ソース共有フォルダ-の-アクセス-権限の確認"><a href="#ソース共有フォルダ-の-アクセス-権限の確認" class="headerlink" title="ソース共有フォルダ の アクセス 権限の確認"></a>ソース共有フォルダ の アクセス 権限の確認</h3><p>ソース共有フォルダ に サイト サーバー の　コンピューター　アカウントの読み込み権限があるか確認してください。</p><ol><li>エクスプローラー でソース共有フォルダの プロパティ を開きます。</li><li>[共有]タブを開き、[詳細な共有] を開きます。<br><img src="/blog/mecm/20230813_01/20230813_01_06.png"></li><li>[アクセス許可] を開き、サイト サーバー のコンピューター アカウントのアクセス権限を確認します。ユーザーグループが指定されている場合は、そのユーザーグループにサイト サーバーのコンピューター アカウントが所属しているか確認してください。<br><img src="/blog/mecm/20230813_01/20230813_01_07.png"></li></ol><h3 id="サイト-サーバーの-SCCMContentLib-フォルダの-アクセス-権限の確認"><a href="#サイト-サーバーの-SCCMContentLib-フォルダの-アクセス-権限の確認" class="headerlink" title="サイト サーバーの SCCMContentLib フォルダの アクセス 権限の確認"></a>サイト サーバーの SCCMContentLib フォルダの アクセス 権限の確認</h3><p>上記と同様に サイト サーバー の SCCMContentLib フォルダに対して　コンピューター アカウント に読み書き権限があるか確認してください。</p><h3 id="リモート配布ポイント-の-SCCMContentLib-フォルダの-アクセス-権限の確認"><a href="#リモート配布ポイント-の-SCCMContentLib-フォルダの-アクセス-権限の確認" class="headerlink" title="リモート配布ポイント の SCCMContentLib フォルダの アクセス 権限の確認"></a>リモート配布ポイント の SCCMContentLib フォルダの アクセス 権限の確認</h3><p>上記と同様に リモート配布ポイント の SCCMContentLib フォルダに対して　サイト サーバー の コンピューター アカウント に読み書き権限があるか確認してください。</p><h3 id="リモート配布ポイント-の-WMI-のアクセス権限の確認"><a href="#リモート配布ポイント-の-WMI-のアクセス権限の確認" class="headerlink" title="リモート配布ポイント の WMI のアクセス権限の確認"></a>リモート配布ポイント の WMI のアクセス権限の確認</h3><p>リモート配布ポイント に対して サイト サーバー のコンピューター アカウント　がアクセス権限を持っているか確認します。</p><ol><li>リモート配布ポイント に ログイン します。</li><li>[ファイル名を指定して実行] より [ wmimgmt.msc ] を開きます。</li><li>[WMI コントロール (ローカル)] を右クリックして [プロパティ] を開きます。<br><img src="/blog/mecm/20230813_01/20230813_01_08.png"></li><li>[セキュリティ] タブを開き、[Root] が選択されている状態で [セキュリティ] を開きます。<br><img src="/blog/mecm/20230813_01/20230813_01_09.png"></li><li>サイト サーバー のコンピューター アカウントのアクセス権限を確認します。ユーザーグループが指定されている場合は、そのユーザーグループにサイト サーバーのコンピューター アカウントが所属しているか確認してください。</li></ol><h2 id="WMI-の動作確認"><a href="#WMI-の動作確認" class="headerlink" title="WMI の動作確認"></a>WMI の動作確認</h2><p>WMI が正しく動作しているか確認するため、以下を確認ください。</p><h3 id="リモート配布ポイント-での動作確認"><a href="#リモート配布ポイント-での動作確認" class="headerlink" title="リモート配布ポイント での動作確認"></a>リモート配布ポイント での動作確認</h3><ol><li>リモート 配布ポイントに管理者権限でログインします。</li><li> PSExec ツールを以下 サイト より ダウンロード します。<br><a href="https://learn.microsoft.com/ja-jp/sysinternals/downloads/psexec">https://learn.microsoft.com/ja-jp/sysinternals/downloads/psexec</a></li><li>ダウンロード 後、解凍し適当な フォルダ に配置します。</li><li>コマンド プロンプト を管理者権限で開き、カレント フォルダ を PSExec ツール を置いた フォルダ に移動します。</li><li>以下のコマンドを実行します。  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PSExec64.exe -i -s -d cmd</span><br></pre></td></tr></table></figure></li></ol><p><img src="/blog/mecm/20230813_01/20230813_01_10.png">  </p><p>  ※ EULA のダイアログが開いた場合は OK をクリックし、再度上記 コマンド を実行してください。  </p><ol start="6"><li>コマンドプロンプト のウィンドウが新たに開きます。</li><li>以下のコマンドを実行し、コマンドプロンプト の実行権限が nt authority\system となっていることを確認ください。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">whoami</span><br></pre></td></tr></table></figure><img src="/blog/mecm/20230813_01/20230813_01_11.png">  </li><li>新たに開いた コマンドプロンプト で 以下を実行します。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wbemtest</span><br></pre></td></tr></table></figure></li><li>[Windows Management Instrumentation テスト]が開きます。 [接続]をクリックします。<br><img src="/blog/mecm/20230813_01/20230813_01_12.png"> </li><li>[名前空間] に [root\SCCMDP] と入力し、[接続]をクリックします。<br><img src="/blog/mecm/20230813_01/20230813_01_13.png">  </li><li>以下のように名前空間の箇所に [root\SCCMDP] とエラー無く表示されれば OK です。<br><img src="/blog/mecm/20230813_01/20230813_01_14.png">  </li></ol><h3 id="プライマリ-サイト-サーバー-での動作確認"><a href="#プライマリ-サイト-サーバー-での動作確認" class="headerlink" title="プライマリ サイト サーバー での動作確認"></a>プライマリ サイト サーバー での動作確認</h3><ol><li>プライマリ サイト サーバー に管理者権限でログインします。</li><li> PSExec ツールを以下 サイト より ダウンロード します。<br><a href="https://learn.microsoft.com/ja-jp/sysinternals/downloads/psexec">https://learn.microsoft.com/ja-jp/sysinternals/downloads/psexec</a></li><li>ダウンロード 後、解凍し適当な フォルダ に配置します。</li><li>コマンド プロンプト を管理者権限で開き、カレント フォルダ を PSExec ツール を置いた フォルダ に移動します。</li><li>以下のコマンドを実行します。  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PSExec64.exe -i -s -d cmd</span><br></pre></td></tr></table></figure></li></ol><p><img src="/blog/mecm/20230813_01/20230813_01_10.png">  </p><p>  ※ EULA のダイアログが開いた場合は OK をクリックし、再度上記 コマンド を実行してください。  </p><ol start="6"><li>コマンドプロンプト のウィンドウが新たに開きます。</li><li>以下のコマンドを実行し、コマンドプロンプト の実行権限が nt authority\system となっていることを確認ください。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">whoami</span><br></pre></td></tr></table></figure><img src="/blog/mecm/20230813_01/20230813_01_11.png">  </li><li>新たに開いた コマンドプロンプト で 以下を実行します。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wbemtest</span><br></pre></td></tr></table></figure></li><li>[Windows Management Instrumentation テスト]が開きます。 [接続]をクリックします。<br><img src="/blog/mecm/20230813_01/20230813_01_12.png">  </li><li>[名前空間] に [\[配布ポイントのFQDN]\root\SCCMDP] と入力し、[接続]をクリックします。<br><img src="/blog/mecm/20230813_01/20230813_01_15.png">  </li><li>以下のように名前空間の箇所に [\[配布ポイントのFQDN]\root\SCCMDP] とエラー無く表示されれば OK です。<br><img src="/blog/mecm/20230813_01/20230813_01_16.png">  </li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。Configuration Manager サポート チームです。本日は、 Microsoft Configuration Manager (ConfigMgr) において、リモート配布ポイントへ コンテンツ を配布出来ないときの トラブルシューティン</summary>
      
    
    
    
    
    <category term="MECM" scheme="https://jpmem.github.io/blog/tags/MECM/"/>
    
  </entry>
  
  <entry>
    <title>Microsoft Update カタログから更新プログラムをインポートする手順が変更されました</title>
    <link href="https://jpmem.github.io/blog/wsus/2023-07-27_01/"/>
    <id>https://jpmem.github.io/blog/wsus/2023-07-27_01/</id>
    <published>2023-07-26T15:00:00.000Z</published>
    <updated>2023-11-07T08:27:44.928Z</updated>
    
    <content type="html"><![CDATA[<p>みなさん、こんにちは。WSUS サポート チームです。  </p><p>これまで WSUS コンソールから更新プログラムをインポートする方法がありましたが、使用機能の ActiveX が非推奨になったことから、ActiveX を介さず PowerShell を使用してインポートする方法をご紹介します。</p><ol><li>以下の公開情報に記載されているスクリプトをコピーし拡張子.ps1として、 WSUS サーバーへ保存します。</li></ol><p>Title : Import updates into WSUS using PowerShell<br>URL : <a href="https://learn.microsoft.com/en-us/windows-server/administration/windows-server-update-services/manage/wsus-and-the-catalog-site?branch=pr-4097#powershell-script-to-import-updates-into-wsus">https://learn.microsoft.com/en-us/windows-server/administration/windows-server-update-services/manage/wsus-and-the-catalog-site?branch=pr-4097#powershell-script-to-import-updates-into-wsus</a></p><ol start="2"><li><p>Microsoft Update カタログ サイトをブラウザーで開きます。<br><a href="https://catalog.update.microsoft.com/">https://catalog.update.microsoft.com</a></p></li><li><p>WSUS にインポートする更新プログラムを検索します。   </p></li><li><p>対象の更新プログラムをクリックします。  </p></li><li><p>開いた詳細ページで UpdateID をコピーします。<br><img src="/blog/wsus/2023-07-27_01/2.png" alt="image.png"></p></li><li><p>管理者として PowerShell コンソールを開きスクリプトの配置パスまで移動させ、ドキュメントに記載されている構文を使用してスクリプトを実行します。<br>例　.\ImportUpdateToWSUS.ps1 -UpdateId &lt;コピーした UpdateID&gt;<br><img src="/blog/wsus/2023-07-27_01/3.png" alt="image.png">  </p></li></ol><p>手順は以上です。  </p><p>上記の手順は、米国エンジニアが公開した以下ブログを参考にしています。日本語に訳してご紹介します。</p><p>Title : Importing updates into WSUS is changing<br>URL : <a href="https://techcommunity.microsoft.com/t5/windows-it-pro-blog/importing-updates-into-wsus-is-changing/ba-p/3882937">https://techcommunity.microsoft.com/t5/windows-it-pro-blog/importing-updates-into-wsus-is-changing/ba-p/3882937</a>  </p><hr><p>Windows Server Update Services（WSUS）を使用してデバイスを更新する場合、更新プログラムのインポート手順が変更されました。更新プログラムのインポートには、新しいPowerShellスクリプトを使用します。デバイスを定期的に更新し、可能な限り安全な方法で更新を行うことで、組織のデバイスの保護がさらに強化されます。その方法を見てみましょう！</p><h1 id="更新プログラムを-WSUS-にインポートする古い手順"><a href="#更新プログラムを-WSUS-にインポートする古い手順" class="headerlink" title="更新プログラムを WSUS にインポートする古い手順"></a>更新プログラムを WSUS にインポートする古い手順</h1><p>これまで、WSUSには Microsoft Update カタログ サイトから更新プログラムをインポートするオプションがありました。このオプションは WSUS 管理コンソール上の <strong>更新プログラム</strong> &gt; <strong>操作</strong> ペインにあります。</p><p><img src="/blog/wsus/2023-07-27_01/1.png" alt="image.png"><br>[更新のインポート] オプションは、WSUS 管理コンソールの [更新プログラム] &gt; [操作] ペインにあります。</p><p>このユーザー インターフェイスの動作が変更されています。<strong>更新プログラムのインポート機能</strong> は、ActiveXを使用して構築されていましたが、現在は非推奨となっています。デバイスを最新の状態に保つための新しく優れた方法が利用できるようになりました！</p><h1 id="更新プログラムを-WSUS-にインポートする新しい手順"><a href="#更新プログラムを-WSUS-にインポートする新しい手順" class="headerlink" title="更新プログラムを WSUS にインポートする新しい手順"></a>更新プログラムを WSUS にインポートする新しい手順</h1><p>新しい PowerShell スクリプトは、WSUS 内のインポート機能を置き換えるものです。このスクリプトを使用して更新プログラムをダウンロードし、WSUS サーバーにインポートします。</p><p>この新しいスクリプトを取得するには、2つの方法があります：</p><p>a. WSUS 管理コンソールで通常の手順に従ってください： <strong>更新プログラム</strong> &gt; <strong>操作</strong> をクリックすると、スクリプトを含むドキュメントにリダイレクトされます。<br>b. 直接、公開情報「WSUS とカタログ サイト」にアクセスし、PowerShell スクリプトを入手します。</p><p>スクリプトをコピーしたら、PowerShell を使用して WSUS にアップデートをインポートする一連の手順を実行します。簡単に説明すると、以下のようになります：</p><ol><li>スクリプトを保存します。</li><li>Web ブラウザで Microsoft Update カタログ サイトを開きます。</li><li>WSUS にインポートする更新プログラムを検索します。</li><li>表示された一覧から、目的の更新プログラムを選択します。</li><li>開いた詳細ページの UpdateID をコピーします。<br>注: 複数の更新プログラムをインポートする場合は、UpdateID をそれぞれ別の行に記述したテキストファイルを作成します。</li><li>更新プログラムをインポートするには、PowerShell コンソールを管理者として開き、ドキュメントに記載されている構文でスクリプトを実行します。</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">注意:</span><br><span class="line">インポートされた更新プログラムのファイルは、インポート時にはダウンロードされません。更新プログラムのファイルの設定を確認し、ダウンロードされるタイミングを確認または変更してください。</span><br></pre></td></tr></table></figure><p>更新プログラムのインポートに関する完全で最新のガイダンスについては、WSUS および Microsoft Update カタログのページを引き続き確認してください。このページには、スクリプト、構文、および役立つ例が掲載されています。</p><p>もし情報が足りないと感じたら、以下のリソースをご覧ください：<br><a href="https://learn.microsoft.com/ja-jp/windows-server/administration/windows-server-update-services/manage/wsus-and-the-catalog-site">WSUS とカタログ サイト</a><br><a href="https://www.catalog.update.microsoft.com/Home.aspx">Microsoft Update Catalog</a><br><a href="https://learn.microsoft.com/ja-jp/cpp/mfc/activex-controls?view=msvc-170">ActiveX コントロール</a>  </p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさん、こんにちは。WSUS サポート チームです。  &lt;/p&gt;
&lt;p&gt;これまで WSUS コンソールから更新プログラムをインポートする方法がありましたが、使用機能の ActiveX が非推奨になったことから、ActiveX を介さず PowerShell を使用してイン</summary>
      
    
    
    
    
    <category term="WSUS" scheme="https://jpmem.github.io/blog/tags/WSUS/"/>
    
  </entry>
  
  <entry>
    <title>Configuration Manager ベーシック ナレッジ シリーズ 1 - Configuration Manager から展開できる機能のご紹介</title>
    <link href="https://jpmem.github.io/blog/mecm/20230720_01/"/>
    <id>https://jpmem.github.io/blog/mecm/20230720_01/</id>
    <published>2023-07-19T15:00:00.000Z</published>
    <updated>2023-11-07T08:27:44.792Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。Configuration Manager サポート チーム 山田 です。  </p><p>本ブログの連載企画として Microsoft Configuration Manager の基本的なナレッジを、これから管理者となる方や導入を検討されている方向けに分かり易くご紹介いたします。<br>今回は、Configuration Manager から展開できる、ソフトウェア更新プログラム、パッケージ、アプリケーション、タスクシーケンスの機能についてご紹介いたします。<br>各機能の概要についてお伝えさせていただきますので、少しでも多く Configuration Manager の機能をご利用いただけたら幸いです。  </p><p>各機能を項目に分けて記載させていただきます。  </p><ul><li>ソフトウェア更新プログラム  </li><li>パッケージ  </li><li>アプリケーション  </li><li>タスクシーケンス  </li></ul><h3 id="ソフトウェア更新プログラム"><a href="#ソフトウェア更新プログラム" class="headerlink" title="ソフトウェア更新プログラム"></a>ソフトウェア更新プログラム</h3><p>OS をアップグレードする機能更新プログラムや品質更新プログラム、Microsoft Defender ウイルス対策のセキュリティ インテリジェンス更新プログラム、Microsoft 365 Apps の更新プログラムなどを展開できる機能です。  </p><p>Title : Configuration Managerのソフトウェア更新プログラムの概要<br>URL : <a href="https://learn.microsoft.com/ja-jp/mem/configmgr/sum/understand/software-updates-introduction">https://learn.microsoft.com/ja-jp/mem/configmgr/sum/understand/software-updates-introduction</a>  </p><p>手動で展開することできますが、あらかじめ規則を設定しておき、自動で展開することも可能です。  </p><p>参考ブログ<br><a href="https://jpmem.github.io/blog/mecm/20220706_01/">MECM 自動展開規則</a>  </p><p>どの更新プログラムも基本的には以下のフローで動作します。  </p><ol><li>ソフトウェア更新ポイント（WSUS）が Microsoft Update カタログと同期  </li><li>Configuration Manager で更新プログラムを展開  </li><li>プライマリ サイト サーバーが Microsoft Update カタログから更新プログラムをダウンロード  </li><li>プライマリ サイト サーバーから配布ポイントへ更新プログラムを配布  </li><li>Configuration Manager クライアントが配布ポイントから更新プログラムをダウンロード  </li><li>Configuration Manager クライアントが更新プログラムをインストール  </li></ol><h3 id="パッケージ"><a href="#パッケージ" class="headerlink" title="パッケージ"></a>パッケージ</h3><p>exe や ps1、bat ファイルなどをクライアントに展開できる機能です。  </p><p>Title : Configuration Managerのパッケージとプログラム<br>URL : <a href="https://learn.microsoft.com/ja-jp/mem/configmgr/apps/deploy-use/packages-and-programs">https://learn.microsoft.com/ja-jp/mem/configmgr/apps/deploy-use/packages-and-programs</a>  </p><p>そのため、お客様にて作成したスクリプトを複数のクライアントや全台に対して展開したいなどの場合、Configuration Manager の本機能をご使用いただくことで実現できます。<br>実現可能なサンプル例を以下に記載いたします。  </p><h5 id="例-1"><a href="#例-1" class="headerlink" title="例 1"></a>例 1</h5><p>クライアントはインターネット接続ができない環境のため、Microsoft ストア アプリや言語パックを展開したい。  </p><h5 id="例-2"><a href="#例-2" class="headerlink" title="例 2"></a>例 2</h5><p>緊急で Defender の定義ファイル（exe ファイル）をパッケージで展開したい。  </p><h5 id="例-3"><a href="#例-3" class="headerlink" title="例 3"></a>例 3</h5><p>特定のレジストリを変更するコマンドを展開したい。  </p><p>もしパッケージ展開がうまくいかない場合、以下のブログもご参照ください。<br><a href="https://jpmem.github.io/blog/mecm/20220125_01/">パッケージの展開が失敗した時に確認したいポイント ~ sysnative 編 ~</a>  </p><h3 id="アプリケーション"><a href="#アプリケーション" class="headerlink" title="アプリケーション"></a>アプリケーション</h3><p>主に msi や appx、appxbundle ファイルなどを展開する際に使用する機能です。  </p><p>Title : Configuration Managerを使用してアプリケーションを作成してデプロイする<br>URL : <a href="https://learn.microsoft.com/ja-jp/mem/configmgr/apps/get-started/create-and-deploy-an-application">https://learn.microsoft.com/ja-jp/mem/configmgr/apps/get-started/create-and-deploy-an-application</a>  </p><p>アプリケーションを作成時、システム用にインストールするか、ユーザー用にインストールするかを設定できます。  </p><p>システム用にインストール　→　SYSTEM アカウント権限でインストールが実行<br>ユーザー用にインストール　→　ログオンしているユーザー アカウントの権限でインストールが実行  </p><p>また、パッケージと違い、アプリケーションは “検出規則” や “置き換え” といった設定も可能です。  </p><h5 id="例-1-1"><a href="#例-1-1" class="headerlink" title="例 1"></a>例 1</h5><p>特定のフォルダーや特定のレジストリが存在する場合にインストール済みと判定させたい。  </p><h5 id="例-2-1"><a href="#例-2-1" class="headerlink" title="例 2"></a>例 2</h5><p>PowerShell のスクリプト実行結果を基にインストール済みと判定させたい。</p><h5 id="例-3-1"><a href="#例-3-1" class="headerlink" title="例 3"></a>例 3</h5><p>アプリ B を展開しようとしているが、既にアプリ A を展開済みで、かつアプリ A は古いバージョンのため、先にアプリ A をアンインストールしてからアプリ B をインストールさせたい。  </p><p>パッケージを使用するかアプリケーションを使用するか迷った際は、以下のブログも併せてご参照ください。<br><a href="https://jpmem.github.io/blog/mecm/20220608_02/">MECM パッケージとアプリケーションどっちを使うべき？違いを解説！</a>  </p><h3 id="タスクシーケンス"><a href="#タスクシーケンス" class="headerlink" title="タスクシーケンス"></a>タスクシーケンス</h3><p>OS のインストールからドメインへの参加、OS のアップグレードからパッケージ、アプリケーションのインストールなど一連のフローを 1 つにまとめて展開できる機能です。<br>主に以下のようなシナリオで活用可能です。  </p><h5 id="例-1-2"><a href="#例-1-2" class="headerlink" title="例 1"></a>例 1</h5><p>新しいクライアントに OS をインストールしてドメインへ参加後、Configuration Manager クライアントをインストールしたい。  </p><p>Title : Configuration Managerを使用して新しいコンピューター (ベア メタル) に新しいバージョンの Windows をインストールする<br>URL : <a href="https://learn.microsoft.com/ja-jp/mem/configmgr/osd/deploy-use/install-new-windows-version-new-computer-bare-metal">https://learn.microsoft.com/ja-jp/mem/configmgr/osd/deploy-use/install-new-windows-version-new-computer-bare-metal</a>  </p><h5 id="例-2-2"><a href="#例-2-2" class="headerlink" title="例 2"></a>例 2</h5><p>既存のクライアントの OS をアップグレードしたい。  </p><p>Title : 構成マネージャーを使用して Windows を最新バージョンにアップグレードする<br>URL : <a href="https://learn.microsoft.com/ja-jp/mem/configmgr/osd/deploy-use/upgrade-windows-to-the-latest-version">https://learn.microsoft.com/ja-jp/mem/configmgr/osd/deploy-use/upgrade-windows-to-the-latest-version</a>  </p><p>どのようなシナリオの場合でも、実行するタスクの順番や、どのようなタスクを組み込むかは自由であり、一度組み込んだタスクを無効とすること、実行する際の条件の設定を行うことも可能ですので、ぜひ一度お試しください。  </p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。Configuration Manager サポート チーム 山田 です。  &lt;/p&gt;
&lt;p&gt;本ブログの連載企画として Microsoft Configuration Manager の基本的なナレッジを、これから管理者となる方や導入を検討されている方</summary>
      
    
    
    
    
    <category term="MECM" scheme="https://jpmem.github.io/blog/tags/MECM/"/>
    
    <category term="ベーシック ナレッジ" scheme="https://jpmem.github.io/blog/tags/%E3%83%99%E3%83%BC%E3%82%B7%E3%83%83%E3%82%AF-%E3%83%8A%E3%83%AC%E3%83%83%E3%82%B8/"/>
    
  </entry>
  
  <entry>
    <title>WSUS で Windows 11 クライアントが Windows 10 と表示される事象について</title>
    <link href="https://jpmem.github.io/blog/mecm/20230601_01/"/>
    <id>https://jpmem.github.io/blog/mecm/20230601_01/</id>
    <published>2023-06-29T15:00:00.000Z</published>
    <updated>2023-11-07T08:27:44.792Z</updated>
    
    <content type="html"><![CDATA[<p><strong>2023/06/01 初版公開</strong><br><strong>2023/06/30 更新</strong><br><strong>- [回避策] の内容を修正しました。</strong><br><strong>- バージョン情報の確認方法を [補足] として追記しました。</strong>  </p><p>みなさま、こんにちは。WSUS サポート チームです。</p><p>今回は WSUS で Windows 11 クライアントが Windows 10 と表示される事象についてご紹介します。</p><p>本問題は弊社でも同様の動作になることを確認できておりますが、誠に恐縮ながら現時点で修正可否は未定です。<br>本問題について進展がありましたら、本ブログを更新する予定ですので、ご不便をおかけしますが、何卒ご理解賜りますようお願い申し上げます。</p><h2 id="事象の概要"><a href="#事象の概要" class="headerlink" title="事象の概要"></a>事象の概要</h2><p>WSUS サーバー上でコンピューターの一覧を表示した場合、Windows 11 であってもオペレーティング システムの表示項目は Windows 10 と表示されます。<br><img src="/blog/mecm/20230601_01/2023-06-01-16-32-45.png"></p><p>本事象はクライアント バージョンを判断するための情報が Windows 10 と Windows 11 で共通であるため発生いたしますが、表示上の問題であり更新プログラムの管理動作には影響はございません。<br><img src="/blog/mecm/20230601_01/2023-06-01-16-33-09.png"></p><h2 id="回避策"><a href="#回避策" class="headerlink" title="回避策"></a>回避策</h2><p>現時点で本動作の修正予定はございませんので、恐れ入りますが、クライアントのオペレーティング システムの判別には表示列を追加し、バージョンの情報をご確認ください。<br>なお、現在確認できているバージョンの情報は下記の通りでございますが、今後変更される可能性がございますのでお含みおきいただけますと幸いです。  </p><p>Windows 11 21H2：10.0.22000 から始まるバージョン<br>Windows 11 22H2 以降：923 から始まるバージョン  </p><p><img src="/blog/mecm/20230601_01/2023-06-01-16-33-48.png"></p><h2 id="補足"><a href="#補足" class="headerlink" title="補足"></a>補足</h2><p>バージョンの情報は、%windir%\System32\wuaueng.dll のバージョンが表示されます。<br>上記バージョン以外が表示された場合は、必要に応じてご確認いただけますと幸いです。  </p><p>// Windows 11 22H2 (OS ビルド 22621.1848) の場合<br><img src="/blog/mecm/20230601_01/2023-06-30-14-29-00.png"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;strong&gt;2023/06/01 初版公開&lt;/strong&gt;&lt;br&gt;&lt;strong&gt;2023/06/30 更新&lt;/strong&gt;&lt;br&gt;&lt;strong&gt;- [回避策] の内容を修正しました。&lt;/strong&gt;&lt;br&gt;&lt;strong&gt;- バージョン情報の確認方法を [補足</summary>
      
    
    
    
    
    <category term="WSUS" scheme="https://jpmem.github.io/blog/tags/WSUS/"/>
    
  </entry>
  
  <entry>
    <title>WSUS から Microsoft Defender Antivirus 向けに定義更新プログラムを配布する方法について</title>
    <link href="https://jpmem.github.io/blog/wsus/2023-06-23_01/"/>
    <id>https://jpmem.github.io/blog/wsus/2023-06-23_01/</id>
    <published>2023-06-22T15:00:00.000Z</published>
    <updated>2023-11-07T08:27:44.924Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。WSUS サポート チームです。今回は、Microsoft Defender Antivirus 向けに定義更新プログラムを配布する方法をご紹介いたします。WSUS で必要な手順についてお伝えいたしますのでお役立ていただけますと幸いです。  </p><p>＜参考情報＞<br><a href="https://docs.microsoft.com/ja-jp/troubleshoot/mem/configmgr/deploy-definition-updates-using-wsus">WSUS を使用して、Windows Defender を実行しているコンピューターに定義の更新を展開する</a><br><a href="https://docs.microsoft.com/ja-jp/mem/configmgr/protect/deploy-use/endpoint-definitions-wsus#synchronize-definition-updates-for-standalone-wsus">スタンドアロン WSUS の定義ファイルの更新を同期する</a>  </p><h1 id="配布手順"><a href="#配布手順" class="headerlink" title="配布手順"></a>配布手順</h1><h2 id="1-WSUS-に-Microsoft-Defender-Antivirus-の定義更新プログラムを同期する"><a href="#1-WSUS-に-Microsoft-Defender-Antivirus-の定義更新プログラムを同期する" class="headerlink" title="1.WSUS に Microsoft Defender Antivirus の定義更新プログラムを同期する"></a>1.WSUS に Microsoft Defender Antivirus の定義更新プログラムを同期する</h2><p>WSUS で Microsoft Defender Antivirus 向けの定義更新プログラムを配布するために必要な設定についてお伝えします。<br>1-1 WSUS コンソール上から[ オプション ]&gt;[ 製品と分類 ]を選択します。<br>1-2 製品タブにて： [ Microsoft Defender Antivirus ] にチェックを入れます。<br>1-3 分類タブにて： [ 定義更新プログラム ] にチェックを入れます。<br><img src="/blog/wsus/2023-06-23_01/2023-06-23_01-1.png">  </p><h2 id="2-自動承認機能を利用して配布する"><a href="#2-自動承認機能を利用して配布する" class="headerlink" title="2.自動承認機能を利用して配布する"></a>2.自動承認機能を利用して配布する</h2><p>WSUS の自動承認機能を利用し、自動承認規則に基づいて同期実行時に更新プログラムのメタデータが WSUS サーバーにダウンロードされたタイミングで自動的承認を行うように設定できます。</p><p>2-1 WSUSコンソール上から [ オプション ] &gt; [ 自動承認 ] を選択します。<br>2-2 [ 新しい規則 ] を選択します。<br>2-3 [ ステップ1．プロパティを選択します ] にて [ 更新が特定の分類に含まれる場合 ] にチェックを入れます。 [ ステップ2．プロパティを変更します (下線付きの値をクリック) ] にて [ 任意の分類] をクリックし、[ 定義更新プログラム ] を選択します。<br>2-4 [ ステップ1．プロパティを選択します ] にて [ 更新プログラムが特定の製品に含まれる場合 ] にチェックを入れます。 [ ステップ2．プロパティを変更します (下線付きの値をクリック) ] にて [ 任意の製品 ] をクリックし、[ Microsoft Defender Antivirus ] を選択します。<br>2-5 [ すべてのコンピューター ] をクリックし、承認対象とするコンピュータグループを選択します。<br>2-6 [ ステップ3．名前を指定します ] にて任意の規則名を入力します。<br>2-7 自動承認規則設定後、同期のタイミングで Microsoft Defender Antivirus の定義更新プログラムが承認されるようになります。<br> <img src="/blog/wsus/2023-06-23_01/2023-06-23_01-2.png">  </p><p>＜参考情報＞<br><a href="https://docs.microsoft.com/ja-jp/security-updates/windowsupdateservices/18111597">更新プログラムの自動承認</a> </p><h1 id="留意いただきたい事項"><a href="#留意いただきたい事項" class="headerlink" title="留意いただきたい事項"></a>留意いただきたい事項</h1><p>特に Microsoft Defender Antivirus 向けの定義更新プログラムは、１日に複数回リリースされます為、自動承認規則により承認される更新プログラムの数が日々増加し、WsusContent フォルダにダウンロードされるファイルが非常に多くなる傾向があります。このことにより、ディスクサイズの容量圧迫につながりやすくなりますため、クリーンアップ ウィザードの 「不要な更新ファイル」 を実行し、定期的にファイルを削除いただくことをお勧めいたします。削除対象となる更新プログラムについては、<a href="https://jpmem.github.io/blog/wsus/2017-12-05_01/">WSUS のクリーンアップ ウィザードについて</a> にてご紹介しておりますのでご参照ください。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。WSUS サポート チームです。今回は、Microsoft Defender Antivirus 向けに定義更新プログラムを配布する方法をご紹介いたします。WSUS で必要な手順についてお伝えいたしますのでお役立ていただけますと幸いです。  &lt;/p&gt;
</summary>
      
    
    
    
    
    <category term="WSUS" scheme="https://jpmem.github.io/blog/tags/WSUS/"/>
    
    <category term="使い方" scheme="https://jpmem.github.io/blog/tags/%E4%BD%BF%E3%81%84%E6%96%B9/"/>
    
  </entry>
  
  <entry>
    <title>WSUS から更新プログラムが配信されないときのチェックポイント</title>
    <link href="https://jpmem.github.io/blog/wsus/2023-06-16_01/"/>
    <id>https://jpmem.github.io/blog/wsus/2023-06-16_01/</id>
    <published>2023-06-15T15:00:00.000Z</published>
    <updated>2023-11-07T08:27:44.924Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。WSUS サポート チームです。</p><p>今回は、WSUS から更新プログラムが配信されない問題が発生したときのチェックポイントをご紹介します。<br>WSUS から更新プログラムが配信される仕組みについては、<a href="https://jpmem.github.io/blog/wsus/2023-05-02_01/">こちらの記事</a>でご紹介しておりますので、こちらも是非ご確認ください。</p><h1 id="設定値のチェック"><a href="#設定値のチェック" class="headerlink" title="設定値のチェック"></a>設定値のチェック</h1><p>WSUS クライアントの接続先となる WSUS サーバーについては、以下のドメイン ポリシー / ローカル ポリシーやレジストリで指定します。  </p><ul><li>ポリシー  </li></ul><p><strong>[コンピューターの構成] - [管理用テンプレート] - [Windows コンポーネント] - [Windows Update] - [イントラネットの Microsoft 更新サービスの場所を指定する]</strong><br>または<br><strong>[コンピューターの構成] - [管理用テンプレート] - [Windows コンポーネント] - [Windows Update] - [Windows Server Update Service から提供される更新プログラムの管理] - [イントラネットの Microsoft 更新サービスの場所を指定する]</strong>  </p><p>これらのポリシーが構成されると、下記レジストリ値がセットされます。</p><ul><li>レジストリ  </li></ul><p><strong>HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate</strong><br><strong>WUServer: &lt;WSUS サーバーの URL&gt;</strong><br><strong>WUStatusServer: &lt;WSUS サーバーの URL&gt;</strong><br><strong>HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate\AU</strong><br><strong>“UseWUServer”=dword:00000001</strong>  </p><p>例) 8530 ポートの場合<br><a href="http://wsus.contoso.com:8530/">http://WSUS.contoso.com:8530</a>  </p><p>まずはレジストリ エディター (regedit) より、このレジストリに正しい値がセットされているかを確認しましょう。<br>もし、想定しない WSUS サーバーの URL がセットされている場合は、ドメイン ポリシーまたはローカル ポリシーの設定値を見直して、正しい値をセットしてください。</p><h1 id="クライアントと-WSUS-の疎通チェック"><a href="#クライアントと-WSUS-の疎通チェック" class="headerlink" title="クライアントと WSUS の疎通チェック"></a>クライアントと WSUS の疎通チェック</h1><p>WSUS クライアントが WSUS サーバーから更新プログラムを受信するためには、WSUS サーバーに対して HTTP リクエストが送信できるネットワーク環境である必要があります。<br>WSUS サーバーの接続先となる URL については、上述で説明したレジストリ値に格納されています。<br>URL が IP アドレスではなく FQDN やホスト名になっている場合、名前解決ができるか確認する必要がありますので、まずはターミナルや PowerShell コンソールを開いて以下のコマンドを実行し IP アドレスを取得できるか確認しましょう。</p><p>例) URL が <a href="http://wsus.contoso.com:8530/">http://WSUS.contoso.com:8530</a> の場合</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nslookup WSUS.contoso.com</span><br></pre></td></tr></table></figure><p>出力例  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Server:  UnKnown</span><br><span class="line">Address:  192.168.1.1</span><br><span class="line"></span><br><span class="line">Name:    WSUS.contoso.com</span><br><span class="line">Address:  192.168.1.10</span><br></pre></td></tr></table></figure><p>ここで IP アドレスが取得できなかった場合、名前解決失敗エラーとなりますので、DNS の設定や FQDN が正しいか見直してください。<br>名前解決ができることを確認した後は、以下の PowerShell コマンドを実行して、この URL に対して、HTTP リクエストが送信できるかどうかを確認しましょう。  </p><p>例) URL が <a href="http://wsus.contoso.com:8530/">http://WSUS.contoso.com:8530</a> の場合</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Invoke-WebRequest -Uri http://WSUS.contoso.com:8530/ClientWebService/Client.asmx?wsdl -UseBasicParsing</span><br><span class="line">Invoke-WebRequest -Uri http://WSUS.contoso.com:8530/SimpleAuthWebService/SimpleAuth.asmx -UseBasicParsing</span><br></pre></td></tr></table></figure><p>アクセス可能な場合は、以下のように StatusCode 200 の出力結果となりますので、このような出力となるかご確認ください。  </p><p>出力例  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">StatusCode        : 200</span><br><span class="line">StatusDescription : OK</span><br><span class="line">...&lt;省略&gt;</span><br></pre></td></tr></table></figure><h1 id="プロキシ設定を確認する"><a href="#プロキシ設定を確認する" class="headerlink" title="プロキシ設定を確認する"></a>プロキシ設定を確認する</h1><p>もし、更新プログラムの確認時に StausCode が 407 の Proxy Authentication Required エラーなどが返された場合、プロキシを経由して WSUS サーバーにアクセスした結果、認証ができずに失敗していることが疑われます。<br>そのときは、以下のコマンドで WinHTTP のプロキシ設定を確認してください。  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netsh winhttp show proxy</span><br></pre></td></tr></table></figure><p>もし、設定されている場合、バイパスリストに WSUS サーバーの FQDN やそのドメインが含まれていなければ、プロキシを経由することになります。<br>その場合は、プロキシ設定が不要であればリセットするか、バイパスリストに WSUS サーバーを追加することをご検討ください。  </p><ul><li><p>リセットするコマンド</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netsh winhttp reset proxy</span><br></pre></td></tr></table></figure></li><li><p>バイパスリストを追加するコマンド<br>例) URL が <a href="http://wsus.contoso.com:8530/">http://WSUS.contoso.com:8530</a> の場合</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netsh winhttp set proxy proxy-server=&quot;&lt;既存のプロキシ サーバー名&gt;&quot; bypass-list=&quot;&lt;既存のバイパス リスト&gt;;WSUS.contoso.com&quot;</span><br></pre></td></tr></table></figure><p>※ ドメイン名をバイパス リストに追加する場合は、*.contoso.com としてください。</p></li></ul><p>プロキシを経由していないにもかかわらず、StausCode が 503 などのサーバー エラーが返された場合、WSUS サーバー側で問題が発生している可能性があるので、次の確認に進みます。</p><h1 id="WSUS-サーバーの正常性チェック"><a href="#WSUS-サーバーの正常性チェック" class="headerlink" title="WSUS サーバーの正常性チェック"></a>WSUS サーバーの正常性チェック</h1><p>WsusPool の停止などによって、WSUS サーバーが正常に動作していない場合、クライアントからの更新プログラムの確認がエラーとなります。<br>WsusPool の停止が発生している場合、WSUS 管理コンソールが開けない状態となりますので、まず WSUS サーバーにログオンし、WSUS 管理コンソールを起動して、情報が確認できるかどうかご確認ください。  </p><p>WSUS コンソール起動時にエラーが発生して情報が確認できない場合は、<a href="https://jpmem.github.io/blog/wsus/2022-05-23_01/">WSUS コンソールが全く開かなくなってしまった！ WsusPool の停止とは</a> の記事をもとに対処を実施しましょう。</p><h1 id="Windows-Update-クライアントの情報をクリアする"><a href="#Windows-Update-クライアントの情報をクリアする" class="headerlink" title="Windows Update クライアントの情報をクリアする"></a>Windows Update クライアントの情報をクリアする</h1><p>ネットワークやサーバー側に問題がなかった場合、Windows Update クライアントがキャッシュしているファイルの問題の影響で、問題が発生している可能性があります。<br>その場合は、以下の手順で Windows Update クライアントの情報をクリアにした後、事象が解消されるかどうかご確認ください。</p><h2 id="注意事項"><a href="#注意事項" class="headerlink" title="注意事項"></a>注意事項</h2><ul><li>[更新履歴の表示] の情報がクリアされます。(作業履歴の情報ですので 現時点の適用状態や今後の適用動作には全く影響ありません)</li><li>過去クライアント側の操作によって「非表示」設定（処理対象から除外）していた更新プログラムが存在する場合は、その設定が解除されます。</li><li>次回 WSUS にアクセスした際にキャッシュされていた情報を再ダウンロードします。 そのため、同時に多数の端末が実施した場合にはネットワークの負荷が発生する場合があります。</li></ul><h2 id="手順"><a href="#手順" class="headerlink" title="手順"></a>手順</h2><p>以下ステップを順にご実施ください。</p><p><strong>1. Windows Update 関連サービスの停止</strong><br><strong>2. SoftwareDistribution フォルダーのリネーム</strong><br><strong>3. BITS のジョブを削除 (Windows 11 の場合、本手順は不要です。)</strong><br><strong>4. Windows Update 関連サービスの開始</strong><br><strong>5. 更新プログラム検出の確認</strong></p><p>各手順の詳細は以下の通りです。</p><h3 id="1-Windows-Update-関連サービスの停止"><a href="#1-Windows-Update-関連サービスの停止" class="headerlink" title="1. Windows Update 関連サービスの停止"></a><strong>1. Windows Update 関連サービスの停止</strong></h3><p>管理者として実行にて起動したコマンド プロンプト、またはターミナルから以下のコマンドを実行して、サービスを停止します。  </p><ul><li><p>Windows Server 2012 / 2012 R2 の場合</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">net stop wuauserv</span><br><span class="line">net stop bits</span><br></pre></td></tr></table></figure></li><li><p>Windows Server 2016 の場合</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">net stop usosvc</span><br><span class="line">net stop wuauserv</span><br><span class="line">net stop bits</span><br></pre></td></tr></table></figure></li><li><p>Windows 10 / Windows 11 / Windows Server 2019 以降の場合</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">net stop usosvc</span><br><span class="line">net stop wuauserv</span><br><span class="line">net stop bits</span><br><span class="line">net stop dosvc</span><br></pre></td></tr></table></figure></li></ul><h3 id="2-SoftwareDistribution-フォルダーのリネーム"><a href="#2-SoftwareDistribution-フォルダーのリネーム" class="headerlink" title="2. SoftwareDistribution フォルダーのリネーム"></a><strong>2. SoftwareDistribution フォルダーのリネーム</strong></h3><p>以下のコマンドを実行して、更新プログラムが保存されている SoftwareDistribution フォルダーをリネームします。<br>SoftwareDistribution フォルダーは、Windows Update に使用されます。例えば Software Distribution フォルダー配下の Download フォルダーにはダウンロードされた更新プログラムが一時的に保管されます。SoftwareDistribution フォルダーをリネームすることで、これまでダウンロードされた更新プログラムやデータベースの情報がクリアされます。  </p><p>コマンド プロンプトの場合</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ren %systemroot%\SoftwareDistribution SoftwareDistribution.old</span><br></pre></td></tr></table></figure><p>PowerShell コンソール / ターミナルの場合</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Rename-Item &quot;$env:systemroot\SoftwareDistribution&quot; &quot;$env:systemroot\SoftwareDistribution.old&quot;</span><br></pre></td></tr></table></figure><h3 id="3-BITS-のジョブを削除-Windows-11-の場合、本手順は不要です。"><a href="#3-BITS-のジョブを削除-Windows-11-の場合、本手順は不要です。" class="headerlink" title="3. BITS のジョブを削除 (Windows 11 の場合、本手順は不要です。)"></a><strong>3. BITS のジョブを削除 (Windows 11 の場合、本手順は不要です。)</strong></h3><p>以下のコマンドを実行して、ダウンロード中の BITS ジョブを削除します。<br>Windows 10 までの Windows Update は BITS という Windows の機能を利用して、アイドル中のネットワーク回線の帯域幅を使用して、バックグラウンドで更新プログラムをダウンロードします。ダウンロードに失敗した更新プログラムが BITS キューに滞留している場合、以下のコマンドを順番に実行してキューから削除することで、新しくダウンロード ジョブが作成され、ダウンロードに成功する可能性があります。  </p><ul><li>Windows 10 バージョン 1703 以前、Windows Server 2012 / 2012 R2 / 2016 の場合  </li></ul><p>コマンド プロンプトの場合</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">del %ALLUSERSPROFILE%\Microsoft\Network\Downloader\qmgr0.dat</span><br><span class="line">del %ALLUSERSPROFILE%\Microsoft\Network\Downloader\qmgr1.dat</span><br></pre></td></tr></table></figure><p>PowerShell コンソール / ターミナルの場合</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Remove-Item &quot;$env:allusersprofile\Microsoft\Network\Downloader\qmgr0.dat&quot;</span><br><span class="line">Remove-Item &quot;$env:allusersprofile\Microsoft\Network\Downloader\qmgr1.dat&quot;</span><br></pre></td></tr></table></figure><ul><li> Windows 10 バージョン 1703 以降 / Windows Server 2019 以降の場合</li></ul><p>コマンド プロンプトの場合</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">del /Q %ALLUSERSPROFILE%\Microsoft\Network\Downloader\*</span><br></pre></td></tr></table></figure><p>PowerShell コンソール / ターミナルの場合</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Remove-Item &quot;$env:allusersprofile\Microsoft\Network\Downloader\*&quot;</span><br></pre></td></tr></table></figure><h3 id="4-Windows-Update-関連サービスの開始"><a href="#4-Windows-Update-関連サービスの開始" class="headerlink" title="4. Windows Update 関連サービスの開始"></a><strong>4. Windows Update 関連サービスの開始</strong></h3><p>以下のコマンドを実行して、項番 1) で停止したサービスを開始します。最初から停止済みのサービスがあった場合は、開始しなくても構いません。</p><ul><li><p>Windows Server 2012 / 2012 R2 の場合</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">net start wuauserv</span><br><span class="line">net start bits</span><br></pre></td></tr></table></figure></li><li><p>Windows Server 2016 の場合</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">net start usosvc</span><br><span class="line">net start wuauserv</span><br><span class="line">net start bits</span><br></pre></td></tr></table></figure></li><li><p>Windows 10 / Windows 11 / Windows Server 2019 以降の場合</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">net start usosvc</span><br><span class="line">net start wuauserv</span><br><span class="line">net start bits</span><br><span class="line">net start dosvc</span><br></pre></td></tr></table></figure></li></ul><h3 id="5-更新プログラム検出の確認"><a href="#5-更新プログラム検出の確認" class="headerlink" title="5. 更新プログラム検出の確認"></a><strong>5. 更新プログラム検出の確認</strong></h3><p>上記の手順を実施して Windows Update クライアントの情報をクリアした後、以下の手順で更新プログラムの確認を実行します。<br>Windows 10 / Windows Server 2016 以降 / Windows 11 の場合、更新プログラムのチェック実行後、更新プログラムを検出すると、更新プログラムのインストールが開始されることがありますので、予めご留意ください。</p><ul><li>Windows Server 2012 / 2012 R2 の場合<br>[コントロール パネル] - [システムとセキュリティ] - [Windows Update] を開き [更新プログラムの確認] をクリック  </li><li>Windows 10 / Windows Server 2016 以降の場合<br>[設定] - [更新とセキュリティ] - [Windows Update] を開き [更新プログラムのチェック] をクリック</li><li>Windows 11 の場合<br>[設定] - [Windows Update] を開き [更新プログラムのチェック] をクリック  </li></ul><p>コマンドで実行する場合は、以下のコマンドを実行してください。</p><ul><li>Windows Server 2012 / 2012 R2 の場合<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wuauclt /detectnow</span><br></pre></td></tr></table></figure></li><li>Windows 10 / Windows 11 / Windows Server 2016 以降の場合<br>コマンド プロンプトから実行可能なコマンドは用意されておりませんので、以下の PowerShell コマンドを PowerShell コンソールやターミナルより実行してください。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$AutoUpdates = New-Object -ComObject &quot;Microsoft.Update.AutoUpdate&quot;</span><br><span class="line">$AutoUpdates.DetectNow()</span><br></pre></td></tr></table></figure>※ 上記 PowerShell コマンドによる検出処理の実行につきましては Windows 10 version 1709 以降のバージョンでは下記ポリシーにて設定いただいている検出頻度 (既定では 22 時間) 以内で実行した場合に、ブロックされる処理が組み込まれており、実行されませんので、ご留意ください。</li></ul><p><strong>[コンピューターの構成] - [管理用テンプレート] - [Windows コンポーネント] - [Windows Update] - [自動更新の検出頻度]</strong></p><p>例えば、最後に「更新プログラムのチェック」が実行された時刻が 1 時の場合、このコマンドは既定値ですと 22 時間後である 23 時までの間機能しないということです。本 PowerShell コマンドを実行して、機能した場合、以下のように [Windows Update] 画面に「更新プログラムを確認しています…」が表示されます。</p><p><img src="/blog/wsus/2023-06-16_01/2023-06-16_01_1.png"></p><h1 id="上記のいずれも問題なかった場合"><a href="#上記のいずれも問題なかった場合" class="headerlink" title="上記のいずれも問題なかった場合"></a>上記のいずれも問題なかった場合</h1><p>WSUS サーバーも問題なく動作しており、クライアントとサーバー間の接続も問題なかった場合は、WSUS サーバーのパフォーマンス劣化により、クライアントからのリクエストに対する応答に時間がかかることで、タイムアウト エラーが発生している可能性があります。<br>この場合は、まず対象の WSUS サーバーで <a href="https://jpmem.github.io/blog/wsus/2022-05-09_01/">WSUS メンテナンスガイド新版</a> を実施いただき、WSUS サーバーのメンテナンスを実施しましょう。これによって、パフォーマンスを改善し、応答までの時間短縮を試みます。  </p><p>これでもタイムアウトが発生する場合は、可能な限り WSUS サーバー側で不要な更新プログラムを「拒否済み」に設定する対処方法が効果的です。<br>例えば、Windows Server 2016 など、リリースされてから時間が経過している OS の累積更新プログラムについては、過去の更新プログラムとの置換関係を保持し続けている関係上、カタログ情報（メタデータ）が肥大化しているため、「未承認」や「インストール承認」の更新プログラムが多いと、タイムアウト エラーなどが発生しやすくなります。  </p><p>OS の累積更新プログラムについては、最新の更新プログラムを配信していれば、それによって置き換えられた更新プログラムを配信しても、クライアント側に配信されませんので、特別な要件が無い限り「未承認」や「インストール承認」のままにしておく必要はありません。<br>例えば、2023 年 6 月の Windows Server 2016 累積更新プログラムを「インストール承認」している場合、それによって置き換えられた更新プログラムは「拒否済み」にすることができます。<br>「拒否済み」については、<a href="https://jpmem.github.io/blog/wsus/2017-12-11_01/">不要な更新プログラムは「拒否済み」に設定しよう！</a>にて紹介していますので、実施をご検討ください。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。WSUS サポート チームです。&lt;/p&gt;
&lt;p&gt;今回は、WSUS から更新プログラムが配信されない問題が発生したときのチェックポイントをご紹介します。&lt;br&gt;WSUS から更新プログラムが配信される仕組みについては、&lt;a href=&quot;https://j</summary>
      
    
    
    
    
    <category term="WSUS" scheme="https://jpmem.github.io/blog/tags/WSUS/"/>
    
    <category term="チェックポイント" scheme="https://jpmem.github.io/blog/tags/%E3%83%81%E3%82%A7%E3%83%83%E3%82%AF%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88/"/>
    
  </entry>
  
  <entry>
    <title>オンプレミス環境向け UUP 更新プログラムを提供開始しました</title>
    <link href="https://jpmem.github.io/blog/mecm/20230530_01/"/>
    <id>https://jpmem.github.io/blog/mecm/20230530_01/</id>
    <published>2023-05-29T15:00:00.000Z</published>
    <updated>2023-11-07T08:27:44.792Z</updated>
    
    <content type="html"><![CDATA[<p>みなさん、こんにちは。Configuration Manager サポート チームです。</p><p>今回は、3 月28日に開始されたオンプレミス環境向け UUP についてです。<br>UUP とは Unified Update Platform の略で、効率的に更新プログラムをダウンロード・インストールするためのテクノロジーです。UUP により、従来の更新プログラムより高速かつ軽量になります。</p><p>Microsoft Update から更新プログラムを取得するデバイスについては、既に Windows 10 バージョン 1709 以降から UUP が導入されていましたが、この度オンプレミス サーバーで更新プログラムを管理する Configuration Manager や WSUS に対しても UUP の提供が開始されました。</p><p>まず、UUP 自体の詳しい情報は、こちらを参考にしてください。</p><ul><li>Unified Update Platform (UUP) のご紹介<br><a href="https://blogs.windows.com/japan/2017/01/30/unified-update-platform-uup/">https://blogs.windows.com/japan/2017/01/30/unified-update-platform-uup/</a></li></ul><p>オンプレミス環境向け UUP の対象は、Windows 11, version 22H2 の累積更新プログラム、および Windows 10, version 20H1 から Windows 11, version 22H2 までの機能更新プログラムです。</p><p>適用される環境の前提は、以下の通りです。</p><ul><li>Configuration Manager バージョン 2203 以降</li><li>サポートされているすべてのバージョンの WSUS  </li></ul><h2 id="配布ポイントに約-10-GB-が転送される？"><a href="#配布ポイントに約-10-GB-が転送される？" class="headerlink" title="配布ポイントに約 10 GB が転送される？"></a>配布ポイントに約 10 GB が転送される？</h2><p>さて前述のとおり軽量化の利点がある UUP ですが、オンプレミス環境で初めて UUP 対象の更新プログラムを展開する際は、約 10 GB の更新プログラムをダウンロードし、配布ポイントに転送する必要がある点にご注意ください。最初の 1 回配布ポイントに転送すれば、以降の更新プログラムは前月との差分コンテンツのみ転送対象となります。</p><p>なおクライアントは差分をダウンロードするため大きなサイズがダウンロードされる心配はありませんのでご安心ください。</p><p>UUP を利用するために必要となりますので、ぜひ計画の上、ダウンロードを進めてください。</p><p>(参考画像)<br>コンソールから更新プログラムのプロパティ &gt; コンテンツ情報を開くと、サイズが確認できます。<br><img src="/blog/mecm/20230530_01/1.png" alt="image.png"></p><p>(参考情報)  </p><ul><li><p>オンプレミス環境向け UUP のスケジュールや、利点についてまとめています。<br>What’s UUP? New update style coming next week!<br><a href="https://techcommunity.microsoft.com/t5/windows-it-pro-blog/what-s-uup-new-update-style-coming-next-week/ba-p/3773065">https://techcommunity.microsoft.com/t5/windows-it-pro-blog/what-s-uup-new-update-style-coming-next-week/ba-p/3773065</a></p></li><li><p>オンプレミス環境向け UUP において、1 度だけ約 10 GBのコンテンツ ダウンロードがおこなわれる詳細動作を記載しています。<br>Unified Update Platform with ConfigMgr – Questions from the Field<br><a href="https://techcommunity.microsoft.com/t5/core-infrastructure-and-security/unified-update-platform-with-configmgr-questions-from-the-field/ba-p/3815038">https://techcommunity.microsoft.com/t5/core-infrastructure-and-security/unified-update-platform-with-configmgr-questions-from-the-field/ba-p/3815038</a></p></li></ul><ul><li>オンプレミス環境向け UUP の FAQ がまとめられています。<br>Unified update platform (UUP) FAQ’s<br><a href="https://techcommunity.microsoft.com/t5/configuration-manager-blog/unified-update-platform-uup-faq-s/ba-p/3808697">https://techcommunity.microsoft.com/t5/configuration-manager-blog/unified-update-platform-uup-faq-s/ba-p/3808697</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさん、こんにちは。Configuration Manager サポート チームです。&lt;/p&gt;
&lt;p&gt;今回は、3 月28日に開始されたオンプレミス環境向け UUP についてです。&lt;br&gt;UUP とは Unified Update Platform の略で、効率的に更新プロ</summary>
      
    
    
    
    
    <category term="MECM" scheme="https://jpmem.github.io/blog/tags/MECM/"/>
    
  </entry>
  
  <entry>
    <title>Configuration Manager クライアントで Windows Update 配下のポリシーが意図せず未構成になってしまう事象について</title>
    <link href="https://jpmem.github.io/blog/mecm/20230427_01/"/>
    <id>https://jpmem.github.io/blog/mecm/20230427_01/</id>
    <published>2023-05-01T15:00:00.000Z</published>
    <updated>2023-11-07T08:27:44.788Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。Configuration Manager サポート チームです。  </p><p>本日は、Configuration Manager クライアントで Windows Update 配下のポリシーが未構成になってしまう事象についてご紹介いたします。該当のポリシーのパスは以下です。  </p><p>[コンピューターの構成] - [管理用テンプレート] - [Windows コンポーネント] - [Windows Update]  </p><p>Configuration Manager でソフトウェア更新プログラムの管理を行っている場合、以下のポリシーが “有効” になりますが、これらのポリシーが意図せず “未構成” になってしまうケースがございます。  </p><p>・[イントラネットの Microsoft 更新サービスの場所を指定する]<br>・[Windows Update に対するスキャンを発生させる更新遅延ポリシーを許可しない]<br>・[イントラネットの Microsoft 更新サービスの保存場所にある署名済み更新を許可する]  </p><p>このケースに当てはまった場合、特に [イントラネットの Microsoft 更新サービスの場所を指定する] ポリシーが “未構成” になってしまった場合、ソフトウェア更新ポイント（WSUS）サーバーに対してスキャンされないため、インターネットの Windows Update に対してスキャンを行ってしまいます。<br>その結果、意図しない機能更新プログラムや品質更新プログラムがダウンロード、インストールされてしまうため、更新プログラムの管理が行えなくなります。  </p><p>想定される要因として以下 3 つが挙げられ、それぞれの場合について記載させていただきますので、トラブルシューティングのご参考になれば幸いです。  </p><ol><li>Configuration Manager クライアントをアンインストールした。  </li><li>クライアント設定で [クライアントのソフトウェア更新プログラムを有効にする] の設定を “いいえ” にした。  </li><li>60 日間、管理ポイントと通信を行っていない。  </li></ol><h3 id="1-Configuration-Manager-クライアントをアンインストールした。"><a href="#1-Configuration-Manager-クライアントをアンインストールした。" class="headerlink" title="1. Configuration Manager クライアントをアンインストールした。"></a>1. Configuration Manager クライアントをアンインストールした。</h3><p>クライアントをアンインストールすると、Configuration Manager で管理されなくなるため、上記 3 つのポリシーは “未構成” になります。<br>対処としては Configuration Manager クライアントをインストールすることです。  </p><h3 id="2-クライアント設定で-クライアントのソフトウェア更新プログラムを有効にする-の設定を-“いいえ”-にした。"><a href="#2-クライアント設定で-クライアントのソフトウェア更新プログラムを有効にする-の設定を-“いいえ”-にした。" class="headerlink" title="2. クライアント設定で [クライアントのソフトウェア更新プログラムを有効にする] の設定を “いいえ” にした。"></a>2. クライアント設定で [クライアントのソフトウェア更新プログラムを有効にする] の設定を “いいえ” にした。</h3><p>クライアント設定の [ソフトウェア更新プログラム] にて、[クライアントのソフトウェア更新プログラムを有効にする] の設定を “いいえ” に変更した際、[イントラネットの Microsoft 更新サービスの場所を指定する] のローカル ポリシーが “未構成” になります。  </p><p><img src="/blog/mecm/20230427_01/2023-04-28-08-58-50.png">  </p><p>対処としては上記の [クライアントのソフトウェア更新プログラムを有効にする] の設定を “はい” に設定することです。  </p><h3 id="3-60-日間、管理ポイントと通信を行っていない。"><a href="#3-60-日間、管理ポイントと通信を行っていない。" class="headerlink" title="3. 60 日間、管理ポイントと通信を行っていない。"></a>3. 60 日間、管理ポイントと通信を行っていない。</h3><p>Configuration Manager の管理ポイントから取得するポリシーには有効期限が 60日に設定されており、この有効期限の間に管理ポイントと通信をしなかった場合にポリシーが削除されます。  </p><p>ポリシーが削除されたあと、CcmExec サービスが起動することにより、上述のポリシーが “未構成” になってしまいます。<br>なお、再度クライアントが Configuration Manager の管理ポイントと通信を行うとポリシーの取得を行います。<br>その後、ソフトウェア更新ポイントへのスキャンのタイミングで、管理ポイントにソフトウェア更新ポイントの場所を問い合わせ、上述のポリシーがローカル グループ ポリシーに書き込まれます。  </p><p>上記のため、対処としては管理ポイントと通信させることです。  </p><p>以上、ご参考になりましたら幸いです。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。Configuration Manager サポート チームです。  &lt;/p&gt;
&lt;p&gt;本日は、Configuration Manager クライアントで Windows Update 配下のポリシーが未構成になってしまう事象についてご紹介いたします。該</summary>
      
    
    
    
    
    <category term="MECM" scheme="https://jpmem.github.io/blog/tags/MECM/"/>
    
  </entry>
  
  <entry>
    <title>WSUS の仕組み クライアント編</title>
    <link href="https://jpmem.github.io/blog/wsus/2023-05-02_01/"/>
    <id>https://jpmem.github.io/blog/wsus/2023-05-02_01/</id>
    <published>2023-05-01T15:00:00.000Z</published>
    <updated>2023-11-07T08:27:44.924Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。WSUS サポート チームです。</p><p>今回は、WSUS クライアントの仕組みについて、ご紹介していきたいと思います。<br>クライアント はどのような流れで WSUS から更新プログラムの取得するのか、その仕組みについてご紹介したいと思います。仕組みの理解やトラブルシューティングの際にお役立ていただける情報となっていますので是非ご一読ください！  </p><h1 id="WSUS-クライアントの仕組み"><a href="#WSUS-クライアントの仕組み" class="headerlink" title="WSUS クライアントの仕組み"></a>WSUS クライアントの仕組み</h1><p>クライアントが WSUS から更新プログラムを取得するまでの流れは以下の通りです。</p><ol><li>WSUS へ検出処理を実施  </li><li>承認情報の取得  </li><li>ダウンロード及びインストール処理実施  </li></ol><p><img src="/blog/wsus/2023-05-02_01/2023-05-02_01_1.png"></p><p>解説</p><ol><li>WSUS サーバーへ検出処理を実施<br>クライアントは、自動更新の検出動作に基づき、既定で約 22 時間毎に WSUS へ更新プログラムの検出処理を行い、自らに適用が可能か否かを確認する処理を行っています。更新プログラムのメタデータには、検出ロジックと呼ばれる検出条件が組み込まれており、クライアントが更新プログラムを検出するためには、その条件を満たしていることが必要です。WSUS へ検出処理を行う際は、WSUS の IIS を介して WSUS データベース (SUSDB) にアクセスする動作となります。なお、検出処理完了後、クライアントは 更新プログラムの適用状態などを状態レポートとして WSUS へ送信します。状態レポートの詳細については、<a href="https://jpmem.github.io/blog/wsus/2022-07-07_01/">WSUS の仕組み レポート編</a>  をご参照下さい。</li></ol><p>以下は検出条件の一例です。<br>◆2023-04 x64 ベース システム用 Windows 10 Version 22H2 の累積更新プログラム (KB5025221)<br>•    2021 年 5 月 11 日 (KB5003173) 以降の LCU がない場合は、2021 年 8 月 10 日SSU (KB5005260) がインストールされていること  </p><p>◆Windows 11(ビジネス エディション)バージョン 22H2 ja-jp x64<br>・Windows 10 Version 1909 以降であること<br>・システム要件を満たしていること  </p><p>※検出条件は更新プログラムごとに異なり、上記はあくまでも検出条件の部分的な一例となりますので参考までとしていただけますと幸いです。</p><ol start="2"><li><p>承認情報の取得<br>WSUS サーバーで承認されており、かつ、1 の検出処理で検出された更新プログラムのみがダウンロードされます。</p></li><li><p>ダウンロード及びインストール処理実施<br>自動更新の設定に基づき、ダウンロード及びインストールの処理が行われます。<br>クライアントは IIS を介して WSUS サーバーの WSUSContent フォルダにアクセスし、その中に格納された更新プログラムコンテンツファイルをダウンロードします。<br>コンテンツファイルの格納先の確認方法については、<a href="https://jpmem.github.io/blog/wsus/2022-06-06_01/">WSUS の仕組み ダウンロード編</a>  の記事下方の補足情報に記載がございますのでご参照下さい。<br>コンテンツファイルのダウンロード後、OS 側に処理が引き継がれ更新プログラムのインストールが行われます。なお、検出処理完了後と同様に、ダウンロード完了後、インストール完了後にクライアントは WSUS へ状態レポートを送信します。</p></li></ol><p>参考情報：<br><a href="https://learn.microsoft.com/ja-jp/windows-server/administration/windows-server-update-services/deploy/4-configure-group-policy-settings-for-automatic-updates#configure-automatic-updates">自動更新の構成</a><br><a href="https://learn.microsoft.com/ja-jp/windows-server/administration/windows-server-update-services/deploy/4-configure-group-policy-settings-for-automatic-updates#automatic-updates-detection-frequency">自動更新の検出頻度</a></p><h1 id="トラブルシュート方法"><a href="#トラブルシュート方法" class="headerlink" title="トラブルシュート方法"></a>トラブルシュート方法</h1><p>更新プログラムの適用に失敗するなどの事象発生時にはログを確認し、どのフェーズで失敗しているかを確認することが問題の切り分けに有効な手段となります。検出、ダウンロード、インストールの処理については、ReportingEvents.log にて簡易的にご確認いただけます。ログの見方については、<a href="https://jpmem.github.io/blog/wsus/2018-02-02_01/">ReportingEvents.log の見方</a>をご参照ください。<br>（インストール処理のログについては、その更新プログラムの名称が記録されますが、ダウンロード処理のログに関しては、更新プログラムの UpdateID で記録されます。※UpdateID は WSUS コンソールにて更新プログラムをクリックした際の下方に表示される “その他の詳細” より確認いただけます。）<br><img src="/blog/wsus/2023-05-02_01/2023-05-02_01_2.png"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。WSUS サポート チームです。&lt;/p&gt;
&lt;p&gt;今回は、WSUS クライアントの仕組みについて、ご紹介していきたいと思います。&lt;br&gt;クライアント はどのような流れで WSUS から更新プログラムの取得するのか、その仕組みについてご紹介したいと思います</summary>
      
    
    
    
    
    <category term="WSUS" scheme="https://jpmem.github.io/blog/tags/WSUS/"/>
    
  </entry>
  
  <entry>
    <title>カスタム セキュリティ ロールで RBAC を設計する方法(RBA Viewer の基本的な使い方)</title>
    <link href="https://jpmem.github.io/blog/mecm/20230412_01/"/>
    <id>https://jpmem.github.io/blog/mecm/20230412_01/</id>
    <published>2023-04-11T15:00:00.000Z</published>
    <updated>2023-11-07T08:27:44.784Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。Configuration Manager サポート チームです。  </p><p>今回は、Configuration Manager にカスタム セキュリティ ロールを作成し、管理コンソールのアクセス制御を行う方法をご案内します。</p><p>Configuration Manager にはロールベースのアクセス制御を行う機能が備わっており、「完全な権利を持つ管理者」や「読み取り専用アナリスト」など、異なるアクセス許可の組み合わせを割り当て済みの幾つかのセキュリティ ロールが予め用意されています。そして、任意のユーザーやグループに一つ以上のセキュリティ ロールを割り当てることで、ロール ベースのアクセス制御(RBAC)を実現することが可能です。</p><p><a href="https://learn.microsoft.com/ja-jp/mem/configmgr/core/servers/deploy/configure/configure-role-based-administration">Configuration Managerのロールベースの管理を構成する</a></p><p>更に、組み込みのセキュリティ ロールとは異なる単位でアクセス許可を設定したい場合は、任意のアクセス許可を割り当てたカスタム セキュリティ ロールを新規に作成することが可能ですが、各アクセス許可が具体的にどの操作を表すか、アクセス許可の名称からは判断が難しい場合があるため、アクセス許可と管理コンソール上の操作との紐づけについてしばしばお問い合わせいただくことがあります。</p><p><img src="/blog/mecm/20230412_01/20230412_01_01.png" alt="図 1: アクセス許可の例"></p><p>実際にアクセス許可を割り当てた上で動作確認する方法もありますが、この様な場合は、Configuration Manager ツールと呼ばれる付属ツール一式に含まれる「RBA Viewer」をご利用いただくことをお勧めします。RBA Viewer は、実際の管理コンソール上の各項目にどのアクセス許可が必要か確認しながらセキュリティ ロールを設計し、設計した内容を管理コンソールからインポート可能な形式でエクスポート可能なツールです。また、既存のセキュリティ ロールを読み込み、管理コンソール上の表示のイメージの確認を行うことも可能です。</p><p>そこで当記事では、RBA Viewer の使用にフォーカスしながら、実際にアクセス許可を構成し、カスタム セキュリティ ロールを作成するまでの流れをご説明します。</p><p>なお、Configuration Manager では、セキュリティ ロールとは別に、セキュリティ スコープを併用することで更に各オブジェクトのアクセス制御を行うことが可能です。また、管理ユーザー単位で各コレクションへのアクセスを制御することも可能ですが、いずれも当記事では触れません。セキュリティ ロールと併せて設定を行う場合は、それぞれ以下のドキュメントをご確認ください。</p><ul><li><a href="https://learn.microsoft.com/ja-jp/mem/configmgr/core/servers/deploy/configure/configure-role-based-administration#configure-security-scopes-for-an-object">セキュリティ スコープの構成方法</a></li><li><a href="https://learn.microsoft.com/ja-jp/mem/configmgr/core/servers/deploy/configure/configure-role-based-administration#configure-collections-to-manage-security">コレクションのアクセス許可</a></li></ul><h2 id="RBA-Viewer-の概要"><a href="#RBA-Viewer-の概要" class="headerlink" title="RBA Viewer の概要"></a>RBA Viewer の概要</h2><p>製品のドキュメントとしては以下でご案内しています。実行前に前提条件をご確認ください。</p><p><a href="https://learn.microsoft.com/ja-jp/mem/configmgr/core/support/rbaviewer">ロールベース管理および監査ツール</a></p><p>RBA Viewer は、バージョン 2107 以降は管理コンソールとともにインストールされますが、スタートメニューには表示されないため、起動する場合は管理コンソールのインストール先ディレクトリ(既定では <code>\Program Files (x86)\Microsoft Endpoint Manager\AdminConsole\bin</code>)内の <code>RBAViewer.exe</code> を直接実行します。必要に応じてショートカットを作成しておくと良いです。</p><p>RBA Viewer を起動すると、図 2 の様なウィンドウが起動します。</p><p><img src="/blog/mecm/20230412_01/20230412_01_02.png" alt="図 2: RBA Viewer のウィンドウ"></p><p>カスタム セキュリティ ロールを設計する際は、基本的には以下の流れで操作を行うことになりますが、詳細は以下のセクションで随時ご説明します。</p><ol><li>左上の [Security Roles] からベースとなるセキュリティ ロールを選択し、読み込む</li><li>左下の [Analyze] ボタンをクリックし、選択済みのアクセス許可の内容を、右側の Admin Console タブに反映する</li><li>右側の Admin Console タブでアクセスが必要/不要な項目を確認し、左側のアクセス許可の有効化/無効化を行う</li><li>Admin Console タブの内容が満足する結果となるまで 2 と 3 を繰り返す</li><li>選択したアクセス許可を左下の [Export] ボタンで XML ファイルにエクスポートする</li><li>管理コンソールで、XML ファイルをカスタム セキュリティ ロールとしてインポートする</li><li>管理コンソールで、インポートしたカスタム セキュリティ ロールの動作確認を行う</li></ol><h2 id="既存のセキュリティ-ロールのアクセス許可を確認する"><a href="#既存のセキュリティ-ロールのアクセス許可を確認する" class="headerlink" title="既存のセキュリティ ロールのアクセス許可を確認する"></a>既存のセキュリティ ロールのアクセス許可を確認する</h2><p>RBA Viewer を起動した直後は全てのアクセス許可が選択された状態ですが、[Security Roles] から既存のセキュリティ ロールを選択することで、そのセキュリティ ロールに割り当てられているアクセス許可のみが選択された状態になります。[Security Roles] から選択可能なセキュリティ ロールは、カスタム セキュリティ ロールを除き英語表記となりますが、概ね直訳のため、以下のリンク先を参考に選択ください。</p><p><a href="https://learn.microsoft.com/ja-jp/mem/configmgr/core/understand/fundamentals-of-role-based-administration#security-roles">組み込みのセキュリティ ロール一覧</a></p><p>今回は、組み込みのセキュリティ ロールの一つである「読み取り専用アナリスト(Read-only Analyst)」を選択することにします。読み取り専用アナリストは、その名の通り読み取り専用のロールであり、基本的に変更操作を行えない様にアクセス許可が割り当てられています。そのため、読み取り専用アナリストをベースにして不要なアクセス許可を削除することで、権限の弱いロールを設計することが可能です。</p><p>それでは実際に [Security Roles] からセキュリティ ロール「Read-only Analyst」を選択し、読み込んでみます。セキュリティ ロールの読み込みを行うと、図 3 の様に左側のアクセス許可の幾つかが有効化されます。なお、管理コンソールからカスタム セキュリティ ロールを新規作成する場合はベースとなるセキュリティ ロールの選択が必要ですが、RBA Viewer で設計を行うにあたっては、既存のセキュリティ ロールの読み込みは必ずしも必要ではありません。例えばごく一部の項目のみ表示可能なロールを設計したい場合は、読み込みを行わずにゼロからアクセス許可を追加した方が早いこともありますので、ニーズに合わせて判断ください。</p><p><img src="/blog/mecm/20230412_01/20230412_01_03.png" alt="図 3: 読み取り専用アナリスト(Read-only Analyst) 選択後"></p><p>セキュリティ ロールの読み込み直後は、右側の Admin Console タブに変化はありません。アクセス許可の有効化や無効化を行っても即時に反映されないため、現在のアクセス許可に基づく管理コンソールのイメージを確認したい場合は、[Analyze] をクリックする必要があります。アクセス許可を変更した際は、クリックを忘れないようにご注意ください。</p><p>Admin Console タブ内は、実際の管理コンソールの様に各メニュー項目をクリックし動作を確認することが可能です。例えば <code>[ソフトウェア ライブラリ] - [概要] - [アプリケーション管理] - [パッケージ]</code> を選択すると図 4 の様に表示されますが、この画面に到るまでに管理コンソール上に <code>[ソフトウェア ライブラリ]</code> のメニュー項目が表示されており、更に <code>[パッケージ]</code> が選択可能となっていた筈です。これは、現在のアクセス許可の選択に基づいた場合、それぞれが表示および選択可能となっていることを表します。すなわち、Admin Console タブ内で実際にできることが管理コンソールでできることになるため、実際の管理コンソールを操作しなくてもイメージを掴むことが可能です。なお、Admin Console タブには、選択したメニュー項目によって実際のレコードの内容が表示されますが、RBA Viewer で行った操作が Configuration Manager へ影響を与えることはありませんので、色々な項目の表示を試してみてください。</p><p><img src="/blog/mecm/20230412_01/20230412_01_04.png" alt="図 4: パッケージの選択後"></p><p>ここまでの操作でお気づきかもしれませんが、Admin Console タブで項目を選択すると、画面右側の「Tasks」の下に、「Actions」や「Query Actions」という項目が表示されます。これらはメニュー項目内で実施できるアクションの分類を表しますが、それぞれ以下の意味です。</p><ul><li>Actions: レコードに関係なく、その項目内で実行可能なアクション(コンソール画面上部のボタン)</li><li>Query Actions: その項目内に表示されるレコードに対して実行可能なアクション(レコードを選択した状態で表示されるコンソール画面上部のボタンや右クリックメニューの内容)</li></ul><p>また、それぞれの分類の配下に表示されているアクションの内容により文字色が黒であったりグレーであったりしますが、それぞれ以下の意味です。</p><ul><li>黒: 実行が許可されているアクション</li><li>グレー: 実行が許可されていないアクション</li></ul><p>例えば <code>[ソフトウェア ライブラリ] - [概要] - [アプリケーション管理] - [パッケージ]</code> の場合は、図 4 では</p><ul><li>Actions<ul><li>作成=&gt;(グレー)</li></ul></li><li>Query Actions<ul><li>パッケージ=&gt;(黒)</li><li>パッケージ変換=&gt;(グレー)</li><li>展開=&gt;(黒)</li><li>分類=&gt;(グレー)</li><li>プロパティ=&gt;(黒)</li></ul></li></ul><p>の様に表示されていますが、これはパッケージの作成は不可であるものの、既存の各パッケージに対する一部のアクションが許可されていることを表します。なお、各アクションの末尾に「=&gt;」が付与されている場合はそのアクションは入れ子になっていることを表し、例えば上記は [展開] が黒ですが、この場合はパッケージの展開が可能と判断するのではなく、[展開] をクリックして表示される配下のアクションの状態を確認して判断します。</p><p>実際に [展開] をクリックすると図 5 の様に</p><ul><li>展開=&gt;(黒)<ul><li>展開(グレー)</li><li>コンテンツの配布(黒)</li><li>配布ポイントの更新(グレー)</li></ul></li></ul><p>であることを確認できますが、これ以上入れ子になっていないため、この時点で [コンテンツの配布] が許可されていると判断可能です。</p><p><img src="/blog/mecm/20230412_01/20230412_01_05.png" alt="図 5: 展開をクリックした後"></p><p>ここまでで、セキュリティ ロールの読み込みから Admin Console タブの確認方法をご説明しましたが、次のセクションからは実際にセキュリティ ロールを設計する上で必要となるアクセス許可の追加や削除の方法についてご説明します。</p><h2 id="必要なアクセス許可を追加する"><a href="#必要なアクセス許可を追加する" class="headerlink" title="必要なアクセス許可を追加する"></a>必要なアクセス許可を追加する</h2><p>実行が許可されていないアクションはグレーの文字で表示されることをご説明しましたが、各アクションの許可をするためには何らかのアクセス許可を付与する必要があります。具体的にどのアクセス許可が必要となるかは、該当のアクションにマウスのカーソルを置くと表示されるポップアップの内容から確認できます。</p><p><img src="/blog/mecm/20230412_01/20230412_01_06.png" alt="図 6: 項目にマウスのカーソルを置いた場合"></p><p>例えば図 6 では、パッケージの [展開] がグレーアウトされている状態で [展開] にカーソルを置くと</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">コレクション: Read/Deploy Packages</span><br><span class="line">パッケージ: Read</span><br></pre></td></tr></table></figure><p>と表示されていますが、これは、[展開] を行うためにはコレクションの Read および Deploy Packages とパッケージの Read のアクセス許可が必要であることを表します。すなわち、これらのアクセス許可を追加することで、パッケージの [展開] が可能となることが分かります。実際にそれぞれのアクセス許可をウィンドウの左側から探して有効化し [Analyze] をクリックすると、図 7 の様に [展開] がグレーから黒へ変わります。</p><p><img src="/blog/mecm/20230412_01/20230412_01_07.png" alt="図 7: アクセス許可を追加後"></p><p>この様に、管理コンソールから行いたい操作や表示したい項目にマウスのカーソルを置くことで必要なアクセス許可を確認することができます。</p><p>なお、日本語版の管理コンソールでは Read や Deploy Package の部分はそれぞれ「読み取り」と「パッケージの展開」と翻訳されるため表記は異なりますが、RBA Viewer からエクスポートした XML ファイルを管理コンソールにインポートした後は、日本語表記へ置き換わります。</p><h2 id="不要なアクセス許可を削除する"><a href="#不要なアクセス許可を削除する" class="headerlink" title="不要なアクセス許可を削除する"></a>不要なアクセス許可を削除する</h2><p>実行可能なアクションや表示可能な項目を不許可にしたり非表示にする場合は、アクセス許可の追加時と同じ要領でアクセス許可を確認し、それらを無効化することで可能です。</p><p>例えば <code>[ソフトウェア ライブラリ] - [概要] - [アプリケーション管理] - [パッケージ]</code> の場合は</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">パッケージ: Read</span><br></pre></td></tr></table></figure><p>のアクセス許可が必要ですが、これを無効化することで図 8 の様に非表示にすることが可能です。</p><p><img src="/blog/mecm/20230412_01/20230412_01_08.png" alt="図 8: パッケージを非表示にした状態"></p><h2 id="設計内容を-Configuration-Manager-へインポートする"><a href="#設計内容を-Configuration-Manager-へインポートする" class="headerlink" title="設計内容を Configuration Manager へインポートする"></a>設計内容を Configuration Manager へインポートする</h2><p>セキュリティ ロールの設計が完了したら、[Export] ボタンをクリックすることで XML ファイルへエクスポートすることができますが、この XML ファイルを管理コンソールからインポートを行うことで、一つのセキュリティ ロールとして扱える様になります。</p><p>XML ファイルをインポートする際は、図 9 の様に管理コンソールで <code>[管理] - [概要] - [セキュリティ] - [セキュリティ ロール]</code> を開き、[セキュリティ ロールのインポート] をクリックします。インポート後は、ファイル名と同じ名称のセキュリティ ロールが作成されます(名称は変更可能です)。実際に管理コンソールで動作確認を行った上で、正式に利用いただければ幸いです。</p><p><img src="/blog/mecm/20230412_01/20230412_01_09.png" alt="図 9: セキュリティ ロールのインポート"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。Configuration Manager サポート チームです。  &lt;/p&gt;
&lt;p&gt;今回は、Configuration Manager にカスタム セキュリティ ロールを作成し、管理コンソールのアクセス制御を行う方法をご案内します。&lt;/p&gt;
&lt;p&gt;C</summary>
      
    
    
    
    
    <category term="MECM" scheme="https://jpmem.github.io/blog/tags/MECM/"/>
    
  </entry>
  
  <entry>
    <title>Configuration Manager のリリース サイクル変更のお知らせ</title>
    <link href="https://jpmem.github.io/blog/mecm/20230404_01/"/>
    <id>https://jpmem.github.io/blog/mecm/20230404_01/</id>
    <published>2023-04-03T15:00:00.000Z</published>
    <updated>2023-11-07T08:27:44.784Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。Configuration Manager サポート チームです。  </p><p>この度、Configuration Manager のリリース サイクルの変更が <a href="https://techcommunity.microsoft.com/t5/configuration-manager-blog/bg-p/ConfigurationManagerBlog">Configuration Manager Blog</a> にて発表されましたので、本ブログでもお知らせいたします。具体的な内容は、次の通りです。</p><ul><li>リリース サイクルが年 3 回 (XX03, XX07, XX11) から年 2 回 (XX03, XX09) となります。</li><li>ベースライン バージョンは XX03 となります。(従来から変更はありません。)</li><li>Technical Preview（TP）は、年 4 回のリリースとなり、その中の 2 つは、本番リリース前にリリースされます。</li><li>サポート サイクルはリリース日から 18 ヶ月間です。(従来から変更はありません。)</li></ul><p>詳細は、Configuration Manager Blog の <a href="https://techcommunity.microsoft.com/t5/configuration-manager-blog/release-cadence-changes-to-microsoft-configuration-manager/ba-p/3785508">Release Cadence Changes to Microsoft Configuration Manager</a> にてご案内しておりますので、ご確認くださいますようお願いいたします。</p><h2 id="抄訳"><a href="#抄訳" class="headerlink" title="抄訳"></a>抄訳</h2><p>この記事では、Microsoft Configuration Manager のリリース サイクル変更に関する情報についてご案内します。Configuration Manager 2303 ベースライン バージョンのリリース後、新しいリリース サイクルを導入します。<br>Configuration Manager の以前のアップデートで導入された変更、ブランディング、およびベースラインについては、<a href="https://learn.microsoft.com/ja-jp/mem/configmgr/core/plan-design/changes/whats-new-incremental-versions">Configuration Manager増分バージョンの新機能</a>、<a href="https://learn.microsoft.com/ja-jp/mem/configmgr/core/understand/configuration-manager-faq">Microsoft Configuration Manager FAQ</a>、および、<a href="https://learn.microsoft.com/ja-jp/mem/configmgr/core/servers/manage/updates#bkmk_Baselines">ベースラインと更新プログラムのバージョン</a>を参照してください。</p><p>Windows が年 1 回の更新モデルに移行しており、Configuration Manager も<strong>年 3 回の更新から 2 回の更新に移行</strong>することで、そのサイクルに合わせます。2303 以降の Microsoft Configuration Manager の次のリリースは、2023 年 9 月、バージョン2309 になります。事実上、xx07 と xx11 のアップデートは、xx09 のアップデートに統合されることになります。アップデートの統合により、このリリースに機能強化が組み込まれることになります。また、もう 1 つのメリットとして、お客様が毎年管理しなければならない展開の数を減らすことができます。</p><p>この変更により、Windows のリリース サイクルとの整合性が向上し、Configuration Manager の展開の管理が軽減されるとともに、Configuration Manager の開発サイクルが長くなることで、高品質のアップデートを提供し続けながら、お客様からの主要な機能要求に対応できるようになります。この変更と開発サイクルの延長により、Configuration Manager 2309 のアップデートでは、<strong>ポリシーの同期、ソフトウェア更新プログラムのトラブルシューティング、アラートやダッシュボード機能の改善など、お客様から寄せられた主要な要望に対応することができます</strong>。また、Hotfix ロールアップとセキュリティ更新プログラムは、重要なバグに対処するため、必要に応じて引き続き提供されます。</p><p><strong>リリース サイクル変更の概要</strong>  </p><ul><li>2023 年から、Configuration Manager のリリースは、従来の xx03、xx07、xx11 から、3月（xx03）、9月（xx09）の 2 回に変更されます。</li><li>ベースライン バージョンは、新しい Configuration Manager のサイトと階層のインストール、またはサポートされているバージョンの Configuration Manager からのアップグレードに使用することができます。2303、2403…がベースライン リリースになります。 </li><li>Technical Preview（TP）は、年に 4 回リリースします。2 つは、各 Current Branch バージョンの本番リリース前にリリースされます。また、Technical Preview リリースの中の 1 つはベースライン リリースとなります。(Technical Preview ベースラインの評価期間は、180 日です。）</li><li>  現在の Current Branch サポート サイクルに変更はありません。各 Current Branch バージョンは、一般提供のリリース日から 18 ヶ月間、サポートが継続されます。詳細は、<a href="https://learn.microsoft.com/ja-jp/mem/configmgr/core/servers/manage/current-branch-versions-supported">現在のブランチ バージョンConfiguration Managerサポート</a>を参照してください。</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。Configuration Manager サポート チームです。  &lt;/p&gt;
&lt;p&gt;この度、Configuration Manager のリリース サイクルの変更が &lt;a href=&quot;https://techcommunity.microsoft.c</summary>
      
    
    
    
    
    <category term="MECM" scheme="https://jpmem.github.io/blog/tags/MECM/"/>
    
  </entry>
  
  <entry>
    <title>ソフトウェアの更新ポイントがクライアントのスキャン先として設定されない原因と対応の例 - CWuaHandler::SetCategoriesForStateReportingExclusion</title>
    <link href="https://jpmem.github.io/blog/mecm/20230327_01/"/>
    <id>https://jpmem.github.io/blog/mecm/20230327_01/</id>
    <published>2023-03-26T15:00:00.000Z</published>
    <updated>2023-11-07T08:27:44.784Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。Configuration Manager サポート チームです。  </p><p>今回は、Configuration Manager でソフトウェアの更新ポイント(以下、SUP と呼びます)を構成している環境で、クライアントのスキャン先が SUP とならない原因とその対応の例についてご案内します。具体的には、Configuration Manager クライアントのログの一つであるWUAHandler.log に</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CWuaHandler::SetCategoriesForStateReportingExclusion</span><br></pre></td></tr></table></figure><p>が記録されているケースを取り上げます。</p><p>Configuration Manager で更新プログラムを配信するためには、クライアントは SUP の役割を持ったサイト サーバーに対して更新プログラムのスキャンを行い、スキャンの結果、その更新プログラムが必要と判定されている必要があります。その後、その更新プログラムを含む展開ポリシーを受け取ったクライアントは、更新プログラムを配布ポイント等からダウンロードします。</p><p>サイト サーバーとクライアントが適切に構成されていれば、通常はクライアントのスキャン先はスキャンを行うタイミングで境界グループに基づき自動で SUP を向く様に構成されますが、もし構成されない場合はスキャンを行えず、その結果、クライアントに更新プログラムが配信されません。あるいは、環境によっては意図せず Microsoft Update 経由で更新プログラムがインストールされてしまうこともあります。</p><p>上記のメッセージが WUAHandler.log に記録されており、クライアントのスキャン先として SUP が設定されていないことが判明した場合は、以下にご案内する方法をお試しください。</p><h2 id="事象を特定する"><a href="#事象を特定する" class="headerlink" title="事象を特定する"></a>事象を特定する</h2><p>Configuration Manager クライアントが更新プログラムのスキャンを実行した際は、ローカル グループ ポリシー(ポリシー名「イントラネットの Microsoft 更新サービスの場所を指定する」)経由でスキャン先が構成されますが、構成された結果、設定値は <code>HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate</code> 以下のレジストリ値 <code>WUServer</code> および <code>WUStatusServer</code> に反映されます。例えば、通常は以下のように設定されます。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate]</span><br><span class="line">&quot;WUServer&quot;=&quot;http://&lt;SUP の FQDN&gt;:8530&quot;</span><br><span class="line">&quot;WUStatusServer&quot;=&quot;http://&lt;SUP の FQDN&gt;:8530&quot;</span><br></pre></td></tr></table></figure><p>もしこれらのレジストリ値が設定されていない場合は正しくスキャン先が設定されていないことになり、SUP に対してスキャンが行われません。このとき、更にクライアントの <code>C:\Windows\CCM\Logs\WUAHandler.log</code> に以下で始まるメッセージが記録されている場合、当記事のケースに該当すると判断できます。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CWuaHandler::SetCategoriesForStateReportingExclusion</span><br></pre></td></tr></table></figure><h2 id="原因と解決策"><a href="#原因と解決策" class="headerlink" title="原因と解決策"></a>原因と解決策</h2><p>原因としては設定に起因する場合と何らかの問題に起因する場合が考えられますが、境界グループの設定あるいはクライアント設定に起因するお問い合わせを多く頂いていますので、まずは以下のセクションの内容をご確認ください。いずれも問題ない場合は詳細な調査が必要となるため、弊社サポート窓口までお問い合わせいただければ幸いです。</p><h3 id="境界グループの設定"><a href="#境界グループの設定" class="headerlink" title="境界グループの設定"></a>境界グループの設定</h3><p>クライアントが SUP をスキャン先として使用するためには、予め SUP を境界グループに追加しておく必要があります。更に、その境界グループにクライアントが紐づいている必要があります。いずれかが満たされない場合はクライアントは SUP を認識できず、スキャン先として設定できません。</p><p>状況を確認するためには、まずクライアントが紐づく境界グループを特定する必要があります。方法は幾つかありますが、例えば管理コンソールの <code>[資産とコンプライアンス] - [概要] - [デバイス]</code> に「境界グループ」列を表示させることで確認可能です(列名が表示されている部分を右クリックすると表示する列を変更できます)。もし境界グループ列に何も表示されていない場合は、どの境界グループにも紐づいていない状態ですので、クライアントを境界グループに紐づけてください。</p><p><img src="/blog/mecm/20230327_01/20230327_01_01.png" alt="デバイス一覧から境界グループを確認可能"></p><p>クライアントと境界グループの紐づけに問題がなければ、次に管理コンソールの <code>[管理] - [概要] - [階層の構成] - [境界グループ]</code> から該当の境界グループのプロパティを開き、「参照」タブ内に SUP の役割を持つサーバーが含まれることを確認します。SUP が含まれていない場合は、その境界グループに紐づくクライアントは参照する SUP が存在しないことになるため、更新プログラムのスキャンに失敗します。そのため、境界グループへ SUP の追加が必要になります。</p><p>境界グループへのクライアントの紐づけやサーバーを追加する手順は以下の記事が参考になりますので、該当する場合は必要に応じて参照ください。</p><p><a href="https://jpmem.github.io/blog/mecm/20180706_02/">参考記事: Configuration Manager から配信しているコンテンツのダウンロードが開始されない</a></p><h3 id="クライアント設定"><a href="#クライアント設定" class="headerlink" title="クライアント設定"></a>クライアント設定</h3><p>クライアントがローカル グループ ポリシー経由でスキャン先等を設定するためには、クライアント設定 [クライアントのソフトウェア更新プログラムを有効にする] を [はい] へ設定する必要があります。</p><p><img src="/blog/mecm/20230327_01/20230327_01_02.png" alt="該当の設定はソフトウェア更新プログラム配下にあります"></p><p>この設定を有効化しないと、境界グループに問題がない場合もスキャン先が設定されません。既定では有効化される項目ですが、意図せず無効化していないかご確認ください。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。Configuration Manager サポート チームです。  &lt;/p&gt;
&lt;p&gt;今回は、Configuration Manager でソフトウェアの更新ポイント(以下、SUP と呼びます)を構成している環境で、クライアントのスキャン先が SUP </summary>
      
    
    
    
    
    <category term="MECM" scheme="https://jpmem.github.io/blog/tags/MECM/"/>
    
  </entry>
  
  <entry>
    <title>WSUS 経由で WebView2 Runtime を更新する手順</title>
    <link href="https://jpmem.github.io/blog/wsus/2023-03-27_01/"/>
    <id>https://jpmem.github.io/blog/wsus/2023-03-27_01/</id>
    <published>2023-03-26T15:00:00.000Z</published>
    <updated>2023-11-07T08:27:44.920Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。WSUS サポート チームです。</p><p>今回は、WSUS 経由で WebView2 Runtime を更新する手順をご紹介いたします。<br>WSUS より WebView2 Runtime の更新を 管理する場合に参考となるかと存じますので是非ご一読ください。<br>なお、本記事は WebView2 Runtime のバージョンを WSUS 経由で更新する際の手順となります。WebView2 Runtime の初期インストールにつきましては、WSUS から配信することはできませんのでご留意ください。  </p><h1 id="1-WebView2-の自動更新を制御する"><a href="#1-WebView2-の自動更新を制御する" class="headerlink" title="1. WebView2 の自動更新を制御する"></a>1. WebView2 の自動更新を制御する</h1><p>WSUSで WebView2 Runtime の更新を管理する場合、WebView2 Runtime 自動更新を制御しておく必要があります。以下の公開ブログにてご案内させていただいております WebView2 Runtime の更新制御するためのポリシーまたはレジストリを追加いただくようお願いいたします。なお、こちらのポリシーについては Active Directory 配下のクライアントである必要がございますのでご留意ください。  <a href="https://jpdsi.github.io/blog/internet-explorer-microsoft-edge/how-and-why-to-update-edge/#4-WebView2-%E3%81%AE%E6%9B%B4%E6%96%B0%E5%88%B6%E5%BE%A1">4) WebView2 の更新制御</a></p><h1 id="2-WSUS-から-WebView2-の更新を配信する"><a href="#2-WSUS-から-WebView2-の更新を配信する" class="headerlink" title="2. WSUS から WebView2 の更新を配信する"></a>2. WSUS から WebView2 の更新を配信する</h1><p>WSUS コンソールで [ オプション ] &gt; [ 製品と分類 ] を開きます。<br>製品： Microsoft Edge 、分類： 更新 にチェックを追加し、更新プログラムを同期します。<br><img src="/blog/wsus/2023-03-27_01/2023-03-27_01_1.png">  </p><p>WebView2 Runtime 向けの更新プログラムが同期されますので、WSUS にて承認作業を行います。<br><img src="/blog/wsus/2023-03-27_01/2023-03-27_01_2.png"></p><p>クライアントが WSUS にアクセスしたタイミングで承認情報を受け取り、更新プログラムの適用処理が行われます。具体的には、クライアントは、（ランダム時間を含む）既定で約 22 時間毎に WSUS へ検出処理が行われ、自動更新の設定に基づきダウンロード、インストールの処理を実施します。<br><img src="/blog/wsus/2023-03-27_01/2023-03-27_01_3.png"></p><p>WebView2 Runtime のバージョンが更新されます。<br>更新プログラム適用前<br><img src="/blog/wsus/2023-03-27_01/2023-03-27_01_4.png"></p><p>更新プログラム適用後<br><img src="/blog/wsus/2023-03-27_01/2023-03-27_01_5.png"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。WSUS サポート チームです。&lt;/p&gt;
&lt;p&gt;今回は、WSUS 経由で WebView2 Runtime を更新する手順をご紹介いたします。&lt;br&gt;WSUS より WebView2 Runtime の更新を 管理する場合に参考となるかと存じますので是</summary>
      
    
    
    
    
    <category term="WSUS" scheme="https://jpmem.github.io/blog/tags/WSUS/"/>
    
  </entry>
  
  <entry>
    <title>Microsoft Configuration Manager 自習書シリーズ 1 Microsoft Configuration Manager とは</title>
    <link href="https://jpmem.github.io/blog/mecm/20230316_01/"/>
    <id>https://jpmem.github.io/blog/mecm/20230316_01/</id>
    <published>2023-03-15T15:00:00.000Z</published>
    <updated>2023-11-07T08:27:44.780Z</updated>
    
    <content type="html"><![CDATA[<p>皆様、Microsoft Configuration Manager サポート チームの箱木です。</p><p>本日より、本ブログの連載企画として Microsoft Configuration Manager の公開情報などを整理し、これから管理者となる方や導入を検討されている方が知っておくべきポイントなどをお伝えする予定です。</p><p>今回は公開情報：<a href="https://learn.microsoft.com/ja-jp/mem/configmgr/core/understand/introduction">Configuration Manager とは</a> をベースに Microsoft Configuration Manager の歴史や機能についてご紹介します。</p><p>現在の最新バージョンである Configuration Manager (Current Branch) では、本製品の所属するブランドについて、以下のように記述されております。</p><blockquote><p><strong>Configuration Managerは、Microsoft Intune製品ファミリの一部です。</strong></p></blockquote><p>Configuration Manager は過去 Microsoft 社内のデバイス構成を管理することが目的に開発され、1994 年に Systems Management Server 1.0 として製品化されました。<br>その後 Systems Management Server 2003 、System Center Configuration Manager 2007 、System Center 2012 Configuration Manager を経て現在の Configuration Manager (Current Branch) に進化してきた歴史があります。<br>主にオンプレミスにあるデバイスを管理する目的の製品群である System Center 製品ファミリーでしたが、現在は上記のように <strong>Microsoft Cloud のパワーを利用しながら、Configuration Manager への既存の投資を活かしつづける</strong> ことが現在の Intune 製品ファミリーとなった背景です。</p><h1 id="概要"><a href="#概要" class="headerlink" title="概要"></a>概要</h1><p>「製品が想定する用途、シナリオ」として、公開情報の <strong>IT の生産性と効率を向上させる</strong> 節でご案内している通り、ハードウェアやソフトウェアに対する展開や分析を行うことが主たる機能です。<br>重要なポイントは Configuration Manager は資産管理ツールではなく、構成管理ツールであることを理解しておきましょう。</p><p>ソフトウェア資産管理（SAM）目的に利用できる機能は備えておりますが、製品のデザインや設計思想は <strong>いかに効率よくデバイスを構成、管理するか</strong> が主目的であるため何のために Configuration Manager の機能を利用したいのかを明確にしておくと導入や運用におけるギャップは少なくなるでしょう。</p><h1 id="ユーザー-インターフェース"><a href="#ユーザー-インターフェース" class="headerlink" title="ユーザー インターフェース"></a>ユーザー インターフェース</h1><p>Configration Manager のインターフェースは管理者が操作する Configration Manager コンソールと、管理デバイス上でユーザーが操作可能なソフトウェア センターがあります。</p><p>コンソールは Configration Manager のすべての操作が可能ですが、コンソール起動時の OS の Active Directory ドメイン アカウントやセキュリティ グループを利用して操作範囲を制限したり、操作内容の監査記録を行うことができます。<br><img src="/blog/mecm/20230316_01/2023-03-17-13-53-56.png"></p><p>またユーザーは展開された更新プログラムやアプリケーションをインストールする場合のインターフェースとしてソフトウェア センターとしてインストールされるアプリケーションから操作することができます。<br><img src="/blog/mecm/20230316_01/2023-03-17-13-54-49.png"></p><p>各インターフェースの説明は次回以降の解説をお待ちください。</p><p>次回は <a href="https://learn.microsoft.com/ja-jp/mem/configmgr/core/understand/configuration-manager-faq">Microsoft Configuration Manager FAQ</a> についての解説を公開予定です。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;皆様、Microsoft Configuration Manager サポート チームの箱木です。&lt;/p&gt;
&lt;p&gt;本日より、本ブログの連載企画として Microsoft Configuration Manager の公開情報などを整理し、これから管理者となる方や導入を検討さ</summary>
      
    
    
    
    
    <category term="MECM" scheme="https://jpmem.github.io/blog/tags/MECM/"/>
    
  </entry>
  
  <entry>
    <title>コンプライアンス機能で特定レジストリ値の状態をチェックする方法</title>
    <link href="https://jpmem.github.io/blog/mecm/20230309_01/"/>
    <id>https://jpmem.github.io/blog/mecm/20230309_01/</id>
    <published>2023-03-08T15:00:00.000Z</published>
    <updated>2023-11-07T08:27:44.776Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。Configuration Manager サポート チーム 山田 です。  </p><p>本日は Configuration Manager のコンプライアンス機能で特定のレジストリ値の状態をチェックする方法についてご紹介いたします。<br>本手順を実施することで、特定のレジストリ値をチェックし、その値になっている場合、クライアントが “準拠している” と判定させることが可能でございます。そのため、以下のようにご判断いただくことができます。  </p><p>準拠している　 ＝ 特定のレジストリ値が設定されている<br>準拠していない ＝ 特定のレジストリ値が設定されていない  </p><p>今回は例として、HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate 配下にある DisableWindowsUpdateAccess というレジストリ値が “1” であることをチェックする方法をご紹介します。  </p><h1 id="手順-1-構成項目の作成"><a href="#手順-1-構成項目の作成" class="headerlink" title="手順 1: 構成項目の作成"></a>手順 1: 構成項目の作成</h1><ol><li>[資産とコンプライアンス] - [概要] - [コンプライアンス設定] - [構成項目] を右クリックし、[構成項目の作成] を選択します。  </li><li>[全般] ページにて、任意の名前を指定し、デバイスの指定において [Windows デスクトップおよびサーバー] を選択し [次へ] をクリックします。  </li><li>[サポートされているプラットフォーム] ページにて、任意で対象の Windows バージョンを選択し「次へ」をクリックします。  </li><li>[設定] ページにて、[新規] をクリックします。  </li><li>[全般] タブにて、任意の名前を指定し以下の設定を行います。<br>・設定の種類 ： レジストリ値<br>・データ型 : 整数<br>・ハイブ名：HKEY_LOCAL_MACHINE<br>・キー名：SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate<br>・値の名前：DisableWindowsUpdateAccess  </li></ol><p><img src="/blog/mecm/20230309_01/2023-03-09-14-08-41.png"></p><ol start="6"><li>[コンプライアンス規則] タブにて、[新規] をクリックし以下の設定を行い [OK] を選択します。<br>・名前：任意の名前<br>・規則の種類：値<br>・演算子：次の値と等しい<br>・次の値の場合：1<br>・サポートされている場合は準拠していない規則を修正する : オフ<br>・この設定インスタンスが見つからない場合はコンプライアンス違反としてレポートする : オン  </li></ol><p><img src="/blog/mecm/20230309_01/2023-03-09-14-08-01.png"></p><p>※注意：[この設定インスタンスが見つからない場合はコンプライアンス違反としてレポートする] チェックは必ず “オン” に設定してください。オフの場合、該当のレジストリ値が存在しない場合、”準拠している” と判定されます。</p><ol start="7"><li>[次へ] を選択していき、構成項目の作成を完了します。  </li></ol><h1 id="手順-2-構成基準の作成と展開"><a href="#手順-2-構成基準の作成と展開" class="headerlink" title="手順 2: 構成基準の作成と展開"></a>手順 2: 構成基準の作成と展開</h1><p>作成した構成項目を含む構成基準を作成・展開します。クライアントはこの構成基準を受信して評価することで、準拠状態をサーバーに報告します。  </p><ol><li>[資産とコンプライアンス] - [概要] - [コンプライアンス設定] - [構成基準] を右クリックし、[構成基準の作成] を選択します。  </li><li>任意の名前を指定し、画面中央部にある [構成データ] で [追加] を選択し、[構成項目] を選択します。  </li><li>手順 1 で作成した構成項目を指定して、画面中央部にある [追加] をクリックし、[OK] を選択します。  </li><li>[OK] を選択します。  </li><li>作成した構成基準を右クリックし [展開] を選択します。  </li><li>以下の設定を実施し [OK] を選択します。<br>・「利用可能な構成基準」から作成した構成基準を選択して [追加] をクリックし「選択した構成基準」に表示されていることを確認します。<br>・[サポートされている場合は準拠していない規則を修復する]: オフ<br>・「コレクション」にて展開対象のコレクションを選択します。<br>・「スケジュール」にて、構成基準の評価スケジュールを指定します。（既定では 7 日に 1 回）  </li></ol><p><img src="/blog/mecm/20230309_01/2023-03-09-14-12-52.png"></p><p>※注意：[サポートされている場合は準拠していない規則を修復する] チェックは必ず “オフ” に設定してください。オンにすると、レジストリ値が修復されてしまいます。  </p><h1 id="実行結果の確認方法"><a href="#実行結果の確認方法" class="headerlink" title="実行結果の確認方法"></a>実行結果の確認方法</h1><p>構成基準を展開した後、クライアント側で、コントロール パネルを開き、表示方法を “小さいアイコン” に変更し、[Configuration Manager] を開いて [操作] タブより [コンピューター ポリシーの取得および評価サイクル] を選択し、[直ちに実行] を何度かクリックします。その後 [構成] タブを開き、[最新の情報に更新] をクリックすると、展開した構成基準の名前が表示されます。<br>最初は「コンプライアンスの状態」が「不明」となっていますので [評価] をクリックします。「準拠している」となった場合、この構成基準は「準拠」として、既定で 15 分以内にサーバー側に状態メッセージとして報告されます。  </p><p><img src="/blog/mecm/20230309_01/2023-03-09-14-17-19.png"></p><p>上図のように “準拠している” と判定されている場合、DisableWindowsUpdateAccess が “1” であると判断できます。  </p><h1 id="補足"><a href="#補足" class="headerlink" title="補足"></a>補足</h1><h2 id="構成基準の実行タイミングについて"><a href="#構成基準の実行タイミングについて" class="headerlink" title="構成基準の実行タイミングについて"></a>構成基準の実行タイミングについて</h2><p>構成基準を展開した後は、クライアント側で [コンピューター ポリシーの取得および評価サイクル] が実行されることで、最大 2 時間以内で構成基準がスケジューリングされ実行されます。<br>コンピューター ポリシーの受信サイクルについては、既定で 60 分間隔で実行されています。<br>なお、できる限り早く実行させたい場合は、「クライアント通知」という機能を使用すれば、「コンピューターポリシーの取得および評価サイクル」を直ちに実行するように、サーバー側からクライアントに通知させることができますので、こちらもご利用ください。(デバイス単位でもコレクション単位でも実行可能です。)  </p><p>Title: Configuration Manager でのクライアント通知<br>URL: <a href="https://learn.microsoft.com/ja-jp/mem/configmgr/core/clients/manage/client-notification">https://learn.microsoft.com/ja-jp/mem/configmgr/core/clients/manage/client-notification</a></p><h2 id="“準拠している”-コレクションの作成"><a href="#“準拠している”-コレクションの作成" class="headerlink" title="“準拠している” コレクションの作成"></a>“準拠している” コレクションの作成</h2><p>レジストリ値が存在する端末、すなわち “準拠している” クライアントのみを含むコレクションを作成することも可能です。  </p><p>作成した構成基準の [展開] を右クリックして [新しいコレクションの作成] - [準拠している] を選択します。<br>ウィザードを進めてコレクションを作成することで、今回の構成基準に対して “準拠している” 端末のみを含むコレクションを作成できます。<br>“準拠していない” コレクションも作成可能ですので、用途に応じてお使い分けください。<br><img src="/blog/mecm/20230309_01/2023-03-09-14-21-17.png"></p><h3 id="関連ブログ"><a href="#関連ブログ" class="headerlink" title="関連ブログ"></a>関連ブログ</h3><p>ハードウェア インベントリで特定のレジストリ値を収集したい場合は、こちらのブログをご参照ください。<br><a href="https://jpmem.github.io/blog/mecm/20220722_01/">ハードウェア インベントリで HKLM 配下の特定のレジストリを収集する ～使い方シリーズ～</a>  </p><p>特定のレジストリ値をセットしたい場合は、こちらのブログをご参照ください。<br><a href="https://jpmem.github.io/blog/mecm/20230307_01/">コンプライアンス機能で特定レジストリ値をセットする方法</a>  </p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。Configuration Manager サポート チーム 山田 です。  &lt;/p&gt;
&lt;p&gt;本日は Configuration Manager のコンプライアンス機能で特定のレジストリ値の状態をチェックする方法についてご紹介いたします。&lt;br&gt;本手順</summary>
      
    
    
    
    
    <category term="MECM" scheme="https://jpmem.github.io/blog/tags/MECM/"/>
    
    <category term="使い方" scheme="https://jpmem.github.io/blog/tags/%E4%BD%BF%E3%81%84%E6%96%B9/"/>
    
  </entry>
  
  <entry>
    <title>コンプライアンス機能で特定レジストリ値をセットする方法</title>
    <link href="https://jpmem.github.io/blog/mecm/20230307_01/"/>
    <id>https://jpmem.github.io/blog/mecm/20230307_01/</id>
    <published>2023-03-06T15:00:00.000Z</published>
    <updated>2023-11-07T08:27:44.776Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。Configuration Manager サポート チーム 山田 です。  </p><p>本日は Configuration Manager のコンプライアンス機能で特定のレジストリ値をセットする方法についてご紹介いたします。<br>クライアントに特定のレジストリ値をセットしたいというときに、別途スクリプトを作成して、それをパッケージで展開する必要なくレジストリ値をセットできます。<br>ワークグループのクライアントでドメインのグループ ポリシーが適用できない場合などにも有効ですので、ぜひご活用ください。  </p><p>今回は例として、HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate 配下にある DisableWindowsUpdateAccess というレジストリ値をセットする方法をご紹介します。  </p><h1 id="手順-1-構成項目の作成"><a href="#手順-1-構成項目の作成" class="headerlink" title="手順 1: 構成項目の作成"></a>手順 1: 構成項目の作成</h1><ol><li>[資産とコンプライアンス] - [概要] - [コンプライアンス設定] - [構成項目] を右クリックし、[構成項目の作成] を選択します。  </li><li>[全般] ページにて、任意の名前を指定し、デバイスの指定において [Windows デスクトップおよびサーバー] を選択し [次へ] をクリックします。  </li><li>[サポートされているプラットフォーム] ページにて、任意で対象の Windows バージョンを選択し「次へ」をクリックします。  </li><li>[設定] ページにて、[新規] をクリックします。  </li><li>[全般] タブにて、任意の名前を指定し以下の設定を行います。<br>・設定の種類 ： レジストリ値<br>・データ型 : 整数<br>・ハイブ名：HKEY_LOCAL_MACHINE<br>・キー名：SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate<br>・値の名前：DisableWindowsUpdateAccess  </li></ol><p><img src="/blog/mecm/20230307_01/2023-03-07-12-00-44.png"></p><ol start="6"><li>[コンプライアンス規則] タブにて、[新規] をクリックし以下の設定を行い [OK] を選択します。<br>・名前：任意の名前<br>・規則の種類：値<br>・演算子：次の値と等しい<br>・次の値の場合：1<br>・サポートされている場合は準拠していない規則を修正する : オン<br>・この設定インスタンスが見つからない場合はコンプライアンス違反としてレポートする : オン  </li></ol><p><img src="/blog/mecm/20230307_01/2023-03-07-13-02-36.png"></p><ol start="7"><li>[次へ] を選択していき、構成項目の作成を完了します。  </li></ol><h1 id="手順-2-構成基準の作成と展開"><a href="#手順-2-構成基準の作成と展開" class="headerlink" title="手順 2: 構成基準の作成と展開"></a>手順 2: 構成基準の作成と展開</h1><p>作成した構成項目を含む構成基準を作成・展開します。クライアントはこの構成基準を受信して評価することで、構成項目内の PowerShell スクリプトを実行し、準拠状態をサーバーに報告します。  </p><ol><li>[資産とコンプライアンス] - [概要] - [コンプライアンス設定] - [構成基準] を右クリックし、[構成基準の作成] を選択します。  </li><li>任意の名前を指定し、画面中央部にある [構成データ] で [追加] を選択し、[構成項目] を選択します。  </li><li>手順 1 で作成した構成項目を指定して、画面中央部にある [追加] をクリックし、[OK] を選択します。  </li><li>[OK] を選択します。  </li><li>作成した構成基準を右クリックし [展開] を選択します。  </li><li>以下の設定を実施し [OK] を選択します。<br>・「利用可能な構成基準」から作成した構成基準を選択して [追加] をクリックし「選択した構成基準」に表示されていることを確認します。<br>・[サポートされている場合は準拠していない規則を修復する]: オン<br>・「コレクション」にて展開対象のコレクションを選択します。<br>・「スケジュール」にて、構成基準の評価スケジュールを指定します。（既定では 7 日に 1 回）  </li></ol><p><img src="/blog/mecm/20230307_01/2023-03-07-16-56-07.png"></p><h1 id="実行結果の確認方法"><a href="#実行結果の確認方法" class="headerlink" title="実行結果の確認方法"></a>実行結果の確認方法</h1><p>構成基準を展開した後、クライアント側で、コントロール パネルを開き、表示方法を “小さいアイコン” に変更し、[Configuration Manager] を開いて [操作] タブより [コンピューター ポリシーの取得および評価サイクル] を選択し、[直ちに実行] を何度かクリックします。その後 [構成] タブを開き、[最新の情報に更新] をクリックすると、展開した構成基準の名前が表示されます。<br>最初は「コンプライアンスの状態」が「不明」となっていますので [評価] をクリックします。「準拠している」となった場合、この構成基準は「準拠」として、既定で 15 分以内にサーバー側に状態メッセージとして報告されます。  </p><p><img src="/blog/mecm/20230307_01/2023-03-07-13-09-32.png"></p><p>「準拠している」となったことを確認後、実際にレジストリ値がセットされているかご確認ください。  </p><p>■構成基準適用前<br><img src="/blog/mecm/20230307_01/2023-03-07-13-10-58.png"></p><p>■構成基準適用後<br><img src="/blog/mecm/20230307_01/2023-03-07-13-11-10.png"></p><h1 id="補足"><a href="#補足" class="headerlink" title="補足"></a>補足</h1><h2 id="構成基準の実行タイミングについて"><a href="#構成基準の実行タイミングについて" class="headerlink" title="構成基準の実行タイミングについて"></a>構成基準の実行タイミングについて</h2><p>構成基準を展開した後は、クライアント側で [コンピューター ポリシーの取得および評価サイクル] が実行されることで、最大 2 時間以内で構成基準がスケジューリングされ実行されます。<br>コンピューター ポリシーの受信サイクルについては、既定で 60 分間隔で実行されています。<br>なお、できる限り早く実行させたい場合は、「クライアント通知」という機能を使用すれば、「コンピューターポリシーの取得および評価サイクル」を直ちに実行するように、サーバー側からクライアントに通知させることができますので、こちらもご利用ください。(デバイス単位でもコレクション単位でも実行可能です。)  </p><p>Title: Configuration Manager でのクライアント通知<br>URL: <a href="https://learn.microsoft.com/ja-jp/mem/configmgr/core/clients/manage/client-notification">https://learn.microsoft.com/ja-jp/mem/configmgr/core/clients/manage/client-notification</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。Configuration Manager サポート チーム 山田 です。  &lt;/p&gt;
&lt;p&gt;本日は Configuration Manager のコンプライアンス機能で特定のレジストリ値をセットする方法についてご紹介いたします。&lt;br&gt;クライアントに</summary>
      
    
    
    
    
    <category term="MECM" scheme="https://jpmem.github.io/blog/tags/MECM/"/>
    
    <category term="使い方" scheme="https://jpmem.github.io/blog/tags/%E4%BD%BF%E3%81%84%E6%96%B9/"/>
    
  </entry>
  
  <entry>
    <title>ハードウェア インベントリで特定の WMI クラスを収集する ～使い方シリーズ～</title>
    <link href="https://jpmem.github.io/blog/mecm/20230306_01/"/>
    <id>https://jpmem.github.io/blog/mecm/20230306_01/</id>
    <published>2023-03-05T15:00:00.000Z</published>
    <updated>2023-11-07T08:27:44.776Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。Configuration Manager サポート チームです。  </p><p>使い方シリーズ、今回はハードウェア インベントリで特定の WMI クラスを収集する方法についてご案内いたします。<br>特定の WMI クラスを収集して、Configuration Manager コンソールで確認したいという場合に本手順をお役立ていただけますと幸いです。  </p><h1 id="想定シナリオ"><a href="#想定シナリオ" class="headerlink" title="想定シナリオ"></a>想定シナリオ</h1><p>今回、収集対象とする WMI クラスは、名前空間 root\cimv2 に存在する Win32_InstalledStoreProgram というクラスです。  </p><h1 id="手順"><a href="#手順" class="headerlink" title="手順"></a>手順</h1><p>以下の手順をご実施ください。  </p><ol><li><p>Configuration Manager 管理コンソールを開きます。  </p></li><li><p>[管理] &gt; [概要] &gt; [クライアント設定] &gt; [既定の設定] を右クリック &gt; プロパティを開きます。  </p></li><li><p>ハードウェア インベントリ を選択 &gt; ハードウェア インベントリ クラス の [クラスの設定] を選択します。  </p></li><li><p>表示されたハードウェア インベントリ クラス ウィザードにて、[追加] を選択します。  </p></li><li><p>名前空間: にて [接続] を選択します。  </p></li><li><p>接続を行いたいコンピューター名と WMI 名前空間を指定します。<br>参照したい WMI 名前空間がローカル コンピューターに存在しない場合には、リモートのコンピューターを指定することも可能です。  </p><p>今回は以下のように指定します。  </p><p>コンピューター名：ローカル コンピューター名（既定値のまま）<br>WMI 名前空間　　：root\cimv2<br>繰り返し　　　　：チェック  </p><p> 上記入力後、[接続] をクリックします。  </p></li><li><p>[インベントリ クラス] のフィルターに Installed と入力し、”Installed Store Program” にチェックを入れ、収集対象としたい項目にチェックを入れ、[OK] で閉じます。<br><img src="/blog/mecm/20230306_01/2023-03-07-17-40-23.png"></p></li></ol><h2 id="確認方法"><a href="#確認方法" class="headerlink" title="確認方法"></a>確認方法</h2><p>実際に対象の情報が収集されているか確認します。  </p><p>まずクライアントは、ポリシーを受けとることで上記で設定したクラスをハードウェア インベントリで収集するようになります。<br>その後、ハードウェア インベントリのサイクルが実行されると、収集対象としたクラスの情報を管理ポイントへ送信し、サイト サーバーに情報が送られ、Configuration Manager のデータベースに書き込まれることで Configuration Manager コンソールで確認できるようになります。  </p><p>そのため、クライアント端末で以下のサイクルを順番に実施します。<br>反映されたポリシーを受信するまでに時間がかかる場合がありますので、テストの際は以下のサイクルを何度か実行ください。  </p><ul><li>[コンピューターポリシーの取得および評価サイクル]  </li><li>[ハードウェア インベントリ サイクル]  </li></ul><p><img src="/blog/mecm/20230306_01/2023-03-07-17-40-53.png"></p><p>ハードウェア インベントリが正常に収集されると、Configuration Manager コンソールからクライアントを右クリックして、リソース エクスプローラを起動することで、収集したレジストリ情報をご確認いただけます。  </p><p><img src="/blog/mecm/20230306_01/2023-03-07-17-41-17.png"></p><p>また、データベースに対して SQL クエリを実行することでもご確認いただけます。<br>今回例の場合は以下のクエリを実行します。  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from v_GS_INSTALLED_STORE_PROGRAM</span><br></pre></td></tr></table></figure><p>SQL の実行方法については、以下の記事をご参照ください。  </p><p>Title: SQL Query 結果の出力方法について<br>URL: <a href="https://jpmem.github.io/memlog/configmgr/sql/sqlquery.html">https://jpmem.github.io/memlog/configmgr/sql/sqlquery.html</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。Configuration Manager サポート チームです。  &lt;/p&gt;
&lt;p&gt;使い方シリーズ、今回はハードウェア インベントリで特定の WMI クラスを収集する方法についてご案内いたします。&lt;br&gt;特定の WMI クラスを収集して、Config</summary>
      
    
    
    
    
    <category term="MECM" scheme="https://jpmem.github.io/blog/tags/MECM/"/>
    
    <category term="使い方" scheme="https://jpmem.github.io/blog/tags/%E4%BD%BF%E3%81%84%E6%96%B9/"/>
    
  </entry>
  
</feed>
