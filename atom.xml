<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Japan Microsoft Configuration Manager Support Team Blog</title>
  
  <subtitle>日本マイクロソフト Microsoft Configuration Manager / Windows 365 / WSUS サポート チームのブログです。</subtitle>
  <link href="https://jpmem.github.io/blog/atom.xml" rel="self"/>
  
  <link href="https://jpmem.github.io/blog/"/>
  <updated>2025-06-25T07:48:40.673Z</updated>
  <id>https://jpmem.github.io/blog/</id>
  
  <author>
    <name>Japan Microsoft Configuration Manager Support Team</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>クライアントがコンテンツのダウンロードを行う際の帯域の制限</title>
    <link href="https://jpmem.github.io/blog/mecm/20250619_01/"/>
    <id>https://jpmem.github.io/blog/mecm/20250619_01/</id>
    <published>2025-06-18T15:00:00.000Z</published>
    <updated>2025-06-25T07:48:40.673Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。Configuration Manager サポート チームです。</p><p>今回は、Configuration Manager (ConfigMgr) クライアントがコンテンツのダウンロードを行う際に使用するネットワーク帯域の制限についてご案内します。基本的に ConfigMgr クライアントは BITS（バックグラウンド インテリジェント転送サービス）を用いてコンテンツをダウンロードしますが、このとき使用されるネットワーク帯域はクライアント設定で制限できます。そのため、帯域が限られている環境では BITS の帯域を制限されているお客様も多いと思います。しかし、設定後に予期せぬ結果とならないよう、いくつか押さえておくべきポイントがあります。</p><h2 id="フォアグラウンドのダウンロードは帯域を制限できません"><a href="#フォアグラウンドのダウンロードは帯域を制限できません" class="headerlink" title="フォアグラウンドのダウンロードは帯域を制限できません"></a>フォアグラウンドのダウンロードは帯域を制限できません</h2><p>ConfigMgr クライアントが生成する BITS ジョブには、フォアグラウンドとバックグラウンドの 2 つの転送モードがございます。このうち、帯域を制限できるのは、バックグラウンド 転送モードのみであることに注意が必要です。ConfigMgr がコンテンツを配布するシナリオごとの、転送モードを表 1 に示します。</p><table>  <caption>表 1: BITS の転送モード</caption>  <thead>    <tr>      <th>コンテンツの種類</th>      <th>ソフトウェア センターからインストールする場合</th>      <th>自動でインストールする場合(必須の展開)    </tr>  </thead>  <tbody>    <tr>      <td>アプリケーション</td>      <td>フォアグラウンド</td>      <td>バックグラウンド</td>    </tr>    <tr>      <td>パッケージ</td>      <td>バックグラウンド</td>      <td>バックグラウンド</td>    </tr>    <tr>      <td>ソフトウェア更新プログラム</td>      <td>フォアグラウンド</td>      <td>バックグラウンド</td>  </tbody></table><p>表 1 からわかる通り、ソフトウェア更新プログラムやアプリケーションは、ソフトウェア センターを使用し [インストール] ボタンをクリックした場合、その転送はフォアグラウンド 転送モードになるため、帯域制限の設定は無視されます。一方、パッケージの場合はソフトウェア センターの利用有無を問わず、常にバックグラウンド 転送モードになるため、帯域制限の設定は有効です。</p><p>したがって、コンテンツの種類を問わずダウンロード時の帯域を制限したい場合は、ソフトウェア センターによるインストールを避け、[利用可能] ではなく [必須] で展開する必要があります。ただし、必須展開でも「インストールの期限」に到達した時点でダウンロードやインストールが未完了の場合は、ソフトウェア センターから [インストール] ボタンをクリックすることが可能です。この状態で [インストール] ボタンをクリックしたとき、コンテンツのダウンロードが未完了であればフォアグラウンド 転送モードでダウンロードが発生します。</p><h2 id="コンテンツのダウンロード時は-BITS-を使用します"><a href="#コンテンツのダウンロード時は-BITS-を使用します" class="headerlink" title="コンテンツのダウンロード時は BITS を使用します"></a>コンテンツのダウンロード時は BITS を使用します</h2><p>上記の動作をご理解いただいていたとしても、「帯域が制限される場合のみ BITS を使用し、そうでない場合は BITS 以外が使われる」と誤解されることがありますが、これは正しくありません。 ConfigMgr のコンテンツ配布は一部の例外を除き、通常 BITS を利用します。帯域が制限されるか否かは、あくまで転送モード(フォアグラウンドかバックグラウンドか)の違いということです。</p><p>なお、UUP (Unified Update Platform) 形式の更新プログラムのダウンロード時には、標準設定の場合、OS の配信の最適化 (DO) エージェントも関与しますが、その場合も DO エージェント が ConfigMgr クライアントがローカルに生成したサーバー プロセス (localhost:8005) にコンテンツを要求し、このサーバーが代理で外部から BITS でコンテンツのダウンロードを行います。先にご案内した一部の例外として、DO の機能だけを使うよう設定も構成できるため、厳密にはすべてが BITS というわけではありませんが、ConfigMgr クライアントがコンテンツのダウンロードを行う際は基本的に BITS が使用されます。</p><h2 id="時間帯以外の条件に応じて帯域を制限することは不可です"><a href="#時間帯以外の条件に応じて帯域を制限することは不可です" class="headerlink" title="時間帯以外の条件に応じて帯域を制限することは不可です"></a>時間帯以外の条件に応じて帯域を制限することは不可です</h2><p>BITS は ConfigMgr の専用機能ではなく、OS の汎用的なサービスであり、すべてのアプリケーションが共有しています。そのため、帯域制限の設定を行う場合、その OS 上ですべての BITS ジョブが対象となります。クライアント設定で帯域を制限すると、実際には「BITS バックグラウンド転送の最大ネットワーク帯域幅を制限する」設定がローカル グループ ポリシーとして適用されます。設定可能な条件は「特定の時間帯」と「それ以外の時間帯」のみで、アプリケーションごとの制限やインターネット接続時のみ帯域制限を行う、といった細かい条件での制限はできません。</p><p>ご参考：<br><a href="https://learn.microsoft.com/ja-jp/intune/configmgr/core/clients/deploy/about-client-settings#limit-the-maximum-network-bandwidth-for-bits-background-transfers">https://learn.microsoft.com/ja-jp/intune/configmgr/core/clients/deploy/about-client-settings#limit-the-maximum-network-bandwidth-for-bits-background-transfers</a></p><p>なお、クライアント設定ではなく、Active Directory グループ ポリシーで「BITS バックグラウンド転送の最大ネットワーク帯域幅を制限する」を設定した場合は、クライアント設定と競合が発生します。そのため ConfigMgr クライアントが稼働する環境では、クライアント設定のみで制限することを推奨します。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。Configuration Manager サポート チームです。&lt;/p&gt;
&lt;p&gt;今回は、Configuration Manager (ConfigMgr) クライアントがコンテンツのダウンロードを行う際に使用するネットワーク帯域の制限についてご案内し</summary>
      
    
    
    
    
    <category term="MECM" scheme="https://jpmem.github.io/blog/tags/MECM/"/>
    
  </entry>
  
  <entry>
    <title>ConfigMgr サポート バージョン FAQ</title>
    <link href="https://jpmem.github.io/blog/mecm/20250408_01/"/>
    <id>https://jpmem.github.io/blog/mecm/20250408_01/</id>
    <published>2025-04-07T15:00:00.000Z</published>
    <updated>2025-06-25T07:48:40.672Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは。Configuration Manager サポート チームです。</p><p>本記事では、Configuration Manager (ConfigMgr) のサポート バージョンについてよくあるご質問と回答をご案内いたします。こちらに記載のないご質問に関しては弊社サポートまでお問い合わせください。</p><h1 id="よくあるご質問の一覧"><a href="#よくあるご質問の一覧" class="headerlink" title="よくあるご質問の一覧"></a>よくあるご質問の一覧</h1><ol><li>ConfigMgr のバージョンを確認するには？</li><li>ConfigMgr がサポート期限を迎えた場合、どうなりますか？</li><li>ConfigMgr クライアントでサポートされる バージョンは？</li><li>ConfigMgr クライアントのバージョンが、サイト サーバーやサイト システムのバージョンより古い場合、どうなりますか？</li><li>ConfigMgr クライアントやサーバーの動作する OS がサポート期限切れを迎えた場合、どうなりますか？</li><li>新しい機能更新プログラムがリリースされた OS に対して ConfigMgr のサポートはどうなりますか？</li><li>サポート期限切れを迎えたが、ESU が適用された OS は ConfigMgr でサポートされますか？</li></ol><h2 id="1-ConfigMgr-のバージョンを確認するには？"><a href="#1-ConfigMgr-のバージョンを確認するには？" class="headerlink" title="1. ConfigMgr のバージョンを確認するには？"></a>1. ConfigMgr のバージョンを確認するには？</h2><p>サーバー側は、ConfigMgr コンソールより以下の画面でご確認ください。  </p><ul><li><p>[ConfigMgr コンソール] - 左上 ▼ ボタン - [Configuration Manager のバージョン情報]</p><p> <img src="/blog/mecm/20250408_01/20250408_01_01.png" alt="smsver.png"></p></li></ul><p>クライアント側は、ConfigMgr コントロール パネル アプレット より、以下の箇所でご確認ください。</p><ul><li><p>[コントロール パネル] - [システムとセキュリティ] - [Configuration Manager] - [全般]タブ</p><p> <img src="/blog/mecm/20250408_01/20250408_01_02.png" alt="ccmver.png"></p></li></ul><h2 id="2-ConfigMgr-がサポート期限を迎えた場合、どうなりますか？"><a href="#2-ConfigMgr-がサポート期限を迎えた場合、どうなりますか？" class="headerlink" title="2. ConfigMgr がサポート期限を迎えた場合、どうなりますか？"></a>2. ConfigMgr がサポート期限を迎えた場合、どうなりますか？</h2><p>サーバーおよびクライアントはそのまま動作しますが、弊社サポート チームに対してお問い合わせされた場合、ご対応いたしかねます。サポート チームでは、サポートされているバージョンへのアップグレードの支援のみご対応させていただきます。アップグレードが完了した後、通常のお問い合わせ対応を再開させていただきます。</p><h2 id="3-ConfigMgr-クライアントでサポートされる-バージョンは？"><a href="#3-ConfigMgr-クライアントでサポートされる-バージョンは？" class="headerlink" title="3. ConfigMgr クライアントでサポートされる バージョンは？"></a>3. ConfigMgr クライアントでサポートされる バージョンは？</h2><p>サーバーでサポートされるバージョンに準じます。現在のサポート バージョンは下記をご参照ください。  </p><p>Configuration ManagerのUpdatesとサービス - サポートされるバージョン<br><a href="https://learn.microsoft.com/ja-jp/intune/configmgr/core/servers/manage/updates#supported-versions">https://learn.microsoft.com/ja-jp/intune/configmgr/core/servers/manage/updates#supported-versions</a></p><h2 id="4-ConfigMgr-クライアントのバージョンが、サイト-サーバーやサイト-システムのバージョンより古い場合、どうなりますか？"><a href="#4-ConfigMgr-クライアントのバージョンが、サイト-サーバーやサイト-システムのバージョンより古い場合、どうなりますか？" class="headerlink" title="4. ConfigMgr クライアントのバージョンが、サイト サーバーやサイト システムのバージョンより古い場合、どうなりますか？"></a>4. ConfigMgr クライアントのバージョンが、サイト サーバーやサイト システムのバージョンより古い場合、どうなりますか？</h2><p>サポートされるバージョンであれば弊社サポートは提供されます。<br>新しいほうのバージョンで提供される新機能のうち、サーバーとクライアントが連携する必要がある機能は提供されません。</p><h2 id="5-ConfigMgr-クライアントやサーバーの動作する-OS-がサポート期限切れを迎えた場合、どうなりますか？"><a href="#5-ConfigMgr-クライアントやサーバーの動作する-OS-がサポート期限切れを迎えた場合、どうなりますか？" class="headerlink" title="5. ConfigMgr クライアントやサーバーの動作する OS がサポート期限切れを迎えた場合、どうなりますか？"></a>5. ConfigMgr クライアントやサーバーの動作する OS がサポート期限切れを迎えた場合、どうなりますか？</h2><p>サーバーおよびクライアントはそのまま動作しますが、弊社サポート チームに対してお問い合わせされた場合、ご対応いたしかねます。サポート チームでは、サポートされているバージョンへの OS アップグレードの支援のみご対応させていただきます。アップグレードが完了した後、通常のお問い合わせ対応を再開させていただきます。</p><h2 id="6-新しい機能更新プログラムがリリースされた-OS-に対して-ConfigMgr-のサポートはどうなりますか？"><a href="#6-新しい機能更新プログラムがリリースされた-OS-に対して-ConfigMgr-のサポートはどうなりますか？" class="headerlink" title="6.新しい機能更新プログラムがリリースされた OS に対して ConfigMgr のサポートはどうなりますか？"></a>6.新しい機能更新プログラムがリリースされた OS に対して ConfigMgr のサポートはどうなりますか？</h2><p>対象の機能更新プログラムのバージョンに合わせて、対応する ConfigMgr のバージョンもアップグレードが必要となります。</p><p>クライアントの機能更新プログラムごとの、ConfigMgr の対応バージョンについては下記をご参照ください。</p><ul><li>Configuration ManagerでのWindows 11のサポート<br><a href="https://learn.microsoft.com/ja-jp/intune/configmgr/core/plan-design/configs/support-for-windows-11#windows-11-versions">https://learn.microsoft.com/ja-jp/intune/configmgr/core/plan-design/configs/support-for-windows-11#windows-11-versions</a></li><li>Configuration ManagerでのWindows 10のサポート<br><a href="https://learn.microsoft.com/ja-jp/intune/configmgr/core/plan-design/configs/support-for-windows-10">https://learn.microsoft.com/ja-jp/intune/configmgr/core/plan-design/configs/support-for-windows-10</a></li></ul><p>例えば、下記表からわかる通り、2025年4月現在、Windows 11 24H2 のサポートは ConfigMgr CB 2409 からとなります。</p><p><img src="/blog/mecm/20250408_01/20250408_01_03.png" alt="win11-24H2suppportver.png"></p><h2 id="7-サポート期限切れを迎えたが、ESU-が適用された-OS-は-ConfigMgr-でサポートされますか？"><a href="#7-サポート期限切れを迎えたが、ESU-が適用された-OS-は-ConfigMgr-でサポートされますか？" class="headerlink" title="7. サポート期限切れを迎えたが、ESU が適用された OS は ConfigMgr でサポートされますか？"></a>7. サポート期限切れを迎えたが、ESU が適用された OS は ConfigMgr でサポートされますか？</h2><p>サーバー、クライアント共にサポートされません。通常の期限切れを迎えた OS と同様の扱い、つまりサポートされる OS へのアップグレードのご支援のみ対応させていただきます。アップグレードが完了した後、通常のお問い合わせ対応を再開させていただきます。</p><p>ESU については以下の公開情報をご参照ください。</p><ul><li>Configuration Manager でサポートされる、クライアントとデバイスの OS のバージョン  - 拡張セキュリティ更新プログラムと Configuration Manager<br><a href="https://learn.microsoft.com/ja-jp/intune/configmgr/core/plan-design/configs/supported-operating-systems-for-clients-and-devices#bkmk_ESU">https://learn.microsoft.com/ja-jp/intune/configmgr/core/plan-design/configs/supported-operating-systems-for-clients-and-devices#bkmk_ESU</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは。Configuration Manager サポート チームです。&lt;/p&gt;
&lt;p&gt;本記事では、Configuration Manager (ConfigMgr) のサポート バージョンについてよくあるご質問と回答をご案内いたします。こちらに記載のないご質問に関し</summary>
      
    
    
    
    
    <category term="MECM" scheme="https://jpmem.github.io/blog/tags/MECM/"/>
    
  </entry>
  
  <entry>
    <title>ConfigMgr クライアントの OS 更新失敗を防ぐ - よくある原因と解決策 (1)</title>
    <link href="https://jpmem.github.io/blog/mecm/20250325_01/"/>
    <id>https://jpmem.github.io/blog/mecm/20250325_01/</id>
    <published>2025-03-24T15:00:00.000Z</published>
    <updated>2025-06-25T07:48:40.669Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは。Configuration Manager サポート チームです。</p><p>本記事では、Configuration Manager (ConfigMgr) を使用した OS 更新プログラムの適用が失敗する際のよくある原因と解決策をご紹介します。</p><p>※本記事では、WSUS、Intune、Windows Update、Windows Update for Business (WUfB) に関する内容は対象外です。</p><p>各症状ごとに詳細な記事を公開しています。記載内容と一致しない事象を確認された場合、弊社サポートまでお問い合わせください。</p><h2 id="症状"><a href="#症状" class="headerlink" title="症状"></a>症状</h2><p>以下のような問題が発生することがあります。</p><ol><li><strong>利用可能展開にしているのに、更新プログラムがソフトウェア センターに表示されない</strong></li><li>ソフトウェア センターでダウンロードが失敗する</li><li>ソフトウェア センターでインストールに失敗する</li><li>必須展開にしているのに、更新プログラムが適用されない</li></ol><p>本記事では、症状 1 の <strong>「利用可能展開にしているのに更新プログラムがソフトウェア センターに表示されない」</strong> 問題について解説します。</p><h2 id="利用可能展開にしているのに、更新プログラムがソフトウェア-センターに表示されない"><a href="#利用可能展開にしているのに、更新プログラムがソフトウェア-センターに表示されない" class="headerlink" title="利用可能展開にしているのに、更新プログラムがソフトウェア センターに表示されない"></a>利用可能展開にしているのに、更新プログラムがソフトウェア センターに表示されない</h2><p>以下のような原因が考えられます。</p><ul><li>管理ポイントと通信できず、展開ポリシーを取得できていない</li><li>展開ポリシーに紐づくコレクションにデバイスが所属していない</li><li>ソフトウェア更新ポイントと通信できず、更新プログラムの検出が失敗している</li></ul><h3 id="管理ポイントと通信できず、展開ポリシーを取得できていない"><a href="#管理ポイントと通信できず、展開ポリシーを取得できていない" class="headerlink" title="管理ポイントと通信できず、展開ポリシーを取得できていない"></a>管理ポイントと通信できず、展開ポリシーを取得できていない</h3><p>管理ポイントと ConfigMgr クライアントの通信ができていない可能性があります。以下の PowerShell コマンドを実行し、管理ポイントと疎通できるか確認してください (拡張 HTTP 通信設定の場合のみ)。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Invoke-WebRequest</span> <span class="literal">-Uri</span> <span class="string">&quot;http://&lt;管理ポイントの FQDN&gt;/sms_mp/.sms_aut?mplist&quot;</span> <span class="literal">-UseBasicParsing</span></span><br></pre></td></tr></table></figure><p>正常な場合、<code>StatusCode : 200</code> が返ります。それ以外の場合、通信エラーの可能性があります。</p><p>ログから確認する場合は、クライアントの <code>C:\Windows\CCM\Logs\CcmMessaging.log</code> を確認すると良いかと存じます。直近に以下のようなログが出力されていれば、通信が失敗している可能性が高いです。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[CCMHTTP] ERROR: URL=[管理ポイントの URL], Port=[port 番号], Options=1248, Code=0, Text=[エラー シンボル]</span><br><span class="line">[CCMHTTP] ERROR INFO: StatusCode=[HTTP ステータス コード] StatusText=[HTTP エラー ステータス テキスト]</span><br></pre></td></tr></table></figure><p>よくあるエラー シンボル の例:</p><ul><li><code>CCM_E_BAD_HTTP_STATUS_CODE</code>: HTTP ステータスコード 4xx または 5xx (サーバー側のエラー)</li><li><code>CCM_E_NO_CLIENT_PKI_CERT</code>: HTTPS 環境でクライアント証明書が見つからない</li><li><code>ERROR_WINHTTP_NAME_NOT_RESOLVED</code>: DNS で管理ポイントを解決できない</li><li><code>ERROR_WINHTTP_TIMEOUT</code>: 管理ポイントとの通信がタイムアウト</li></ul><h2 id="展開ポリシーに紐づくコレクションにデバイスが所属していない"><a href="#展開ポリシーに紐づくコレクションにデバイスが所属していない" class="headerlink" title="展開ポリシーに紐づくコレクションにデバイスが所属していない"></a>展開ポリシーに紐づくコレクションにデバイスが所属していない</h2><p>デバイスがコレクションに所属していないと、展開ポリシーを取得できません。以下の PowerShell コマンドを実行し、展開ポリシーを取得できているか確認してください。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Get-WmiObject</span> <span class="literal">-Namespace</span> <span class="string">&quot;root\CCM\Policy\Machine\ActualConfig&quot;</span> <span class="literal">-ClassName</span> CCM_UpdateCIAssignment | <span class="built_in">Select-Object</span> AssignmentID,  AssignmentName | <span class="built_in">Sort-Object</span> <span class="literal">-Property</span> AssignmentName | <span class="built_in">Format-Table</span> </span><br></pre></td></tr></table></figure><h2 id="ソフトウェア更新ポイントと通信できずに更新プログラムの検出が失敗している"><a href="#ソフトウェア更新ポイントと通信できずに更新プログラムの検出が失敗している" class="headerlink" title="ソフトウェア更新ポイントと通信できずに更新プログラムの検出が失敗している"></a>ソフトウェア更新ポイントと通信できずに更新プログラムの検出が失敗している</h2><p>デバイスがソフトウェア更新ポイントと通信できていない場合、更新プログラムの検出が失敗します。以下のコマンドを実行し、通信状況を確認してください (HTTP 通信設定の場合のみ)。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Invoke-WebRequest</span> <span class="literal">-Uri</span> <span class="string">&quot;http://&lt;ソフトウェア更新ポイントの FQDN&gt;:8530/ClientWebService/client.asmx&quot;</span> <span class="literal">-UseBasicParsing</span></span><br></pre></td></tr></table></figure><p><code>StatusCode : 200</code> 以外が返る場合、通信エラーの可能性があります。</p><p>また、ソフトウェア更新ポイントとアクセスする際には、通常、WinHTTP Proxy が利用されます。ご利用の NW 経路上、該当の Proxy は利用できるのか確認いただき、利用できない場合は、Proxy をバイパスするよう設定ください。</p><p>WinHTTP Proxy の設定は、コマンド プロンプトを開き、以下のコマンドを実行して確認できます。</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netsh winhttp show proxy</span><br></pre></td></tr></table></figure><p>このほか、ソフトウェア更新ポイントがクライアントの所属する境界グループに紐づいていない、もしくは所属するドメインのグループ ポリシーで上書きされている場合がございます。こちらの確認は、コマンド プロンプトで、以下を実行して出力されるグループ ポリシーの評価結果をご確認ください。</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gpresult /H gpresult.html</span><br></pre></td></tr></table></figure><p>出力された gpresult.html にて [設定] - [ポリシー] - [管理用テンプレート] - [Windows コンポーネント/Windows Update/(Windows Server Update Service から提供される更新プログラムの管理)]のポリシー [イントラネットの Microsoft 更新サービスの場所を指定する] の[優勢なGPO]が　[ローカル セキュリティ ポリシー]であり、かつ、以下の項目が以下の設定であるのが正しい設定です。</p><ul><li>更新を検出するためのイントラネットの更新サービスを指定する: ソフトウェア更新ポイントの FQDN</li><li>イントラネット統計サーバーの設定: ソフトウェア更新ポイントの FQDN</li><li>代替ダウンロード サーバーの設定: <a href="http://localhost:8005/">http://localhost:8005</a></li></ul><p> <img src="/blog/mecm/20250325_01/20250325_01_01.png" alt="gpresult.png"></p><p>上記の修復は [ConfigMgrコンソール] - [管理] - [階層の構成] - [境界グループ] より設定を見直しください。<br>IP サブネット境界設定が誤っている場合などもございます。</p><p>IP サブネット境界設定の考え方<br><a href="https://jpmem.github.io/blog/mecm/20220414_01/">https://jpmem.github.io/blog/mecm/20220414_01/</a></p><p>この他、「ソフトウェア更新ポイントとの通信がタイムアウトする」場合がございます。この事象は、 <code>C:\Windows\CCM\WUAHandler.log</code> の以下のようなログの出力で確認できます。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">OnSearchComplete - Failed to end search job. Error = 0x80072ee2</span><br><span class="line">Scan failed with error = 0x80072ee2.</span><br></pre></td></tr></table></figure><p>0x80072ee2:    WININET_E_TIMEOUT</p><p>また、「ソフトウェア更新ポイントとの通信が 503 エラーで返答される」場合もございます。この事象も、<code>C:\Windows\CCM\WUAHandler.log</code> の以下のようなログの出力で確認できます。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">OnSearchComplete - Failed to end search job. Error = 0x80244022.</span><br><span class="line">Scan failed with error = 0x80244022. </span><br></pre></td></tr></table></figure><p>0x80244022: WU_E_PT_HTTP_STATUS_SERVICE_UNAVAIL / Same as HTTP status 503 - the service is temporarily overloaded.</p><p>これらの原因は、ソフトウェア更新ポイントとして利用している WSUS のメンテナンスが適切に行われていない場合が極めて多いので、以下でご案内のメンテナンスを実施ください。</p><p>WSUS メンテナンスガイド新版<br><a href="https://jpmem.github.io/blog/wsus/2022-05-09_01/">https://jpmem.github.io/blog/wsus/2022-05-09_01/</a></p><p>この他、実際にクライアントで更新プログラムの検出が成功しているかどうかは、以下の Powershell スクリプトを実行することでも確認できます。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Get-WmiObject</span> <span class="literal">-Namespace</span> <span class="string">&quot;root\CCM\SoftwareUpdates\UpdatesStore&quot;</span> <span class="literal">-ClassName</span> CCM_UpdateStatus | <span class="built_in">Select-Object</span> UniqueId,Title,Status | <span class="built_in">Format-Table</span></span><br></pre></td></tr></table></figure><p>適用させたい更新プログラムの Status が Missing になっているかを確認ください。該当の更新プログラムが見つからない場合、ソフトウェア更新ポイント上で該当の更新プログラムの承認状態が「未承認」でないか、そもそもソフトウェア更新ポイントと通信できていないか、もしくは、WUfB 関連のポリシー / レジストリが有効になっているためにデュアル スキャン状態になっている可能性がございます。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは。Configuration Manager サポート チームです。&lt;/p&gt;
&lt;p&gt;本記事では、Configuration Manager (ConfigMgr) を使用した OS 更新プログラムの適用が失敗する際のよくある原因と解決策をご紹介します。&lt;/p&gt;
&lt;</summary>
      
    
    
    
    
    <category term="MECM" scheme="https://jpmem.github.io/blog/tags/MECM/"/>
    
  </entry>
  
  <entry>
    <title>ConfigMgr クライアントでのOS 更新失敗を防ぐ - よくある原因と解決策 (2)</title>
    <link href="https://jpmem.github.io/blog/mecm/20250325_02/"/>
    <id>https://jpmem.github.io/blog/mecm/20250325_02/</id>
    <published>2025-03-24T15:00:00.000Z</published>
    <updated>2025-06-25T07:48:40.670Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは。Configuration Manager サポート チームです。</p><p>本記事では、Configuration Manager (ConfigMgr) を使用した OS 更新プログラムの適用が失敗する際のよくある原因と解決策をご紹介します。</p><p>※本記事では、WSUS、Intune、Windows Update、Windows Update for Business (WUfB) に関する内容は対象外です。</p><p>各症状ごとに詳細な記事を公開しています。記載内容と一致しない事象を確認された場合、弊社サポートまでお問い合わせください。</p><h2 id="症状"><a href="#症状" class="headerlink" title="症状"></a>症状</h2><p>以下のような問題が発生することがあります。</p><ol><li>利用可能展開にしているのに、更新プログラムがソフトウェア センターに表示されない</li><li><strong>ソフトウェア センターでダウンロードが失敗する</strong></li><li>ソフトウェア センターでインストールに失敗する</li><li>必須展開にしているのに、更新プログラムが適用されない</li></ol><p>本記事では、症状 2 の <strong>「ソフトウェア センターでダウンロードが失敗する」</strong> 問題について解説します。</p><h2 id="ソフトウェア-センター-でダウンロードが失敗する"><a href="#ソフトウェア-センター-でダウンロードが失敗する" class="headerlink" title="ソフトウェア センター でダウンロードが失敗する"></a>ソフトウェア センター でダウンロードが失敗する</h2><p>ソフトウェア センターで対象の更新プログラムのインストールを開始した際に、ダウンロードが失敗する場合、以下のような原因が考えられます。</p><ul><li>クライアントの所属する境界グループに配布ポイントが紐づいていない</li><li>配布ポイントにコンテンツが配布されていない。</li><li>クライアントの ccmcache フォルダー領域の空き容量が不足している。</li></ul><h3 id="クライアントの所属する境界グループに配布ポイントが紐づいていない"><a href="#クライアントの所属する境界グループに配布ポイントが紐づいていない" class="headerlink" title="クライアントの所属する境界グループに配布ポイントが紐づいていない"></a>クライアントの所属する境界グループに配布ポイントが紐づいていない</h3><h3 id="配布ポイントにコンテンツが配布されていない。"><a href="#配布ポイントにコンテンツが配布されていない。" class="headerlink" title="配布ポイントにコンテンツが配布されていない。"></a>配布ポイントにコンテンツが配布されていない。</h3><p>クライアントの所属する境界グループに配布ポイントが紐づいていない、または紐づいていたとしても配布ポイントにコンテンツが割り当たっていないために、該当の更新プログラム コンテンツのダウンロード元が見つからない場合がございます。この場合、<code>C:\Windows\CCM\Logs\ContentTransferManager.log</code> に以下のようなログが出力されます。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CCTMJob::UpdateLocations - Received empty location update for CTM Job &#123;XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX&#125;</span><br><span class="line">CTM job &#123;XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX&#125; suspended   </span><br></pre></td></tr></table></figure><p>ソフトウェア センターからインストールする際に、以下のようなエラーが表示される場合も該当します。  </p><p><img src="/blog/mecm/20250325_02/20250325_02_01.png" alt="sclient.png"></p><p>0x87d00607: “Content not found”</p><p>上記、修復には ConfigMgr コンソールより、該当の配布ポイントに対象の更新プログラムを含む展開パッケージが配布されているかをご確認ください。</p><p>確認すべき項目は、以下です。</p><ul><li><p>境界グループ設定の見直し<br>[ConfigMgr コンソール] - [管理] - [階層の構成] - [境界グループ] より設定を見直しください。<br>IP サブネット境界設定が誤っている場合などもございます。</p><p>IP サブネット境界設定の考え方<br><a href="https://jpmem.github.io/blog/mecm/20220414_01/">https://jpmem.github.io/blog/mecm/20220414_01/</a></p></li><li><p>展開パッケージ配布状況の確認<br>[ConfigMgr コンソール] - [監視] - [概要] - [配布ステータス] - [コンテンツのステータス]</p></li></ul><h3 id="クライアントの-ccmcache-フォルダー領域の空き容量が不足している。"><a href="#クライアントの-ccmcache-フォルダー領域の空き容量が不足している。" class="headerlink" title="クライアントの ccmcache フォルダー領域の空き容量が不足している。"></a>クライアントの ccmcache フォルダー領域の空き容量が不足している。</h3><p>配信の最適化であれ、PeerCache や BranchCache を利用されている環境であれ、必ず <code>C:\Windows\CCMCache</code> にダウンロードしたコンテンツはキャッシュされる仕組みとなっております。機能更新プログラムは数 GB になることも多くあることから、上記キャッシュ領域が不足することもございますので、<br>容量を確保するようお願いいたします。 </p><p>最大キャッシュ サイズの設定は,  以下で設定可能です。(MB) と (ディスクの割合) の二つの設定がございますが、計算した結果小さいほうが採用されます。また 100 GB　以上は現状設定不可となっています。  </p><p>[ConfigMgr コンソール] - [管理] - [概要] - [クライアント設定] - ご利用のクライアント設定を選択 - [プロパティ] - [クライアント キャッシュの設定] - [最大キャッシュ サイズ]</p><p><img src="/blog/mecm/20250325_02/20250325_02_02.png" alt="CCMCacche.png"></p><p>この他、クライアントのキャッシュをクリアしたい場合は以下の記事をご参照ください。  </p><p>ccmcache フォルダー配下のキャッシュ クリア方法<br><a href="https://jpmem.github.io/blog/mecm/20220511_01/">https://jpmem.github.io/blog/mecm/20220511_01/</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは。Configuration Manager サポート チームです。&lt;/p&gt;
&lt;p&gt;本記事では、Configuration Manager (ConfigMgr) を使用した OS 更新プログラムの適用が失敗する際のよくある原因と解決策をご紹介します。&lt;/p&gt;
&lt;</summary>
      
    
    
    
    
    <category term="MECM" scheme="https://jpmem.github.io/blog/tags/MECM/"/>
    
  </entry>
  
  <entry>
    <title>ConfigMgr クライアントでの OS 更新失敗を防ぐ - よくある原因と解決策 (3)</title>
    <link href="https://jpmem.github.io/blog/mecm/20250325_03/"/>
    <id>https://jpmem.github.io/blog/mecm/20250325_03/</id>
    <published>2025-03-24T15:00:00.000Z</published>
    <updated>2025-06-25T07:48:40.670Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは。Configuration Manager サポート チームです。</p><p>本記事では、Configuration Manager (ConfigMgr) を使用した OS 更新プログラムの適用が失敗する際のよくある原因と解決策をご紹介します。</p><p>※本記事では、WSUS、Intune、Windows Update、Windows Update for Business (WUfB) に関する内容は対象外です。</p><p>各症状ごとに詳細な記事を公開しています。記載内容と一致しない事象を確認された場合、弊社サポートまでお問い合わせください。</p><h2 id="症状"><a href="#症状" class="headerlink" title="症状"></a>症状</h2><p>以下のような問題が発生することがあります。</p><ol><li>利用可能展開にしているのに、更新プログラムがソフトウェア センターに表示されない</li><li>ソフトウェア センターでダウンロードが失敗する</li><li><strong>ソフトウェア センターでインストールに失敗する</strong></li><li>必須展開にしているのに、更新プログラムが適用されない</li></ol><p>本記事では、症状 3 の <strong>「ソフトウェア センターでインストールに失敗する」</strong> 問題について解説します。</p><h2 id="ソフトウェア-センター-でインストールに失敗する"><a href="#ソフトウェア-センター-でインストールに失敗する" class="headerlink" title="ソフトウェア センター でインストールに失敗する"></a>ソフトウェア センター でインストールに失敗する</h2><p>ソフトウェア センターでダウンロード成功後、インストールに失敗する場合、以下のような原因が考えられます。</p><ul><li>更新プログラムの最長実行時間よりも更新プログラムの適用に時間がかかり、途中でキャンセルされた</li></ul><h3 id="更新プログラムの最長実行時間よりも更新プログラムの適用に時間がかかり、途中でキャンセルされた"><a href="#更新プログラムの最長実行時間よりも更新プログラムの適用に時間がかかり、途中でキャンセルされた" class="headerlink" title="更新プログラムの最長実行時間よりも更新プログラムの適用に時間がかかり、途中でキャンセルされた"></a>更新プログラムの最長実行時間よりも更新プログラムの適用に時間がかかり、途中でキャンセルされた</h3><p>ConfigMgr の更新プログラムの展開は、適用中の意図しない トラブルを防ぐため、最長実行時間が設定されており、これを超えた場合、更新プログラムの適用処理が途中で キャンセル される動きとなっております。</p><p>上記は、<code>C:\Windows\SoftwareDistribution\ReportingEvents.log</code> に出力される以下のようなログ文字列があることでも判断可能です。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(1) [AGENT_INSTALLING_STARTED]xxx&#123;XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX&#125;xxxxCcmExecSuccessContent InstallInstallation Started: Windows has started installing the following update: [更新プログラム タイトル]........</span><br><span class="line">(2) [AGENT_INSTALLING_FAILED]xxx&#123;XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX&#125;100800704c7CcmExecFailureContent InstallInstallation Failure: Windows failed to install the following update with error 0x800704c7: [更新プログラム タイトル].......</span><br></pre></td></tr></table></figure><ul><li>(1) と (2) それぞれの文字列に CCMExec による実行ログであることが記載されている。</li><li>(1) と (2) の時間が最長実行時間以上</li><li>(2) のエラーが 0x800704c: E_CANCELLED</li></ul><p>お客様の環境によっては、上記実行時間を超えても更新プログラムの適用が終わらない場合があるかと存じますので、最長実行時間の設定を見直されると良いかと存じます。</p><ul><li>更新プログラム全体の設定確認<br>[ConfigMgr コンソール] - [サイトの構成] - [サイト] - ご利用のサイトの選択 - [サイト] - ご利用のサイトを選択 - [サイト コンポーネントの構成] - [ソフトウェアの更新ポイント]  - [最長実行時間] タブ  </li></ul><p><img src="/blog/mecm/20250325_03/20250325_03_01.png" alt="MaxExecution.png"></p><ul><li><p>更新プログラム単体の設定確認</p><ul><li><p>更新プログラムの場合<br>[ConfigMgr コンソール] - [ソフトウェア ライブラリ] - [概要] - [ソフトウェア更新プログラム] - [すべてのソフトウェア更新プログラム] - 該当の更新プログラムを選択 - [プロパティ] - [最長実行時間]タブ</p></li><li><p>機能更新プログラムの場合<br>[ConfigMgr コンソール] - [ソフトウェア ライブラリ] - [概要] - [Windows Servicing] - [すべての Windows 機能更新プログラム]-該当の更新プログラムを選択 - [プロパティ] - [最長実行時間]タブ</p><p><img src="/blog/mecm/20250325_03/20250325_03_02.png" alt="MaxEachExecution.png"></p></li></ul></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは。Configuration Manager サポート チームです。&lt;/p&gt;
&lt;p&gt;本記事では、Configuration Manager (ConfigMgr) を使用した OS 更新プログラムの適用が失敗する際のよくある原因と解決策をご紹介します。&lt;/p&gt;
&lt;</summary>
      
    
    
    
    
    <category term="MECM" scheme="https://jpmem.github.io/blog/tags/MECM/"/>
    
  </entry>
  
  <entry>
    <title>ConfigMgr クライアントでの OS 更新失敗を防ぐ - よくある原因と解決策 (4)</title>
    <link href="https://jpmem.github.io/blog/mecm/20250325_04/"/>
    <id>https://jpmem.github.io/blog/mecm/20250325_04/</id>
    <published>2025-03-24T15:00:00.000Z</published>
    <updated>2025-06-25T07:48:40.671Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは。Configuration Manager サポート チームです。</p><p>本記事では、Configuration Manager (ConfigMgr) を使用した OS 更新プログラムの適用が失敗する際のよくある原因と解決策をご紹介します。</p><p>※本記事では、WSUS、Intune、Windows Update、Windows Update for Business (WUfB) に関する内容は対象外です。</p><p>各症状ごとに詳細な記事を公開しています。記載内容と一致しない事象を確認された場合、弊社サポートまでお問い合わせください。</p><h2 id="症状"><a href="#症状" class="headerlink" title="症状"></a>症状</h2><p>以下のような問題が発生することがあります。</p><ol><li>利用可能展開にしているのに、更新プログラムがソフトウェア センターに表示されない</li><li>ソフトウェア センターでダウンロードが失敗する</li><li>ソフトウェア センターでインストールに失敗する</li><li><strong>必須展開にしているのに、更新プログラムが適用されない</strong></li></ol><p>本記事では、症状 4 の <strong>「必須展開にしているのに、更新プログラムが適用されない」</strong> 問題について解説します。</p><h2 id="必須展開にしているのに更新プログラムがいつまでも適用されない"><a href="#必須展開にしているのに更新プログラムがいつまでも適用されない" class="headerlink" title="必須展開にしているのに更新プログラムがいつまでも適用されない"></a>必須展開にしているのに更新プログラムがいつまでも適用されない</h2><p>「必須」で展開しているのに更新プログラムが適用されない場合、以下のような原因が考えられます。</p><ul><li>管理ポイントと通信できずに展開ポリシーを受け取れていない</li><li>展開ポリシーに紐づくコレクションにデバイスが所属していない</li><li>ソフトウェア更新ポイントと通信できずに更新プログラムの検出が失敗している</li><li>クライアントの所属する境界グループに配布ポイントが紐づいていない</li><li>配布ポイントにコンテンツが配布されていない。</li><li>クライアントの ccmcache フォルダー領域の空き容量が不足している。</li><li>更新プログラムの最長実行時間よりも更新プログラムの適用に時間がかかり、途中でキャンセルされた</li><li>更新プログラムの最長実行時間が、メンテナンス期間の間に収まっていない。</li></ul><h3 id="管理ポイントと通信できずに展開ポリシーを受け取れていない"><a href="#管理ポイントと通信できずに展開ポリシーを受け取れていない" class="headerlink" title="管理ポイントと通信できずに展開ポリシーを受け取れていない"></a>管理ポイントと通信できずに展開ポリシーを受け取れていない</h3><p>管理ポイントと ConfigMgr クライアントの通信ができていない可能性があります。以下の PowerShell コマンドを実行し、管理ポイントと疎通できるか確認してください (拡張 HTTP 通信設定の場合のみ)。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Invoke-WebRequest</span> <span class="literal">-Uri</span> <span class="string">&quot;http://&lt;管理ポイントの FQDN&gt;/sms_mp/.sms_aut?mplist&quot;</span> <span class="literal">-UseBasicParsing</span></span><br></pre></td></tr></table></figure><p>正常な場合、<code>StatusCode : 200</code> が返ります。それ以外の場合、通信エラーの可能性があります。</p><p>ログから確認する場合は、クライアントの <code>C:\Windows\CCM\Logs\CcmMessaging.log</code> を確認すると良いかと存じます。直近に以下のようなログが出力されていれば、通信が失敗している可能性が高いです。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[CCMHTTP] ERROR: URL=[管理ポイントの URL], Port=[port 番号], Options=1248, Code=0, Text=[エラー シンボル]</span><br><span class="line">[CCMHTTP] ERROR INFO: StatusCode=[HTTP ステータス コード] StatusText=[HTTP エラー ステータス テキスト]</span><br></pre></td></tr></table></figure><p>よくあるエラー シンボル の例:</p><ul><li><code>CCM_E_BAD_HTTP_STATUS_CODE</code>: HTTP ステータスコード 4xx または 5xx (サーバー側のエラー)</li><li><code>CCM_E_NO_CLIENT_PKI_CERT</code>: HTTPS 環境でクライアント証明書が見つからない</li><li><code>ERROR_WINHTTP_NAME_NOT_RESOLVED</code>: DNS で管理ポイントを解決できない</li><li><code>ERROR_WINHTTP_TIMEOUT</code>: 管理ポイントとの通信がタイムアウト</li></ul><h3 id="展開ポリシーに紐づくコレクションにデバイスが所属していない"><a href="#展開ポリシーに紐づくコレクションにデバイスが所属していない" class="headerlink" title="展開ポリシーに紐づくコレクションにデバイスが所属していない"></a>展開ポリシーに紐づくコレクションにデバイスが所属していない</h3><p>デバイスがコレクションに所属していないと、展開ポリシーを取得できません。以下の PowerShell コマンドを実行し、展開ポリシーを取得できているか確認してください。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Get-WmiObject</span> <span class="literal">-Namespace</span> <span class="string">&quot;root\CCM\Policy\Machine\ActualConfig&quot;</span> <span class="literal">-ClassName</span> CCM_UpdateCIAssignment | <span class="built_in">Select-Object</span> AssignmentID,  AssignmentName | <span class="built_in">Sort-Object</span> <span class="literal">-Property</span> AssignmentName | <span class="built_in">Format-Table</span> </span><br></pre></td></tr></table></figure><h3 id="ソフトウェア更新ポイントと通信できずに更新プログラムの検出が失敗している"><a href="#ソフトウェア更新ポイントと通信できずに更新プログラムの検出が失敗している" class="headerlink" title="ソフトウェア更新ポイントと通信できずに更新プログラムの検出が失敗している"></a>ソフトウェア更新ポイントと通信できずに更新プログラムの検出が失敗している</h3><p>デバイスがソフトウェア更新ポイントと通信できずに更新プログラムの検出が失敗している場合がございます。クライアントにて以下を実施し、ソフトウェア更新ポイントと疎通が取れるかご確認ください。(HTTP 通信設定の場合のみ)</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Invoke-WebRequest</span> <span class="literal">-Uri</span> <span class="string">&quot;http://&lt;ソフトウェア更新ポイントの FQDN&gt;:8530/ClientWebService/client.asmx&quot;</span> <span class="literal">-UseBasicParsing</span></span><br></pre></td></tr></table></figure><p><code>StatusCode : 200</code> 以外が返る場合、通信エラーの可能性があります。</p><p>また、ソフトウェア更新ポイントとアクセスする際には、通常、WinHTTP Proxy が利用されます。ご利用の NW 経路上、該当の Proxy は利用できるのか確認いただき、利用できない場合は、Proxy をバイパスするよう設定ください。</p><p>WinHTTP Proxy の設定は、コマンド プロンプトを開き、以下のコマンドを実行して確認できます。</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netsh winhttp show proxy</span><br></pre></td></tr></table></figure><p>このほか、ソフトウェア更新ポイントがクライアントの所属する境界グループに紐づいていない、もしくは所属するドメインのグループ ポリシーで上書きされている場合がございます。こちらの確認は、コマンド プロンプトで、以下を実行して出力されるグループ ポリシーの評価結果をご確認ください。</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gpresult /H gpresult.html</span><br></pre></td></tr></table></figure><p>出力された gpresult.html にて [設定] - [ポリシー] - [管理用テンプレート] - [Windows コンポーネント/Windows Update/(Windows Server Update Service から提供される更新プログラムの管理)]のポリシー [イントラネットの Microsoft 更新サービスの場所を指定する] の[優勢なGPO]が　[ローカル セキュリティ ポリシー]であり、かつ、以下の項目が以下の設定であるのが正しい設定です。</p><ul><li>更新を検出するためのイントラネットの更新サービスを指定する: ソフトウェア更新ポイントの FQDN</li><li>イントラネット統計サーバーの設定: ソフトウェア更新ポイントの FQDN</li><li>代替ダウンロード サーバーの設定: <a href="http://localhost:8005/">http://localhost:8005</a></li></ul><p> <img src="/blog/mecm/20250325_04/20250325_04_01.png" alt="gpresult.png"></p><p>上記の修復は [ConfigMgr コンソール] - [管理] - [階層の構成] - [境界グループ] より設定を見直しください。<br>IP サブネット境界設定が誤っている場合などもございます。</p><p>IP サブネット境界設定の考え方<br><a href="https://jpmem.github.io/blog/mecm/20220414_01/">https://jpmem.github.io/blog/mecm/20220414_01/</a></p><p>この他、「ソフトウェア更新ポイントとの通信がタイムアウトする」場合がございます。この事象は、 <code>C:\Windows\CCM\WUAHandler.log</code> の以下のようなログの出力で確認できます。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">OnSearchComplete - Failed to end search job. Error = 0x80072ee2</span><br><span class="line">Scan failed with error = 0x80072ee2.</span><br></pre></td></tr></table></figure><p>0x80072ee2:    WININET_E_TIMEOUT</p><p>また、「ソフトウェア更新ポイントとの通信が 503 エラーで返答される」場合もございます。この事象も、<code>C:\Windows\CCM\WUAHandler.log</code> の以下のようなログの出力で確認できます。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">OnSearchComplete - Failed to end search job. Error = 0x80244022.</span><br><span class="line">Scan failed with error = 0x80244022. </span><br></pre></td></tr></table></figure><p>0x80244022: WU_E_PT_HTTP_STATUS_SERVICE_UNAVAIL / Same as HTTP status 503 - the service is temporarily overloaded.</p><p>これらの原因は、ソフトウェア更新ポイントとして利用している WSUS のメンテナンスが適切に行われていない場合が極めて多いので、以下でご案内のメンテナンスを実施ください。</p><p>WSUS メンテナンスガイド新版<br><a href="https://jpmem.github.io/blog/wsus/2022-05-09_01/">https://jpmem.github.io/blog/wsus/2022-05-09_01/</a></p><p>この他、実際にクライアントで更新プログラムの検出が成功しているかどうかは、以下の Powershell スクリプトを実行することでも確認できます。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Get-WmiObject</span> <span class="literal">-Namespace</span> <span class="string">&quot;root\CCM\SoftwareUpdates\UpdatesStore&quot;</span> <span class="literal">-ClassName</span> CCM_UpdateStatus | <span class="built_in">Select-Object</span> UniqueId,Title,Status | <span class="built_in">Format-Table</span></span><br></pre></td></tr></table></figure><p>適用させたい更新プログラムの Status が Missing になっているかを確認ください。該当の更新プログラムが見つからない場合、ソフトウェア更新ポイント上で該当の更新プログラムの承認状態が「未承認」でないか、そもそもソフトウェア更新ポイントと通信できていないか、もしくは、WUfB 関連のポリシー/レジストリが有効になっているために デュアル スキャン 状態になっている可能性がございます。</p><h3 id="クライアントの所属する境界グループに配布ポイントが紐づいていない"><a href="#クライアントの所属する境界グループに配布ポイントが紐づいていない" class="headerlink" title="クライアントの所属する境界グループに配布ポイントが紐づいていない"></a>クライアントの所属する境界グループに配布ポイントが紐づいていない</h3><h3 id="配布ポイントにコンテンツが配布されていない。"><a href="#配布ポイントにコンテンツが配布されていない。" class="headerlink" title="配布ポイントにコンテンツが配布されていない。"></a>配布ポイントにコンテンツが配布されていない。</h3><p>クライアントの所属する境界グループに配布ポイントが紐づいていない、または紐づいていたとしても配布ポイントにコンテンツが割り当たっていないために、該当の更新プログラム コンテンツのダウンロード元が見つからない場合がございます。この場合、<code>C:\Windows\CCM\Logs\ContentTransferManager.log</code> に以下のようなログが出力されます。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CCTMJob::UpdateLocations - Received empty location update for CTM Job &#123;XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX&#125;</span><br><span class="line">CTM job &#123;XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX&#125; suspended   </span><br></pre></td></tr></table></figure><p>上記、修復には ConfigMgr コンソールより、該当の配布ポイントに対象の更新プログラムを含む展開パッケージが配布されているかをご確認ください。</p><p>確認すべき項目は、以下です。</p><ul><li><p>境界グループ設定の見直し<br>[ConfigMgr コンソール] - [管理] - [階層の構成] - [境界グループ] より設定を見直しください。<br>IP サブネット境界設定が誤っている場合などもございます。</p><p>IP サブネット境界設定の考え方<br><a href="https://jpmem.github.io/blog/mecm/20220414_01/">https://jpmem.github.io/blog/mecm/20220414_01/</a></p></li><li><p>展開パッケージ配布状況の確認<br>[ConfigMgr コンソール] - [監視] - [概要] - [配布ステータス] - [コンテンツのステータス]</p></li></ul><h3 id="クライアントの-ccmcache-フォルダー領域の空き容量が不足している。"><a href="#クライアントの-ccmcache-フォルダー領域の空き容量が不足している。" class="headerlink" title="クライアントの ccmcache フォルダー領域の空き容量が不足している。"></a>クライアントの ccmcache フォルダー領域の空き容量が不足している。</h3><p>配信の最適化であれ、PeerCache や BranchCache を利用されている環境であれ、必ず <code>C:\Windows\CCMCache</code> にダウンロードしたコンテンツはキャッシュされる仕組みとなっております。機能更新プログラムは数 GB になることも多くあることから、上記キャッシュ領域が不足することもございますので、<br>容量を確保するようお願いいたします。 </p><p>最大キャッシュ サイズの設定は,  以下で設定可能です。(MB) と (ディスクの割合) の二つの設定がございますが、計算した結果小さいほうが採用されます。また 100 GB　以上は現状設定不可となっています。  </p><p>[ConfigMgr コンソール] - [管理] - [概要] - [クライアント設定] - ご利用のクライアント設定を選択 - [プロパティ] - [クライアント キャッシュの設定] - [最大キャッシュ サイズ]</p><p><img src="/blog/mecm/20250325_04/20250325_04_02.png" alt="CCMCacche.png"></p><p>この他、クライアントのキャッシュをクリアしたい場合は以下の記事をご参照ください。  </p><p>ccmcache フォルダー配下のキャッシュ クリア方法<br><a href="https://jpmem.github.io/blog/mecm/20220511_01/">https://jpmem.github.io/blog/mecm/20220511_01/</a></p><h3 id="更新プログラムの最長実行時間よりも更新プログラムの適用に時間がかかり、途中でキャンセルされた"><a href="#更新プログラムの最長実行時間よりも更新プログラムの適用に時間がかかり、途中でキャンセルされた" class="headerlink" title="更新プログラムの最長実行時間よりも更新プログラムの適用に時間がかかり、途中でキャンセルされた"></a>更新プログラムの最長実行時間よりも更新プログラムの適用に時間がかかり、途中でキャンセルされた</h3><p>ConfigMgr の更新プログラムの展開は、適用中の意図しないトラブルを防ぐため、最長実行時間が設定されており、これを超えた場合、更新プログラムの適用処理が途中でキャンセルされる動きとなっております。</p><p>上記は、<code>C:\Windows\SoftwareDistribution\ReportingEvents.log</code> に出力される以下のようなログ文字列があることでも判断可能です。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(1) [AGENT_INSTALLING_STARTED]xxx&#123;XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX&#125;xxxxCcmExecSuccessContent InstallInstallation Started: Windows has started installing the following update: [更新プログラム タイトル]........</span><br><span class="line">(2) [AGENT_INSTALLING_FAILED]xxx&#123;XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX&#125;100800704c7CcmExecFailureContent InstallInstallation Failure: Windows failed to install the following update with error 0x800704c7: [更新プログラム タイトル].......</span><br></pre></td></tr></table></figure><ul><li>(1) と (2) それぞれの文字列に CCMExec による実行ログであることが記載されている。</li><li>(1) と (2) の時間が最長実行時間以上</li><li>(2) のエラーが 0x800704c: E_CANCELLED</li></ul><p>お客様の環境によっては、上記実行時間を超えても更新プログラムの適用が終わらない場合があるかと存じますので、最長実行時間の設定を見直されると良いかと存じます。</p><ul><li>更新プログラム全体の設定確認<br>[ConfigMgr コンソール] - [サイトの構成] - [サイト] - ご利用のサイトの選択 - [サイト] - ご利用のサイトを選択 - [サイト コンポーネントの構成] - [ソフトウェアの更新ポイント]  - [最長実行時間] タブ  </li></ul><p><img src="/blog/mecm/20250325_04/20250325_04_03.png" alt="MaxExecution.png"></p><ul><li><p>更新プログラム単体の設定確認</p><ul><li><p>更新プログラムの場合<br>[ConfigMgr コンソール] - [ソフトウェア ライブラリ] - [概要] - [ソフトウェア更新プログラム] - [すべてのソフトウェア更新プログラム] - 該当の更新プログラムを選択 - [プロパティ] - [最長実行時間]タブ</p></li><li><p>機能更新プログラムの場合<br>[ConfigMgr コンソール] - [ソフトウェア ライブラリ] - [概要] - [Windows Servicing] - [すべての Windows 機能更新プログラム] - 該当の更新プログラムを選択 - [プロパティ] - [最長実行時間]タブ</p><p><img src="/blog/mecm/20250325_04/20250325_04_04.png" alt="MaxEachExecution.png"></p></li></ul></li></ul><h2 id="更新プログラムの最長実行時間が、メンテナンス期間の間に収まっていない。"><a href="#更新プログラムの最長実行時間が、メンテナンス期間の間に収まっていない。" class="headerlink" title="更新プログラムの最長実行時間が、メンテナンス期間の間に収まっていない。"></a>更新プログラムの最長実行時間が、メンテナンス期間の間に収まっていない。</h2><p>お客様がメンテナンス期間を設定されている場合、設定されているメンテナンス期間の期間が最長実行時間より長いものが一つもない場合、更新プログラムの適用がキックされることはございませんので予め、ご認識ください。</p><p>メンテナンス期間は、以下で設定されています。</p><p>[ConfigMgr コンソール] - [資産とコンプライアンス] - [概要] - [デバイス コレクション] - デバイスの所属するコレクションを選択 - [プロパティ] - [メンテナンス期間] タブ</p><p><img src="/blog/mecm/20250325_04/20250325_04_05.png" alt="MaintenanceWindows.png"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは。Configuration Manager サポート チームです。&lt;/p&gt;
&lt;p&gt;本記事では、Configuration Manager (ConfigMgr) を使用した OS 更新プログラムの適用が失敗する際のよくある原因と解決策をご紹介します。&lt;/p&gt;
&lt;</summary>
      
    
    
    
    
    <category term="MECM" scheme="https://jpmem.github.io/blog/tags/MECM/"/>
    
  </entry>
  
  <entry>
    <title>Configuration Manager のアップグレードをオフラインで行う場合の注意点について</title>
    <link href="https://jpmem.github.io/blog/mecm/20250207_01/"/>
    <id>https://jpmem.github.io/blog/mecm/20250207_01/</id>
    <published>2025-02-06T15:00:00.000Z</published>
    <updated>2025-06-25T07:48:40.667Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。 Configuration Manager サポート チームです。<br>本日は、Configuration Manger (ConfigMgr) のアップグレードをオフラインで行う場合の注意点についてご案内させていただきます。<br>ConfigMgr のアップグレードでは、サービス接続ポイントというサイトサービスの役割を使用しますが、この役割にはオンラインとオフラインの 2 つのモードが存在します。  </p><ul><li>オンライン モード: サービス接続ポイントは自動的に Microsoft クラウド サービスに接続し、該当する更新プログラムをダウンロードします。  </li><li>オフライン モード: サービス接続ポイントは Microsoft クラウド サービスに接続しません。 利用可能な更新プログラムをダウンロードしてインポートするには、 サービス接続ツールを使用します。  </li></ul><p>サービス接続ポイントがオフライン モードの場合は、インターネットに接続したコンピューターでサービス接続ツール “ServiceConnectionTool.exe” を実行し、ConfigMgr の更新プログラムをダウンロードします。<br>その後、取得した更新プログラムを サイトサーバーにインポートし、アップグレードを行う流れになります。<br>サービス接続ツールの詳しい使い方につきましては、公開情報よりご確認いただきたく割愛させていただきますが、更新プログラムをダウンロードする場合、以下のようなコマンドをコマンド プロンプトから実行します。  </p><p>参考<br><a href="https://learn.microsoft.com/ja-jp/mem/configmgr/core/servers/manage/use-the-service-connection-tool">Configuration Manager のサービス接続ツールを使用する</a>  </p><p>更新プログラムをダウンロードする場合のコマンド例  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ServiceConnectionTool.exe -connect -downloadsiteversion -usagedatasrv C:\temp\cab -updatepackdest C:\temp\UpdatePacks  </span><br></pre></td></tr></table></figure><p>ダウンロードは主に 2 ステップに分かれており、ServiceConnectionTool.exe と ServiceConnectionTool.exe から呼び出された setupdl.exe によって行われます。<br>すべてのダウンロードが完了すると、以下のように呼び出し元に戻ってくる流れとなっており、通信断など予期せぬトラブルが発生した場合、コマンド プロンプト上でエラーが表示されますが、ファイルのダウンロード結果についてはコマンド プロンプト上で表示されません。  </p><p><img src="/blog/mecm/20250207_01/20250207.png" alt="20250207.png">  </p><p>このため、何も表示せずに呼び出し元に戻る状態の確認のみでは、ダウンロードがすべて成功したことを判断できず、ダウンロードが成功したかどうかはログを確認する必要があります。<br>一部ファイルのダウンロードが失敗した状態でサイトサーバーにインポートするとアップグレードに失敗する要因となるため、そのような事態を回避するためにも、ダウンロード完了後は、サービス接続ツールのログ ファイルからダウンロード結果をご確認いただくことをお勧めいたします。  </p><p>確認方法<br>サービス接続ツールによる更新プログラムダウンロードのログは以下 2 つのファイルに記録されます。  </p><ul><li>ServiceConnectionTool.log<br>　サービス接続ツールと同じ場所に作成されます。<br>　マニフェストや更新プログラムの実体のダウンロードに関するログが記録されます。  </li><li>ConfigMgrSetup.log<br>　システム ドライブ直下に存在します。<br>　言語パックや SQL のインストールモジュールのダウンロードに関するログが記録されます。  </li></ul><p>上記それぞれのファイルを開き、ファイルのダウンロードに失敗していないか確認をします。  </p><ul><li><p>ServiceConnectionTool.log について<br>「ERROR:Failed to download redist for」という文字列が含まれていないことを確認します。  </p></li><li><p>成功の出力例  </p><pre><code>2024-11-19 11:53:40 INFO:downloading redist  2024-11-19 12:20:42 INFO:Successfully download redist for 5B8886C7-F967-4F8A-92AA-009E28368853  </code></pre></li><li><p>エラーの出力例  </p><pre><code>2024-11-19 11:06:30 INFO:downloading redist  2024-11-19 11:10:18 ERROR:Failed to download redist for 5B8886C7-F967-4F8A-92AA-009E28368853  </code></pre></li><li><p>ConfigMgrSetup.logについて<br>「ERROR: Download() failed」という文字列が含まれていないことを確認します。<br>また、ダウンロードしたファイル群から Redist フォルダを開き、0KB のファイルが存在しないことを確認します。  </p></li><li><p>エラーの出力例  </p><pre><code>ERROR: Download() failed with 0x80072EE2  </code></pre></li></ul><p>上記ログにダウンロード失敗のログが記録されている、または Redist フォルダ配下に 0KB のファイルが存在する場合は、ダウンロードに失敗していますので、ダウンロードしたファイル群は使用せず、再ダウンロードをお試しください。<br>なお、アップグレードに伴いご確認いただきたいことや注意事項は、公開情報にてチェックリストとしてご案内しておりますのでこちらも併せて参考にしてください。<br>特に、予期せぬトラブルに備え、アップグレード前のバックアップいただくことをお勧めいたします。  </p><p>参考<br><a href="https://learn.microsoft.com/ja-jp/mem/configmgr/core/servers/manage/checklist-for-installing-update-2409">更新プログラム 2409 をインストールするためのチェックリスト</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。 Configuration Manager サポート チームです。&lt;br&gt;本日は、Configuration Manger (ConfigMgr) のアップグレードをオフラインで行う場合の注意点についてご案内させていただきます。&lt;br&gt;ConfigM</summary>
      
    
    
    
    
    <category term="MECM" scheme="https://jpmem.github.io/blog/tags/MECM/"/>
    
  </entry>
  
  <entry>
    <title>タスクシーケンスのコンテンツを事前にダウンロードする</title>
    <link href="https://jpmem.github.io/blog/mecm/20250128_01/"/>
    <id>https://jpmem.github.io/blog/mecm/20250128_01/</id>
    <published>2025-01-27T15:00:00.000Z</published>
    <updated>2025-06-25T07:48:40.663Z</updated>
    
    <content type="html"><![CDATA[<p>みなさん、こんにちは。Configuration Manager チームです。<br>この投稿では、Configuration Manager を利用してオペレーティング システムを展開する時にお役立ていただける、タスクシーケンスのコンテンツを事前にダウンロードするオプションをご紹介します。</p><p>オペレーティング システムの展開に利用されるコンテンツのファイル サイズは比較的大きい傾向があります。タスクシーケンスの展開の種類を “利用可能” として展開をすると、ユーザーがソフトウェア センターから [インストール] ボタンをクリックすることでコンテンツのダウンロードが開始されますが、ファイル サイズが大きい場合はダウンロードおよびインストール完了までに時間を要し、ユーザーが待機する時間が長くかかってしまうと思うことはありませんか？</p><p>今回ご紹介する “事前ダウンロード” のオプションを利用すると、指定した言語とアーキテクチャに一致するコンテンツが事前にクライアントのキャッシュ フォルダーにダウンロードされます。ユーザーがソフトウェア センターから [インストール] ボタンをクリックすると、既にキャッシュされたコンテンツを使用してインストール処理から開始することができるため、ユーザーが処理を待機する時間が短くなるメリットがあります。ぜひご検討の上、活用ください。</p><h1 id="利用要件"><a href="#利用要件" class="headerlink" title="利用要件"></a>利用要件</h1><p>コンテンツの事前ダウンロードは、タスクシーケンスを利用して以下のコンテンツを配信する時に利用ができます。</p><ul><li>OS アップグレード パッケージ (*1)</li><li>OS イメージ</li><li>ドライバー パッケージ</li><li>パッケージ</li></ul><p>*1 OS アップグレード パッケージにソフトウェア更新プログラムによる機能更新プログラムを選択しているときは、事前ダウンロードが有効になりません。ISO メディアを使用したアップグレード パッケージを使用している場合に、事前ダウンロードが有効になります。詳細については、以下の公開情報もあわせて確認してください。</p><p>公開情報 : <a href="https://learn.microsoft.com/ja-jp/mem/configmgr/osd/deploy-use/configure-precache-content">タスク シーケンスの事前キャッシュ コンテンツを構成する</a>  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">注意  </span><br><span class="line">バージョン 2103 以降、 アップグレード OS タスク シーケンス ステップで機能更新プログラムを使用する場合、 このタスク シーケンスのコンテンツを事前にダウンロードするオプションは機能更新プログラムには適用されません。</span><br></pre></td></tr></table></figure><h1 id="事前準備"><a href="#事前準備" class="headerlink" title="事前準備"></a>事前準備</h1><p>OS イメージや OS アップグレード パッケージなど複数の言語やアーキテクチャを含むコンテンツに対し、クライアントの条件に一致する設定とします。</p><h2 id="OS-アップグレード-パッケージ"><a href="#OS-アップグレード-パッケージ" class="headerlink" title="OS アップグレード パッケージ"></a>OS アップグレード パッケージ</h2><p>Configuration Manager コンソールで [ソフトウェア ライブラリ] - [概要] - [オペレーティング システム] - [オペレーティング システム アップグレード パッケージ] に移動し、OS アップグレード パッケージのプロパティを開きます。<br>[データソース] タブから言語とアーキテクチャを指定します。</p><h2 id="OS-イメージ"><a href="#OS-イメージ" class="headerlink" title="OS イメージ"></a>OS イメージ</h2><p>Configuration Manager コンソールで [ソフトウェア ライブラリ] - [概要] - [オペレーティング システム] - [オペレーティング システム イメージ] に移動し、OS イメージのプロパティを開きます。<br>[データソース] タブから言語とアーキテクチャを指定します。</p><h2 id="ドライバー-パッケージ"><a href="#ドライバー-パッケージ" class="headerlink" title="ドライバー パッケージ"></a>ドライバー パッケージ</h2><p>Configuration Manager コンソールで [ソフトウェア ライブラリ] - [概要] - [オペレーティング システム] - [ドライバー パッケージ] に移動し、ドライバー パッケージのプロパティを開きます。<br>[全般] タブからモデルを指定します。</p><p>ここで評価されるモデル名は、クライアントの WMI クラス Win32_ComputerSystemProduct の Name に格納されている名前です。確認する場合はクライアント上で PowerShell コマンド <code>Get-WmiObject -query &quot;select * from win32_computersystemproduct&quot;</code> を実行し、Name の値を確認します。タスクシーケンスの実行中は <code>select * from win32_computersystemproduct where name like &quot;%指定したモデル名%&quot;</code> というように評価が行われますので、指定したモデル名を含むことで条件に一致するとみなされます。</p><h2 id="パッケージ"><a href="#パッケージ" class="headerlink" title="パッケージ"></a>パッケージ</h2><p>Configuration Manager コンソールで [ソフトウェア ライブラリ] - [概要] - [アプリケーション管理] - [パッケージ] に移動し、パッケージのプロパティを開きます。[全般] タブから言語とアーキテクチャを指定します。</p><h1 id="事前ダウンロードの利用手順"><a href="#事前ダウンロードの利用手順" class="headerlink" title="事前ダウンロードの利用手順"></a>事前ダウンロードの利用手順</h1><p>事前に作成したタスクシーケンスを “事前ダウンロード” を有効としてデバイス コレクションに展開します。</p><ol><li><p>Configuration Manager コンソールで、[ソフトウェア ライブラリ] - [概要] - [オペレーティング システム] - [タスク シーケンス] の順に展開します。</p></li><li><p>展開するタスクシーケンスを選択し、[ホーム]  メニュー内の [展開] ボタンをクリックします。</p></li><li><p>“ソフトウェアの展開ウィザード”  が起動します。</p></li><li><p>[全般] ページでコレクションを指定し、”このタスク シーケンスのコンテンツを事前にダウンロードする” にチェックを付け、[次へ] をクリックします。<br><img src="/blog/mecm/20250128_01/1.png" alt="1.png"></p></li><li><p>[展開設定] ページで目的は “利用可能” を選択し、[次へ] をクリックします。<br><img src="/blog/mecm/20250128_01/2.png" alt="2.png"></p></li><li><p>[スケジュール] ページでは、”この展開が使用可能になる日時を指定する” にチェックを付け、任意の日時を指定し、[次へ] をクリックします。クライアントはこの日時が過ぎたことを検知すると、コンテンツの事前ダウンロードを開始します。<br><img src="/blog/mecm/20250128_01/3.png" alt="3.png"></p></li><li><p>[ユーザー側の表示と操作]  ページは任意の設定に指定して、[次へ] をクリックします。</p></li><li><p>[アラート]  ページは任意の設定に指定して、[次へ] をクリックします。</p></li><li><p>[配布ポイント] ページの展開オプションの設定は、ユーザーが事前ダウンロードを完了する前にタスクシーケンスを実行した場合に参照されます。事前にすべてのコンテンツをダウンロードしておくため、こちらの展開オプションも “タスクシーケンスを開始する前にすべてのコンテンツをローカルにダウンロードする” を選択しておきます。 近隣や、既定の境界グループ内の配布ポイントの使用については任意で設定をおこない、[次へ] をクリックします。<br><img src="/blog/mecm/20250128_01/6.png" alt="6.png"></p></li><li><p>[概要] ページで設定内容を確認し、[次へ] をクリックします。</p></li><li><p>[完了]  ページが表示されたら [閉じる] をクリックします。</p></li></ol><h1 id="クライアントでの動作を確認する"><a href="#クライアントでの動作を確認する" class="headerlink" title="クライアントでの動作を確認する"></a>クライアントでの動作を確認する</h1><p>クライアント側で事前ダウンロードがおこなわれる処理の大まかなイメージです。<br><img src="/blog/mecm/20250128_01/Image.png" alt="Image.png"></p><ol><li>管理者が管理コンソールから配信の設定をおこないます。  </li><li>クライアントは、クライアント ポリシーのポーリング間隔 (既定で 60 分 ＋ ランダム遅延最大 60 分) にて自動でポリシーの取得をおこなっています。(*2)</li></ol><p>*2 既定値は [クライアント設定] &gt; [クライアント ポリシー] の “クライアント ポリシーのポーリング間隔” 箇所で設定されています。間隔を待たず、直ちにポリシーの取得をおこないたい場合は、コントロール パネルから Configuration Manager を起動し [操作] タブ上の [コンピューター ポリシーの取得および評価サイクル] を直ちに実行してください。</p><ol start="3"><li>ポリシーを取得したタイミングで、ソフトウェア センターにタスクシーケンスが表示されます。</li></ol><p><img src="/blog/mecm/20250128_01/SC.png" alt="SC.png"></p><ol start="4"><li><p>タスクシーケンスに紐づくコンテンツに対して、Configuration Manager クライアント (execmgr) が「事前準備」で設定した条件に該当するか評価をおこないます。</p></li><li><p>4 の条件に該当したコンテンツは、「事前ダウンロードの利用手順」の手順 6 で指定した使用可能になる日時が過ぎてからダウンロードを開始します。</p></li></ol><p>上記の動作上、ユーザーが 3 のソフトウェア センターに表示された直後に [インストール] ボタンをクリックすると、4、5 の事前ダウンロードの処理が完了する前にダウンロードおよびインストール処理がおこなわれる可能性があることにご留意ください。この時、「事前ダウンロードの利用手順」の手順 9 で設定した展開オプションに従ってダウンロードがおこなわれます。</p><ol start="6"><li>ダウンロードされたコンテンツはキャッシュ フォルダーに格納されます。</li></ol><p><strong>[Tips]</strong> ユーザー側で事前ダウンロードが完了したことを確認するためには、コンテンツごとの確認となりますが、クライアント上のキャッシュ フォルダーの状態から確認が可能です。まず、Configuration Manager コンソールから事前ダウンロードを有効にしたコンテンツ ID を確認します。</p><p>例: OS イメージ<br><img src="/blog/mecm/20250128_01/ID.png" alt="ID.png"></p><p>次にクライアント上で PowerShell コマンド <code>gwmi -namespace root\ccm\softmgmtagent -query &quot;select * from CacheInfoEx where contentID=&#39;コンテンツID&#39;&quot;</code> のように実行します。<br><img src="/blog/mecm/20250128_01/PS.png" alt="PS.png"></p><p>ContentComplete が True となっていればダウンロードは完了しています。実際に Location に指定されているキャッシュ フォルダーを確認すると以下のようにコンテンツが配置されていることを確認することができます。<br><img src="/blog/mecm/20250128_01/ccmcache.png" alt="ccmcache.png"></p><p>参考情報 : <a href="https://learn.microsoft.com/ja-jp/mem/configmgr/osd/deploy-use/configure-precache-content">タスク シーケンスの事前キャッシュ コンテンツを構成する</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさん、こんにちは。Configuration Manager チームです。&lt;br&gt;この投稿では、Configuration Manager を利用してオペレーティング システムを展開する時にお役立ていただける、タスクシーケンスのコンテンツを事前にダウンロードするオプショ</summary>
      
    
    
    
    
    <category term="MECM" scheme="https://jpmem.github.io/blog/tags/MECM/"/>
    
    <category term="OS 展開" scheme="https://jpmem.github.io/blog/tags/OS-%E5%B1%95%E9%96%8B/"/>
    
  </entry>
  
  <entry>
    <title>AutoPilot を使って キッティングした Windows 11 端末に対して共同管理ポリシーが適用されない問題</title>
    <link href="https://jpmem.github.io/blog/mecm/20241010_01/"/>
    <id>https://jpmem.github.io/blog/mecm/20241010_01/</id>
    <published>2024-10-09T15:00:00.000Z</published>
    <updated>2025-06-25T07:48:40.662Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。Configuration Manager サポート チームです。<br>本日は、AutoPilot を使って キッティング した Win 11 端末に対して共同管理ポリシーが正しく適用できない場合の対処策についてご案内致します。</p><h1 id="現象"><a href="#現象" class="headerlink" title="現象"></a>現象</h1><ul><li>共同管理構成ポリシー で ワークロード を Configuration Manager 側に寄せているにもかかわらず、 全ての ワークロード が Intune 側に寄っている状態の挙動を示します。</li></ul><h1 id="事象発生条件"><a href="#事象発生条件" class="headerlink" title="事象発生条件"></a>事象発生条件</h1><ul><li><p>AutoPilot を使って キッティングする</p></li><li><p>Windows 11 端末</p></li><li><p>[Intune 管理センター] - [デバイス] - [デバイスのオンボーディング] - [登録] - [Windows] - [登録オプション] - [共同管理の設定] にてプロファイルが作成されていない<br> <img src="/blog/mecm/20241010_01/20241010_01_01.png" alt="image.png"></p><p>もしくは、上記画面で設定されているプロファイルにて「共同管理ポリシーをオーバーライドし、すべてのワークロードに対して Intune　を使用します] が「はい」の状態でプロファイルが端末に適用されている。<br><img src="/blog/mecm/20241010_01/20241010_01_02.png" alt="image.png"></p></li></ul><h1 id="事象発生の確認方法"><a href="#事象発生の確認方法" class="headerlink" title="事象発生の確認方法"></a>事象発生の確認方法</h1><ul><li>[ファイル名を指定して実行] - [C:\Windows\CCM\SMSCFGRC.cpl] を開き、全般タブを開いた際に「共同管理機能」の値が以下のように 「2147479807」 を示します。</li><li>C:\Windows\CCM\CoManagementHandler.log に以下のように出力されます。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Workloads are explicitly set by Intune Co-Management Profile so not using ConfigMgr set workloads. Current value from set from Intune is 2147479807</span><br></pre></td></tr></table></figure></li><li>管理機関を示すレジストリ値が 以下にて Intune に設定されています。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[HKLM\SOFTWARE\Microsoft\DeviceManageabilityCSP\Provider\MS DM Server]</span><br><span class="line">Key: ConfigInfo</span><br><span class="line">Value: 1</span><br></pre></td></tr></table></figure>Value が 1 のとき Intune, Value が 2 のとき Configuration Manager を示します。</li></ul><h1 id="事象の解消方法"><a href="#事象の解消方法" class="headerlink" title="事象の解消方法"></a>事象の解消方法</h1><ul><li><p>事象が既に発生してしまっている端末については、以下のレジストリの値を変更し、CCMExec サービスを再起動することで事象が解消され、ワークロードの設定が Configuration Manager で設定したものに設定されます。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[HKLM\SOFTWARE\Microsoft\DeviceManageabilityCSP\Provider\MS DM Server]</span><br><span class="line">Key: ConfigInfo</span><br><span class="line">Value: 2</span><br></pre></td></tr></table></figure><ul><li>[ファイル名を指定して実行] - [C:\Windows\CCM\SMSCFGRC.cpl] を開き、全般タブを開いた際に「共同管理機能」の値が 「2147479807」 以外の値を示すようになります。</li></ul></li><li><p>これからキッティングする端末にて事象が発生しないようにするためには、プロファイルにて「共同管理ポリシーをオーバーライドし、すべてのワークロードに対して Intune　を使用します] を「いいえ」にして端末に割り当ててください。</p></li></ul><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a href="https://learn.microsoft.com/ja-jp/mem/configmgr/comanage/autopilot-enrollment#limitations">Autopilot に登録する方法 - 制限事項</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。Configuration Manager サポート チームです。&lt;br&gt;本日は、AutoPilot を使って キッティング した Win 11 端末に対して共同管理ポリシーが正しく適用できない場合の対処策についてご案内致します。&lt;/p&gt;
&lt;h1 id</summary>
      
    
    
    
    
    <category term="MECM" scheme="https://jpmem.github.io/blog/tags/MECM/"/>
    
    <category term="共同管理" scheme="https://jpmem.github.io/blog/tags/%E5%85%B1%E5%90%8C%E7%AE%A1%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>Content Library Explorer を使って配布ポイントに格納されているコンテンツを確認する</title>
    <link href="https://jpmem.github.io/blog/mecm/20241004_01/"/>
    <id>https://jpmem.github.io/blog/mecm/20241004_01/</id>
    <published>2024-10-03T15:00:00.000Z</published>
    <updated>2025-06-25T07:48:40.662Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。 Configuration Manager サポート チームです。<br>本日は、Configuration Mager (ConfigMgr) の配布ポイントに格納されているコンテンツを確認するために有用な Content Library Explorer のご利用方法をご案内させていただきます。</p><h1 id="利用するパターン"><a href="#利用するパターン" class="headerlink" title="利用するパターン"></a>利用するパターン</h1><ul><li>クライアントにアプリケーションや更新プログラムを配布する際、配布ポイントにコンテンツが存在しない旨エラーが出た場合、配布ポイント上のコンテンツを検証したり、ファイル破損が発生したりしていないか確認する。</li></ul><h1 id="使い方"><a href="#使い方" class="headerlink" title="使い方"></a>使い方</h1><ol><li>サイト サーバー にアクセスします。</li><li>[ConfigMgr インストールフォルダ]\tools\ServerTools\contentlibraryexplorer.exe を開きます。<br><img src="/blog/mecm/20241004_01/20241004_01_01.png" alt="image.png"></li><li>[Enter Distribution Point Location] とダイアログが表示されるので、配布ポイントの FQDN を入力し、[OK] をクリックします。<br>　<img src="/blog/mecm/20241004_01/20241004_01_02.png" alt="image.png"></li><li>該当の配布ポイントに配布されているコンテンツの一覧が表示されます。<br>　<img src="/blog/mecm/20241004_01/20241004_01_03.png" alt="image.png"></li><li>左ペインから調査したいパッケージを選択すると、右ペインに該当のパッケージに含まれるファイルの一覧が表示されます。各列の意味は以下の通りです。<ul><li>File: ファイル名</li><li>Size: ファイルサイズ (byte)</li><li>Time Modified: 最新変更日付</li><li>Shared With: 別のパッケージでも該当ファイルを共有している場合、共有しているパッケージの名前が表示されます。</li><li>Path: 配布ポイントのファイルシステム上のファイルパスが表示されます。<ul><li>ここで、実際のファイル名は 該当ファイルの SHA-1 ハッシュです。この点に着目すると、ソース共有フォルダのファイルを PowerShell の Get-FileHash で取得したハッシュと、このファイルパスのハッシュが一致するかどうかで、コンテンツ ファイル を正しく配布出来ているかどうかを確認出来たりします。</li></ul></li></ul></li></ol><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a href="https://learn.microsoft.com/ja-jp/mem/configmgr/core/support/content-library-explorer">Content Library Explorer</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。 Configuration Manager サポート チームです。&lt;br&gt;本日は、Configuration Mager (ConfigMgr) の配布ポイントに格納されているコンテンツを確認するために有用な Content Library Expl</summary>
      
    
    
    
    
    <category term="MECM" scheme="https://jpmem.github.io/blog/tags/MECM/"/>
    
    <category term="使い方" scheme="https://jpmem.github.io/blog/tags/%E4%BD%BF%E3%81%84%E6%96%B9/"/>
    
  </entry>
  
  <entry>
    <title>WSUS 開発終了のお知らせ</title>
    <link href="https://jpmem.github.io/blog/wsus/2024-09-24_01/"/>
    <id>https://jpmem.github.io/blog/wsus/2024-09-24_01/</id>
    <published>2024-09-23T15:00:00.000Z</published>
    <updated>2025-06-25T07:48:40.806Z</updated>
    
    <content type="html"><![CDATA[<p>皆様、こんにちは。WSUS サポート チームです。<br>本記事は、2024 年 9 月 20 日に米国の Windows IT Pro Blog で公開された <a href="https://techcommunity.microsoft.com/t5/windows-it-pro-blog/windows-server-update-services-wsus-deprecation/ba-p/4250436">Windows Server Update Services (WSUS) deprecation</a> の抄訳です。<br>ご案内の通り、誠に恐縮ながら、WSUS の新機能の開発および新機能のリクエストの受付は終了いたしますが、WSUS および Configuration Manager は引き続きサポートいたします。</p><hr><p>クラウドからの簡素化された Windows 管理のビジョンの一環として、マイクロソフトは <a href="https://learn.microsoft.com/ja-jp/windows-server/get-started/removed-deprecated-features-windows-server-2025">Windows Server Update Services（WSUS）</a> の廃止を発表しました。具体的には、新しい機能の開発や新機能のリクエストの受付を終了することを意味します。ただし、現在の機能は維持され、WSUS チャネルを通じて更新プログラムを引き続き公開します。また、WSUS チャネルを通じて既に公開されたコンテンツもサポートします。</p><p>廃止とは、機能やサービスがもはや積極的に開発されていない製品ライフサイクルの段階を意味します。WSUS の廃止は、Microsoft Configuration Manager の既存の機能やサポートには影響しません。また、WSUS の役割は Windows Server 2025 でも利用可能ですが、クライアントの更新管理には <a href="https://learn.microsoft.com/ja-jp/windows/deployment/windows-autopatch/overview/windows-autopatch-overview">Windows Autopatch</a> や<a href="https://learn.microsoft.com/ja-jp/mem/intune/fundamentals/what-is-intune">Microsoft Intune</a>、サーバーの更新管理には <a href="https://azure.microsoft.com/ja-jp/products/azure-update-management-center/">Azure Update Manager</a> などのクラウド ツールへの移行をお勧めします。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;皆様、こんにちは。WSUS サポート チームです。&lt;br&gt;本記事は、2024 年 9 月 20 日に米国の Windows IT Pro Blog で公開された &lt;a href=&quot;https://techcommunity.microsoft.com/t5/windows-</summary>
      
    
    
    
    
    <category term="WSUS" scheme="https://jpmem.github.io/blog/tags/WSUS/"/>
    
  </entry>
  
  <entry>
    <title>更新ビューの作成方法</title>
    <link href="https://jpmem.github.io/blog/wsus/2024-06-13_01/"/>
    <id>https://jpmem.github.io/blog/wsus/2024-06-13_01/</id>
    <published>2024-06-12T15:00:00.000Z</published>
    <updated>2025-06-25T07:48:40.805Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。WSUS サポート チームです。今回は、更新ビューの作成方法について紹介いたします。更新ビューを作成いただくことにより、WSUS メンテナンスや承認作業等を効率的に行うことができますので是非ご活用ください。  </p><hr><h1 id="更新ビューについて"><a href="#更新ビューについて" class="headerlink" title="更新ビューについて"></a>更新ビューについて</h1><p>更新ビューは、WSUS コンソール上で、必要な更新プログラムをフィルタリングして表示する機能です。以下に WSUS で新しい更新ビューを作成する手順をご紹介します。  </p><h1 id="作成方法"><a href="#作成方法" class="headerlink" title="作成方法"></a>作成方法</h1><ol><li><p> WSUS 管理コンソールの左ペインで、 [更新プログラム] を展開し、 [すべての更新プログラム] を選択します。  </p></li><li><p>右クリックで、 [新しい更新ビュー] を選択すると、更新ビューの追加ウィンドウが開きます。<br><img src="/blog/wsus/2024-06-13_01/2024-06-13_01_1.png"> </p></li><li><p>更新ビューの追加ウィンドウにて、必要なプロパティや値を選択し更新ビューを作成します。  </p><h3 id="ステップ１：プロパティを選択します。"><a href="#ステップ１：プロパティを選択します。" class="headerlink" title="ステップ１：プロパティを選択します。"></a>ステップ１：プロパティを選択します。</h3><p><img src="/blog/wsus/2024-06-13_01/2024-06-13_01_2.png">  </p><ul><li>[更新は特定の分類に含まれます]：分類 でフィルタリングする場合にチェックを入れます。  </li><li>[更新は特定の製品用です]：製品 でフィルタリングする場合にチェックを入れます。  </li><li>[更新は特定のグループに対して承認済みです]：承認先のコンピューターグループ でフィルタリングする場合にチェックを入れます。  </li><li>[特定の期間内に同期された更新]：特定の期間に同期された更新プログラムでフィルタリングする場合にチェックを入れます。  </li><li>[更新は WSUS 更新です]：こちらは現在既に廃止されている機能である為選択不要です。</li></ul><h3 id="ステップ２-プロパティを変更します-下線付きの値をクリック"><a href="#ステップ２-プロパティを変更します-下線付きの値をクリック" class="headerlink" title="ステップ２: プロパティを変更します　(下線付きの値をクリック)"></a>ステップ２: プロパティを変更します　(下線付きの値をクリック)</h3><p>上記で選択したプロパティに従って値を変更ください。<br><img src="/blog/wsus/2024-06-13_01/2024-06-13_01_3.png">  </p><h3 id="ステップ３-名前を指定します-N"><a href="#ステップ３-名前を指定します-N" class="headerlink" title="ステップ３: 名前を指定します　(N)"></a>ステップ３: 名前を指定します　(N)</h3><p>作成した更新ビューに任意の名前を付け [OK] を選択します。<br><img src="/blog/wsus/2024-06-13_01/2024-06-13_01_4.png">  </p></li></ol><p>参考：<a href="%5Bhttps://learn.microsoft.com/ja-jp/windows-server/administration/windows-server-update-services/manage/viewing-and-managing-updates">更新プログラムを表示および管理する</a>  </p><p>上記手順により、新しい更新ビューが作成され更新ビューが追加されます。これらの更新ビューを利用いただくことで、特定の製品、分類、コンピュータグループへの承認状態、同期期間などに基づいて更新プログラムを効率的に管理できますので運用管理にお役立てください。  </p><p>補足事項 : 更新ビューの情報は、MMC と呼ばれるキャッシュ ファイル ( %appdata%\Microsoft\MMC\wsus) に保存されます。このため、何らかの理由により、キャッシュ ファイルが失われた場合には、作成した更新ビューも失われることになりますのでご留意ください。  </p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。WSUS サポート チームです。今回は、更新ビューの作成方法について紹介いたします。更新ビューを作成いただくことにより、WSUS メンテナンスや承認作業等を効率的に行うことができますので是非ご活用ください。  &lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&quot;更新ビ</summary>
      
    
    
    
    
    <category term="WSUS" scheme="https://jpmem.github.io/blog/tags/WSUS/"/>
    
    <category term="使い方" scheme="https://jpmem.github.io/blog/tags/%E4%BD%BF%E3%81%84%E6%96%B9/"/>
    
  </entry>
  
  <entry>
    <title>Configuration Manager Current Branch 2403 で追加された アップグレード前提条件</title>
    <link href="https://jpmem.github.io/blog/mecm/20240513_01/"/>
    <id>https://jpmem.github.io/blog/mecm/20240513_01/</id>
    <published>2024-05-12T15:00:00.000Z</published>
    <updated>2025-06-25T07:48:40.661Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。 Configuration Manager サポートチームでございます。本日は、Configuration Manager Current Branch (ConfigMgr CB) 2403 で追加された 更新時の前提条件についてご案内致します。  </p><p>前提条件を含めた ConfigMgr CB 2403 での更新については以下をご参照ください。  </p><p>現在のブランチのバージョン 2403 の新機能Configuration Manager<br><a href="https://learn.microsoft.com/ja-jp/mem/configmgr/core/plan-design/changes/whats-new-in-version-2403">https://learn.microsoft.com/ja-jp/mem/configmgr/core/plan-design/changes/whats-new-in-version-2403</a>  </p><p>ConfigMgr のアップデート 時の全ての前提条件については下記でもご案内しております。  </p><p>Configuration Managerの前提条件チェックの一覧<br><a href="https://learn.microsoft.com/ja-jp/mem/configmgr/core/servers/deploy/install/list-of-prerequisite-checks">https://learn.microsoft.com/ja-jp/mem/configmgr/core/servers/deploy/install/list-of-prerequisite-checks</a>  </p><h2 id="Windows-Server-2012-2012-R2-のサポート終了"><a href="#Windows-Server-2012-2012-R2-のサポート終了" class="headerlink" title="Windows Server 2012 / 2012 R2 のサポート終了"></a>Windows Server 2012 / 2012 R2 のサポート終了</h2><p>Windows Server 2012 / 2012 R2 のサポート終了に伴い、 ConfigMgr CB 2403 へのアップデートの際に、同 OS をサイト サーバー、サイト システム サーバー に使用している環境下では ConfigMgr CB 2403 へのアップグレードがブロックされます。<br>現在サポートされている Windows Server へアップグレードしてご利用されるようお願い致します。</p><p>なお、上記は ConfigMgr CB 2309 以前で 2024/5/13 現在で Windows Server 2012 / 2012 R2 がサポートされることを意味しておりませんのでご注意ください。上記にかかわらず、既に Windows Server 2012 / 2012 R2 の ConfigMgr サイト サーバー、サイト システムでの利用はサポートされておりません。<br>ESU 契約をお持ちの場合でも、クライアントとしての管理以外はサポートされませんのでご留意ください。</p><h2 id="クライアント-サーバー-間の-HTTP-通信の削除"><a href="#クライアント-サーバー-間の-HTTP-通信の削除" class="headerlink" title="クライアント - サーバー 間の HTTP 通信の削除"></a>クライアント - サーバー 間の HTTP 通信の削除</h2><p>クライアント - サーバー 間の HTTP 通信がサポートされなくなります。拡張 HTTP もしくは HTTPS 通信への通信形態の変更を実施ください。よりセキュリティの高い通信を利用されたい場合は HTTPS をご検討ください。 拡張 HTTP の方が手順少なく対応できます。なお、AD スキーマを拡張されていない環境にて、<br>サイト サーバー設定にて通信設定を 「HTTPS のみ」に変更するとクライアント - サーバー 間の通信を以降 拡張 HTTP に変更できない場合がございますので、ご注意ください。  </p><p>拡張 HTTP の設定確認については下記でご案内しております。</p><p>Configuration Managerにおける拡張 HTTP の確認方法<br><a href="https://jpmem.github.io/blog/mecm/20220122_01/">https://jpmem.github.io/blog/mecm/20220122_01/</a>  </p><h2 id="クラウド-サービス-クラシック-ベースのクラウド管理ゲートウェイのブロック"><a href="#クラウド-サービス-クラシック-ベースのクラウド管理ゲートウェイのブロック" class="headerlink" title="クラウド サービス(クラシック) ベースのクラウド管理ゲートウェイのブロック"></a>クラウド サービス(クラシック) ベースのクラウド管理ゲートウェイのブロック</h2><p>クラウド サービス (クラシック) ベースのクラウド管理ゲートウェイの利用は ConfigMgr CB 2403 以降サポートされないため、削除する必要がございます。仮想マシン スケールセットへの移行を実施ください。<br>[ConfigMgrコンソール] - [管理] - [概要] - [クラウド サービス] - [クラウド管理ゲートウェイ] で一覧表示した際に、[デプロイ モデル] が 「クラウド サービス(クラシック)」のものが対象です。<br>下記にて仮想マシン スケールセットへの移行についてご案内しております。  </p><p>仮想マシン スケールセットのクラウド管理ゲートウェイについて<br><a href="https://jpmem.github.io/blog/mecm/20211212_01/">https://jpmem.github.io/blog/mecm/20211212_01/</a>  </p><p>suffix が cloudapp.net な CMG の仮想マシン スケールセットへの移行について<br><a href="https://jpmem.github.io/blog/mecm/20230816_01/">https://jpmem.github.io/blog/mecm/20230816_01/</a></p><h2 id="共同管理でのリソース-アクセス-ポリシー-ワークロードのブロック"><a href="#共同管理でのリソース-アクセス-ポリシー-ワークロードのブロック" class="headerlink" title="共同管理でのリソース アクセス ポリシー ワークロードのブロック"></a>共同管理でのリソース アクセス ポリシー ワークロードのブロック</h2><p>ConfigMgr でのリソース アクセス ポリシー配布機能の削除にともない、共同管理構成を設定されている場合、リソース アクセス ポリシーのワークロードを Intune に寄せる必要がございますのでご留意ください。本設定は下記から確認可能です。  </p><p>[ConfigMgrコンソール] - [管理] - [概要] - [クラウド サービス] - [クラウドの接続] - [CoMgmtSettingsProd] - [プロパティ] - [ワークロード] タブ  </p><p><img src="/blog/mecm/20240513_01/20240513_01_02.png">  </p><p>なお、ConfigMgrでのリソース アクセス ポリシーの利用有無は以下からご確認可能です。  </p><p>[ConfigMgrコンソール] – [資産とコンプライアンス] – [概要] – [コンプライアンス設定]- [会社のリソースへのアクセス] </p><p>   <img src="/blog/mecm/20240513_01/20240513_01_01.png">  </p><p>リソース アクセス ポリシーについては下記ドキュメントもご参照ください。  </p><p>リソース アクセスの非推奨に関してよく寄せられる質問<br><a href="https://learn.microsoft.com/ja-jp/mem/configmgr/protect/plan-design/resource-access-deprecation-faq">https://learn.microsoft.com/ja-jp/mem/configmgr/protect/plan-design/resource-access-deprecation-faq</a>  </p><h2 id="その他"><a href="#その他" class="headerlink" title="その他"></a>その他</h2><p>ConfigMgr CB 2309 以降へのアップグレードは SQL ODBC Driver 18 以降のインストールが必要ですのでご留意ください。  </p><p>Configuration Manager Current Branch 2309 にて変更となった Microsoft ODBC Driver for SQL Server の要件のご紹介<br><a href="https://jpmem.github.io/blog/mecm/20240110_01/">https://jpmem.github.io/blog/mecm/20240110_01/</a></p><p>また、ConfigMgr CB 2403 において、共同管理を有効化されていて Intune 側の Endpoint Protection をご利用されているお客様について、影響が出る可能性のある不具合がございます。詳しくは下記をご確認くださいませ。  </p><p>2309 ロールアップ KB25858444 適用済み、または 2403 共同管理クライアントで Endpoint Protection ワークロードを Intune に設定した場合に影響を受ける不具合について<br><a href="https://jpmem.github.io/blog/mecm/20240510_01/">https://jpmem.github.io/blog/mecm/20240510_01/</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。 Configuration Manager サポートチームでございます。本日は、Configuration Manager Current Branch (ConfigMgr CB) 2403 で追加された 更新時の前提条件についてご案内致します。 </summary>
      
    
    
    
    
    <category term="MECM" scheme="https://jpmem.github.io/blog/tags/MECM/"/>
    
  </entry>
  
  <entry>
    <title>2309 ロールアップ KB25858444 適用済み、または 2403 共同管理クライアントで Endpoint Protection ワークロードを Intune に設定した場合に影響を受ける不具合について</title>
    <link href="https://jpmem.github.io/blog/mecm/20240510_01/"/>
    <id>https://jpmem.github.io/blog/mecm/20240510_01/</id>
    <published>2024-05-09T15:00:00.000Z</published>
    <updated>2025-06-25T07:48:40.661Z</updated>
    
    <content type="html"><![CDATA[<p>[改訂履歴]<br>第 1 版 2024 年 5 月 10 日 初版リリース<br>第 2 版 2024 年 5 月 23 日 ワークアラウンドの項目を削除し、解決策を追加  </p><p>みなさま、こんにちは。Configuration Manager サポート チームです。  </p><p>ConfigMgr CB 2403 及び CB 2309 に KB25858444 を適用した環境において、以下でご案内します不具合が報告されております。<br>不具合の解決策をご案内いたしますので、ご確認頂きますようお願い致します。  </p><h3 id="事象に該当する環境"><a href="#事象に該当する環境" class="headerlink" title="事象に該当する環境"></a>事象に該当する環境</h3><p>ConfigMgr CB 2403 及び CB 2309 KB25858444 適用環境である、以下のクライアントをお使いの場合  </p><ul><li>ConfigMgr CB 2403: 5.00.9128.1007  </li><li>ConfigMgr CB 2309 + KB25858444: 5.00.9122.1018  </li></ul><p>かつ、以下の設定をお使いの場合。  </p><ul><li>共同管理環境を有効にしており、Endpoint Protection ワークロードを Intune もしくは パイロット Intune 側に寄せている  </li></ul><h3 id="事象"><a href="#事象" class="headerlink" title="事象"></a>事象</h3><p>ワークロードを Intune に寄せているのにもかかわらず、Endpoint Protection のポリシーが Intune から管理されなくなります。  </p><h3 id="解決策"><a href="#解決策" class="headerlink" title="解決策"></a>解決策</h3><p>Microsoft セキュリティ クライアント ポリシー構成ツール (ConfigSecurityPolicy.exe) のバージョンを 4.18.24040.4 に更新することで、事象が解消いたします。<br>具体的には「Microsoft Defender Antivirus マルウェア対策プラットフォームの更新プログラム - KB4052623 (バージョン 4.18.24040.4) - 現在のチャネル (広範)」という名前の更新プログラムがリリースされておりますので、こちらの更新プログラムが適用されて、「マルウェア対策クライアント バージョン」が 4.18.24040.4 以降のバージョンになっていれば、本不具合の影響は受けません。<br>クライアントの「マルウェア対策クライアント バージョン」は、Configuration Manager 管理コンソールの「デバイス」のノードで当該項目を表示列に追加することでご確認いただけます。  </p><h3 id="該当リリースノートのリンク及び抄訳"><a href="#該当リリースノートのリンク及び抄訳" class="headerlink" title="該当リリースノートのリンク及び抄訳"></a>該当リリースノートのリンク及び抄訳</h3><p> Title : Intuneから削除されたセキュリティ構成<br>URL : <a href="https://learn.microsoft.com/ja-jp/mem/configmgr/core/servers/deploy/install/release-notes#security-configurations-removed-from-intune">https://learn.microsoft.com/ja-jp/mem/configmgr/core/servers/deploy/install/release-notes#security-configurations-removed-from-intune</a><br>— &lt;抜粋&gt; —<br>Microsoft Defenderバージョン 2403 に更新するか、2309 の更新プログラムのロールアップをインストールした後、Configuration Manager Microsoft Intuneで管理されなくなりました。  </p><p>この現象は、Intuneで表示すると、Microsoft セキュリティ スコアの値が低下したと見なされます。この問題は、Configuration Manager クライアントがアップグレードされた後に、セキュリティ ポリシー構成データがクライアントから誤って削除されるために発生します。  </p><p>Microsoft セキュリティ クライアント ポリシー構成ツールの更新バージョン (ConfigSecurityPolicy.exe) は、このノートで説明されている Endpoint Protection ポリシーの問題を解決するために使用できます。  </p><p>更新されたツールバージョン 4.18.24040.4 は、2024 年 4 月の月次Microsoft Defenderプラットフォーム更新プログラムと共に配布されます。 この記事の執筆時点では、プラットフォームの更新プログラムはグローバル配布の処理中であり、2024 年 5 月 17 日までにすべてのリージョンで幅広く利用できる必要があります。<br>影響を受けるクライアントにプラットフォーム更新プログラムがインストールされると、Endpoint Protection ポリシーは 8 時間以内にIntuneから再適用されます。Configuration Managerの [クライアント コンピューターでエンドポイント保護クライアントを管理する] 設定は、必要に応じて “はい” に戻すことができます。<br>— &lt;抜粋&gt; —  </p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;[改訂履歴]&lt;br&gt;第 1 版 2024 年 5 月 10 日 初版リリース&lt;br&gt;第 2 版 2024 年 5 月 23 日 ワークアラウンドの項目を削除し、解決策を追加  &lt;/p&gt;
&lt;p&gt;みなさま、こんにちは。Configuration Manager サポート チーム</summary>
      
    
    
    
    
    <category term="MECM" scheme="https://jpmem.github.io/blog/tags/MECM/"/>
    
    <category term="共同管理" scheme="https://jpmem.github.io/blog/tags/%E5%85%B1%E5%90%8C%E7%AE%A1%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>自動承認規則の &quot;承認の期日の設定&quot; について</title>
    <link href="https://jpmem.github.io/blog/wsus/2024-05-02_01/"/>
    <id>https://jpmem.github.io/blog/wsus/2024-05-02_01/</id>
    <published>2024-05-01T15:00:00.000Z</published>
    <updated>2025-06-25T07:48:40.803Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。WSUS サポート チームです。今回は、自動承認規則の “承認の期日” の設定について紹介いたします。 字面からは一見勘違いしやすい設定ですが、下記に記載の通りの動作となりますのでご留意いただければと存じます。</p><hr><h2 id="“承認の期日の設定”-とは"><a href="#“承認の期日の設定”-とは" class="headerlink" title="“承認の期日の設定” とは"></a>“承認の期日の設定” とは</h2><p>“承認の期日の設定” とは、自動承認規則で利用することのできる期日の設定です。<br>参考：自動承認規則については以下の記事を参照ください。  </p><ul><li><a href="https://jpmem.github.io/blog/mecm/20220426_01/">Configuration Manager の自動展開規則と WSUS の自動承認規則について</a>   </li><li><a href="https://learn.microsoft.com/ja-jp/windows-server/administration/windows-server-update-services/deploy/3-approve-and-deploy-updates-in-wsus#32-configure-auto-approval-rules">3.2. 自動承認規則を構成する</a>   </li></ul><p>自動承認規則を事前に設定していると、上位サーバー（ Microsoft Update サイトや非レプリカ環境のアップストリームサーバー ）と同期したタイミングで、自動承認規則で事前設定した条件を満たした更新プログラムが、事前設定したコンピューターグループに承認されます。<br>この自動承認規則で設定出来る項目の一つに “承認の期日の設定” があります。  </p><p><img src="/blog/wsus/2024-05-02_01/2024-05-02_01_1.png">  </p><p>“承認の期日の設定” で期日を指定すると、この期日までに更新プログラムのインストールが終わっていない端末に対して強制的に更新プログラムのインストールを行わせることができます。<br>上記画面ショットの例では、自動承認により、更新プログラムの同期が完了し、コンピューターグループに対する承認が行われた、その日時から7日後の 3:00 までに、対象のコンピューターグループに所属していながら、更新プログラムのインストールが完了していないクライアントは、強制的にインストールが実行されます。  </p><p>字面からは、コンピューターグループに対する自動承認を行う設定のように一見読み取れますが、そうではなく、上記でも述べました通り、自動展開規則の承認後に、インストールを強制する日付ですのでご留意ください。  </p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。WSUS サポート チームです。今回は、自動承認規則の “承認の期日” の設定について紹介いたします。 字面からは一見勘違いしやすい設定ですが、下記に記載の通りの動作となりますのでご留意いただければと存じます。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&quot;“承認</summary>
      
    
    
    
    
    <category term="WSUS" scheme="https://jpmem.github.io/blog/tags/WSUS/"/>
    
  </entry>
  
  <entry>
    <title>Windows Server 2019 以降 WSUS レポート機能のソフトウェア要件について</title>
    <link href="https://jpmem.github.io/blog/wsus/2024-03-08_01/"/>
    <id>https://jpmem.github.io/blog/wsus/2024-03-08_01/</id>
    <published>2024-03-07T15:00:00.000Z</published>
    <updated>2025-06-25T07:48:40.803Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。WSUS サポート チームです。<br>今回は、Windows Server 2019 以降 WSUS レポート機能のソフトウェア要件が変更になりましたことをお知らせいたします。</p><p>WSUS レポート機能については、<a href="https://jpmem.github.io/blog/wsus/2017-09-04_02/">こちらの記事</a>でも紹介しておりますので、合わせてご確認ください。</p><h1 id="対象"><a href="#対象" class="headerlink" title="対象"></a>対象</h1><p>Windows Server 2019, Windows Server 2022</p><h1 id="変更点"><a href="#変更点" class="headerlink" title="変更点"></a>変更点</h1><p>これまで WSUS レポート機能を使用する場合、事前に Microsoft Report Viewer Runtime 2012 と Microsoft System CLR Types for SQL Server 2012 をインストールする必要がありました。<br>Windows Server 2019 / Windows Server 2022 においても、同様に必要となっておりましたが、以下の累積更新プログラム、またはそれより新しい累積更新プログラムをインストール済みの Windows Server の場合、これらのソフトウェアは不要となりました。</p><ul><li>Windows Server 2019: <a href="https://support.microsoft.com/ja-jp/topic/2023-%E5%B9%B4-10-%E6%9C%88-10-%E6%97%A5-kb5031361-os-%E3%83%93%E3%83%AB%E3%83%89-17763-4974-766593db-b47a-4b18-a698-906426860313">2023 年 10 月 10 日 — KB5031361 (OS ビルド 17763.4974)</a></li><li>Windows Server 2022: <a href="https://support.microsoft.com/ja-jp/topic/2023-%E5%B9%B4-10-%E6%9C%88-10-%E6%97%A5-kb5031364-os-%E3%83%93%E3%83%AB%E3%83%89-20348-2031-7f1d69e7-c468-4566-887a-1902af791bbc">2023 年 10 月 10 日 — KB5031364 (OS ビルド 20348.2031)</a></li></ul><p>そのため、対象の累積更新プログラム適用済みの Windows Server 2019 / Windows Server 2022 の場合、これらのソフトウェアをアンインストールしても WSUS レポート機能は利用可能となります。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。WSUS サポート チームです。&lt;br&gt;今回は、Windows Server 2019 以降 WSUS レポート機能のソフトウェア要件が変更になりましたことをお知らせいたします。&lt;/p&gt;
&lt;p&gt;WSUS レポート機能については、&lt;a href=&quot;htt</summary>
      
    
    
    
    
    <category term="WSUS" scheme="https://jpmem.github.io/blog/tags/WSUS/"/>
    
  </entry>
  
  <entry>
    <title>Configuration Manager ベーシック ナレッジ シリーズ 4 - サイト システムの各役割の意味</title>
    <link href="https://jpmem.github.io/blog/mecm/20240216_01/"/>
    <id>https://jpmem.github.io/blog/mecm/20240216_01/</id>
    <published>2024-02-15T15:00:00.000Z</published>
    <updated>2025-06-25T07:48:40.660Z</updated>
    
    <content type="html"><![CDATA[<p>Configuration Manager では、サイト システムの役割をインストールすることで、様々な機能を拡張することができます。サイト システムの役割をインストールしたサーバーを、サイト システム サーバーと言います。<br>この投稿では代表的なサイト システム サーバーがどのような機能を使えるようにするものなのかを説明していきます。</p><p>( ) 内は英語名称および略称です。</p><h2 id="管理ポイント-Management-point-MP"><a href="#管理ポイント-Management-point-MP" class="headerlink" title="管理ポイント (Management point / MP)"></a>管理ポイント (Management point / MP)</h2><p>プライマリ サイト サーバーやセカンダリ サイト サーバーに既定でインストールされています。<br>クライアントが最も多く通信をおこなう役割となります。</p><p>クライアントは管理ポイントから “クライアント設定” の変更や “境界グループ” の構成など、あらゆる情報をポリシーとしてダウンロードすることで受け取っています。<br>また、クライアントは定期的に管理ポイントへ状態メッセージを送信  (既定で 15 分間隔) することで、クライアントに配信したソフトウェア更新プログラムやアプリケーション展開の進捗状態を管理することが出来ています。</p><h2 id="配布ポイント-Distribution-point-DP"><a href="#配布ポイント-Distribution-point-DP" class="headerlink" title="配布ポイント (Distribution point / DP)"></a>配布ポイント (Distribution point / DP)</h2><p>プライマリ サイト サーバーやセカンダリ サイト サーバーに既定で配布ポイントがインストールされています。<br>以下のようなコンテンツを配布ポイントに配置することで、クライアントは配布ポイントからコンテンツをダウンロードすることが可能になります。</p><p>・アプリケーション コンテンツ<br>・ソフトウェア パッケージ<br>・ソフトウェア更新プログラム<br>・OS イメージ<br>・ブート イメージ  </p><p>コンテンツの大きさにより、ダウンロードに使用する通信量を懸念される場合、配布ポイント サーバーを要所に配置することでネットワーク回線の負荷軽減が期待できます。<br>例えば、サーバーとは地理的に離れた場所にクライアントが存在し、ネットワークの通信を可能な限り抑えたい場合には、拠点となるポイントに配布ポイントを配置することを検討します。<br>クライアントが通信をおこなう配布ポイントをコントロールするには、<a href="https://learn.microsoft.com/ja-jp/mem/configmgr/core/servers/deploy/configure/boundary-group-procedures">“境界” と “境界グループ”</a> の設定も忘れずに行いましょう。</p><h2 id="ソフトウェアの更新ポイント-Software-update-point-SUP"><a href="#ソフトウェアの更新ポイント-Software-update-point-SUP" class="headerlink" title="ソフトウェアの更新ポイント (Software update point / SUP)"></a>ソフトウェアの更新ポイント (Software update point / SUP)</h2><p>Windows Server Update Services (WSUS) と連携し、Microsoft Update や上位 WSUS からメタデータ (更新プログラムのカタログ情報) を同期します。<br>クライアントはソフトウェアの更新ポイントに更新プログラムの確認 (コンプライアンス スキャン) を定期実行し、自分自身に各更新プログラムのインストールが必要か、不要かを判定しています。<br>また Configuration Manager ではクライアントがインストールを必要としている状態を “必須” と表現し、”必須” と判定した更新プログラムのみ、コンテンツのダウンロード・インストールを行います。</p><p>こちらの図は、Configuration Manager クライアントが更新プログラムの配信を受け取り、インストールされるまでの処理のイメージとなります。<br><img src="/blog/mecm/20240216_01/2024-02-09_1.png" alt="image.PNG"></p><p>① 管理者が、更新プログラムの配信の設定をします。ポリシー情報が MP のデータベースに格納されます。<br>② クライアントは、定期的にポリシーの確認を行っています。MP に更新されたポリシー情報があれば、ポリシーをダウンロードをします。<br>③ クライアントは、定期的にコンプライアンス スキャンを行っています。<br>④ クライアントは、② のポリシーを評価し、③ で “必須” と判定した更新プログラムが含まれる場合は、展開スケジュールに従って配布ポイントからコンテンツ ダウンロードをおこないます。<br>⑤ クライアントは、展開スケジュールに従って、ダウンロード済みの更新プログラムをインストールします。</p><h2 id="サービス接続ポイント-Service-connection-point-SCP"><a href="#サービス接続ポイント-Service-connection-point-SCP" class="headerlink" title="サービス接続ポイント (Service connection point / SCP)"></a>サービス接続ポイント (Service connection point / SCP)</h2><p>Configuration Manager のバージョンアップをおこなうために欠かせない役割がサービス接続ポイントです。サービス接続ポイントには [オンライン モード] 、[オフライン モード] があり、モードに応じた処理で新しい更新プログラムの同期をおこないます。<br>Configuration Manager では <a href="https://learn.microsoft.com/ja-jp/mem/configmgr/core/servers/manage/current-branch-versions-supported">サポート ライフ サイクル</a> が 18 か月ごとに定義されていますので、余裕をもったバージョン アップの計画をお願いいたします。</p><p>※ オンライン モードは <a href="https://learn.microsoft.com/ja-jp/mem/configmgr/core/plan-design/network/internet-endpoints">こちら</a> のインターネット要件を満たす必要があります。</p><h2 id="クラウド管理ゲートウェイ接続ポイント-Cloud-management-gateway-connection-point-CMG-CP"><a href="#クラウド管理ゲートウェイ接続ポイント-Cloud-management-gateway-connection-point-CMG-CP" class="headerlink" title="クラウド管理ゲートウェイ接続ポイント (Cloud management gateway connection point / CMG CP)"></a>クラウド管理ゲートウェイ接続ポイント (Cloud management gateway connection point / CMG CP)</h2><p>Configuration Manager はオンプレミス環境に構築しますが、オンプレミス環境に接続しないクライアントも管理したいといった要望はありませんか？<br>その方法のひとつに Azure と連携したクラウド管理ゲートウェイ (CMG) の構築があります。クラウド管理ゲートウェイ接続ポイントとは、CMG とオンプレミスのサイト システムを接続する役割です。</p><p>CMG の概要および具体的な構築手順については下記に投稿をまとめていますので、あわせて参照ください。<br><a href="https://jpmem.github.io/blog/tags/CMG/">https://jpmem.github.io/blog/tags/CMG/</a></p><p>代表的なサイト システム サーバーができることについて解説しましたが、いかがでしたでしょうか。今回紹介できなかったサイト システムについては、次の公開情報から確認してください。<br><a href="https://learn.microsoft.com/ja-jp/mem/configmgr/core/plan-design/hierarchy/plan-for-site-system-servers-and-site-system-roles">https://learn.microsoft.com/ja-jp/mem/configmgr/core/plan-design/hierarchy/plan-for-site-system-servers-and-site-system-roles</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Configuration Manager では、サイト システムの役割をインストールすることで、様々な機能を拡張することができます。サイト システムの役割をインストールしたサーバーを、サイト システム サーバーと言います。&lt;br&gt;この投稿では代表的なサイト システム サー</summary>
      
    
    
    
    
    <category term="MECM" scheme="https://jpmem.github.io/blog/tags/MECM/"/>
    
    <category term="ベーシック ナレッジ" scheme="https://jpmem.github.io/blog/tags/%E3%83%99%E3%83%BC%E3%82%B7%E3%83%83%E3%82%AF-%E3%83%8A%E3%83%AC%E3%83%83%E3%82%B8/"/>
    
  </entry>
  
  <entry>
    <title>WSUS サーバーのコンピューター名変更について</title>
    <link href="https://jpmem.github.io/blog/wsus/2024-01-31_01/"/>
    <id>https://jpmem.github.io/blog/wsus/2024-01-31_01/</id>
    <published>2024-01-30T15:00:00.000Z</published>
    <updated>2025-06-25T07:48:40.803Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。WSUS サポート チームです。今回は、WSUS サーバーのコンピューター名変更に際してご留意いただきたい事項をご説明いたします。  </p><hr><h2 id="WSUS-サーバーのコンピューター名変更に伴う留意事項"><a href="#WSUS-サーバーのコンピューター名変更に伴う留意事項" class="headerlink" title="WSUS サーバーのコンピューター名変更に伴う留意事項"></a>WSUS サーバーのコンピューター名変更に伴う留意事項</h2><p>WSUS サーバーのコンピューター名の変更につきましては、WSUS の公開情報にその手順のご案内が存在しないことから、弊社開発部署にて公式にテストされていない操作となりサポートされないものとなります。<br>そのため、WSUS の役割をインストール後にコンピューター名の変更作業が必要な場合は、後述の “WSUS の役割の再インストール” のご実施をご検討いただきますようお願い申し上げます。  </p><h2 id="報告事例"><a href="#報告事例" class="headerlink" title="報告事例"></a>報告事例</h2><p>コンピューター名変更後、WSUS コンソールに作成された更新ビューが表示できなくなるとの報告がございます。<br>こちらは、Microsoft Management Console(MMC) のキャッシュ情報に変更前のコンピューター名が格納されていることに起因し、下記のイベントログ （ ID：7032 ）が記録され、MMC キャッシュの情報を読み込むことができないために発生いたします。  </p><pre><code>警告    20xx/xx/xx 10:35:00    Windows Server Update Services    7032WSUS 管理コンソールは、リモート API 経由で WSUS サーバーに接続できませんでした。  Update Services サービス、 IIS および SQL がサーバー上で実行されていることを確認してください。問題が解決しない場合は、IIS、SQL、および Update Services サービスを再起動してみてください。  System.Net.Sockets.SocketException -- そのようなホストは不明です。</code></pre><h3 id="コンピューター名変更に伴う-WSUS-の役割の再インストール"><a href="#コンピューター名変更に伴う-WSUS-の役割の再インストール" class="headerlink" title="コンピューター名変更に伴う WSUS の役割の再インストール"></a>コンピューター名変更に伴う WSUS の役割の再インストール</h3><p>コンピューター名を変更する場合は、以下でご紹介する手順により、一度 WSUS の役割をアンインストールしコンピューター名を変更後に WSUS の役割を再インストールし、事前に取得したバックアップデータから復元を行う手順を実施いただけますようお願いいたします。</p><p>※残念ながら WSUS の役割を再インストールした場合でも、上記 “報告事例” にございます更新ビューを引き継ぐことはできませんので、ご留意いただけますようお願い申し上げます。  </p><p>&lt;実施手順&gt;<br>手順1. WSUS データベースをバックアップする<br>手順2. WSUS の役割をアンインストール<br>手順3. WSUS コンピューター名を変更する<br>手順4. WSUS の役割をインストールする<br>手順5. WSUS データベースを復元する<br>手順6. WSUS クライアントを新しい コンピューター名に接続する設定  </p><p>手順 1. および手順 5. につきましては、次の情報に詳細手順の記載がございますのでご参照ください。<br><a href="https://jpmem.github.io/blog/wsus/2021-10-19_01/">Windows Server 2012 R2 WSUS から Windows Server 2019 WSUS への移行手順 (WID -&gt; WID の場合)</a><br>2.3. WSUS データベースをバックアップする<br>2.4. WSUS データベースのバックアップを移行先サーバーで復元する  </p><p>手順2. 次の情報に詳細手順の記載がございますのでご参照ください。以下の記事でご紹介の手順を実施します。<br><a href="https://jpmem.github.io/blog/wsus/2022-03-29_01/">WSUS アンインストール手順について (Windows Server 2022 対応版)</a></p><p>手順4. 次の情報に詳細手順の記載がございますのでご参照ください。以下の記事でご紹介の “a. 役割と機能のインストール” を実施します。<br><a href="https://jpmem.github.io/blog/wsus/2023-02-16_01/">WSUS 構築マニュアル</a><br>参照項目　a. 役割と機能のインストール  </p><p>手順 6につきましては、次の情報に詳細手順の記載がございますのでご参照ください。<br><a href="https://jpmem.github.io/blog/wsus/2019-04-16_01/">WSUS クライアントのグループ ポリシー:その 1 – 基本編</a><br>参照項目　1. [イントラネットの Microsoft 更新サービスの場所を指定する]  </p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。WSUS サポート チームです。今回は、WSUS サーバーのコンピューター名変更に際してご留意いただきたい事項をご説明いたします。  &lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&quot;WSUS-サーバーのコンピューター名変更に伴う留意事項&quot;&gt;&lt;a href=&quot;#WS</summary>
      
    
    
    
    
    <category term="WSUS" scheme="https://jpmem.github.io/blog/tags/WSUS/"/>
    
  </entry>
  
  <entry>
    <title>Configuration Manager Current Branch 2309 にて変更となった Microsoft ODBC Driver for SQL Server の要件のご紹介</title>
    <link href="https://jpmem.github.io/blog/mecm/20240110_01/"/>
    <id>https://jpmem.github.io/blog/mecm/20240110_01/</id>
    <published>2024-01-24T15:00:00.000Z</published>
    <updated>2025-06-25T07:48:40.660Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。Configuration Manager サポート チームです。  </p><p>Configuration Manager Current Branch 2309 のアップグレードにて Microsoft ODBC Driver for SQL Server の要件が変更になっております。<br>要件を満たさない場合はアップグレードの前提条件チェックで失敗してしまうため、今回は対応方法をご紹介させて頂きます。  </p><h1 id="Microsoft-ODBC-Driver-for-SQL-Server-の要件に関する情報"><a href="#Microsoft-ODBC-Driver-for-SQL-Server-の要件に関する情報" class="headerlink" title="Microsoft ODBC Driver for SQL Server の要件に関する情報"></a>Microsoft ODBC Driver for SQL Server の要件に関する情報</h1><p>サイト サーバーとサイト システムの役割を持つサーバーにおいて ODBC Driver for SQL Server 18.1.0 以降の ODBC ドライバーのインストールが必要です。  </p><p>Title : 現在のブランチのバージョン 2309 の新機能 Configuration Manager - Configuration Managerの SQL ODBC ドライバー サポートの概要<br>URL : <a href="https://learn.microsoft.com/ja-jp/mem/configmgr/core/plan-design/changes/whats-new-in-version-2309#introducing-sql-odbc-driver-support-for-configuration-manager">https://learn.microsoft.com/ja-jp/mem/configmgr/core/plan-design/changes/whats-new-in-version-2309#introducing-sql-odbc-driver-support-for-configuration-manager</a>  </p><p>下記公開情報で SQL Server ODBC ドライバーのインストールが必要なサイト サーバーとサイト システムの役割を持つサーバーを確認できます。<br>例えば、配布ポイントにはインストールは必要ございません。  </p><p>Title : Configuration Managerのサイトとサイト システムの前提条件<br>URL : <a href="https://learn.microsoft.com/ja-jp/mem/configmgr/core/plan-design/configs/site-and-site-system-prerequisites">https://learn.microsoft.com/ja-jp/mem/configmgr/core/plan-design/configs/site-and-site-system-prerequisites</a></p><h1 id="Microsoft-ODBC-Driver-for-SQL-Server-のインストール方法"><a href="#Microsoft-ODBC-Driver-for-SQL-Server-のインストール方法" class="headerlink" title="Microsoft ODBC Driver for SQL Server のインストール方法"></a>Microsoft ODBC Driver for SQL Server のインストール方法</h1><p>以下の手順でインストールをご実施くださいませ。  </p><ol><li>以下の URL より、18.1.0 以降のバージョンの Microsoft ODBC Driver for SQL Server をダウンロードします。  </li></ol><p>Title : ODBC Driver for SQL Server のダウンロード<br>URL : <a href="https://learn.microsoft.com/ja-jp/sql/connect/odbc/download-odbc-driver-for-sql-server?view=sql-server-ver16">https://learn.microsoft.com/ja-jp/sql/connect/odbc/download-odbc-driver-for-sql-server?view=sql-server-ver16</a>  </p><ol start="2"><li>ダウンロードした「msodbcsql.msi」をダブルクリックします。  </li><li>セットアップ開始の画面が表示されたら [次へ] をクリックします。  </li><li>ライセンス条項を確認の上「同意する」にチェックを入れて [次へ] をクリックします。  </li><li>機能の選択は特に変更せず [次へ] をクリックします。  </li><li>[インストール] をクリックします。  </li><li>インストールの完了画面で [完了] をクリックしたら、インストール完了です。  </li></ol><h2 id="補足"><a href="#補足" class="headerlink" title="補足"></a>補足</h2><p>Microsoft ODBC Driver for SQL Server のインストールによる OS 再起動は発生いたしませんので、ご安心くださいませ。<br>また、サイト サーバーの役割を持つサーバーのみに SQL Server 18.1.0 以降の ODBC ドライバーをインストールすることで、ConfigMgr 2309 のバージョンアップにおける前提条件チェックに合格します。<br>ConfigMgr 2309 へのバージョンアップを実施しますと、管理ポイント等のサイト システム サーバーには必要に応じて SQL Server ODBC ドライバーがインストールされる動作となりますため、サイト サーバーの役割を持つサーバーにのみ SQL Server 18.1.0 以降の ODBC ドライバーのインストールを実施後、ConfigMgr 2309 へのバージョンアップを実施ください。  </p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。Configuration Manager サポート チームです。  &lt;/p&gt;
&lt;p&gt;Configuration Manager Current Branch 2309 のアップグレードにて Microsoft ODBC Driver for SQL </summary>
      
    
    
    
    
    <category term="MECM" scheme="https://jpmem.github.io/blog/tags/MECM/"/>
    
  </entry>
  
  <entry>
    <title>HTTPS 構成の WSUS 環境構築マニュアル</title>
    <link href="https://jpmem.github.io/blog/wsus/2023-12-07_01/"/>
    <id>https://jpmem.github.io/blog/wsus/2023-12-07_01/</id>
    <published>2023-12-06T15:00:00.000Z</published>
    <updated>2025-06-25T07:48:40.795Z</updated>
    
    <content type="html"><![CDATA[<p>[改訂履歴]<br>第 1 版 2023 年 12 月 7 日 初版リリース<br>第 2 版 2025 年 2 月 4 日 レイアウト修正、「d. HTTPS の構成」で入力するコマンド書式を修正</p><p>みなさま、こんにちは。WSUS サポート チームです。今回は、HTTPS 構成 の WSUS 構築手順についてご紹介します。HTTPS 構成とすることをご検討いただく際に是非ご一読ください。</p><hr><h2 id="HTTPS-構成の-WSUS-環境構築手順"><a href="#HTTPS-構成の-WSUS-環境構築手順" class="headerlink" title="HTTPS 構成の WSUS 環境構築手順"></a>HTTPS 構成の WSUS 環境構築手順</h2><ul><li>手順<br>a. サーバー証明書の準備<br>b. サーバー証明書のインポート<br>c. サーバー証明書のバインド<br>d. HTTPS の構成<br>e. クライアントの参照する WSUS サーバーの設定<br>f. クライアントのアクセス確認</li></ul><h3 id="a-サーバー証明書準備"><a href="#a-サーバー証明書準備" class="headerlink" title="a. サーバー証明書準備"></a>a. サーバー証明書準備</h3><p>参考として、Active Directory 証明書サービスを利用して証明書を発行することができますのでご紹介します。<br>Active Directory 証明書サービスを利用して、エンタープライズ CA を構築し、テンプレートの複製を利用することで、Active Directory 配下のクライアントが証明書の発行要求を行うことができます。  </p><p>１．Active Directoryサーバーにて、役割と機能の追加から「Active Directory 証明書サービス」を追加します。<br><a href="https://learn.microsoft.com/ja-jp/windows-server/networking/core-network-guide/cncg/server-certs/install-the-certification-authority#to-install-active-directory-certificate-services">Active Directory Certificate Services をインストールするには</a>  </p><p>２．Active Directoryサーバーにて、証明機関を開き、[証明書テンプレート]-[管理]より、[Webサーバー]を選択しテンプレートの複製を行います。<br>３．Active Directoryサーバーにて、証明機関を開き、[証明書テンプレート]より、[新規作成]を選択し[発行する証明書テンプレート]から、２．で複製した [Webサーバー] のテンプレートを選択します。<br>４．WSUS サーバーにて、証明書ストアを開き、[個人用]-[証明書] から、[すべてのタスク]―[新しい証明書の要求] を行い、３で作成した [Webサーバー] の証明書を要求します。</p><h3 id="b-サーバー証明書のインポート"><a href="#b-サーバー証明書のインポート" class="headerlink" title="b. サーバー証明書のインポート"></a>b. サーバー証明書のインポート</h3><p>使用するサーバー証明書を個人用 証明書ストア にインポートします。  </p><ol><li>WSUS サーバーで、インターネット インフォメーション サービス (IIS) マネージャを起動します。  </li><li>左ペインより、サーバー名を選択します。  </li><li>中央ペインより [サーバー証明書] を選択します。  </li><li>右ペインより [インポート] を選択します。  </li><li>証明書ファイルを選択後、パスワードを入力し、[OK] をクリックします。<br>※　WSUS サーバーの 個人用 証明書ストアに使用する証明書が既に存在する場合はこの手順の実施は不要です。</li></ol><h3 id="c-サーバー証明書のバインド"><a href="#c-サーバー証明書のバインド" class="headerlink" title="c. サーバー証明書のバインド"></a>c. サーバー証明書のバインド</h3><p>インターネットインフォメーション サービス (IIS) にて、サーバー証明書をバインドします。  </p><ol><li>インターネットインフォメーション サービス (IIS) マネージャより、[サイト] を展開し、 WSUS にて利用している Web サイト (既定 「 WSUS の管理」) を右クリックして、[バインドの編集] をクリックします。  </li><li>サイトバインドにて、8531 を選択し [編集] をクリックします。(カスタムポートをご利用の場合、ご利用の Web サイトより同様に サイトバインドにて 443 を選択します。)<br><img src="/blog/wsus/2023-12-07_01/2023-12-07_01-1.png">  </li><li> [ SSL 証明書] にて、登録したサーバー証明書を選択し、[OK] をクリックします。  </li><li>[閉じる] をクリックして [サイト バインド] ダイアログ ボックスを終了します。<br><img src="/blog/wsus/2023-12-07_01/2023-12-07_01-2.png">  </li></ol><h3 id="d-HTTPS-の構成"><a href="#d-HTTPS-の構成" class="headerlink" title="d. HTTPS の構成"></a>d. HTTPS の構成</h3><p>インターネットインフォメーション サービス ( IIS ) にて、 HTTPS を有効化します。  </p><ol><li><p>インターネットインフォメーション サービス ( IIS ) マネージャより[サイト] を展開し、 WSUS にて利用している Webサイトを展開します。  </p></li><li><p>WSUS Web サイトの下にある APIRemoting30、ClientWebService、DSSAuthWebService、ServerSyncWebService および SimpleAuthWebService の各仮想ディレクトリで、次の手順を実行します。なお、一部の Web サービス で HTTP の通信を利用する仕様の為、Web サイト全体を HTTPS 構成にすることはできませんのでご留意ください。<br>&lt; 参考情報 &gt; <a href="https://learn.microsoft.com/ja-jp/windows-server/administration/windows-server-update-services/deploy/2-configure-wsus#232-configure-the-wsus-servers-iis-web-server-to-use-ssl-for-some-connections">2.3.2. 一部の接続に SSL を使用するように WSUS サーバーの IIS Web サーバーを構成する</a><br>2-1. [機能ビュー] で [ SSL 設定] をダブルクリックします。<br>2-2. [ SSL 設定] ページで、[ SSL が必要] を選択します。<br>2-3. [操作] ウィンドウで、[適用] をクリックします。<br><img src="/blog/wsus/2023-12-07_01/2023-12-07_01-3.png">  </p></li><li><p>インターネットインフォメーション サービス ( IIS ) マネージャを閉じます。</p></li><li><p>コマンドプロンプトを管理者権限で立ち上げ 「C:\Program Files\Update Services\Tools」 フォルダに移動します。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd C:\Program Files\Update Services\Tools</span><br></pre></td></tr></table></figure></li><li><p>次のコマンドを実行します。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WSUSUtil.exe configuressl &lt;サーバー証明書のサブジェクト名で指定した WSUS サーバーの FQDN&gt;  </span><br></pre></td></tr></table></figure><p>&lt; 参考情報 &gt; <a href="https://learn.microsoft.com/ja-jp/windows-server/administration/windows-server-update-services/deploy/2-configure-wsus#233-configure-wsus-to-use-the-ssl-signing-certificate-for-its-client-connections">2.3.3. クライアント接続に SSL 署名証明書を使用するように WSUS を構成する</a>  </p></li></ol><h3 id="e-クライアントの参照する-WSUS-サーバーの設定"><a href="#e-クライアントの参照する-WSUS-サーバーの設定" class="headerlink" title="e. クライアントの参照する WSUS サーバーの設定"></a>e. クライアントの参照する WSUS サーバーの設定</h3><p>上述の a,b,c の手順にて、WSUS サーバーの HTTPS を有効化した後、クライアントが WSUS との通信において HTTPS を利用できるように構成します。下記ポリシーにて、WSUS サーバーの通信プロトコル及びポート番号をご指定ください。  </p><p>・ポリシー<br>[コンピューターの構成] - [管理用テンプレート] - [Windows コンポーネント] - [Windows Update] - [イントラネットの Microsoft 更新サービスの場所を指定する]<br>または<br>[コンピューターの構成] - [管理用テンプレート] - [Windows コンポーネント] - [Windows Update] - [Windows Server Update Service から提供される更新プログラムの管理] - [イントラネットの Microsoft 更新サービスの場所を指定する]  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">例　https://&lt; WSUS サーバーのFQDN &gt;:8531 </span><br></pre></td></tr></table></figure><p> <img src="/blog/wsus/2023-12-07_01/2023-12-07_01-4.png">  </p><h3 id="f-クライアントのアクセス確認"><a href="#f-クライアントのアクセス確認" class="headerlink" title="f. クライアントのアクセス確認"></a>f. クライアントのアクセス確認</h3><p>クライアントが HTTPS で WSUS サーバーへ通信を行えることを確認します。<br>[設定]-[Windows Update]-[更新プログラムのチェック]ボタンを押下して検出処理が完了できることをご確認ください。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;[改訂履歴]&lt;br&gt;第 1 版 2023 年 12 月 7 日 初版リリース&lt;br&gt;第 2 版 2025 年 2 月 4 日 レイアウト修正、「d. HTTPS の構成」で入力するコマンド書式を修正&lt;/p&gt;
&lt;p&gt;みなさま、こんにちは。WSUS サポート チームです。今回は</summary>
      
    
    
    
    
    <category term="WSUS" scheme="https://jpmem.github.io/blog/tags/WSUS/"/>
    
    <category term="構築マニュアル" scheme="https://jpmem.github.io/blog/tags/%E6%A7%8B%E7%AF%89%E3%83%9E%E3%83%8B%E3%83%A5%E3%82%A2%E3%83%AB/"/>
    
  </entry>
  
</feed>
