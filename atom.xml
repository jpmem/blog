<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Japan Microsoft Configuration Manager Support Team Blog</title>
  
  <subtitle>日本マイクロソフト Microsoft Configuration Manager / Windows 365 / WSUS サポート チームのブログです。</subtitle>
  <link href="https://jpmem.github.io/blog/atom.xml" rel="self"/>
  
  <link href="https://jpmem.github.io/blog/"/>
  <updated>2025-02-13T07:48:34.246Z</updated>
  <id>https://jpmem.github.io/blog/</id>
  
  <author>
    <name>Japan Microsoft Configuration Manager Support Team</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Configuration Manager のアップグレードをオフラインで行う場合の注意点について</title>
    <link href="https://jpmem.github.io/blog/mecm/20250207_01/"/>
    <id>https://jpmem.github.io/blog/mecm/20250207_01/</id>
    <published>2025-02-06T15:00:00.000Z</published>
    <updated>2025-02-13T07:48:34.246Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。 Configuration Manager サポート チームです。<br>本日は、Configuration Manger (ConfigMgr) のアップグレードをオフラインで行う場合の注意点についてご案内させていただきます。<br>ConfigMgr のアップグレードでは、サービス接続ポイントというサイトサービスの役割を使用しますが、この役割にはオンラインとオフラインの 2 つのモードが存在します。  </p><ul><li>オンライン モード: サービス接続ポイントは自動的に Microsoft クラウド サービスに接続し、該当する更新プログラムをダウンロードします。  </li><li>オフライン モード: サービス接続ポイントは Microsoft クラウド サービスに接続しません。 利用可能な更新プログラムをダウンロードしてインポートするには、 サービス接続ツールを使用します。  </li></ul><p>サービス接続ポイントがオフライン モードの場合は、インターネットに接続したコンピューターでサービス接続ツール “ServiceConnectionTool.exe” を実行し、ConfigMgr の更新プログラムをダウンロードします。<br>その後、取得した更新プログラムを サイトサーバーにインポートし、アップグレードを行う流れになります。<br>サービス接続ツールの詳しい使い方につきましては、公開情報よりご確認いただきたく割愛させていただきますが、更新プログラムをダウンロードする場合、以下のようなコマンドをコマンド プロンプトから実行します。  </p><p>参考<br><a href="https://learn.microsoft.com/ja-jp/mem/configmgr/core/servers/manage/use-the-service-connection-tool">Configuration Manager のサービス接続ツールを使用する</a>  </p><p>更新プログラムをダウンロードする場合のコマンド例  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ServiceConnectionTool.exe -connect -downloadsiteversion -usagedatasrv C:\temp\cab -updatepackdest C:\temp\UpdatePacks  </span><br></pre></td></tr></table></figure><p>ダウンロードは主に 2 ステップに分かれており、ServiceConnectionTool.exe と ServiceConnectionTool.exe から呼び出された setupdl.exe によって行われます。<br>すべてのダウンロードが完了すると、以下のように呼び出し元に戻ってくる流れとなっており、通信断など予期せぬトラブルが発生した場合、コマンド プロンプト上でエラーが表示されますが、ファイルのダウンロード結果についてはコマンド プロンプト上で表示されません。  </p><p><img src="/blog/mecm/20250207_01/20250207.png" alt="20250207.png">  </p><p>このため、何も表示せずに呼び出し元に戻る状態の確認のみでは、ダウンロードがすべて成功したことを判断できず、ダウンロードが成功したかどうかはログを確認する必要があります。<br>一部ファイルのダウンロードが失敗した状態でサイトサーバーにインポートするとアップグレードに失敗する要因となるため、そのような事態を回避するためにも、ダウンロード完了後は、サービス接続ツールのログ ファイルからダウンロード結果をご確認いただくことをお勧めいたします。  </p><p>確認方法<br>サービス接続ツールによる更新プログラムダウンロードのログは以下 2 つのファイルに記録されます。  </p><ul><li>ServiceConnectionTool.log<br>　サービス接続ツールと同じ場所に作成されます。<br>　マニフェストや更新プログラムの実体のダウンロードに関するログが記録されます。  </li><li>ConfigMgrSetup.log<br>　システム ドライブ直下に存在します。<br>　言語パックや SQL のインストールモジュールのダウンロードに関するログが記録されます。  </li></ul><p>上記それぞれのファイルを開き、ファイルのダウンロードに失敗していないか確認をします。  </p><ul><li><p>ServiceConnectionTool.log について<br>「ERROR:Failed to download redist for」という文字列が含まれていないことを確認します。  </p></li><li><p>成功の出力例  </p><pre><code>2024-11-19 11:53:40 INFO:downloading redist  2024-11-19 12:20:42 INFO:Successfully download redist for 5B8886C7-F967-4F8A-92AA-009E28368853  </code></pre></li><li><p>エラーの出力例  </p><pre><code>2024-11-19 11:06:30 INFO:downloading redist  2024-11-19 11:10:18 ERROR:Failed to download redist for 5B8886C7-F967-4F8A-92AA-009E28368853  </code></pre></li><li><p>ConfigMgrSetup.logについて<br>「ERROR: Download() failed」という文字列が含まれていないことを確認します。<br>また、ダウンロードしたファイル群から Redist フォルダを開き、0KB のファイルが存在しないことを確認します。  </p></li><li><p>エラーの出力例  </p><pre><code>ERROR: Download() failed with 0x80072EE2  </code></pre></li></ul><p>上記ログにダウンロード失敗のログが記録されている、または Redist フォルダ配下に 0KB のファイルが存在する場合は、ダウンロードに失敗していますので、ダウンロードしたファイル群は使用せず、再ダウンロードをお試しください。<br>なお、アップグレードに伴いご確認いただきたいことや注意事項は、公開情報にてチェックリストとしてご案内しておりますのでこちらも併せて参考にしてください。<br>特に、予期せぬトラブルに備え、アップグレード前のバックアップいただくことをお勧めいたします。  </p><p>参考<br><a href="https://learn.microsoft.com/ja-jp/mem/configmgr/core/servers/manage/checklist-for-installing-update-2409">更新プログラム 2409 をインストールするためのチェックリスト</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。 Configuration Manager サポート チームです。&lt;br&gt;本日は、Configuration Manger (ConfigMgr) のアップグレードをオフラインで行う場合の注意点についてご案内させていただきます。&lt;br&gt;ConfigM</summary>
      
    
    
    
    
    <category term="MECM" scheme="https://jpmem.github.io/blog/tags/MECM/"/>
    
  </entry>
  
  <entry>
    <title>タスクシーケンスのコンテンツを事前にダウンロードする</title>
    <link href="https://jpmem.github.io/blog/mecm/20250128_01/"/>
    <id>https://jpmem.github.io/blog/mecm/20250128_01/</id>
    <published>2025-01-27T15:00:00.000Z</published>
    <updated>2025-02-13T07:48:34.242Z</updated>
    
    <content type="html"><![CDATA[<p>みなさん、こんにちは。Configuration Manager チームです。<br>この投稿では、Configuration Manager を利用してオペレーティング システムを展開する時にお役立ていただける、タスクシーケンスのコンテンツを事前にダウンロードするオプションをご紹介します。</p><p>オペレーティング システムの展開に利用されるコンテンツのファイル サイズは比較的大きい傾向があります。タスクシーケンスの展開の種類を “利用可能” として展開をすると、ユーザーがソフトウェア センターから [インストール] ボタンをクリックすることでコンテンツのダウンロードが開始されますが、ファイル サイズが大きい場合はダウンロードおよびインストール完了までに時間を要し、ユーザーが待機する時間が長くかかってしまうと思うことはありませんか？</p><p>今回ご紹介する “事前ダウンロード” のオプションを利用すると、指定した言語とアーキテクチャに一致するコンテンツが事前にクライアントのキャッシュ フォルダーにダウンロードされます。ユーザーがソフトウェア センターから [インストール] ボタンをクリックすると、既にキャッシュされたコンテンツを使用してインストール処理から開始することができるため、ユーザーが処理を待機する時間が短くなるメリットがあります。ぜひご検討の上、活用ください。</p><h1 id="利用要件"><a href="#利用要件" class="headerlink" title="利用要件"></a>利用要件</h1><p>コンテンツの事前ダウンロードは、タスクシーケンスを利用して以下のコンテンツを配信する時に利用ができます。</p><ul><li>OS アップグレード パッケージ (*1)</li><li>OS イメージ</li><li>ドライバー パッケージ</li><li>パッケージ</li></ul><p>*1 OS アップグレード パッケージにソフトウェア更新プログラムによる機能更新プログラムを選択しているときは、事前ダウンロードが有効になりません。ISO メディアを使用したアップグレード パッケージを使用している場合に、事前ダウンロードが有効になります。詳細については、以下の公開情報もあわせて確認してください。</p><p>公開情報 : <a href="https://learn.microsoft.com/ja-jp/mem/configmgr/osd/deploy-use/configure-precache-content">タスク シーケンスの事前キャッシュ コンテンツを構成する</a>  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">注意  </span><br><span class="line">バージョン 2103 以降、 アップグレード OS タスク シーケンス ステップで機能更新プログラムを使用する場合、 このタスク シーケンスのコンテンツを事前にダウンロードするオプションは機能更新プログラムには適用されません。</span><br></pre></td></tr></table></figure><h1 id="事前準備"><a href="#事前準備" class="headerlink" title="事前準備"></a>事前準備</h1><p>OS イメージや OS アップグレード パッケージなど複数の言語やアーキテクチャを含むコンテンツに対し、クライアントの条件に一致する設定とします。</p><h2 id="OS-アップグレード-パッケージ"><a href="#OS-アップグレード-パッケージ" class="headerlink" title="OS アップグレード パッケージ"></a>OS アップグレード パッケージ</h2><p>Configuration Manager コンソールで [ソフトウェア ライブラリ] - [概要] - [オペレーティング システム] - [オペレーティング システム アップグレード パッケージ] に移動し、OS アップグレード パッケージのプロパティを開きます。<br>[データソース] タブから言語とアーキテクチャを指定します。</p><h2 id="OS-イメージ"><a href="#OS-イメージ" class="headerlink" title="OS イメージ"></a>OS イメージ</h2><p>Configuration Manager コンソールで [ソフトウェア ライブラリ] - [概要] - [オペレーティング システム] - [オペレーティング システム イメージ] に移動し、OS イメージのプロパティを開きます。<br>[データソース] タブから言語とアーキテクチャを指定します。</p><h2 id="ドライバー-パッケージ"><a href="#ドライバー-パッケージ" class="headerlink" title="ドライバー パッケージ"></a>ドライバー パッケージ</h2><p>Configuration Manager コンソールで [ソフトウェア ライブラリ] - [概要] - [オペレーティング システム] - [ドライバー パッケージ] に移動し、ドライバー パッケージのプロパティを開きます。<br>[全般] タブからモデルを指定します。</p><p>ここで評価されるモデル名は、クライアントの WMI クラス Win32_ComputerSystemProduct の Name に格納されている名前です。確認する場合はクライアント上で PowerShell コマンド <code>Get-WmiObject -query &quot;select * from win32_computersystemproduct&quot;</code> を実行し、Name の値を確認します。タスクシーケンスの実行中は <code>select * from win32_computersystemproduct where name like &quot;%指定したモデル名%&quot;</code> というように評価が行われますので、指定したモデル名を含むことで条件に一致するとみなされます。</p><h2 id="パッケージ"><a href="#パッケージ" class="headerlink" title="パッケージ"></a>パッケージ</h2><p>Configuration Manager コンソールで [ソフトウェア ライブラリ] - [概要] - [アプリケーション管理] - [パッケージ] に移動し、パッケージのプロパティを開きます。[全般] タブから言語とアーキテクチャを指定します。</p><h1 id="事前ダウンロードの利用手順"><a href="#事前ダウンロードの利用手順" class="headerlink" title="事前ダウンロードの利用手順"></a>事前ダウンロードの利用手順</h1><p>事前に作成したタスクシーケンスを “事前ダウンロード” を有効としてデバイス コレクションに展開します。</p><ol><li><p>Configuration Manager コンソールで、[ソフトウェア ライブラリ] - [概要] - [オペレーティング システム] - [タスク シーケンス] の順に展開します。</p></li><li><p>展開するタスクシーケンスを選択し、[ホーム]  メニュー内の [展開] ボタンをクリックします。</p></li><li><p>“ソフトウェアの展開ウィザード”  が起動します。</p></li><li><p>[全般] ページでコレクションを指定し、”このタスク シーケンスのコンテンツを事前にダウンロードする” にチェックを付け、[次へ] をクリックします。<br><img src="/blog/mecm/20250128_01/1.png" alt="1.png"></p></li><li><p>[展開設定] ページで目的は “利用可能” を選択し、[次へ] をクリックします。<br><img src="/blog/mecm/20250128_01/2.png" alt="2.png"></p></li><li><p>[スケジュール] ページでは、”この展開が使用可能になる日時を指定する” にチェックを付け、任意の日時を指定し、[次へ] をクリックします。クライアントはこの日時が過ぎたことを検知すると、コンテンツの事前ダウンロードを開始します。<br><img src="/blog/mecm/20250128_01/3.png" alt="3.png"></p></li><li><p>[ユーザー側の表示と操作]  ページは任意の設定に指定して、[次へ] をクリックします。</p></li><li><p>[アラート]  ページは任意の設定に指定して、[次へ] をクリックします。</p></li><li><p>[配布ポイント] ページの展開オプションの設定は、ユーザーが事前ダウンロードを完了する前にタスクシーケンスを実行した場合に参照されます。事前にすべてのコンテンツをダウンロードしておくため、こちらの展開オプションも “タスクシーケンスを開始する前にすべてのコンテンツをローカルにダウンロードする” を選択しておきます。 近隣や、既定の境界グループ内の配布ポイントの使用については任意で設定をおこない、[次へ] をクリックします。<br><img src="/blog/mecm/20250128_01/6.png" alt="6.png"></p></li><li><p>[概要] ページで設定内容を確認し、[次へ] をクリックします。</p></li><li><p>[完了]  ページが表示されたら [閉じる] をクリックします。</p></li></ol><h1 id="クライアントでの動作を確認する"><a href="#クライアントでの動作を確認する" class="headerlink" title="クライアントでの動作を確認する"></a>クライアントでの動作を確認する</h1><p>クライアント側で事前ダウンロードがおこなわれる処理の大まかなイメージです。<br><img src="/blog/mecm/20250128_01/Image.png" alt="Image.png"></p><ol><li>管理者が管理コンソールから配信の設定をおこないます。  </li><li>クライアントは、クライアント ポリシーのポーリング間隔 (既定で 60 分 ＋ ランダム遅延最大 60 分) にて自動でポリシーの取得をおこなっています。(*2)</li></ol><p>*2 既定値は [クライアント設定] &gt; [クライアント ポリシー] の “クライアント ポリシーのポーリング間隔” 箇所で設定されています。間隔を待たず、直ちにポリシーの取得をおこないたい場合は、コントロール パネルから Configuration Manager を起動し [操作] タブ上の [コンピューター ポリシーの取得および評価サイクル] を直ちに実行してください。</p><ol start="3"><li>ポリシーを取得したタイミングで、ソフトウェア センターにタスクシーケンスが表示されます。</li></ol><p><img src="/blog/mecm/20250128_01/SC.png" alt="SC.png"></p><ol start="4"><li><p>タスクシーケンスに紐づくコンテンツに対して、Configuration Manager クライアント (execmgr) が「事前準備」で設定した条件に該当するか評価をおこないます。</p></li><li><p>4 の条件に該当したコンテンツは、「事前ダウンロードの利用手順」の手順 6 で指定した使用可能になる日時が過ぎてからダウンロードを開始します。</p></li></ol><p>上記の動作上、ユーザーが 3 のソフトウェア センターに表示された直後に [インストール] ボタンをクリックすると、4、5 の事前ダウンロードの処理が完了する前にダウンロードおよびインストール処理がおこなわれる可能性があることにご留意ください。この時、「事前ダウンロードの利用手順」の手順 9 で設定した展開オプションに従ってダウンロードがおこなわれます。</p><ol start="6"><li>ダウンロードされたコンテンツはキャッシュ フォルダーに格納されます。</li></ol><p><strong>[Tips]</strong> ユーザー側で事前ダウンロードが完了したことを確認するためには、コンテンツごとの確認となりますが、クライアント上のキャッシュ フォルダーの状態から確認が可能です。まず、Configuration Manager コンソールから事前ダウンロードを有効にしたコンテンツ ID を確認します。</p><p>例: OS イメージ<br><img src="/blog/mecm/20250128_01/ID.png" alt="ID.png"></p><p>次にクライアント上で PowerShell コマンド <code>gwmi -namespace root\ccm\softmgmtagent -query &quot;select * from CacheInfoEx where contentID=&#39;コンテンツID&#39;&quot;</code> のように実行します。<br><img src="/blog/mecm/20250128_01/PS.png" alt="PS.png"></p><p>ContentComplete が True となっていればダウンロードは完了しています。実際に Location に指定されているキャッシュ フォルダーを確認すると以下のようにコンテンツが配置されていることを確認することができます。<br><img src="/blog/mecm/20250128_01/ccmcache.png" alt="ccmcache.png"></p><p>参考情報 : <a href="https://learn.microsoft.com/ja-jp/mem/configmgr/osd/deploy-use/configure-precache-content">タスク シーケンスの事前キャッシュ コンテンツを構成する</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさん、こんにちは。Configuration Manager チームです。&lt;br&gt;この投稿では、Configuration Manager を利用してオペレーティング システムを展開する時にお役立ていただける、タスクシーケンスのコンテンツを事前にダウンロードするオプショ</summary>
      
    
    
    
    
    <category term="MECM" scheme="https://jpmem.github.io/blog/tags/MECM/"/>
    
    <category term="OS 展開" scheme="https://jpmem.github.io/blog/tags/OS-%E5%B1%95%E9%96%8B/"/>
    
  </entry>
  
  <entry>
    <title>AutoPilot を使って キッティング した Win 11 端末に対して共同管理ポリシーが適用されない問題</title>
    <link href="https://jpmem.github.io/blog/mecm/20241010_01/"/>
    <id>https://jpmem.github.io/blog/mecm/20241010_01/</id>
    <published>2024-10-09T15:00:00.000Z</published>
    <updated>2025-02-13T07:48:34.242Z</updated>
    
    <content type="html"><![CDATA[<h2 id="AutoPilot-を使って-キッティング-した-Win-11-端末に対して共同管理ポリシーが適用されない場合の対処策"><a href="#AutoPilot-を使って-キッティング-した-Win-11-端末に対して共同管理ポリシーが適用されない場合の対処策" class="headerlink" title="AutoPilot を使って キッティング した Win 11 端末に対して共同管理ポリシーが適用されない場合の対処策"></a>AutoPilot を使って キッティング した Win 11 端末に対して共同管理ポリシーが適用されない場合の対処策</h2><p>みなさま、こんにちは。Configuration Manager サポート チームです。  </p><p>本日は、AutoPilot を使って キッティング した Win 11 端末に対して共同管理ポリシーが正しく適用できない場合の対処策についてご案内致します。</p><h2 id="現象"><a href="#現象" class="headerlink" title="現象"></a>現象</h2><ul><li>共同管理構成ポリシー で ワークロード を ConfigMgr 側に寄せているにもかかわらず、 全ての ワークロード が Intune 側に寄っている状態の挙動を示します。</li></ul><h2 id="事象発生条件"><a href="#事象発生条件" class="headerlink" title="事象発生条件"></a>事象発生条件</h2><ul><li><p>AutoPilot を使って キッティングする</p></li><li><p>Windows 11 端末</p></li><li><p>[Intune 管理センター] - [デバイス] - [デバイスのオンボーディング] - [登録] - [Windows] - [登録オプション] - [共同管理の設定] にてプロファイルが作成されていない<br> <img src="/blog/mecm/20241010_01/20241010_01_01.png" alt="image.png"></p><p>もしくは、上記画面で設定されているプロファイルにて「共同管理ポリシーをオーバーライドし、すべてのワークロードに対して Intune　を使用します] が「はい」の状態でプロファイルが端末に適用されている。<br><img src="/blog/mecm/20241010_01/20241010_01_02.png" alt="image.png"></p></li></ul><h2 id="事象発生の確認方法"><a href="#事象発生の確認方法" class="headerlink" title="事象発生の確認方法"></a>事象発生の確認方法</h2><ul><li>[ファイル名を指定して実行] - [C:\Windows\CCM\SMSCFGRC.cpl] を開き、全般タブを開いた際に「共同管理機能」の値が以下のように 「2147479807」 を示します。</li><li>C:\Windows\CCM\CoManagementHandler.log に以下のように出力されます。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Workloads are explicitly set by Intune Co-Management Profile so not using ConfigMgr set workloads. Current value from set from Intune is 2147479807</span><br></pre></td></tr></table></figure></li><li>管理機関を示すレジストリ値が 以下にて Intune に設定されています。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[HKLM\SOFTWARE\Microsoft\DeviceManageabilityCSP\Provider\MS DM Server]</span><br><span class="line">Key: ConfigInfo</span><br><span class="line">Value: 1</span><br></pre></td></tr></table></figure>Value が 1 のとき Intune, Value が 2 のとき ConfigMgr を示します。</li></ul><h2 id="事象の解消方法"><a href="#事象の解消方法" class="headerlink" title="事象の解消方法"></a>事象の解消方法</h2><ul><li><p>事象が既に発生してしまっている端末については、以下のレジストリの値を変更し、CCMExec サービスを再起動することで事象が解消され、ワークロードの設定が ConfigMgr で設定したものに設定されます。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[HKLM\SOFTWARE\Microsoft\DeviceManageabilityCSP\Provider\MS DM Server]</span><br><span class="line">Key: ConfigInfo</span><br><span class="line">Value: 2</span><br></pre></td></tr></table></figure><ul><li>[ファイル名を指定して実行] - [C:\Windows\CCM\SMSCFGRC.cpl] を開き、全般タブを開いた際に「共同管理機能」の値が 「2147479807」 以外の値を示すようになります。</li></ul></li><li><p>これからキッティングする端末にて事象が発生しないようにするためには、プロファイルにて「共同管理ポリシーをオーバーライドし、すべてのワークロードに対して Intune　を使用します] を「いいえ」にして端末に割り当ててください。</p></li></ul><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://learn.microsoft.com/ja-jp/mem/configmgr/comanage/autopilot-enrollment#limitations">https://learn.microsoft.com/ja-jp/mem/configmgr/comanage/autopilot-enrollment#limitations</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;AutoPilot-を使って-キッティング-した-Win-11-端末に対して共同管理ポリシーが適用されない場合の対処策&quot;&gt;&lt;a href=&quot;#AutoPilot-を使って-キッティング-した-Win-11-端末に対して共同管理ポリシーが適用されない場合の対処策&quot; </summary>
      
    
    
    
    
    <category term="MECM" scheme="https://jpmem.github.io/blog/tags/MECM/"/>
    
    <category term="共同管理" scheme="https://jpmem.github.io/blog/tags/%E5%85%B1%E5%90%8C%E7%AE%A1%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>Contents Library Explorer を使って配布ポイントに格納されているコンテンツを確認する</title>
    <link href="https://jpmem.github.io/blog/mecm/20241004_01/"/>
    <id>https://jpmem.github.io/blog/mecm/20241004_01/</id>
    <published>2024-10-03T15:00:00.000Z</published>
    <updated>2025-02-13T07:48:34.241Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。 Configuration Manager サポート チームです。  </p><p>本日は、Configuration Mager (ConfigMgr) の配布ポイントに格納されているコンテンツを確認するために有用な Contents Library Explorer のご利用方法をご案内させていただきます。</p><h1 id="利用するパターン"><a href="#利用するパターン" class="headerlink" title="利用するパターン"></a>利用するパターン</h1><ul><li>クライアントにアプリケーションや更新プログラムを配布する際、配布ポイントにコンテンツが存在しない旨エラーが出た場合、配布ポイント上のコンテンツを検証したり、ファイル破損が発生したりしていないか確認する。</li></ul><h1 id="使い方"><a href="#使い方" class="headerlink" title="使い方"></a>使い方</h1><ol><li>サイト サーバー にアクセスします。</li><li>[ConfigMgr インストールフォルダ]\tools\ServerTools\contentlibraryexplorer.exe を開きます。<br><img src="/blog/mecm/20241004_01/20241004_01_01.png" alt="image.png"></li><li>[Enter Distribution Point Location] とダイアログが表示されるので、配布ポイントの FQDN を入力し、[OK] をクリックします。<br>　<img src="/blog/mecm/20241004_01/20241004_01_02.png" alt="image.png"></li><li>該当の配布ポイントに配布されているコンテンツの一覧が表示されます。<br>　<img src="/blog/mecm/20241004_01/20241004_01_03.png" alt="image.png"></li><li>左ペインから調査したいパッケージを選択すると、右ペインに該当のパッケージに含まれるファイルの一覧が表示されます。各列の意味は以下の通りです。<ul><li>File: ファイル名</li><li>Size: ファイルサイズ (byte)</li><li>Time Modified: 最新変更日付</li><li>Shared With: 別のパッケージでも該当ファイルを共有している場合、共有しているパッケージの名前が表示されます。</li><li>Path: 配布ポイントのファイルシステム上のファイルパスが表示されます。<ul><li>ここで、実際のファイル名は 該当ファイルの SHA-1 ハッシュです。この点に着目すると、ソース共有フォルダのファイルを PowerShell の Get-FileHash で取得したハッシュと、このファイルパスのハッシュが一致するかどうかで、コンテンツ ファイル を正しく配布出来ているかどうかを確認出来たりします。</li></ul></li></ul></li></ol><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p>Content Library Explorer<br><a href="https://learn.microsoft.com/ja-jp/mem/configmgr/core/support/content-library-explorer">https://learn.microsoft.com/ja-jp/mem/configmgr/core/support/content-library-explorer</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。 Configuration Manager サポート チームです。  &lt;/p&gt;
&lt;p&gt;本日は、Configuration Mager (ConfigMgr) の配布ポイントに格納されているコンテンツを確認するために有用な Contents Libra</summary>
      
    
    
    
    
    <category term="MECM" scheme="https://jpmem.github.io/blog/tags/MECM/"/>
    
    <category term="使い方" scheme="https://jpmem.github.io/blog/tags/%E4%BD%BF%E3%81%84%E6%96%B9/"/>
    
  </entry>
  
  <entry>
    <title>WSUS 開発終了のお知らせ</title>
    <link href="https://jpmem.github.io/blog/wsus/2024-09-24_01/"/>
    <id>https://jpmem.github.io/blog/wsus/2024-09-24_01/</id>
    <published>2024-09-23T15:00:00.000Z</published>
    <updated>2025-02-13T07:48:34.383Z</updated>
    
    <content type="html"><![CDATA[<p>皆様、こんにちは。WSUS サポート チームです。<br>本記事は、2024 年 9 月 20 日に米国の Windows IT Pro Blog で公開された <a href="https://techcommunity.microsoft.com/t5/windows-it-pro-blog/windows-server-update-services-wsus-deprecation/ba-p/4250436">Windows Server Update Services (WSUS) deprecation</a> の抄訳です。<br>ご案内の通り、誠に恐縮ながら、WSUS の新機能の開発および新機能のリクエストの受付は終了いたしますが、WSUS および Configuration Manager は引き続きサポートいたします。</p><hr><p>クラウドからの簡素化された Windows 管理のビジョンの一環として、マイクロソフトは <a href="https://learn.microsoft.com/ja-jp/windows-server/get-started/removed-deprecated-features-windows-server-2025">Windows Server Update Services（WSUS）</a> の廃止を発表しました。具体的には、新しい機能の開発や新機能のリクエストの受付を終了することを意味します。ただし、現在の機能は維持され、WSUS チャネルを通じて更新プログラムを引き続き公開します。また、WSUS チャネルを通じて既に公開されたコンテンツもサポートします。</p><p>廃止とは、機能やサービスがもはや積極的に開発されていない製品ライフサイクルの段階を意味します。WSUS の廃止は、Microsoft Configuration Manager の既存の機能やサポートには影響しません。また、WSUS の役割は Windows Server 2025 でも利用可能ですが、クライアントの更新管理には <a href="https://learn.microsoft.com/ja-jp/windows/deployment/windows-autopatch/overview/windows-autopatch-overview">Windows Autopatch</a> や<a href="https://learn.microsoft.com/ja-jp/mem/intune/fundamentals/what-is-intune">Microsoft Intune</a>、サーバーの更新管理には <a href="https://azure.microsoft.com/ja-jp/products/azure-update-management-center/">Azure Update Manager</a> などのクラウド ツールへの移行をお勧めします。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;皆様、こんにちは。WSUS サポート チームです。&lt;br&gt;本記事は、2024 年 9 月 20 日に米国の Windows IT Pro Blog で公開された &lt;a href=&quot;https://techcommunity.microsoft.com/t5/windows-</summary>
      
    
    
    
    
    <category term="WSUS" scheme="https://jpmem.github.io/blog/tags/WSUS/"/>
    
  </entry>
  
  <entry>
    <title>更新ビューの作成方法</title>
    <link href="https://jpmem.github.io/blog/wsus/2024-06-13_01/"/>
    <id>https://jpmem.github.io/blog/wsus/2024-06-13_01/</id>
    <published>2024-06-12T15:00:00.000Z</published>
    <updated>2025-02-13T07:48:34.381Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。WSUS サポート チームです。今回は、更新ビューの作成方法について紹介いたします。更新ビューを作成いただくことにより、WSUS メンテナンスや承認作業等を効率的に行うことができますので是非ご活用ください。  </p><hr><h1 id="更新ビューについて"><a href="#更新ビューについて" class="headerlink" title="更新ビューについて"></a>更新ビューについて</h1><p>更新ビューは、WSUS コンソール上で、必要な更新プログラムをフィルタリングして表示する機能です。以下に WSUS で新しい更新ビューを作成する手順をご紹介します。  </p><h1 id="作成方法"><a href="#作成方法" class="headerlink" title="作成方法"></a>作成方法</h1><ol><li><p> WSUS 管理コンソールの左ペインで、 [更新プログラム] を展開し、 [すべての更新プログラム] を選択します。  </p></li><li><p>右クリックで、 [新しい更新ビュー] を選択すると、更新ビューの追加ウィンドウが開きます。<br><img src="/blog/wsus/2024-06-13_01/2024-06-13_01_1.png"> </p></li><li><p>更新ビューの追加ウィンドウにて、必要なプロパティや値を選択し更新ビューを作成します。  </p><h3 id="ステップ１：プロパティを選択します。"><a href="#ステップ１：プロパティを選択します。" class="headerlink" title="ステップ１：プロパティを選択します。"></a>ステップ１：プロパティを選択します。</h3><p><img src="/blog/wsus/2024-06-13_01/2024-06-13_01_2.png">  </p><ul><li>[更新は特定の分類に含まれます]：分類 でフィルタリングする場合にチェックを入れます。  </li><li>[更新は特定の製品用です]：製品 でフィルタリングする場合にチェックを入れます。  </li><li>[更新は特定のグループに対して承認済みです]：承認先のコンピューターグループ でフィルタリングする場合にチェックを入れます。  </li><li>[特定の期間内に同期された更新]：特定の期間に同期された更新プログラムでフィルタリングする場合にチェックを入れます。  </li><li>[更新は WSUS 更新です]：こちらは現在既に廃止されている機能である為選択不要です。</li></ul><h3 id="ステップ２-プロパティを変更します-下線付きの値をクリック"><a href="#ステップ２-プロパティを変更します-下線付きの値をクリック" class="headerlink" title="ステップ２: プロパティを変更します　(下線付きの値をクリック)"></a>ステップ２: プロパティを変更します　(下線付きの値をクリック)</h3><p>上記で選択したプロパティに従って値を変更ください。<br><img src="/blog/wsus/2024-06-13_01/2024-06-13_01_3.png">  </p><h3 id="ステップ３-名前を指定します-N"><a href="#ステップ３-名前を指定します-N" class="headerlink" title="ステップ３: 名前を指定します　(N)"></a>ステップ３: 名前を指定します　(N)</h3><p>作成した更新ビューに任意の名前を付け [OK] を選択します。<br><img src="/blog/wsus/2024-06-13_01/2024-06-13_01_4.png">  </p></li></ol><p>参考：<a href="%5Bhttps://learn.microsoft.com/ja-jp/windows-server/administration/windows-server-update-services/manage/viewing-and-managing-updates">更新プログラムを表示および管理する</a>  </p><p>上記手順により、新しい更新ビューが作成され更新ビューが追加されます。これらの更新ビューを利用いただくことで、特定の製品、分類、コンピュータグループへの承認状態、同期期間などに基づいて更新プログラムを効率的に管理できますので運用管理にお役立てください。  </p><p>補足事項 : 更新ビューの情報は、MMC と呼ばれるキャッシュ ファイル ( %appdata%\Microsoft\MMC\wsus) に保存されます。このため、何らかの理由により、キャッシュ ファイルが失われた場合には、作成した更新ビューも失われることになりますのでご留意ください。  </p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。WSUS サポート チームです。今回は、更新ビューの作成方法について紹介いたします。更新ビューを作成いただくことにより、WSUS メンテナンスや承認作業等を効率的に行うことができますので是非ご活用ください。  &lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&quot;更新ビ</summary>
      
    
    
    
    
    <category term="WSUS" scheme="https://jpmem.github.io/blog/tags/WSUS/"/>
    
    <category term="使い方" scheme="https://jpmem.github.io/blog/tags/%E4%BD%BF%E3%81%84%E6%96%B9/"/>
    
  </entry>
  
  <entry>
    <title>Configuration Manager Current Branch 2403 で追加された アップグレード前提条件</title>
    <link href="https://jpmem.github.io/blog/mecm/20240513_01/"/>
    <id>https://jpmem.github.io/blog/mecm/20240513_01/</id>
    <published>2024-05-12T15:00:00.000Z</published>
    <updated>2025-02-13T07:48:34.240Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。 Configuration Manager サポートチームでございます。本日は、Configuration Manager Current Branch (ConfigMgr CB) 2403 で追加された 更新時の前提条件についてご案内致します。  </p><p>前提条件を含めた ConfigMgr CB 2403 での更新については以下をご参照ください。  </p><p>現在のブランチのバージョン 2403 の新機能Configuration Manager<br><a href="https://learn.microsoft.com/ja-jp/mem/configmgr/core/plan-design/changes/whats-new-in-version-2403">https://learn.microsoft.com/ja-jp/mem/configmgr/core/plan-design/changes/whats-new-in-version-2403</a>  </p><p>ConfigMgr のアップデート 時の全ての前提条件については下記でもご案内しております。  </p><p>Configuration Managerの前提条件チェックの一覧<br><a href="https://learn.microsoft.com/ja-jp/mem/configmgr/core/servers/deploy/install/list-of-prerequisite-checks">https://learn.microsoft.com/ja-jp/mem/configmgr/core/servers/deploy/install/list-of-prerequisite-checks</a>  </p><h2 id="Windows-Server-2012-2012-R2-のサポート終了"><a href="#Windows-Server-2012-2012-R2-のサポート終了" class="headerlink" title="Windows Server 2012 / 2012 R2 のサポート終了"></a>Windows Server 2012 / 2012 R2 のサポート終了</h2><p>Windows Server 2012 / 2012 R2 のサポート終了に伴い、 ConfigMgr CB 2403 へのアップデートの際に、同 OS をサイト サーバー、サイト システム サーバー に使用している環境下では ConfigMgr CB 2403 へのアップグレードがブロックされます。<br>現在サポートされている Windows Server へアップグレードしてご利用されるようお願い致します。</p><p>なお、上記は ConfigMgr CB 2309 以前で 2024/5/13 現在で Windows Server 2012 / 2012 R2 がサポートされることを意味しておりませんのでご注意ください。上記にかかわらず、既に Windows Server 2012 / 2012 R2 の ConfigMgr サイト サーバー、サイト システムでの利用はサポートされておりません。<br>ESU 契約をお持ちの場合でも、クライアントとしての管理以外はサポートされませんのでご留意ください。</p><h2 id="クライアント-サーバー-間の-HTTP-通信の削除"><a href="#クライアント-サーバー-間の-HTTP-通信の削除" class="headerlink" title="クライアント - サーバー 間の HTTP 通信の削除"></a>クライアント - サーバー 間の HTTP 通信の削除</h2><p>クライアント - サーバー 間の HTTP 通信がサポートされなくなります。拡張 HTTP もしくは HTTPS 通信への通信形態の変更を実施ください。よりセキュリティの高い通信を利用されたい場合は HTTPS をご検討ください。 拡張 HTTP の方が手順少なく対応できます。なお、AD スキーマを拡張されていない環境にて、<br>サイト サーバー設定にて通信設定を 「HTTPS のみ」に変更するとクライアント - サーバー 間の通信を以降 拡張 HTTP に変更できない場合がございますので、ご注意ください。  </p><p>拡張 HTTP の設定確認については下記でご案内しております。</p><p>Configuration Managerにおける拡張 HTTP の確認方法<br><a href="https://jpmem.github.io/blog/mecm/20220122_01/">https://jpmem.github.io/blog/mecm/20220122_01/</a>  </p><h2 id="クラウド-サービス-クラシック-ベースのクラウド管理ゲートウェイのブロック"><a href="#クラウド-サービス-クラシック-ベースのクラウド管理ゲートウェイのブロック" class="headerlink" title="クラウド サービス(クラシック) ベースのクラウド管理ゲートウェイのブロック"></a>クラウド サービス(クラシック) ベースのクラウド管理ゲートウェイのブロック</h2><p>クラウド サービス (クラシック) ベースのクラウド管理ゲートウェイの利用は ConfigMgr CB 2403 以降サポートされないため、削除する必要がございます。仮想マシン スケールセットへの移行を実施ください。<br>[ConfigMgrコンソール] - [管理] - [概要] - [クラウド サービス] - [クラウド管理ゲートウェイ] で一覧表示した際に、[デプロイ モデル] が 「クラウド サービス(クラシック)」のものが対象です。<br>下記にて仮想マシン スケールセットへの移行についてご案内しております。  </p><p>仮想マシン スケールセットのクラウド管理ゲートウェイについて<br><a href="https://jpmem.github.io/blog/mecm/20211212_01/">https://jpmem.github.io/blog/mecm/20211212_01/</a>  </p><p>suffix が cloudapp.net な CMG の仮想マシン スケールセットへの移行について<br><a href="https://jpmem.github.io/blog/mecm/20230816_01/">https://jpmem.github.io/blog/mecm/20230816_01/</a></p><h2 id="共同管理でのリソース-アクセス-ポリシー-ワークロードのブロック"><a href="#共同管理でのリソース-アクセス-ポリシー-ワークロードのブロック" class="headerlink" title="共同管理でのリソース アクセス ポリシー ワークロードのブロック"></a>共同管理でのリソース アクセス ポリシー ワークロードのブロック</h2><p>ConfigMgr でのリソース アクセス ポリシー配布機能の削除にともない、共同管理構成を設定されている場合、リソース アクセス ポリシーのワークロードを Intune に寄せる必要がございますのでご留意ください。本設定は下記から確認可能です。  </p><p>[ConfigMgrコンソール] - [管理] - [概要] - [クラウド サービス] - [クラウドの接続] - [CoMgmtSettingsProd] - [プロパティ] - [ワークロード] タブ  </p><p><img src="/blog/mecm/20240513_01/20240513_01_02.png">  </p><p>なお、ConfigMgrでのリソース アクセス ポリシーの利用有無は以下からご確認可能です。  </p><p>[ConfigMgrコンソール] – [資産とコンプライアンス] – [概要] – [コンプライアンス設定]- [会社のリソースへのアクセス] </p><p>   <img src="/blog/mecm/20240513_01/20240513_01_01.png">  </p><p>リソース アクセス ポリシーについては下記ドキュメントもご参照ください。  </p><p>リソース アクセスの非推奨に関してよく寄せられる質問<br><a href="https://learn.microsoft.com/ja-jp/mem/configmgr/protect/plan-design/resource-access-deprecation-faq">https://learn.microsoft.com/ja-jp/mem/configmgr/protect/plan-design/resource-access-deprecation-faq</a>  </p><h2 id="その他"><a href="#その他" class="headerlink" title="その他"></a>その他</h2><p>ConfigMgr CB 2309 以降へのアップグレードは SQL ODBC Driver 18 以降のインストールが必要ですのでご留意ください。  </p><p>Configuration Manager Current Branch 2309 にて変更となった Microsoft ODBC Driver for SQL Server の要件のご紹介<br><a href="https://jpmem.github.io/blog/mecm/20240110_01/">https://jpmem.github.io/blog/mecm/20240110_01/</a></p><p>また、ConfigMgr CB 2403 において、共同管理を有効化されていて Intune 側の Endpoint Protection をご利用されているお客様について、影響が出る可能性のある不具合がございます。詳しくは下記をご確認くださいませ。  </p><p>2309 ロールアップ KB25858444 適用済み、または 2403 共同管理クライアントで Endpoint Protection ワークロードを Intune に設定した場合に影響を受ける不具合について<br><a href="https://jpmem.github.io/blog/mecm/20240510_01/">https://jpmem.github.io/blog/mecm/20240510_01/</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。 Configuration Manager サポートチームでございます。本日は、Configuration Manager Current Branch (ConfigMgr CB) 2403 で追加された 更新時の前提条件についてご案内致します。 </summary>
      
    
    
    
    
    <category term="MECM" scheme="https://jpmem.github.io/blog/tags/MECM/"/>
    
  </entry>
  
  <entry>
    <title>2309 ロールアップ KB25858444 適用済み、または 2403 共同管理クライアントで Endpoint Protection ワークロードを Intune に設定した場合に影響を受ける不具合について</title>
    <link href="https://jpmem.github.io/blog/mecm/20240510_01/"/>
    <id>https://jpmem.github.io/blog/mecm/20240510_01/</id>
    <published>2024-05-09T15:00:00.000Z</published>
    <updated>2025-02-13T07:48:34.240Z</updated>
    
    <content type="html"><![CDATA[<p>[改訂履歴]<br>第 1 版 2024 年 5 月 10 日 初版リリース<br>第 2 版 2024 年 5 月 23 日 ワークアラウンドの項目を削除し、解決策を追加  </p><p>みなさま、こんにちは。Configuration Manager サポート チームです。  </p><p>ConfigMgr CB 2403 及び CB 2309 に KB25858444 を適用した環境において、以下でご案内します不具合が報告されております。<br>不具合の解決策をご案内いたしますので、ご確認頂きますようお願い致します。  </p><h3 id="事象に該当する環境"><a href="#事象に該当する環境" class="headerlink" title="事象に該当する環境"></a>事象に該当する環境</h3><p>ConfigMgr CB 2403 及び CB 2309 KB25858444 適用環境である、以下のクライアントをお使いの場合  </p><ul><li>ConfigMgr CB 2403: 5.00.9128.1007  </li><li>ConfigMgr CB 2309 + KB25858444: 5.00.9122.1018  </li></ul><p>かつ、以下の設定をお使いの場合。  </p><ul><li>共同管理環境を有効にしており、Endpoint Protection ワークロードを Intune もしくは パイロット Intune 側に寄せている  </li></ul><h3 id="事象"><a href="#事象" class="headerlink" title="事象"></a>事象</h3><p>ワークロードを Intune に寄せているのにもかかわらず、Endpoint Protection のポリシーが Intune から管理されなくなります。  </p><h3 id="解決策"><a href="#解決策" class="headerlink" title="解決策"></a>解決策</h3><p>Microsoft セキュリティ クライアント ポリシー構成ツール (ConfigSecurityPolicy.exe) のバージョンを 4.18.24040.4 に更新することで、事象が解消いたします。<br>具体的には「Microsoft Defender Antivirus マルウェア対策プラットフォームの更新プログラム - KB4052623 (バージョン 4.18.24040.4) - 現在のチャネル (広範)」という名前の更新プログラムがリリースされておりますので、こちらの更新プログラムが適用されて、「マルウェア対策クライアント バージョン」が 4.18.24040.4 以降のバージョンになっていれば、本不具合の影響は受けません。<br>クライアントの「マルウェア対策クライアント バージョン」は、Configuration Manager 管理コンソールの「デバイス」のノードで当該項目を表示列に追加することでご確認いただけます。  </p><h3 id="該当リリースノートのリンク及び抄訳"><a href="#該当リリースノートのリンク及び抄訳" class="headerlink" title="該当リリースノートのリンク及び抄訳"></a>該当リリースノートのリンク及び抄訳</h3><p> Title : Intuneから削除されたセキュリティ構成<br>URL : <a href="https://learn.microsoft.com/ja-jp/mem/configmgr/core/servers/deploy/install/release-notes#security-configurations-removed-from-intune">https://learn.microsoft.com/ja-jp/mem/configmgr/core/servers/deploy/install/release-notes#security-configurations-removed-from-intune</a><br>— &lt;抜粋&gt; —<br>Microsoft Defenderバージョン 2403 に更新するか、2309 の更新プログラムのロールアップをインストールした後、Configuration Manager Microsoft Intuneで管理されなくなりました。  </p><p>この現象は、Intuneで表示すると、Microsoft セキュリティ スコアの値が低下したと見なされます。この問題は、Configuration Manager クライアントがアップグレードされた後に、セキュリティ ポリシー構成データがクライアントから誤って削除されるために発生します。  </p><p>Microsoft セキュリティ クライアント ポリシー構成ツールの更新バージョン (ConfigSecurityPolicy.exe) は、このノートで説明されている Endpoint Protection ポリシーの問題を解決するために使用できます。  </p><p>更新されたツールバージョン 4.18.24040.4 は、2024 年 4 月の月次Microsoft Defenderプラットフォーム更新プログラムと共に配布されます。 この記事の執筆時点では、プラットフォームの更新プログラムはグローバル配布の処理中であり、2024 年 5 月 17 日までにすべてのリージョンで幅広く利用できる必要があります。<br>影響を受けるクライアントにプラットフォーム更新プログラムがインストールされると、Endpoint Protection ポリシーは 8 時間以内にIntuneから再適用されます。Configuration Managerの [クライアント コンピューターでエンドポイント保護クライアントを管理する] 設定は、必要に応じて “はい” に戻すことができます。<br>— &lt;抜粋&gt; —  </p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;[改訂履歴]&lt;br&gt;第 1 版 2024 年 5 月 10 日 初版リリース&lt;br&gt;第 2 版 2024 年 5 月 23 日 ワークアラウンドの項目を削除し、解決策を追加  &lt;/p&gt;
&lt;p&gt;みなさま、こんにちは。Configuration Manager サポート チーム</summary>
      
    
    
    
    
    <category term="MECM" scheme="https://jpmem.github.io/blog/tags/MECM/"/>
    
    <category term="共同管理" scheme="https://jpmem.github.io/blog/tags/%E5%85%B1%E5%90%8C%E7%AE%A1%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>自動承認規則の &quot;承認の期日の設定&quot; について</title>
    <link href="https://jpmem.github.io/blog/wsus/2024-05-02_01/"/>
    <id>https://jpmem.github.io/blog/wsus/2024-05-02_01/</id>
    <published>2024-05-01T15:00:00.000Z</published>
    <updated>2025-02-13T07:48:34.380Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。WSUS サポート チームです。今回は、自動承認規則の “承認の期日” の設定について紹介いたします。 字面からは一見勘違いしやすい設定ですが、下記に記載の通りの動作となりますのでご留意いただければと存じます。</p><hr><h2 id="“承認の期日の設定”-とは"><a href="#“承認の期日の設定”-とは" class="headerlink" title="“承認の期日の設定” とは"></a>“承認の期日の設定” とは</h2><p>“承認の期日の設定” とは、自動承認規則で利用することのできる期日の設定です。<br>参考：自動承認規則については以下の記事を参照ください。  </p><ul><li><a href="https://jpmem.github.io/blog/mecm/20220426_01/">Configuration Manager の自動展開規則と WSUS の自動承認規則について</a>   </li><li><a href="https://learn.microsoft.com/ja-jp/windows-server/administration/windows-server-update-services/deploy/3-approve-and-deploy-updates-in-wsus#32-configure-auto-approval-rules">3.2. 自動承認規則を構成する</a>   </li></ul><p>自動承認規則を事前に設定していると、上位サーバー（ Microsoft Update サイトや非レプリカ環境のアップストリームサーバー ）と同期したタイミングで、自動承認規則で事前設定した条件を満たした更新プログラムが、事前設定したコンピューターグループに承認されます。<br>この自動承認規則で設定出来る項目の一つに “承認の期日の設定” があります。  </p><p><img src="/blog/wsus/2024-05-02_01/2024-05-02_01_1.png">  </p><p>“承認の期日の設定” で期日を指定すると、この期日までに更新プログラムのインストールが終わっていない端末に対して強制的に更新プログラムのインストールを行わせることができます。<br>上記画面ショットの例では、自動承認により、更新プログラムの同期が完了し、コンピューターグループに対する承認が行われた、その日時から7日後の 3:00 までに、対象のコンピューターグループに所属していながら、更新プログラムのインストールが完了していないクライアントは、強制的にインストールが実行されます。  </p><p>字面からは、コンピューターグループに対する自動承認を行う設定のように一見読み取れますが、そうではなく、上記でも述べました通り、自動展開規則の承認後に、インストールを強制する日付ですのでご留意ください。  </p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。WSUS サポート チームです。今回は、自動承認規則の “承認の期日” の設定について紹介いたします。 字面からは一見勘違いしやすい設定ですが、下記に記載の通りの動作となりますのでご留意いただければと存じます。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&quot;“承認</summary>
      
    
    
    
    
    <category term="WSUS" scheme="https://jpmem.github.io/blog/tags/WSUS/"/>
    
  </entry>
  
  <entry>
    <title>Windows Server 2019 以降 WSUS レポート機能のソフトウェア要件について</title>
    <link href="https://jpmem.github.io/blog/wsus/2024-03-08_01/"/>
    <id>https://jpmem.github.io/blog/wsus/2024-03-08_01/</id>
    <published>2024-03-07T15:00:00.000Z</published>
    <updated>2025-02-13T07:48:34.380Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。WSUS サポート チームです。<br>今回は、Windows Server 2019 以降 WSUS レポート機能のソフトウェア要件が変更になりましたことをお知らせいたします。</p><p>WSUS レポート機能については、<a href="https://jpmem.github.io/blog/wsus/2017-09-04_02/">こちらの記事</a>でも紹介しておりますので、合わせてご確認ください。</p><h1 id="対象"><a href="#対象" class="headerlink" title="対象"></a>対象</h1><p>Windows Server 2019, Windows Server 2022</p><h1 id="変更点"><a href="#変更点" class="headerlink" title="変更点"></a>変更点</h1><p>これまで WSUS レポート機能を使用する場合、事前に Microsoft Report Viewer Runtime 2012 と Microsoft System CLR Types for SQL Server 2012 をインストールする必要がありました。<br>Windows Server 2019 / Windows Server 2022 においても、同様に必要となっておりましたが、以下の累積更新プログラム、またはそれより新しい累積更新プログラムをインストール済みの Windows Server の場合、これらのソフトウェアは不要となりました。</p><ul><li>Windows Server 2019: <a href="https://support.microsoft.com/ja-jp/topic/2023-%E5%B9%B4-10-%E6%9C%88-10-%E6%97%A5-kb5031361-os-%E3%83%93%E3%83%AB%E3%83%89-17763-4974-766593db-b47a-4b18-a698-906426860313">2023 年 10 月 10 日 — KB5031361 (OS ビルド 17763.4974)</a></li><li>Windows Server 2022: <a href="https://support.microsoft.com/ja-jp/topic/2023-%E5%B9%B4-10-%E6%9C%88-10-%E6%97%A5-kb5031364-os-%E3%83%93%E3%83%AB%E3%83%89-20348-2031-7f1d69e7-c468-4566-887a-1902af791bbc">2023 年 10 月 10 日 — KB5031364 (OS ビルド 20348.2031)</a></li></ul><p>そのため、対象の累積更新プログラム適用済みの Windows Server 2019 / Windows Server 2022 の場合、これらのソフトウェアをアンインストールしても WSUS レポート機能は利用可能となります。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。WSUS サポート チームです。&lt;br&gt;今回は、Windows Server 2019 以降 WSUS レポート機能のソフトウェア要件が変更になりましたことをお知らせいたします。&lt;/p&gt;
&lt;p&gt;WSUS レポート機能については、&lt;a href=&quot;htt</summary>
      
    
    
    
    
    <category term="WSUS" scheme="https://jpmem.github.io/blog/tags/WSUS/"/>
    
  </entry>
  
  <entry>
    <title>Configuration Manager ベーシック ナレッジ シリーズ 4 - サイト システムの各役割の意味</title>
    <link href="https://jpmem.github.io/blog/mecm/20240216_01/"/>
    <id>https://jpmem.github.io/blog/mecm/20240216_01/</id>
    <published>2024-02-15T15:00:00.000Z</published>
    <updated>2025-02-13T07:48:34.240Z</updated>
    
    <content type="html"><![CDATA[<p>Configuration Manager では、サイト システムの役割をインストールすることで、様々な機能を拡張することができます。サイト システムの役割をインストールしたサーバーを、サイト システム サーバーと言います。<br>この投稿では代表的なサイト システム サーバーがどのような機能を使えるようにするものなのかを説明していきます。</p><p>( ) 内は英語名称および略称です。</p><h2 id="管理ポイント-Management-point-MP"><a href="#管理ポイント-Management-point-MP" class="headerlink" title="管理ポイント (Management point / MP)"></a>管理ポイント (Management point / MP)</h2><p>プライマリ サイト サーバーやセカンダリ サイト サーバーに既定でインストールされています。<br>クライアントが最も多く通信をおこなう役割となります。</p><p>クライアントは管理ポイントから “クライアント設定” の変更や “境界グループ” の構成など、あらゆる情報をポリシーとしてダウンロードすることで受け取っています。<br>また、クライアントは定期的に管理ポイントへ状態メッセージを送信  (既定で 15 分間隔) することで、クライアントに配信したソフトウェア更新プログラムやアプリケーション展開の進捗状態を管理することが出来ています。</p><h2 id="配布ポイント-Distribution-point-DP"><a href="#配布ポイント-Distribution-point-DP" class="headerlink" title="配布ポイント (Distribution point / DP)"></a>配布ポイント (Distribution point / DP)</h2><p>プライマリ サイト サーバーやセカンダリ サイト サーバーに既定で配布ポイントがインストールされています。<br>以下のようなコンテンツを配布ポイントに配置することで、クライアントは配布ポイントからコンテンツをダウンロードすることが可能になります。</p><p>・アプリケーション コンテンツ<br>・ソフトウェア パッケージ<br>・ソフトウェア更新プログラム<br>・OS イメージ<br>・ブート イメージ  </p><p>コンテンツの大きさにより、ダウンロードに使用する通信量を懸念される場合、配布ポイント サーバーを要所に配置することでネットワーク回線の負荷軽減が期待できます。<br>例えば、サーバーとは地理的に離れた場所にクライアントが存在し、ネットワークの通信を可能な限り抑えたい場合には、拠点となるポイントに配布ポイントを配置することを検討します。<br>クライアントが通信をおこなう配布ポイントをコントロールするには、<a href="https://learn.microsoft.com/ja-jp/mem/configmgr/core/servers/deploy/configure/boundary-group-procedures">“境界” と “境界グループ”</a> の設定も忘れずに行いましょう。</p><h2 id="ソフトウェアの更新ポイント-Software-update-point-SUP"><a href="#ソフトウェアの更新ポイント-Software-update-point-SUP" class="headerlink" title="ソフトウェアの更新ポイント (Software update point / SUP)"></a>ソフトウェアの更新ポイント (Software update point / SUP)</h2><p>Windows Server Update Services (WSUS) と連携し、Microsoft Update や上位 WSUS からメタデータ (更新プログラムのカタログ情報) を同期します。<br>クライアントはソフトウェアの更新ポイントに更新プログラムの確認 (コンプライアンス スキャン) を定期実行し、自分自身に各更新プログラムのインストールが必要か、不要かを判定しています。<br>また Configuration Manager ではクライアントがインストールを必要としている状態を “必須” と表現し、”必須” と判定した更新プログラムのみ、コンテンツのダウンロード・インストールを行います。</p><p>こちらの図は、Configuration Manager クライアントが更新プログラムの配信を受け取り、インストールされるまでの処理のイメージとなります。<br><img src="/blog/mecm/20240216_01/2024-02-09_1.png" alt="image.PNG"></p><p>① 管理者が、更新プログラムの配信の設定をします。ポリシー情報が MP のデータベースに格納されます。<br>② クライアントは、定期的にポリシーの確認を行っています。MP に更新されたポリシー情報があれば、ポリシーをダウンロードをします。<br>③ クライアントは、定期的にコンプライアンス スキャンを行っています。<br>④ クライアントは、② のポリシーを評価し、③ で “必須” と判定した更新プログラムが含まれる場合は、展開スケジュールに従って配布ポイントからコンテンツ ダウンロードをおこないます。<br>⑤ クライアントは、展開スケジュールに従って、ダウンロード済みの更新プログラムをインストールします。</p><h2 id="サービス接続ポイント-Service-connection-point-SCP"><a href="#サービス接続ポイント-Service-connection-point-SCP" class="headerlink" title="サービス接続ポイント (Service connection point / SCP)"></a>サービス接続ポイント (Service connection point / SCP)</h2><p>Configuration Manager のバージョンアップをおこなうために欠かせない役割がサービス接続ポイントです。サービス接続ポイントには [オンライン モード] 、[オフライン モード] があり、モードに応じた処理で新しい更新プログラムの同期をおこないます。<br>Configuration Manager では <a href="https://learn.microsoft.com/ja-jp/mem/configmgr/core/servers/manage/current-branch-versions-supported">サポート ライフ サイクル</a> が 18 か月ごとに定義されていますので、余裕をもったバージョン アップの計画をお願いいたします。</p><p>※ オンライン モードは <a href="https://learn.microsoft.com/ja-jp/mem/configmgr/core/plan-design/network/internet-endpoints">こちら</a> のインターネット要件を満たす必要があります。</p><h2 id="クラウド管理ゲートウェイ接続ポイント-Cloud-management-gateway-connection-point-CMG-CP"><a href="#クラウド管理ゲートウェイ接続ポイント-Cloud-management-gateway-connection-point-CMG-CP" class="headerlink" title="クラウド管理ゲートウェイ接続ポイント (Cloud management gateway connection point / CMG CP)"></a>クラウド管理ゲートウェイ接続ポイント (Cloud management gateway connection point / CMG CP)</h2><p>Configuration Manager はオンプレミス環境に構築しますが、オンプレミス環境に接続しないクライアントも管理したいといった要望はありませんか？<br>その方法のひとつに Azure と連携したクラウド管理ゲートウェイ (CMG) の構築があります。クラウド管理ゲートウェイ接続ポイントとは、CMG とオンプレミスのサイト システムを接続する役割です。</p><p>CMG の概要および具体的な構築手順については下記に投稿をまとめていますので、あわせて参照ください。<br><a href="https://jpmem.github.io/blog/tags/CMG/">https://jpmem.github.io/blog/tags/CMG/</a></p><p>代表的なサイト システム サーバーができることについて解説しましたが、いかがでしたでしょうか。今回紹介できなかったサイト システムについては、次の公開情報から確認してください。<br><a href="https://learn.microsoft.com/ja-jp/mem/configmgr/core/plan-design/hierarchy/plan-for-site-system-servers-and-site-system-roles">https://learn.microsoft.com/ja-jp/mem/configmgr/core/plan-design/hierarchy/plan-for-site-system-servers-and-site-system-roles</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Configuration Manager では、サイト システムの役割をインストールすることで、様々な機能を拡張することができます。サイト システムの役割をインストールしたサーバーを、サイト システム サーバーと言います。&lt;br&gt;この投稿では代表的なサイト システム サー</summary>
      
    
    
    
    
    <category term="MECM" scheme="https://jpmem.github.io/blog/tags/MECM/"/>
    
    <category term="ベーシック ナレッジ" scheme="https://jpmem.github.io/blog/tags/%E3%83%99%E3%83%BC%E3%82%B7%E3%83%83%E3%82%AF-%E3%83%8A%E3%83%AC%E3%83%83%E3%82%B8/"/>
    
  </entry>
  
  <entry>
    <title>WSUS サーバーのコンピューター名変更について</title>
    <link href="https://jpmem.github.io/blog/wsus/2024-01-31_01/"/>
    <id>https://jpmem.github.io/blog/wsus/2024-01-31_01/</id>
    <published>2024-01-30T15:00:00.000Z</published>
    <updated>2025-02-13T07:48:34.380Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。WSUS サポート チームです。今回は、WSUS サーバーのコンピューター名変更に際してご留意いただきたい事項をご説明いたします。  </p><hr><h2 id="WSUS-サーバーのコンピューター名変更に伴う留意事項"><a href="#WSUS-サーバーのコンピューター名変更に伴う留意事項" class="headerlink" title="WSUS サーバーのコンピューター名変更に伴う留意事項"></a>WSUS サーバーのコンピューター名変更に伴う留意事項</h2><p>WSUS サーバーのコンピューター名の変更につきましては、WSUS の公開情報にその手順のご案内が存在しないことから、弊社開発部署にて公式にテストされていない操作となりサポートされないものとなります。<br>そのため、WSUS の役割をインストール後にコンピューター名の変更作業が必要な場合は、後述の “WSUS の役割の再インストール” のご実施をご検討いただきますようお願い申し上げます。  </p><h2 id="報告事例"><a href="#報告事例" class="headerlink" title="報告事例"></a>報告事例</h2><p>コンピューター名変更後、WSUS コンソールに作成された更新ビューが表示できなくなるとの報告がございます。<br>こちらは、Microsoft Management Console(MMC) のキャッシュ情報に変更前のコンピューター名が格納されていることに起因し、下記のイベントログ （ ID：7032 ）が記録され、MMC キャッシュの情報を読み込むことができないために発生いたします。  </p><pre><code>警告    20xx/xx/xx 10:35:00    Windows Server Update Services    7032WSUS 管理コンソールは、リモート API 経由で WSUS サーバーに接続できませんでした。  Update Services サービス、 IIS および SQL がサーバー上で実行されていることを確認してください。問題が解決しない場合は、IIS、SQL、および Update Services サービスを再起動してみてください。  System.Net.Sockets.SocketException -- そのようなホストは不明です。</code></pre><h3 id="コンピューター名変更に伴う-WSUS-の役割の再インストール"><a href="#コンピューター名変更に伴う-WSUS-の役割の再インストール" class="headerlink" title="コンピューター名変更に伴う WSUS の役割の再インストール"></a>コンピューター名変更に伴う WSUS の役割の再インストール</h3><p>コンピューター名を変更する場合は、以下でご紹介する手順により、一度 WSUS の役割をアンインストールしコンピューター名を変更後に WSUS の役割を再インストールし、事前に取得したバックアップデータから復元を行う手順を実施いただけますようお願いいたします。</p><p>※残念ながら WSUS の役割を再インストールした場合でも、上記 “報告事例” にございます更新ビューを引き継ぐことはできませんので、ご留意いただけますようお願い申し上げます。  </p><p>&lt;実施手順&gt;<br>手順1. WSUS データベースをバックアップする<br>手順2. WSUS の役割をアンインストール<br>手順3. WSUS コンピューター名を変更する<br>手順4. WSUS の役割をインストールする<br>手順5. WSUS データベースを復元する<br>手順6. WSUS クライアントを新しい コンピューター名に接続する設定  </p><p>手順 1. および手順 5. につきましては、次の情報に詳細手順の記載がございますのでご参照ください。<br><a href="https://jpmem.github.io/blog/wsus/2021-10-19_01/">Windows Server 2012 R2 WSUS から Windows Server 2019 WSUS への移行手順 (WID -&gt; WID の場合)</a><br>2.3. WSUS データベースをバックアップする<br>2.4. WSUS データベースのバックアップを移行先サーバーで復元する  </p><p>手順2. 次の情報に詳細手順の記載がございますのでご参照ください。以下の記事でご紹介の手順を実施します。<br><a href="https://jpmem.github.io/blog/wsus/2022-03-29_01/">WSUS アンインストール手順について (Windows Server 2022 対応版)</a></p><p>手順4. 次の情報に詳細手順の記載がございますのでご参照ください。以下の記事でご紹介の “a. 役割と機能のインストール” を実施します。<br><a href="https://jpmem.github.io/blog/wsus/2023-02-16_01/">WSUS 構築マニュアル</a><br>参照項目　a. 役割と機能のインストール  </p><p>手順 6につきましては、次の情報に詳細手順の記載がございますのでご参照ください。<br><a href="https://jpmem.github.io/blog/wsus/2019-04-16_01/">WSUS クライアントのグループ ポリシー:その 1 – 基本編</a><br>参照項目　1. [イントラネットの Microsoft 更新サービスの場所を指定する]  </p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。WSUS サポート チームです。今回は、WSUS サーバーのコンピューター名変更に際してご留意いただきたい事項をご説明いたします。  &lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&quot;WSUS-サーバーのコンピューター名変更に伴う留意事項&quot;&gt;&lt;a href=&quot;#WS</summary>
      
    
    
    
    
    <category term="WSUS" scheme="https://jpmem.github.io/blog/tags/WSUS/"/>
    
  </entry>
  
  <entry>
    <title>Configuration Manager Current Branch 2309 にて変更となった Microsoft ODBC Driver for SQL Server の要件のご紹介</title>
    <link href="https://jpmem.github.io/blog/mecm/20240110_01/"/>
    <id>https://jpmem.github.io/blog/mecm/20240110_01/</id>
    <published>2024-01-24T15:00:00.000Z</published>
    <updated>2025-02-13T07:48:34.240Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。Configuration Manager サポート チームです。  </p><p>Configuration Manager Current Branch 2309 のアップグレードにて Microsoft ODBC Driver for SQL Server の要件が変更になっております。<br>要件を満たさない場合はアップグレードの前提条件チェックで失敗してしまうため、今回は対応方法をご紹介させて頂きます。  </p><h1 id="Microsoft-ODBC-Driver-for-SQL-Server-の要件に関する情報"><a href="#Microsoft-ODBC-Driver-for-SQL-Server-の要件に関する情報" class="headerlink" title="Microsoft ODBC Driver for SQL Server の要件に関する情報"></a>Microsoft ODBC Driver for SQL Server の要件に関する情報</h1><p>サイト サーバーとサイト システムの役割を持つサーバーにおいて ODBC Driver for SQL Server 18.1.0 以降の ODBC ドライバーのインストールが必要です。  </p><p>Title : 現在のブランチのバージョン 2309 の新機能 Configuration Manager - Configuration Managerの SQL ODBC ドライバー サポートの概要<br>URL : <a href="https://learn.microsoft.com/ja-jp/mem/configmgr/core/plan-design/changes/whats-new-in-version-2309#introducing-sql-odbc-driver-support-for-configuration-manager">https://learn.microsoft.com/ja-jp/mem/configmgr/core/plan-design/changes/whats-new-in-version-2309#introducing-sql-odbc-driver-support-for-configuration-manager</a>  </p><p>下記公開情報で SQL Server ODBC ドライバーのインストールが必要なサイト サーバーとサイト システムの役割を持つサーバーを確認できます。<br>例えば、配布ポイントにはインストールは必要ございません。  </p><p>Title : Configuration Managerのサイトとサイト システムの前提条件<br>URL : <a href="https://learn.microsoft.com/ja-jp/mem/configmgr/core/plan-design/configs/site-and-site-system-prerequisites">https://learn.microsoft.com/ja-jp/mem/configmgr/core/plan-design/configs/site-and-site-system-prerequisites</a></p><h1 id="Microsoft-ODBC-Driver-for-SQL-Server-のインストール方法"><a href="#Microsoft-ODBC-Driver-for-SQL-Server-のインストール方法" class="headerlink" title="Microsoft ODBC Driver for SQL Server のインストール方法"></a>Microsoft ODBC Driver for SQL Server のインストール方法</h1><p>以下の手順でインストールをご実施くださいませ。  </p><ol><li>以下の URL より、18.1.0 以降のバージョンの Microsoft ODBC Driver for SQL Server をダウンロードします。  </li></ol><p>Title : ODBC Driver for SQL Server のダウンロード<br>URL : <a href="https://learn.microsoft.com/ja-jp/sql/connect/odbc/download-odbc-driver-for-sql-server?view=sql-server-ver16">https://learn.microsoft.com/ja-jp/sql/connect/odbc/download-odbc-driver-for-sql-server?view=sql-server-ver16</a>  </p><ol start="2"><li>ダウンロードした「msodbcsql.msi」をダブルクリックします。  </li><li>セットアップ開始の画面が表示されたら [次へ] をクリックします。  </li><li>ライセンス条項を確認の上「同意する」にチェックを入れて [次へ] をクリックします。  </li><li>機能の選択は特に変更せず [次へ] をクリックします。  </li><li>[インストール] をクリックします。  </li><li>インストールの完了画面で [完了] をクリックしたら、インストール完了です。  </li></ol><h2 id="補足"><a href="#補足" class="headerlink" title="補足"></a>補足</h2><p>Microsoft ODBC Driver for SQL Server のインストールによる OS 再起動は発生いたしませんので、ご安心くださいませ。<br>また、サイト サーバーの役割を持つサーバーのみに SQL Server 18.1.0 以降の ODBC ドライバーをインストールすることで、ConfigMgr 2309 のバージョンアップにおける前提条件チェックに合格します。<br>ConfigMgr 2309 へのバージョンアップを実施しますと、管理ポイント等のサイト システム サーバーには必要に応じて SQL Server ODBC ドライバーがインストールされる動作となりますため、サイト サーバーの役割を持つサーバーにのみ SQL Server 18.1.0 以降の ODBC ドライバーのインストールを実施後、ConfigMgr 2309 へのバージョンアップを実施ください。  </p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。Configuration Manager サポート チームです。  &lt;/p&gt;
&lt;p&gt;Configuration Manager Current Branch 2309 のアップグレードにて Microsoft ODBC Driver for SQL </summary>
      
    
    
    
    
    <category term="MECM" scheme="https://jpmem.github.io/blog/tags/MECM/"/>
    
  </entry>
  
  <entry>
    <title>HTTPS 構成の WSUS 環境構築マニュアル</title>
    <link href="https://jpmem.github.io/blog/wsus/2023-12-07_01/"/>
    <id>https://jpmem.github.io/blog/wsus/2023-12-07_01/</id>
    <published>2023-12-06T15:00:00.000Z</published>
    <updated>2025-02-13T07:48:34.372Z</updated>
    
    <content type="html"><![CDATA[<p>[改訂履歴]<br>第 1 版 2023 年 12 月 7 日 初版リリース<br>第 2 版 2025 年 2 月 4 日 レイアウト修正、「d. HTTPS の構成」で入力するコマンド書式を修正</p><p>みなさま、こんにちは。WSUS サポート チームです。今回は、HTTPS 構成 の WSUS 構築手順についてご紹介します。HTTPS 構成とすることをご検討いただく際に是非ご一読ください。</p><hr><h2 id="HTTPS-構成の-WSUS-環境構築手順"><a href="#HTTPS-構成の-WSUS-環境構築手順" class="headerlink" title="HTTPS 構成の WSUS 環境構築手順"></a>HTTPS 構成の WSUS 環境構築手順</h2><ul><li>手順<br>a. サーバー証明書の準備<br>b. サーバー証明書のインポート<br>c. サーバー証明書のバインド<br>d. HTTPS の構成<br>e. クライアントの参照する WSUS サーバーの設定<br>f. クライアントのアクセス確認</li></ul><h3 id="a-サーバー証明書準備"><a href="#a-サーバー証明書準備" class="headerlink" title="a. サーバー証明書準備"></a>a. サーバー証明書準備</h3><p>参考として、Active Directory 証明書サービスを利用して証明書を発行することができますのでご紹介します。<br>Active Directory 証明書サービスを利用して、エンタープライズ CA を構築し、テンプレートの複製を利用することで、Active Directory 配下のクライアントが証明書の発行要求を行うことができます。  </p><p>１．Active Directoryサーバーにて、役割と機能の追加から「Active Directory 証明書サービス」を追加します。<br><a href="https://learn.microsoft.com/ja-jp/windows-server/networking/core-network-guide/cncg/server-certs/install-the-certification-authority#to-install-active-directory-certificate-services">Active Directory Certificate Services をインストールするには</a>  </p><p>２．Active Directoryサーバーにて、証明機関を開き、[証明書テンプレート]-[管理]より、[Webサーバー]を選択しテンプレートの複製を行います。<br>３．Active Directoryサーバーにて、証明機関を開き、[証明書テンプレート]より、[新規作成]を選択し[発行する証明書テンプレート]から、２．で複製した [Webサーバー] のテンプレートを選択します。<br>４．WSUS サーバーにて、証明書ストアを開き、[個人用]-[証明書] から、[すべてのタスク]―[新しい証明書の要求] を行い、３で作成した [Webサーバー] の証明書を要求します。</p><h3 id="b-サーバー証明書のインポート"><a href="#b-サーバー証明書のインポート" class="headerlink" title="b. サーバー証明書のインポート"></a>b. サーバー証明書のインポート</h3><p>使用するサーバー証明書を個人用 証明書ストア にインポートします。  </p><ol><li>WSUS サーバーで、インターネット インフォメーション サービス (IIS) マネージャを起動します。  </li><li>左ペインより、サーバー名を選択します。  </li><li>中央ペインより [サーバー証明書] を選択します。  </li><li>右ペインより [インポート] を選択します。  </li><li>証明書ファイルを選択後、パスワードを入力し、[OK] をクリックします。<br>※　WSUS サーバーの 個人用 証明書ストアに使用する証明書が既に存在する場合はこの手順の実施は不要です。</li></ol><h3 id="c-サーバー証明書のバインド"><a href="#c-サーバー証明書のバインド" class="headerlink" title="c. サーバー証明書のバインド"></a>c. サーバー証明書のバインド</h3><p>インターネットインフォメーション サービス (IIS) にて、サーバー証明書をバインドします。  </p><ol><li>インターネットインフォメーション サービス (IIS) マネージャより、[サイト] を展開し、 WSUS にて利用している Web サイト (既定 「 WSUS の管理」) を右クリックして、[バインドの編集] をクリックします。  </li><li>サイトバインドにて、8531 を選択し [編集] をクリックします。(カスタムポートをご利用の場合、ご利用の Web サイトより同様に サイトバインドにて 443 を選択します。)<br><img src="/blog/wsus/2023-12-07_01/2023-12-07_01-1.png">  </li><li> [ SSL 証明書] にて、登録したサーバー証明書を選択し、[OK] をクリックします。  </li><li>[閉じる] をクリックして [サイト バインド] ダイアログ ボックスを終了します。<br><img src="/blog/wsus/2023-12-07_01/2023-12-07_01-2.png">  </li></ol><h3 id="d-HTTPS-の構成"><a href="#d-HTTPS-の構成" class="headerlink" title="d. HTTPS の構成"></a>d. HTTPS の構成</h3><p>インターネットインフォメーション サービス ( IIS ) にて、 HTTPS を有効化します。  </p><ol><li><p>インターネットインフォメーション サービス ( IIS ) マネージャより[サイト] を展開し、 WSUS にて利用している Webサイトを展開します。  </p></li><li><p>WSUS Web サイトの下にある APIRemoting30、ClientWebService、DSSAuthWebService、ServerSyncWebService および SimpleAuthWebService の各仮想ディレクトリで、次の手順を実行します。なお、一部の Web サービス で HTTP の通信を利用する仕様の為、Web サイト全体を HTTPS 構成にすることはできませんのでご留意ください。<br>&lt; 参考情報 &gt; <a href="https://learn.microsoft.com/ja-jp/windows-server/administration/windows-server-update-services/deploy/2-configure-wsus#232-configure-the-wsus-servers-iis-web-server-to-use-ssl-for-some-connections">2.3.2. 一部の接続に SSL を使用するように WSUS サーバーの IIS Web サーバーを構成する</a><br>2-1. [機能ビュー] で [ SSL 設定] をダブルクリックします。<br>2-2. [ SSL 設定] ページで、[ SSL が必要] を選択します。<br>2-3. [操作] ウィンドウで、[適用] をクリックします。<br><img src="/blog/wsus/2023-12-07_01/2023-12-07_01-3.png">  </p></li><li><p>インターネットインフォメーション サービス ( IIS ) マネージャを閉じます。</p></li><li><p>コマンドプロンプトを管理者権限で立ち上げ 「C:\Program Files\Update Services\Tools」 フォルダに移動します。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd C:\Program Files\Update Services\Tools</span><br></pre></td></tr></table></figure></li><li><p>次のコマンドを実行します。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WSUSUtil.exe configuressl &lt;サーバー証明書のサブジェクト名で指定した WSUS サーバーの FQDN&gt;  </span><br></pre></td></tr></table></figure><p>&lt; 参考情報 &gt; <a href="https://learn.microsoft.com/ja-jp/windows-server/administration/windows-server-update-services/deploy/2-configure-wsus#233-configure-wsus-to-use-the-ssl-signing-certificate-for-its-client-connections">2.3.3. クライアント接続に SSL 署名証明書を使用するように WSUS を構成する</a>  </p></li></ol><h3 id="e-クライアントの参照する-WSUS-サーバーの設定"><a href="#e-クライアントの参照する-WSUS-サーバーの設定" class="headerlink" title="e. クライアントの参照する WSUS サーバーの設定"></a>e. クライアントの参照する WSUS サーバーの設定</h3><p>上述の a,b,c の手順にて、WSUS サーバーの HTTPS を有効化した後、クライアントが WSUS との通信において HTTPS を利用できるように構成します。下記ポリシーにて、WSUS サーバーの通信プロトコル及びポート番号をご指定ください。  </p><p>・ポリシー<br>[コンピューターの構成] - [管理用テンプレート] - [Windows コンポーネント] - [Windows Update] - [イントラネットの Microsoft 更新サービスの場所を指定する]<br>または<br>[コンピューターの構成] - [管理用テンプレート] - [Windows コンポーネント] - [Windows Update] - [Windows Server Update Service から提供される更新プログラムの管理] - [イントラネットの Microsoft 更新サービスの場所を指定する]  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">例　https://&lt; WSUS サーバーのFQDN &gt;:8531 </span><br></pre></td></tr></table></figure><p> <img src="/blog/wsus/2023-12-07_01/2023-12-07_01-4.png">  </p><h3 id="f-クライアントのアクセス確認"><a href="#f-クライアントのアクセス確認" class="headerlink" title="f. クライアントのアクセス確認"></a>f. クライアントのアクセス確認</h3><p>クライアントが HTTPS で WSUS サーバーへ通信を行えることを確認します。<br>[設定]-[Windows Update]-[更新プログラムのチェック]ボタンを押下して検出処理が完了できることをご確認ください。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;[改訂履歴]&lt;br&gt;第 1 版 2023 年 12 月 7 日 初版リリース&lt;br&gt;第 2 版 2025 年 2 月 4 日 レイアウト修正、「d. HTTPS の構成」で入力するコマンド書式を修正&lt;/p&gt;
&lt;p&gt;みなさま、こんにちは。WSUS サポート チームです。今回は</summary>
      
    
    
    
    
    <category term="WSUS" scheme="https://jpmem.github.io/blog/tags/WSUS/"/>
    
    <category term="構築マニュアル" scheme="https://jpmem.github.io/blog/tags/%E6%A7%8B%E7%AF%89%E3%83%9E%E3%83%8B%E3%83%A5%E3%82%A2%E3%83%AB/"/>
    
  </entry>
  
  <entry>
    <title>Windows 11 以降のデバイスにおいて、Windows Defender の定義ファイルや OS の更新プログラムが配布されない事象について</title>
    <link href="https://jpmem.github.io/blog/mecm/20231102_02/"/>
    <id>https://jpmem.github.io/blog/mecm/20231102_02/</id>
    <published>2023-11-01T15:00:00.000Z</published>
    <updated>2025-02-13T07:48:34.240Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。Configuration Manager サポート チームです。</p><p>特定の条件下にある Windows 11 以降のデバイスにおいて、Windows Defender の定義ファイルや OS の更新プログラムが配布されない事象についてご案内いたします。</p><h1 id="事象について"><a href="#事象について" class="headerlink" title="事象について"></a>事象について</h1><p>Windows 11 以降のデバイスにおいて、Windows Defender の定義ファイルや OS の更新プログラムが配布されないことがございます。<br>また、本事象については <a href="https://learn.microsoft.com/ja-jp/mem/configmgr/hotfix/2303/25073607">Microsoft Configuration Manager バージョン 2303 のクライアント更新プログラム</a> の公開情報でもご案内しております。</p><h1 id="発生条件について"><a href="#発生条件について" class="headerlink" title="発生条件について"></a>発生条件について</h1><ol><li><p>Windows 11 以降のデバイスである。  </p></li><li><p>2023 年の 7 月以降の累積更新プログラムが適用されている。    </p></li><li><p>以下の何れかの Windows Update に関するグループポリシー (ローカルグループポリシー) が設定されている。    </p><p>  ・[コンピューターの構成] -&gt; [管理用テンプレート] -&gt; [Windows コンポーネント] -&gt; [Windows Update] -&gt; [Windows Update から提供される更新プログラムの管理] -&gt; [品質更新プログラムをいつ受信するかを選択してください]<br>  ※構成されるレジストリは HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate : DeferQualityUpdatesPeriodInDays となります。</p><p> ・[コンピューターの構成] -&gt; [管理用テンプレート] -&gt; [Windows コンポーネント] -&gt; [Windows Update] -&gt; [Windows Update から提供される更新プログラムの管理] -&gt; [プレビュービルドや機能更新プログラムをいつ受信するかを選択してください]<br>  ※構成されるレジストリは HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate : DeferFeatureUpdatesPeriodInDays となります。</p></li></ol><h1 id="原因について"><a href="#原因について" class="headerlink" title="原因について"></a>原因について</h1><p>発生条件に当てはまるデバイスについては、Configuration Manager を利用して Windows 更新プログラムを取得するのではなく、Windows Update 経由で Windows 更新プログラムを取得する動作に変更されます。<br>これはデュアルスキャンと呼称され、Configuration Manager から Windows Defender の定義ファイルや OS の更新プログラムが配布されなくなります。<br>Configuration Manager クライアントは、既定でこのデュアル スキャンを抑止するレジストリをセットしますが、Windows 11 においては、抑止するための以下のレジストリが正しくセットされていないために、意図せずデュアルスキャンが発生します。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate\AU</span><br><span class="line">UseUpdateClassPolicySource</span><br></pre></td></tr></table></figure><h1 id="対処について"><a href="#対処について" class="headerlink" title="対処について"></a>対処について</h1><p>以下の 1 ～ 3 のいずれかの対処を行うことで、本事象は解消します。  </p><h2 id="1．Configuration-Manager-Version-2303-に-“Configuration-Manager-2303-修正プログラム-KB25506239-”-をインストールする、または-2309-にアップグレードする"><a href="#1．Configuration-Manager-Version-2303-に-“Configuration-Manager-2303-修正プログラム-KB25506239-”-をインストールする、または-2309-にアップグレードする" class="headerlink" title="1．Configuration Manager Version 2303 に “Configuration Manager 2303 修正プログラム (KB25506239)” をインストールする、または 2309 にアップグレードする"></a>1．Configuration Manager Version 2303 に “Configuration Manager 2303 修正プログラム (KB25506239)” をインストールする、または 2309 にアップグレードする</h2><p>Configuration Manager 2303 修正プログラム (KB25506239) および、Configuration Manager 2309 にはデュアルスキャンの動作を抑制するためのレジストリである UseUpdateClassPolicySource を自動で構成するための修正がされております。<br>そのため、サーバーを本バージョンにアップグレードした後、問題のクライアント端末にインストールされている Configuration Manager クライアントをアップグレードしてください。</p><p>修正プログラムのインポート方法については<a href="https://learn.microsoft.com/ja-jp/mem/configmgr/hotfix/2303/25073607#update-information-for-microsoft--configuration-manager">こちら</a>をご確認ください。</p><p>また、Configuration Manager 2309 にも本修正は含まれております。</p><h2 id="2．Windows-Update-for-Business-のグループポリシー-ローカルグループポリシー-が不要な場合、未構成にする"><a href="#2．Windows-Update-for-Business-のグループポリシー-ローカルグループポリシー-が不要な場合、未構成にする" class="headerlink" title="2．Windows Update for Business のグループポリシー (ローカルグループポリシー) が不要な場合、未構成にする"></a>2．Windows Update for Business のグループポリシー (ローカルグループポリシー) が不要な場合、未構成にする</h2><p>項番 1. の対処ができない場合は、以下のグループポリシーを未構成にすることで、デュアルスキャンの動作を抑止することができます。</p><p>. [コンピューターの構成] -&gt; [管理用テンプレート] -&gt; [Windows コンポーネント] -&gt; [Windows Update] -&gt; [Windows Update から提供される更新プログラムの管理] -&gt; [品質更新プログラムをいつ受信するかを選択してください]   </p><p>直接レジストリに設定をしている場合には以下を削除ください。<br>HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate : DeferQualityUpdatesPeriodInDays</p><p>・[コンピューターの構成] -&gt; [管理用テンプレート] -&gt; [Windows コンポーネント] -&gt; [Windows Update] -&gt; [Windows Update から提供される更新プログラムの管理] -&gt; [プレビュービルドや機能更新プログラムをいつ受信するかを選択してください]  </p><p>直接レジストリに設定をしている場合には以下を削除ください。<br>HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate : DeferFeatureUpdatesPeriodInDays</p><h2 id="3．デュアルスキャンを回避するためのレジストリを手動で追加する"><a href="#3．デュアルスキャンを回避するためのレジストリを手動で追加する" class="headerlink" title="3．デュアルスキャンを回避するためのレジストリを手動で追加する"></a>3．デュアルスキャンを回避するためのレジストリを手動で追加する</h2><p>項番 1. 項番 2. の対処ができない場合は、UseUpdateClassPolicySource を構成することにより、デュアルスキャンの動作を抑制することが可能です。本レジストリを構成した時の影響は特にございません。   </p><p>HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate\AU<br>値の名前：UseUpdateClassPolicySource<br>値のデータ：1<br>値の種類：REG_DWORD  </p><p>Configuration Manager を利用してレジストリを構成する手順については、<a href="https://jpmem.github.io/blog/mecm/20230307_01/">コンプライアンス機能で特定レジストリ値をセットする方法</a>を参照ください。<br>なお、Configuration Manager 2303 修正プログラムの適用、または Configuration Manager 2309 にアップグレードして本事象を解消した後は、本構成基準の展開は無効または削除ください。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。Configuration Manager サポート チームです。&lt;/p&gt;
&lt;p&gt;特定の条件下にある Windows 11 以降のデバイスにおいて、Windows Defender の定義ファイルや OS の更新プログラムが配布されない事象についてご案</summary>
      
    
    
    
    
    <category term="MECM" scheme="https://jpmem.github.io/blog/tags/MECM/"/>
    
  </entry>
  
  <entry>
    <title>Microsoft Configuration Manager 自習書シリーズ 2 Microsoft Configuration Manager FAQ よりライセンスについての解説</title>
    <link href="https://jpmem.github.io/blog/mecm/20230928_01/"/>
    <id>https://jpmem.github.io/blog/mecm/20230928_01/</id>
    <published>2023-09-27T15:00:00.000Z</published>
    <updated>2025-02-13T07:48:34.239Z</updated>
    
    <content type="html"><![CDATA[<p>皆様、Microsoft Configuration Manager サポート チームの箱木です。</p><p>今回は <a href="https://learn.microsoft.com/ja-jp/mem/configmgr/core/understand/configuration-manager-faq">Microsoft Configuration Manager FAQ</a> についてライセンス部分の詳細をご案内します。</p><p>なお技術サポートではお客様の契約内容を確認することができませんので、ライセンスについての消費概念や購入方法などの詳細なご質問については弊社担当営業もしくは契約担当者へお問い合わせいただくようお願いいたします。</p><p>ライセンス観点で特にお問合せをいただく内容についてご説明いたします。</p><h1 id="管理するためのサーバー（管理ポイントやソフトウェア更新ポイントなど）側にライセンスは必要ですか？"><a href="#管理するためのサーバー（管理ポイントやソフトウェア更新ポイントなど）側にライセンスは必要ですか？" class="headerlink" title="管理するためのサーバー（管理ポイントやソフトウェア更新ポイントなど）側にライセンスは必要ですか？"></a>管理するためのサーバー（管理ポイントやソフトウェア更新ポイントなど）側にライセンスは必要ですか？</h1><p>不要です。ConfigMgr は管理対象のクライアントもしくはユーザー数、OSE 数でライセンスを購入いただく必要がありますが、管理インフラストラクチャ側にはライセンスは不要です。<br>サイト データベースを構成するための SQL Server ライセンスについてもクライアント管理ライセンスに含まれます。<br>ただしこの SQL Server のライセンスは、ConfigMgr のサイト データベースとしてのみ利用いただけますため、外部連携用のアプリケーションとして SQL Server を使う場合にはその SQL インスタンスごとに別途ライセンスが必要となります。</p><h1 id="プライマリ-サイトや中央管理サイトのインストール時に求められるライセンス-キーはどこから入手できますか？"><a href="#プライマリ-サイトや中央管理サイトのインストール時に求められるライセンス-キーはどこから入手できますか？" class="headerlink" title="プライマリ サイトや中央管理サイトのインストール時に求められるライセンス キーはどこから入手できますか？"></a>プライマリ サイトや中央管理サイトのインストール時に求められるライセンス キーはどこから入手できますか？</h1><p>従来のボリューム ライセンスで契約されている場合は ConfgMgr および SQL Server ライセンスを VLSC <a href="https://www.microsoft.com/licensing/servicecenter/default.aspx">ボリューム ライセンス サービス センター</a> より入手いただけます。<br>しかしながら、最近は Intune との共同管理目的で導入されるため EMS や M365 ライセンスを保持されている状態からの ConfigMgr のインストールを始められる方が多い傾向です。</p><p>この場合、ライセンス キーは VLSC ではなくライセンスを購入されたクラウド ソリューション プロバイダー (CSP) パートナーから入手いただく必要があります。</p><p>またクラウド ソリューション プロバイダー (CSP)自身がお客様に提供するためのライセンス キーを入手する場合は技術サポートではなく、<a href="https://partner.microsoft.com/ja-JP/support/?stage=1">Microsoft パートナー センター</a> にて ID 4033838 のライセンス発行を依頼してください。</p><p>詳細については <a href="https://learn.microsoft.com/ja-jp/mem/configmgr/core/understand/product-and-licensing-faq">Configuration Manager ブランチとライセンスについてよく寄せられる質問</a> もご参照ください。</p><p>上記リンクのポイントについて抜粋します。</p><h1 id="Microsoft-Intune-製品ファミリの共同管理のライセンスに関する変更点"><a href="#Microsoft-Intune-製品ファミリの共同管理のライセンスに関する変更点" class="headerlink" title="Microsoft Intune 製品ファミリの共同管理のライセンスに関する変更点"></a>Microsoft Intune 製品ファミリの共同管理のライセンスに関する変更点</h1><blockquote><p>以前に System Center Configuration Manager に対して持っていたライセンスは、引き続き Microsoft Configuration Managerに適用されます。 新しいサイトをインストールする場合は、既存のプロダクト キーを使用してください。</p></blockquote><p>上記の通りすでに保有しているクライアント管理用のライセンスは新規環境でも再利用することができます。<br>サイト自体を新規インストールする場合には VLSC などから旧環境構築時に利用したプロダクト キーを入手いただいて利用ください。</p><p>次回は Configuration Manager のシステム設計についてご紹介する予定です。</p><h1 id="免責事項"><a href="#免責事項" class="headerlink" title="免責事項"></a>免責事項</h1><p>下記内容は 2023/9/1 時点での内容についての記載となっております。<br>今後内容が更新されることもございますので、最新情報は以下の公開情報をご確認ください。<br><a href="https://learn.microsoft.com/ja-jp/mem/configmgr/core/understand/product-and-licensing-faq">Configuration Manager ブランチとライセンスについてよく寄せられる質問</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;皆様、Microsoft Configuration Manager サポート チームの箱木です。&lt;/p&gt;
&lt;p&gt;今回は &lt;a href=&quot;https://learn.microsoft.com/ja-jp/mem/configmgr/core/understand/con</summary>
      
    
    
    
    
    <category term="MECM" scheme="https://jpmem.github.io/blog/tags/MECM/"/>
    
    <category term="自習書シリーズ" scheme="https://jpmem.github.io/blog/tags/%E8%87%AA%E7%BF%92%E6%9B%B8%E3%82%B7%E3%83%AA%E3%83%BC%E3%82%BA/"/>
    
  </entry>
  
  <entry>
    <title>suffix が cloudapp.net な CMG の仮想マシンスケールセットへの移行について</title>
    <link href="https://jpmem.github.io/blog/mecm/20230816_01/"/>
    <id>https://jpmem.github.io/blog/mecm/20230816_01/</id>
    <published>2023-08-15T15:00:00.000Z</published>
    <updated>2025-02-13T07:48:34.239Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。Configuration Manager サポート チームです。本日は、 Microsoft Configuration Manager (ConfigMgr) において、suffix が cloudapp.net である、クラウド サービス(クラシック) ベースのクラウド管理ゲートウェイ (CMG) を仮想マシンスケールセット （VMSS) の CMG に移行する方法についてご案内させて頂きます。</p><p>以前も下記記事でご案内させて頂いている通り、クライアントからアクセスする際に使われる URL (サービス名) が 展開名と同じ、 [ホスト名].cloudapp.net の CMG については VMSS の CMG への変換が利用できません。それは、VMSS への変換に伴い、展開名の URL の形式が [ホスト名].[リージョン名].cloudapp.azure.com に変わりますが、その変更をクライアント側に伝える手段が無いためです。DNS サーバーに CNAME レコードにより、お客様独自の サービス名を、[ホスト名].cloudapp.net の エイリアスとして登録されていたお客様であれば、CNAME レコードのエイリアスを変更するだけで対処が出来るのですが、それが使えないため、 VMSS 版 CMG への変換をご提供していません。</p><p>仮想マシン スケールセットのクラウド管理ゲートウェイについて<br><a href="https://jpmem.github.io/blog/mecm/20211212_01/">https://jpmem.github.io/blog/mecm/20211212_01/</a>  </p><p>そのため、サービス名を [ホスト名].cloudapp.net として設定した CMG をお使いのお客様は、VMSS 版 CMG への移行に当たって、変換ではなく、CMG の再構築を実施頂く必要がございます。</p><p>なお、上記記事でもご案内の通り、 MECM CB 2203 以降、クラウドサービス (クラシック) 版の CMG のデプロイは利用できなくなっております。 MECM CB 2203 へアップグレードする際の前提条件チェックでも警告されますが、アップグレード後も構築済みのクラウドサービス (クラシック)のご利用は可能なものの、一度でも削除すると、再デプロイできなくなるため、出来る限り早く VMSS 版の CMG への移行を推奨しております。</p><h2 id="VMSS-版-CMG-への移行にあたっての課題"><a href="#VMSS-版-CMG-への移行にあたっての課題" class="headerlink" title="VMSS 版 CMG への移行にあたっての課題"></a>VMSS 版 CMG への移行にあたっての課題</h2><p>上記でも触れたとおり、VMSS 版 CMG の利用により クライアントが CMG に繋がる際に利用する FQDN が変わるため、その変更をクライアントに伝える手段が必要となります。インターネットとイントラネット ( VPN 接続を含む)を行き来するようなご利用をされている端末であれば、イントラネットに接続した際に 新しい URL をクライアントに伝えることが出来ますが、インターネット経由でしか繋げないクライアントの場合、新しい URL が分からないため、二度と ConfgMgr へ接続出来なくなるといった課題が生じます。</p><p>また、新規構築した VMSS 版の CMG では、もちろん、移行前の CMG で配布していたコンテンツが引き継がれていないため、移行前の CMG で配布していた コンテンツ を アップロード する必要が出てきます。ConfigMgr CB 2211 以降では、<a href="https://learn.microsoft.com/ja-jp/mem/configmgr/core/servers/deploy/configure/deploy-and-manage-content#start-cmdistributionpointmigration">Start-CMDistributionPointMigration コマンドレット</a> が利用可能になりました。本記事ではこちらの コマンドレット を利用しますが、ConfigMgr CB 2207 以前の環境では利用出来ないので、旧 CMG の プロパティ から配布コンテンツ の リスト をスクリーンショット等で採取しておき、 手動で1つ1つ プライマリ サイト サーバー から配布する必要がございます。</p><h2 id="上記課題に対する対策"><a href="#上記課題に対する対策" class="headerlink" title="上記課題に対する対策"></a>上記課題に対する対策</h2><p>上記、二つの課題に対応するため、以下の対策を実施します。</p><ol><li>クラウド サービス(クラシック)版と VMSS 版 CMG を、VMSS 版 CMG の URL がクライアントに伝わるまで、並行稼働する。クライアントに伝わったかどうかはスクリプト機能を使って収集する。電源断等でスクリプトが伝わったかどうか不明なクライアントに対しては手動で設定変更させる。</li><li>Start-CMDistributionMigration コマンドレットを使う。</li></ol><h3 id="必要なコスト"><a href="#必要なコスト" class="headerlink" title="必要なコスト"></a>必要なコスト</h3><p>上記対応策では、二つの CMG を並行稼働させるため、並行稼働期間中、クラウド管理ゲートウェイのコストが約 2 倍となります。また、それぞれの CMG からの通信を中継するため、クラウド管理ゲートウェイ接続ポイント (CMG-CP) が動作するサーバーを追加で用意する必要がございます。（2 個の CMG からの通信を 1 つの CMG-CP では中継できません。それぞれの CMG 用の CMG-CP を用意する必要がございます)</p><h3 id="実施手順"><a href="#実施手順" class="headerlink" title="実施手順"></a>実施手順</h3><ol><li><p>VMSS 版 CMG とその通信を中継する CMG-CP を作成します。以下でご案内している手順をご参考にしていただければと存じます。<br>クラウド管理ゲートウェイ (CMG) の構築手順例<br><a href="https://jpmem.github.io/blog/mecm/20220501_01/">https://jpmem.github.io/blog/mecm/20220501_01/</a>  </p></li><li><p>[ConfigMgrコンソール] - 画面左上の下▼ボタンをクリック - [Windows PowerShell で接続する]をクリックします。<br><img src="/blog/mecm/20230816_01/20230816_01_03.png"></p></li><li><p>Start-CMDistributionMigration コマンドレットで以下を実行します。</p></li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Start-CMDistributionPointMigration -SourceDistributionPointName [旧クラウド管理ゲートウェイのFQDN] -DestinationDistributionPointName [新クラウド管理ゲートウェイのFQDN]</span><br></pre></td></tr></table></figure><ol start="4"><li>実行後、以下を実行し複製状況を確認します。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Get-CMDistributionPointMigrationContentStatus -SourceDistributionPointName [旧クラウド管理ゲートウェイのFQDN] -DestinationDistributionPointName [新クラウド管理ゲートウェイのFQDN]</span><br></pre></td></tr></table></figure></li></ol><p>実行中は以下のように進行状態が表示されます。<br><img src="/blog/mecm/20230816_01/20230816_01_01.png"></p><p>実行が完了すると何も表示されなくなります。<br><img src="/blog/mecm/20230816_01/20230816_01_02.png"></p><ol start="5"><li>スクリプト機能を使って、以下のスクリプトにより新規に作成した VMSS 版 CMG の情報がクライアント側に伝わっているかを定期的に確認します。以下のスクリプトを実行すると、クライアントに伝わっている CMG の FQDN が ;(セミコロン) を区切り文字として取得可能です。</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$RegPath = &quot;HKLM:\SOFTWARE\Microsoft\CCM\&quot;</span><br><span class="line">$RegKey  = &quot;CMGFQDNs&quot;</span><br><span class="line"></span><br><span class="line">$cmgfqdns = Get-ItemPropertyValue $RegPath -Name $RegKey</span><br><span class="line"></span><br><span class="line">if($null -ne $cmgfqdns)&#123;</span><br><span class="line">    Write-Host $cmgfqdns</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    Write-Host &quot;No CMG&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>スクリプト機能のご紹介<br><a href="https://jpmem.github.io/blog/mecm/20211025_01/">https://jpmem.github.io/blog/mecm/20211025_01/</a>  </p><ol start="6"><li>クライアント側に十分に VMSS 版 CMG の情報が伝わったら、クラウド サービス(クラシック)側の CMG を削除します。</li><li>電源断等で FQDN 情報が伝わらなかったクライアントに対しては別途、イントラ内管理ポイントに接続させるか、ccmsetup による ConfigMgr クライアント再インストールで対応します。ccmsetup で VMSS 版 CMG の FQDN を設定するには、 CCMHOSTNAME オプションを使用します。以下、コマンドの例です。</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ccmsetup.exe /NoCRLCheck /mp:[CMGのFQDN ]SMSMP=[イントラの管理ポイント] CCMHOSTNAME=[CMGのFQDN] SMSSITECODE=[サイトコード]</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。Configuration Manager サポート チームです。本日は、 Microsoft Configuration Manager (ConfigMgr) において、suffix が cloudapp.net である、クラウド サービス(クラシ</summary>
      
    
    
    
    
    <category term="MECM" scheme="https://jpmem.github.io/blog/tags/MECM/"/>
    
    <category term="CMG" scheme="https://jpmem.github.io/blog/tags/CMG/"/>
    
  </entry>
  
  <entry>
    <title>リモート配布ポイントへ コンテンツ が配布出来ないときの トラブルシューティング</title>
    <link href="https://jpmem.github.io/blog/mecm/20230813_01/"/>
    <id>https://jpmem.github.io/blog/mecm/20230813_01/</id>
    <published>2023-08-12T15:00:00.000Z</published>
    <updated>2025-02-13T07:48:34.233Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。Configuration Manager サポート チームです。本日は、 Microsoft Configuration Manager (ConfigMgr) において、リモート配布ポイントへ コンテンツ を配布出来ないときの トラブルシューティング についてご案内致します。配布ポイントに対して コンテンツ が配布出来ないとき、以下の項目をまずご確認くださいますようお願い致します。</p><p>サイト サーバー から コンテンツ を配布する際に、リモート配布ポイントとの通信が必要ですが、その際に使われる プロトコル は RPC と SMB です。この二つが使われていることを意識していると トラブルシューティング がやりやすくなります。また、これらの プロトコル を扱う際の権限は、既定の設定だと サイトサーバー の コンピューター アカウント 権限が使われます。</p><ul><li>利用される プロトコル<ul><li>RPC</li><li>SMB</li></ul></li><li>プロトコル で使われる アカウント<ul><li>(既定の場合) サイト サーバー の コンピューター アカウント</li></ul></li></ul><h1 id="コンテンツ-転送の流れ"><a href="#コンテンツ-転送の流れ" class="headerlink" title="コンテンツ 転送の流れ"></a>コンテンツ 転送の流れ</h1><p>サイト サーバーから コンテンツ を リモート配布ポイント へ配布する際の コンテンツ の流れは以下の通りです。各 フォルダ に コンテンツ を格納するための十分な容量が必要です。</p><h2 id="アプリケーション、パッケージ、オペレーティングシステムイメージ、アップグレードイメージ、ブートイメージ"><a href="#アプリケーション、パッケージ、オペレーティングシステムイメージ、アップグレードイメージ、ブートイメージ" class="headerlink" title="アプリケーション、パッケージ、オペレーティングシステムイメージ、アップグレードイメージ、ブートイメージ"></a>アプリケーション、パッケージ、オペレーティングシステムイメージ、アップグレードイメージ、ブートイメージ</h2><p>ソース 共有 フォルダ -&gt; サイト サーバー の SCCMContentLib フォルダ -&gt; リモート 配布ポイントの SCCMContentLib フォルダ</p><p><img src="/blog/mecm/20230813_01/20230813_01_02.png"></p><h2 id="更新プログラム-（自動展開規則でのダウンロードも含む"><a href="#更新プログラム-（自動展開規則でのダウンロードも含む" class="headerlink" title="更新プログラム　（自動展開規則でのダウンロードも含む)"></a>更新プログラム　（自動展開規則でのダウンロードも含む)</h2><p>OS の TEMP フォルダ -&gt; ソース 共有 フォルダ -&gt; サイト サーバーの SCCMContentLib フォルダ -&gt;　リモート 配布ポイント の SCCMContentLib フォルダ</p><p><img src="/blog/mecm/20230813_01/20230813_01_03.png"></p><h1 id="エラーが出力されるログ"><a href="#エラーが出力されるログ" class="headerlink" title="エラーが出力されるログ"></a>エラーが出力されるログ</h1><p>コンテンツ 転送時に エラー が出力されるログは以下の通りです。プライマリサイトサーバーの [ConfigMgrのインストールフォルダ]\Logs\ フォルダを確認ください。</p><ul><li>distmgr.log</li><li>PkgXferMgr.log</li><li>PatchDownloader.log</li></ul><h1 id="チェック-リスト"><a href="#チェック-リスト" class="headerlink" title="チェック リスト"></a>チェック リスト</h1><p>上記を含め、確認すべき点は以下の通りです。</p><ul><li>時刻同期</li><li>プライマリサイトサーバー、リモート配布ポイントの更新プログラム適用状況</li><li>セキュリティ ソフトの設定</li><li>名前解決可否</li><li>通信 ポート の開放状況</li><li>格納 フォルダ の容量</li><li>SMB の利用可否</li><li>RPC の利用可否</li><li>アクセス権限</li><li>WMI の動作確認</li></ul><h2 id="時刻同期"><a href="#時刻同期" class="headerlink" title="時刻同期"></a>時刻同期</h2><p>プライマリサイトサーバー と リモート配布ポイント で時刻ズレがあると RPC 通信に失敗します。時刻ズレが発生していないか確認してください。また、両 サーバー にて NTP サービス が正しく動作していることを確認してください。</p><h2 id="プライマリサイトサーバー、リモート配布ポイントの更新プログラム適用状況"><a href="#プライマリサイトサーバー、リモート配布ポイントの更新プログラム適用状況" class="headerlink" title="プライマリサイトサーバー、リモート配布ポイントの更新プログラム適用状況"></a>プライマリサイトサーバー、リモート配布ポイントの更新プログラム適用状況</h2><p>DCOM 脆弱性 (CVE-2021-26414) に対応するため、DCOM　認証レベルが強化されるようになっています。</p><p>[IT管理者向け] DCOM の脆弱性 (CVE-2021-26414) に対応するためのガイダンス<br><a href="https://msrc.microsoft.com/blog/2021/06/20210609_dcomenrocement/">https://msrc.microsoft.com/blog/2021/06/20210609_dcomenrocement/</a></p><p>プライマリサイトサイトサーバー および リモート配布ポイント に 2023 年 3 月以降の OS 累積品質更新プログラムが適用されていることを確認してください。</p><h2 id="セキュリティ-ソフトの設定"><a href="#セキュリティ-ソフトの設定" class="headerlink" title="セキュリティ ソフトの設定"></a>セキュリティ ソフトの設定</h2><p>セキュリティ　ソフトをご利用の場合、以下をご確認頂き、サイト サーバー、リモート配布ポイントの各種フォルダの除外設定が正しく実施されているかご確認ください。</p><p>Configuration Manager サイト サーバー、サイト システム、クライアントに推奨されるウイルス対策の除外<br><a href="https://learn.microsoft.com/ja-jp/troubleshoot/mem/configmgr/endpoint-protection/recommended-antivirus-exclusions">https://learn.microsoft.com/ja-jp/troubleshoot/mem/configmgr/endpoint-protection/recommended-antivirus-exclusions</a></p><h2 id="名前解決可否"><a href="#名前解決可否" class="headerlink" title="名前解決可否"></a>名前解決可否</h2><p>サイト サーバーにて nslookup コマンド を使って リモート配布ポイント を名前解決できるか確認ください。</p><h2 id="通信-ポート-の開放状況"><a href="#通信-ポート-の開放状況" class="headerlink" title="通信 ポート の開放状況"></a>通信 ポート の開放状況</h2><p>サイトサーバー と リモート配布ポイント の通信ポート は以下の図の通りです。経路上正しく開放設定がなされているかご確認ください。確認には弊社 PortQry 等をご利用いただくのが良いかと存じます。</p><p><img src="/blog/mecm/20230813_01/20230813_01_01.png"></p><p>PortQryUI - User Interface for the PortQry Command Line Port Scanner<br><a href="https://www.microsoft.com/en-us/download/details.aspx?id=24009">https://www.microsoft.com/en-us/download/details.aspx?id=24009</a> </p><h2 id="格納-フォルダの容量"><a href="#格納-フォルダの容量" class="headerlink" title="格納 フォルダの容量"></a>格納 フォルダの容量</h2><p>格納 フォルダ が含まれる フォルダ 容量に十分な空き容量があるか確認ください。</p><p>確認すべき ドライブ は以下の通りです。</p><ul><li>OS ドライブ (更新 プログラム の場合)</li><li>ソース 共有 フォルダ のドライブ</li><li>サイト サーバー の SCCMContentLib フォルダ の ドライブ</li><li>リモート 配布ポイントの SCCMContentLib フォルダ の ドライブ</li></ul><h2 id="SMB-の利用可否"><a href="#SMB-の利用可否" class="headerlink" title="SMB の利用可否"></a>SMB の利用可否</h2><p>Powershell で　Get-SmbShare コマンドレットを使って サイト サーバー 及び リモート配布ポイントの 共有 フォルダ設定をご確認ください。</p><ul><li>サイト サーバー: ソース共有フォルダが共有できているか</li><li>リモート 配布ポイント 以下の共有フォルダが設定されているか<ul><li>ADMIN$</li><li>SCCMContentLib$</li><li>SMS_DP$</li><li>SMSPKG&lt;ドライブ名&gt;$</li><li>SMSSIG$</li></ul></li></ul><h2 id="RPC-の利用可否"><a href="#RPC-の利用可否" class="headerlink" title="RPC の利用可否"></a>RPC の利用可否</h2><p>RPC を利用出来る状況か確認ください。</p><h3 id="DCOM-の設定確認"><a href="#DCOM-の設定確認" class="headerlink" title="DCOM の設定確認"></a>DCOM の設定確認</h3><ol><li>[ファイル名を指定して実行] より [dcomcnfg] を開きます。</li><li>[コンソール ルート] - [コンポーネント サービス] - [コンピューター] - [マイ コンピューター] を右クリックして [プロパティ] を開きます。</li><li>[このコンピューター上で分散 COM を有効にする] にチェックが入っていることを確認します。<br><img src="/blog/mecm/20230813_01/20230813_01_04.png"></li></ol><h3 id="RPC-関連サービスの動作確認"><a href="#RPC-関連サービスの動作確認" class="headerlink" title="RPC 関連サービスの動作確認"></a>RPC 関連サービスの動作確認</h3><ol><li>[ファイル名を指定して実行] より [services.msc] を開きます。</li><li>以下の サービス の状態が [実行中] かつ スタートアップの種類が[自動]　であることを確認します。</li></ol><ul><li>DCOM Server Process Launcher</li><li>Remote Procedure Call (RPC)</li><li>RPC Endpoint Mapper</li></ul><h2 id="アクセス権限"><a href="#アクセス権限" class="headerlink" title="アクセス権限"></a>アクセス権限</h2><p>デフォルト　である　サイト サーバー　の コンピューターアカウント に 各種 アクセス 権限があることを確認します。</p><h3 id="サイト-システム-アクセス-に使われる-アカウント-の確認"><a href="#サイト-システム-アクセス-に使われる-アカウント-の確認" class="headerlink" title="サイト システム アクセス に使われる アカウント の確認"></a>サイト システム アクセス に使われる アカウント の確認</h3><ol><li>[ConfigMgr コンソール] - [監視] - [管理] - [概要] - [サイトの構成] - [サーバー と サイト システム の役割] を開きます。</li><li>リモート 配布ポイント の動作する サイト システム を選択します。</li><li>画面下部の [サイト システム] を選択し、[プロパティ] を開きます。</li><li>[全般] タブ にて、サイト システムのインストール アカウント に、[サイト サーバーのコンピューター アカウントを使用してこのサイト システムをインストールする] にチェックが入っていることを確認します。<br><img src="/blog/mecm/20230813_01/20230813_01_05.png"></li></ol><h3 id="ソース共有フォルダ-の-アクセス-権限の確認"><a href="#ソース共有フォルダ-の-アクセス-権限の確認" class="headerlink" title="ソース共有フォルダ の アクセス 権限の確認"></a>ソース共有フォルダ の アクセス 権限の確認</h3><p>ソース共有フォルダ に サイト サーバー の　コンピューター　アカウントの読み込み権限があるか確認してください。</p><ol><li>エクスプローラー でソース共有フォルダの プロパティ を開きます。</li><li>[共有]タブを開き、[詳細な共有] を開きます。<br><img src="/blog/mecm/20230813_01/20230813_01_06.png"></li><li>[アクセス許可] を開き、サイト サーバー のコンピューター アカウントのアクセス権限を確認します。ユーザーグループが指定されている場合は、そのユーザーグループにサイト サーバーのコンピューター アカウントが所属しているか確認してください。<br><img src="/blog/mecm/20230813_01/20230813_01_07.png"></li></ol><h3 id="サイト-サーバーの-SCCMContentLib-フォルダの-アクセス-権限の確認"><a href="#サイト-サーバーの-SCCMContentLib-フォルダの-アクセス-権限の確認" class="headerlink" title="サイト サーバーの SCCMContentLib フォルダの アクセス 権限の確認"></a>サイト サーバーの SCCMContentLib フォルダの アクセス 権限の確認</h3><p>上記と同様に サイト サーバー の SCCMContentLib フォルダに対して　コンピューター アカウント に読み書き権限があるか確認してください。</p><h3 id="リモート配布ポイント-の-SCCMContentLib-フォルダの-アクセス-権限の確認"><a href="#リモート配布ポイント-の-SCCMContentLib-フォルダの-アクセス-権限の確認" class="headerlink" title="リモート配布ポイント の SCCMContentLib フォルダの アクセス 権限の確認"></a>リモート配布ポイント の SCCMContentLib フォルダの アクセス 権限の確認</h3><p>上記と同様に リモート配布ポイント の SCCMContentLib フォルダに対して　サイト サーバー の コンピューター アカウント に読み書き権限があるか確認してください。</p><h3 id="リモート配布ポイント-の-WMI-のアクセス権限の確認"><a href="#リモート配布ポイント-の-WMI-のアクセス権限の確認" class="headerlink" title="リモート配布ポイント の WMI のアクセス権限の確認"></a>リモート配布ポイント の WMI のアクセス権限の確認</h3><p>リモート配布ポイント に対して サイト サーバー のコンピューター アカウント　がアクセス権限を持っているか確認します。</p><ol><li>リモート配布ポイント に ログイン します。</li><li>[ファイル名を指定して実行] より [ wmimgmt.msc ] を開きます。</li><li>[WMI コントロール (ローカル)] を右クリックして [プロパティ] を開きます。<br><img src="/blog/mecm/20230813_01/20230813_01_08.png"></li><li>[セキュリティ] タブを開き、[Root] が選択されている状態で [セキュリティ] を開きます。<br><img src="/blog/mecm/20230813_01/20230813_01_09.png"></li><li>サイト サーバー のコンピューター アカウントのアクセス権限を確認します。ユーザーグループが指定されている場合は、そのユーザーグループにサイト サーバーのコンピューター アカウントが所属しているか確認してください。</li></ol><h2 id="WMI-の動作確認"><a href="#WMI-の動作確認" class="headerlink" title="WMI の動作確認"></a>WMI の動作確認</h2><p>WMI が正しく動作しているか確認するため、以下を確認ください。</p><h3 id="リモート配布ポイント-での動作確認"><a href="#リモート配布ポイント-での動作確認" class="headerlink" title="リモート配布ポイント での動作確認"></a>リモート配布ポイント での動作確認</h3><ol><li>リモート 配布ポイントに管理者権限でログインします。</li><li> PSExec ツールを以下 サイト より ダウンロード します。<br><a href="https://learn.microsoft.com/ja-jp/sysinternals/downloads/psexec">https://learn.microsoft.com/ja-jp/sysinternals/downloads/psexec</a></li><li>ダウンロード 後、解凍し適当な フォルダ に配置します。</li><li>コマンド プロンプト を管理者権限で開き、カレント フォルダ を PSExec ツール を置いた フォルダ に移動します。</li><li>以下のコマンドを実行します。  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PSExec64.exe -i -s -d cmd</span><br></pre></td></tr></table></figure></li></ol><p><img src="/blog/mecm/20230813_01/20230813_01_10.png">  </p><p>  ※ EULA のダイアログが開いた場合は OK をクリックし、再度上記 コマンド を実行してください。  </p><ol start="6"><li>コマンドプロンプト のウィンドウが新たに開きます。</li><li>以下のコマンドを実行し、コマンドプロンプト の実行権限が nt authority\system となっていることを確認ください。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">whoami</span><br></pre></td></tr></table></figure><img src="/blog/mecm/20230813_01/20230813_01_11.png">  </li><li>新たに開いた コマンドプロンプト で 以下を実行します。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wbemtest</span><br></pre></td></tr></table></figure></li><li>[Windows Management Instrumentation テスト]が開きます。 [接続]をクリックします。<br><img src="/blog/mecm/20230813_01/20230813_01_12.png"> </li><li>[名前空間] に [root\SCCMDP] と入力し、[接続]をクリックします。<br><img src="/blog/mecm/20230813_01/20230813_01_13.png">  </li><li>以下のように名前空間の箇所に [root\SCCMDP] とエラー無く表示されれば OK です。<br><img src="/blog/mecm/20230813_01/20230813_01_14.png">  </li></ol><h3 id="プライマリ-サイト-サーバー-での動作確認"><a href="#プライマリ-サイト-サーバー-での動作確認" class="headerlink" title="プライマリ サイト サーバー での動作確認"></a>プライマリ サイト サーバー での動作確認</h3><ol><li>プライマリ サイト サーバー に管理者権限でログインします。</li><li> PSExec ツールを以下 サイト より ダウンロード します。<br><a href="https://learn.microsoft.com/ja-jp/sysinternals/downloads/psexec">https://learn.microsoft.com/ja-jp/sysinternals/downloads/psexec</a></li><li>ダウンロード 後、解凍し適当な フォルダ に配置します。</li><li>コマンド プロンプト を管理者権限で開き、カレント フォルダ を PSExec ツール を置いた フォルダ に移動します。</li><li>以下のコマンドを実行します。  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PSExec64.exe -i -s -d cmd</span><br></pre></td></tr></table></figure></li></ol><p><img src="/blog/mecm/20230813_01/20230813_01_10.png">  </p><p>  ※ EULA のダイアログが開いた場合は OK をクリックし、再度上記 コマンド を実行してください。  </p><ol start="6"><li>コマンドプロンプト のウィンドウが新たに開きます。</li><li>以下のコマンドを実行し、コマンドプロンプト の実行権限が nt authority\system となっていることを確認ください。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">whoami</span><br></pre></td></tr></table></figure><img src="/blog/mecm/20230813_01/20230813_01_11.png">  </li><li>新たに開いた コマンドプロンプト で 以下を実行します。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wbemtest</span><br></pre></td></tr></table></figure></li><li>[Windows Management Instrumentation テスト]が開きます。 [接続]をクリックします。<br><img src="/blog/mecm/20230813_01/20230813_01_12.png">  </li><li>[名前空間] に [\[配布ポイントのFQDN]\root\SCCMDP] と入力し、[接続]をクリックします。<br><img src="/blog/mecm/20230813_01/20230813_01_15.png">  </li><li>以下のように名前空間の箇所に [\[配布ポイントのFQDN]\root\SCCMDP] とエラー無く表示されれば OK です。<br><img src="/blog/mecm/20230813_01/20230813_01_16.png">  </li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。Configuration Manager サポート チームです。本日は、 Microsoft Configuration Manager (ConfigMgr) において、リモート配布ポイントへ コンテンツ を配布出来ないときの トラブルシューティン</summary>
      
    
    
    
    
    <category term="MECM" scheme="https://jpmem.github.io/blog/tags/MECM/"/>
    
  </entry>
  
  <entry>
    <title>Microsoft Update カタログから更新プログラムをインポートする手順が変更されました</title>
    <link href="https://jpmem.github.io/blog/wsus/2023-07-27_01/"/>
    <id>https://jpmem.github.io/blog/wsus/2023-07-27_01/</id>
    <published>2023-07-26T15:00:00.000Z</published>
    <updated>2025-02-13T07:48:34.371Z</updated>
    
    <content type="html"><![CDATA[<p><strong>2023/07/27 初版公開</strong><br><strong>2024/05/09 更新</strong><br><strong>- スクリプト エラーとなった際の対処策を追記しました。</strong>  </p><p>みなさん、こんにちは。WSUS サポート チームです。  </p><p>これまで WSUS コンソールから更新プログラムをインポートする方法がありましたが、使用機能の ActiveX が非推奨になったことから、ActiveX を介さず PowerShell を使用してインポートする方法をご紹介します。</p><h1 id="手順"><a href="#手順" class="headerlink" title="手順"></a>手順</h1><ol><li>以下の公開情報に記載されているスクリプトをコピーし拡張子.ps1として、 WSUS サーバーへ保存します。</li></ol><p>Title : Import updates into WSUS using PowerShell<br>URL : <a href="https://learn.microsoft.com/en-us/windows-server/administration/windows-server-update-services/manage/wsus-and-the-catalog-site?branch=pr-4097#powershell-script-to-import-updates-into-wsus">https://learn.microsoft.com/en-us/windows-server/administration/windows-server-update-services/manage/wsus-and-the-catalog-site?branch=pr-4097#powershell-script-to-import-updates-into-wsus</a></p><ol start="2"><li><p>Microsoft Update カタログ サイトをブラウザーで開きます。<br><a href="https://catalog.update.microsoft.com/">https://catalog.update.microsoft.com</a></p></li><li><p>WSUS にインポートする更新プログラムを検索します。   </p></li><li><p>対象の更新プログラムをクリックします。  </p></li><li><p>開いた詳細ページで UpdateID をコピーします。<br><img src="/blog/wsus/2023-07-27_01/2.png" alt="image.png"></p></li><li><p>管理者として PowerShell コンソールを開きスクリプトの配置パスまで移動させ、ドキュメントに記載されている構文を使用してスクリプトを実行します。<br>例　.\ImportUpdateToWSUS.ps1 -UpdateId &lt;コピーした UpdateID&gt;<br><img src="/blog/wsus/2023-07-27_01/3.png" alt="image.png">  </p></li></ol><p>手順は以上です。  </p><p>上記の手順は、米国エンジニアが公開した以下ブログを参考にしています。日本語に訳してご紹介します。</p><p>Title : Importing updates into WSUS is changing<br>URL : <a href="https://techcommunity.microsoft.com/t5/windows-it-pro-blog/importing-updates-into-wsus-is-changing/ba-p/3882937">https://techcommunity.microsoft.com/t5/windows-it-pro-blog/importing-updates-into-wsus-is-changing/ba-p/3882937</a>  </p><p>なお、スクリプト実行時にエラーとなった場合は、手順 1. にてご案内いたしましたスクリプトの “.NOTES” に記載の手順をご実施ください。<br>こちらを実施後も事象に変化が見られない場合は、弊社サポートへのお問い合わせをご検討いただけますと幸いです。  </p><hr><p>Windows Server Update Services（WSUS）を使用してデバイスを更新する場合、更新プログラムのインポート手順が変更されました。更新プログラムのインポートには、新しいPowerShellスクリプトを使用します。デバイスを定期的に更新し、可能な限り安全な方法で更新を行うことで、組織のデバイスの保護がさらに強化されます。その方法を見てみましょう！</p><h1 id="更新プログラムを-WSUS-にインポートする古い手順"><a href="#更新プログラムを-WSUS-にインポートする古い手順" class="headerlink" title="更新プログラムを WSUS にインポートする古い手順"></a>更新プログラムを WSUS にインポートする古い手順</h1><p>これまで、WSUSには Microsoft Update カタログ サイトから更新プログラムをインポートするオプションがありました。このオプションは WSUS 管理コンソール上の <strong>更新プログラム</strong> &gt; <strong>操作</strong> ペインにあります。</p><p><img src="/blog/wsus/2023-07-27_01/1.png" alt="image.png"><br>[更新のインポート] オプションは、WSUS 管理コンソールの [更新プログラム] &gt; [操作] ペインにあります。</p><p>このユーザー インターフェイスの動作が変更されています。<strong>更新プログラムのインポート機能</strong> は、ActiveXを使用して構築されていましたが、現在は非推奨となっています。デバイスを最新の状態に保つための新しく優れた方法が利用できるようになりました！</p><h1 id="更新プログラムを-WSUS-にインポートする新しい手順"><a href="#更新プログラムを-WSUS-にインポートする新しい手順" class="headerlink" title="更新プログラムを WSUS にインポートする新しい手順"></a>更新プログラムを WSUS にインポートする新しい手順</h1><p>新しい PowerShell スクリプトは、WSUS 内のインポート機能を置き換えるものです。このスクリプトを使用して更新プログラムをダウンロードし、WSUS サーバーにインポートします。</p><p>この新しいスクリプトを取得するには、2つの方法があります：</p><p>a. WSUS 管理コンソールで通常の手順に従ってください： <strong>更新プログラム</strong> &gt; <strong>操作</strong> をクリックすると、スクリプトを含むドキュメントにリダイレクトされます。<br>b. 直接、公開情報「WSUS とカタログ サイト」にアクセスし、PowerShell スクリプトを入手します。</p><p>スクリプトをコピーしたら、PowerShell を使用して WSUS にアップデートをインポートする一連の手順を実行します。簡単に説明すると、以下のようになります：</p><ol><li>スクリプトを保存します。</li><li>Web ブラウザで Microsoft Update カタログ サイトを開きます。</li><li>WSUS にインポートする更新プログラムを検索します。</li><li>表示された一覧から、目的の更新プログラムを選択します。</li><li>開いた詳細ページの UpdateID をコピーします。<br>注: 複数の更新プログラムをインポートする場合は、UpdateID をそれぞれ別の行に記述したテキストファイルを作成します。</li><li>更新プログラムをインポートするには、PowerShell コンソールを管理者として開き、ドキュメントに記載されている構文でスクリプトを実行します。</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">注意:</span><br><span class="line">インポートされた更新プログラムのファイルは、インポート時にはダウンロードされません。更新プログラムのファイルの設定を確認し、ダウンロードされるタイミングを確認または変更してください。</span><br></pre></td></tr></table></figure><p>更新プログラムのインポートに関する完全で最新のガイダンスについては、WSUS および Microsoft Update カタログのページを引き続き確認してください。このページには、スクリプト、構文、および役立つ例が掲載されています。</p><p>もし情報が足りないと感じたら、以下のリソースをご覧ください：<br><a href="https://learn.microsoft.com/ja-jp/windows-server/administration/windows-server-update-services/manage/wsus-and-the-catalog-site">WSUS とカタログ サイト</a><br><a href="https://www.catalog.update.microsoft.com/Home.aspx">Microsoft Update Catalog</a><br><a href="https://learn.microsoft.com/ja-jp/cpp/mfc/activex-controls?view=msvc-170">ActiveX コントロール</a>  </p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;strong&gt;2023/07/27 初版公開&lt;/strong&gt;&lt;br&gt;&lt;strong&gt;2024/05/09 更新&lt;/strong&gt;&lt;br&gt;&lt;strong&gt;- スクリプト エラーとなった際の対処策を追記しました。&lt;/strong&gt;  &lt;/p&gt;
&lt;p&gt;みなさん、こんにちは。W</summary>
      
    
    
    
    
    <category term="WSUS" scheme="https://jpmem.github.io/blog/tags/WSUS/"/>
    
  </entry>
  
  <entry>
    <title>Configuration Manager ベーシック ナレッジ シリーズ 1 - Configuration Manager から展開できる機能のご紹介</title>
    <link href="https://jpmem.github.io/blog/mecm/20230720_01/"/>
    <id>https://jpmem.github.io/blog/mecm/20230720_01/</id>
    <published>2023-07-19T15:00:00.000Z</published>
    <updated>2025-02-13T07:48:34.233Z</updated>
    
    <content type="html"><![CDATA[<p>みなさま、こんにちは。Configuration Manager サポート チーム 山田 です。  </p><p>本ブログの連載企画として Microsoft Configuration Manager の基本的なナレッジを、これから管理者となる方や導入を検討されている方向けに分かり易くご紹介いたします。<br>今回は、Configuration Manager から展開できる、ソフトウェア更新プログラム、パッケージ、アプリケーション、タスクシーケンスの機能についてご紹介いたします。<br>各機能の概要についてお伝えさせていただきますので、少しでも多く Configuration Manager の機能をご利用いただけたら幸いです。  </p><p>各機能を項目に分けて記載させていただきます。  </p><ul><li>ソフトウェア更新プログラム  </li><li>パッケージ  </li><li>アプリケーション  </li><li>タスクシーケンス  </li></ul><h3 id="ソフトウェア更新プログラム"><a href="#ソフトウェア更新プログラム" class="headerlink" title="ソフトウェア更新プログラム"></a>ソフトウェア更新プログラム</h3><p>OS をアップグレードする機能更新プログラムや品質更新プログラム、Microsoft Defender ウイルス対策のセキュリティ インテリジェンス更新プログラム、Microsoft 365 Apps の更新プログラムなどを展開できる機能です。  </p><p>Title : Configuration Managerのソフトウェア更新プログラムの概要<br>URL : <a href="https://learn.microsoft.com/ja-jp/mem/configmgr/sum/understand/software-updates-introduction">https://learn.microsoft.com/ja-jp/mem/configmgr/sum/understand/software-updates-introduction</a>  </p><p>手動で展開することできますが、あらかじめ規則を設定しておき、自動で展開することも可能です。  </p><p>参考ブログ<br><a href="https://jpmem.github.io/blog/mecm/20220706_01/">MECM 自動展開規則</a>  </p><p>どの更新プログラムも基本的には以下のフローで動作します。  </p><ol><li>ソフトウェア更新ポイント（WSUS）が Microsoft Update カタログと同期  </li><li>Configuration Manager で更新プログラムを展開  </li><li>プライマリ サイト サーバーが Microsoft Update カタログから更新プログラムをダウンロード  </li><li>プライマリ サイト サーバーから配布ポイントへ更新プログラムを配布  </li><li>Configuration Manager クライアントが配布ポイントから更新プログラムをダウンロード  </li><li>Configuration Manager クライアントが更新プログラムをインストール  </li></ol><h3 id="パッケージ"><a href="#パッケージ" class="headerlink" title="パッケージ"></a>パッケージ</h3><p>exe や ps1、bat ファイルなどをクライアントに展開できる機能です。  </p><p>Title : Configuration Managerのパッケージとプログラム<br>URL : <a href="https://learn.microsoft.com/ja-jp/mem/configmgr/apps/deploy-use/packages-and-programs">https://learn.microsoft.com/ja-jp/mem/configmgr/apps/deploy-use/packages-and-programs</a>  </p><p>そのため、お客様にて作成したスクリプトを複数のクライアントや全台に対して展開したいなどの場合、Configuration Manager の本機能をご使用いただくことで実現できます。<br>実現可能なサンプル例を以下に記載いたします。  </p><h5 id="例-1"><a href="#例-1" class="headerlink" title="例 1"></a>例 1</h5><p>クライアントはインターネット接続ができない環境のため、Microsoft ストア アプリや言語パックを展開したい。  </p><h5 id="例-2"><a href="#例-2" class="headerlink" title="例 2"></a>例 2</h5><p>緊急で Defender の定義ファイル（exe ファイル）をパッケージで展開したい。  </p><h5 id="例-3"><a href="#例-3" class="headerlink" title="例 3"></a>例 3</h5><p>特定のレジストリを変更するコマンドを展開したい。  </p><p>もしパッケージ展開がうまくいかない場合、以下のブログもご参照ください。<br><a href="https://jpmem.github.io/blog/mecm/20220125_01/">パッケージの展開が失敗した時に確認したいポイント ~ sysnative 編 ~</a>  </p><h3 id="アプリケーション"><a href="#アプリケーション" class="headerlink" title="アプリケーション"></a>アプリケーション</h3><p>主に msi や appx、appxbundle ファイルなどを展開する際に使用する機能です。  </p><p>Title : Configuration Managerを使用してアプリケーションを作成してデプロイする<br>URL : <a href="https://learn.microsoft.com/ja-jp/mem/configmgr/apps/get-started/create-and-deploy-an-application">https://learn.microsoft.com/ja-jp/mem/configmgr/apps/get-started/create-and-deploy-an-application</a>  </p><p>アプリケーションを作成時、システム用にインストールするか、ユーザー用にインストールするかを設定できます。  </p><p>システム用にインストール　→　SYSTEM アカウント権限でインストールが実行<br>ユーザー用にインストール　→　ログオンしているユーザー アカウントの権限でインストールが実行  </p><p>また、パッケージと違い、アプリケーションは “検出規則” や “置き換え” といった設定も可能です。  </p><h5 id="例-1-1"><a href="#例-1-1" class="headerlink" title="例 1"></a>例 1</h5><p>特定のフォルダーや特定のレジストリが存在する場合にインストール済みと判定させたい。  </p><h5 id="例-2-1"><a href="#例-2-1" class="headerlink" title="例 2"></a>例 2</h5><p>PowerShell のスクリプト実行結果を基にインストール済みと判定させたい。</p><h5 id="例-3-1"><a href="#例-3-1" class="headerlink" title="例 3"></a>例 3</h5><p>アプリ B を展開しようとしているが、既にアプリ A を展開済みで、かつアプリ A は古いバージョンのため、先にアプリ A をアンインストールしてからアプリ B をインストールさせたい。  </p><p>パッケージを使用するかアプリケーションを使用するか迷った際は、以下のブログも併せてご参照ください。<br><a href="https://jpmem.github.io/blog/mecm/20220608_02/">MECM パッケージとアプリケーションどっちを使うべき？違いを解説！</a>  </p><h3 id="タスクシーケンス"><a href="#タスクシーケンス" class="headerlink" title="タスクシーケンス"></a>タスクシーケンス</h3><p>OS のインストールからドメインへの参加、OS のアップグレードからパッケージ、アプリケーションのインストールなど一連のフローを 1 つにまとめて展開できる機能です。<br>主に以下のようなシナリオで活用可能です。  </p><h5 id="例-1-2"><a href="#例-1-2" class="headerlink" title="例 1"></a>例 1</h5><p>新しいクライアントに OS をインストールしてドメインへ参加後、Configuration Manager クライアントをインストールしたい。  </p><p>Title : Configuration Managerを使用して新しいコンピューター (ベア メタル) に新しいバージョンの Windows をインストールする<br>URL : <a href="https://learn.microsoft.com/ja-jp/mem/configmgr/osd/deploy-use/install-new-windows-version-new-computer-bare-metal">https://learn.microsoft.com/ja-jp/mem/configmgr/osd/deploy-use/install-new-windows-version-new-computer-bare-metal</a>  </p><h5 id="例-2-2"><a href="#例-2-2" class="headerlink" title="例 2"></a>例 2</h5><p>既存のクライアントの OS をアップグレードしたい。  </p><p>Title : 構成マネージャーを使用して Windows を最新バージョンにアップグレードする<br>URL : <a href="https://learn.microsoft.com/ja-jp/mem/configmgr/osd/deploy-use/upgrade-windows-to-the-latest-version">https://learn.microsoft.com/ja-jp/mem/configmgr/osd/deploy-use/upgrade-windows-to-the-latest-version</a>  </p><p>どのようなシナリオの場合でも、実行するタスクの順番や、どのようなタスクを組み込むかは自由であり、一度組み込んだタスクを無効とすること、実行する際の条件の設定を行うことも可能ですので、ぜひ一度お試しください。  </p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさま、こんにちは。Configuration Manager サポート チーム 山田 です。  &lt;/p&gt;
&lt;p&gt;本ブログの連載企画として Microsoft Configuration Manager の基本的なナレッジを、これから管理者となる方や導入を検討されている方</summary>
      
    
    
    
    
    <category term="MECM" scheme="https://jpmem.github.io/blog/tags/MECM/"/>
    
    <category term="ベーシック ナレッジ" scheme="https://jpmem.github.io/blog/tags/%E3%83%99%E3%83%BC%E3%82%B7%E3%83%83%E3%82%AF-%E3%83%8A%E3%83%AC%E3%83%83%E3%82%B8/"/>
    
  </entry>
  
</feed>
